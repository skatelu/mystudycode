/**
 * KJDP4.0.0
 * Copyright (c) 2009-2016 www.szkingdom.com. All rights reserved.
 */
define("lib/kui",["lib/kui/draggable","lib/kui/droppable","lib/kui/resizable","lib/kui/linkbutton","lib/kui/progressbar","lib/kui/statistics","lib/kui/localstorage","lib/kui/menu","lib/kui/calendar","lib/kui/validatebox","lib/kui/flowlite","lib/kui/mousewheel","lib/kui/sibar","lib/kui/uploadify","lib/kui/fieldset","lib/kui/obviousbox","lib/kui/scrollbox","lib/kui/slider","lib/kui/tree","lib/kui/panel","lib/kui/pagination","lib/kui/window","lib/kui/dialog","lib/kui/message","lib/kui/layout","lib/kui/tabs","lib/kui/accordion","lib/kui/combo","lib/kui/combobox","lib/kui/autocomplete","lib/kui/combotree","lib/kui/textinput","lib/kui/password","lib/kui/textarea","lib/kui/numberbox","lib/kui/spinner","lib/kui/numberspinner","lib/kui/timespinner","lib/kui/datebox","lib/kui/datetimebox","lib/kui/report","lib/kui/tpls/report-import-tpl","lib/kui/form","lib/kui/sform","lib/kui/datagrid","lib/kui/treegrid","lib/kui/propertygrid","lib/kui/combogrid"],function(a,b){b.kui={formatNumber:function(a){if(!/^(\+|-)?(\d+)(,\d{3})*(\.|\.\d+)?$/.test(a))return a;for(var b=/(\d)(\d{3})(,|$)/,c=RegExp.$1,d=RegExp.$2,e=RegExp.$4;b.test(d);)d=d.replace(b,"$1,$2$3");return c+""+d+e},valueReplace:function(a){return a?$("<div></div>").text($.trim(a+"")).html().replace(/\"/g,"&quot;"):""},getCurrDate:function(a,b){b=b||"";var c=new Date,d=c.getFullYear(),e=c.getMonth()+1,f=c.getDate();if(!a)return"";switch(a){case":month_first":f=1;break;case":month_last":var g=d,h=e;12==e&&(g+=1,h=1),f=32-new Date(g,h-1,32).getDate();break;case":week_last":f=7>=f?1:f-7;break;case":next_year":d+=1;break;case":curr_date":}return d+b+(10>e?"0"+e:e)+b+(10>f?"0"+f:f)},serialize2Json:function(a,b,c,d){function e(a){try{return decodeURIComponent(a)}catch(b){return a}}b=b||",",c=c||$.noop;var f,g,h,i={},j=a.split("&");return $.each(j,function(){if(f=this.indexOf("="),-1===f)return!0;if(g=this.substring(0,f),h=this.substring(f+1,this.length),g=e(g),h=e(h),h=c.call(a,g,h)||h,i[g]){var j=b,k=$(d).find($(d).find(".kui-combobox[comboname="+g+"]").length>0?".kui-combobox[comboname="+g+"]":"input[comboname="+g+"]");if(d&&k.length>0){var l=k.data("combo").options;j=l&&1==l.singleByte?"":l.submitSeparator||l.seperator||b}-1===_.indexOf(i[g].split(j),h)&&(i[g]=i[g]+j+h)}else i[g]=h}),$.each(i,function(a,b){var c=$(".kui-combobox[comboname="+a+"]",d);if(c.length>0){var e=c.data("combobox").options,f=c.combo("panel");if(e.atIsAll){var g=e.singleByte?"":e.submitSeparator||e.seperator||",",h=b.split(g);h.length==f.find(".combobox-item").length&&(i[a]="@")}}}),i},quickSort:function(a,b,c){if(a.length<=1)return a;for(var d=Math.floor(a.length/2),e=a[d],f=[],g=[],h=0;h<a.length;h++)if(h!=d){var i;i=c?-1==new String(a[h][b]).localeCompare(e[b]):new String(a[h][b])<e[b],i?f.push(a[h]):g.push(a[h])}return kui.quickSort(f,b).concat([e],kui.quickSort(g,b))},getSysDict:function(a,b){var c=a.indexOf("["),d=a.indexOf("]"),e=c>-1?a.substring(0,c):a,f=dict.getDictData(e).get(e);if(!b){var g=a.substring(c+1,d),h=[];if(g){var i="!"==g.substr(0,1),j=i?g.substr(1):g;f=_.filter(f,function(a){var b=a.DICT_ITEM.substr(0,j.length)==j;return i?!b:b})}return _.each(f,function(a){h.push({dict_val:a.DICT_ITEM,dict_des:a.DICT_ITEM_NAME})}),h}return f.isEmpty()?b:f.getTextByVal(b)}},$.fn._outerWidth=function(a){return void 0==a?this[0]==window?this.width()||document.body.clientWidth:this.outerWidth()||0:this.each(function(){$(this).width(!$.support.boxModel&&$.browser.msie?a:a-($(this).outerWidth()-$(this).width()))})},$.fn._outerHeight=function(a){return void 0==a?this[0]==window?this.height()||document.body.clientHeight:this.outerHeight()||0:this.each(function(){$(this).height(!$.support.boxModel&&$.browser.msie?a:a-($(this).outerHeight()-$(this).height()))})},$.fn._scrollLeft=function(a){return void 0==a?this.scrollLeft():this.each(function(){$(this).scrollLeft(a)})},$.fn._fit=function(a){a=void 0==a?!0:a;var b=this.parent()[0],c=this[0],d=b&&b.fcount||0;return a?c.fitted||(c.fitted=!0,b.fcount=d+1,$(b).addClass("panel-noscroll"),"BODY"==b.tagName&&$("html").addClass("panel-fit")):c.fitted&&(c.fitted=!1,b.fcount=d-1,0==b.fcount&&($(b).removeClass("panel-noscroll"),"BODY"==b.tagName&&$("html").removeClass("panel-fit"))),{width:$(b).width(),height:$(b).height()}},b.ajaxRequest=function(a){ajax.post(a).then(function(b){$.isFunction(a.func)&&a.func.apply(this,[b.getData(),b.getHead()])},function(){$.isFunction(a.error)&&a.error.apply(this,arguments)})},a("lib/kui/draggable"),a("lib/kui/droppable"),a("lib/kui/resizable"),a("lib/kui/linkbutton"),a("lib/kui/progressbar"),a("lib/kui/statistics"),a("lib/kui/localstorage"),a("lib/kui/menu"),a("lib/kui/calendar"),a("lib/kui/validatebox"),a("lib/kui/flowlite"),a("lib/kui/mousewheel"),a("lib/kui/sibar"),a("lib/kui/uploadify"),a("lib/kui/fieldset"),a("lib/kui/obviousbox"),a("lib/kui/scrollbox"),a("lib/kui/slider"),a("lib/kui/tree"),a("lib/kui/panel"),a("lib/kui/pagination"),a("lib/kui/window"),a("lib/kui/dialog"),b.message=a("lib/kui/message"),a("lib/kui/layout"),a("lib/kui/tabs"),a("lib/kui/accordion"),a("lib/kui/combo"),a("lib/kui/combobox"),a("lib/kui/autocomplete"),a("lib/kui/combotree"),a("lib/kui/textinput"),a("lib/kui/password"),a("lib/kui/textarea"),a("lib/kui/numberbox"),a("lib/kui/spinner"),a("lib/kui/numberspinner"),a("lib/kui/timespinner"),a("lib/kui/datebox"),a("lib/kui/datetimebox"),a("lib/kui/report"),a("lib/kui/form"),a("lib/kui/sform"),a("lib/kui/datagrid"),a("lib/kui/treegrid"),a("lib/kui/propertygrid"),a("lib/kui/combogrid"),$.fn.pagination&&$.fn.pagination.defaults&&($.fn.pagination.defaults.beforePageText="第",$.fn.pagination.defaults.afterPageText="共{pages}页",$.fn.pagination.defaults.displayMsg="显示{from}到{to},共{total}记录",$.fn.pagination.defaults.timeMsg="时间 {time}ms",$.fn.pagination.defaults.fallPageInfoFinish="加载完成，总共有{total}条记录",$.fn.pagination.defaults.fallPageInfoLoading="当前加载了0条记录",$.fn.pagination.defaults.fallPageInfoStart="还有数据未加载，当前加载了{total}条记录"),$.fn.datagrid&&$.fn.datagrid.defaults&&($.fn.datagrid.defaults.loadMsg="正在处理,请稍候..."),$.fn.reportgrid&&$.fn.reportgrid.defaults&&($.fn.reportgrid.defaults.loadMsg="正在处理,请稍候..."),$.fn.treegrid&&$.fn.treegrid.defaults&&$.fn.datagrid&&$.fn.datagrid.defaults&&($.fn.treegrid.defaults.loadMsg=$.fn.datagrid.defaults.loadMsg),$.message&&$.message.defaults&&($.message.defaults.ok="确定",$.message.defaults.cancel="取消"),$.fn.validatebox&&$.fn.validatebox.defaults&&$.fn.validatebox.defaults.rules&&($.fn.validatebox.defaults.missingMessage="该输入项为必输项",$.fn.validatebox.defaults.rules.email.message="请输入有效的电子邮件地址",$.fn.validatebox.defaults.rules.url.message="请输入有效的URL地址",$.fn.validatebox.defaults.rules.length.message="请输入 {0} 到 {1}个字符，1个中文算2个字符"),$.fn.numberbox&&$.fn.numberbox.defaults&&($.fn.numberbox.defaults.missingMessage="该输入项为必输项"),$.fn.combobox&&$.fn.combobox.defaults,$.fn.combotree&&$.fn.combotree.defaults&&($.fn.combotree.defaults.missingMessage="该输入项为必输项"),$.fn.combogrid&&$.fn.combogrid.defaults&&($.fn.combogrid.defaults.missingMessage="该输入项为必输项"),$.fn.calendar&&$.fn.calendar.defaults&&($.fn.calendar.defaults.weeks=["日","一","二","三","四","五","六"],$.fn.calendar.defaults.months=["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"]),$.fn.datebox&&$.fn.datebox.defaults&&($.fn.datebox.defaults.currentText="今天",$.fn.datebox.defaults.closeText="清空",$.fn.datebox.defaults.okText="确定",$.fn.datebox.defaults.missingMessage="该输入项为必输项"),$.fn.datetimebox&&$.fn.datetimebox.defaults&&$.fn.datebox&&$.fn.datebox.defaults&&$.extend($.fn.datetimebox.defaults,{currentText:$.fn.datebox.defaults.currentText,closeText:$.fn.datebox.defaults.closeText,okText:$.fn.datebox.defaults.okText,missingMessage:$.fn.datebox.defaults.missingMessage}),$.fn.uploadify&&$.fn.uploadify.defaults&&($.fn.uploadify.defaults.definedId="请为上传下载组件定义ID",$.fn.uploadify.defaults.definedType="请将上传下载组件的type定义为file",$.fn.uploadify.defaults.definedInput="请将上传下载组件定义为input标签",$.fn.uploadify.defaults.configFlash="请确认浏览器是否禁用了FLASH")}),define("lib/kui/draggable",[],function(){function a(a){var b=$.data(a.data.target,"draggable").options;if(!i)return!1;var c=a.data,d=c.startLeft+a.pageX-c.startX,e=c.startTop+a.pageY-c.startY;null!=b.deltaX&&void 0!=b.deltaX&&(d=a.pageX+b.deltaX),null!=b.deltaY&&void 0!=b.deltaY&&(e=a.pageY+b.deltaY),a.data.parent!=document.body&&(d+=$(a.data.parent).scrollLeft(),e+=$(a.data.parent).scrollTop()),"h"==b.axis?c.left=d:"v"==b.axis?c.top=e:(c.left=d,c.top=e)}function b(a){if(!i)return!1;var b=$.data(a.data.target,"draggable").options,c=$.data(a.data.target,"draggable").proxy;c||(c=$(a.data.target)),c.css({left:a.data.left,top:a.data.top}).show(),$("body").css("cursor",b.cursor)}function c(c){h=!0,i=!1;var d=$.data(c.data.target,"draggable").options;d.delay&&setTimeout(function(){i=!0},d.delay);var e=$(".droppable:visible").filter(function(){return c.data.target!=this}).filter(function(){var a=$.data(this,"droppable").options;if(1==a.disabled)return!1;var b=a.accept;return b?$(b).filter(function(){return this==c.data.target}).length>0:!0});$.data(c.data.target,"draggable").droppables=e;var f=$.data(c.data.target,"draggable").proxy;return f||(d.proxy?(f="clone"==d.proxy?$(c.data.target).clone():d.proxy.call(c.data.target,c.data.target),i||f.hide(),$.data(c.data.target,"draggable").proxy=f):f=$(c.data.target)),f.css("position","absolute"),a(c),b(c),d.onStartDrag.call(c.data.target,c),!1}function d(c){return a(c),0!=$.data(c.data.target,"draggable").options.onDrag.call(c.data.target,c)&&b(c),f($.data(c.data.target,"draggable").droppables,c,!0),!1}function e(b){function c(){e&&e.remove();var a=$.data(b.data.target,"draggable");a&&(a.proxy=null)}function d(){var a=!1;return $.each(f($.data(b.data.target,"draggable").droppables,b),function(){g.call(this,b)&&(j.revert&&$(b.data.target).css({position:b.data.startPosition,left:b.data.startLeft,top:b.data.startTop}),a=0==$(this).triggerHandler("_drop",[b.data.target])?!1:!0,this.entered=!1)}),a}h=!1,i=!1,a(b);var e=$.data(b.data.target,"draggable").proxy,j=$.data(b.data.target,"draggable").options;return j.revert?1==d()?(c(),$(b.data.target).css({position:b.data.startPosition,left:b.data.startLeft,top:b.data.startTop})):e?e.animate({left:b.data.startLeft,top:b.data.startTop},function(){c(),j.onRevert.call(b.data.target,b)}):$(b.data.target).animate({left:b.data.startLeft,top:b.data.startTop},function(){$(b.data.target).css("position",b.data.startPosition),j.onRevert.call(b.data.target,b)}):(d(),c()),j.onStopDrag.call(b.data.target,b),$(document).unbind(".draggable"),setTimeout(function(){$("body").css("cursor","")},100),!1}function f(a,b,c){function d(a){this.entered&&($(this).trigger("_dragleave",[a.data.target]),this.entered=!1)}function e(a){this.entered||($(this).trigger("_dragenter",[a.data.target]),this.entered=!0),$(this).trigger("_dragover",[a.data.target])}a=a||$();var f=a.filter(function(){return/\d/.test($(this).css("z-index"))?g.call(this,b)?!0:(c&&d.call(this,b),!1):!1}),h=$.makeArray(f);h.sort(function(a,b){var c=parseInt($(a).css("z-index")),d=parseInt($(b).css("z-index"));return c>d?-1:d>c?1:0});var i=[];return $.each(h,function(a,b){if(0===i.length)return i.push(b),!0;var c=parseInt($(b).css("z-index")),d=parseInt($(i[i.length-1]).css("z-index"));return d>c?!1:void i.push(b)}),c&&$.each(i,function(a,c){$.each(h,function(a,e){e!=c&&d.call(this,b)}),e.call(this,b)}),i.concat($.makeArray(a.filter(function(){return/\d/.test($(this).css("z-index"))?!1:g.call(this,b)?(c&&e.call(this,b),!0):(c&&d.call(this,b),!1)})))}function g(a){var b=$(this),c=b.offset();return a.pageX>c.left&&a.pageX<c.left+b._outerWidth()&&a.pageY>c.top&&a.pageY<c.top+b._outerHeight()}$.fn.draggable=function(a,b){return"string"==typeof a?$.fn.draggable.methods[a](this,b):this.each(function(){function b(a){if(!h){var b=$.data(a.data.target,"draggable").options;g(a)?$(this).css("cursor",b.cursor):$(this).css("cursor","")}}function f(a){if(0!=g(a)){var b=$.data(a.data.target,"draggable").options,f=b.offsetParent?$(a.data.target).position():$(a.data.target).offset(),h={startPosition:$(a.data.target).css("position"),startLeft:f.left,startTop:f.top,left:f.left,top:f.top,startX:a.pageX,startY:a.pageY,target:a.data.target,parent:$(a.data.target).parent()[0]};$.extend(a.data,h),0!=b.onBeforeDrag.call(a.data.target,a)&&($(document).unbind(".draggable"),$(document).bind("mousedown.draggable",a.data,c),$(document).bind("mousemove.draggable",a.data,d),$(document).bind("mouseup.draggable",a.data,e))}}function g(a){var b=$.data(a.data.target,"draggable");if(!b.isCheckArea)return!0;var c=b.handle,d=$(c).offset(),e=$(c)._outerWidth(),f=$(c)._outerHeight(),g=a.pageY-d.top,h=d.left+e-a.pageX,i=d.top+f-a.pageY,j=a.pageX-d.left;return Math.min(g,h,i,j)>b.options.edge}var i,j=$.data(this,"draggable");j?(j.handle.unbind(".draggable"),i=$.extend(j.options,a)):i=$.extend({},$.fn.draggable.defaults,$.fn.draggable.parseOptions(this),a||{});var k=null;return k="undefined"==typeof i.handle||null==i.handle?$(this):"string"==typeof i.handle?$(i.handle,this):i.handle,$.data(this,"draggable",{options:i,handle:k}),1==i.disabled?void $(this).css("cursor",""):void k.unbind(".draggable").bind("mousemove.draggable",{target:this},b).bind("mouseleave.draggable",{target:this},function(){$(this).css("cursor","")}).bind("mousedown.draggable",{target:this},f)})},$.fn.draggable.methods={options:function(a){return $.data(a[0],"draggable").options},proxy:function(a){return $.data(a[0],"draggable").proxy},enable:function(a){return a.each(function(){$(this).draggable({disabled:!1})})},disable:function(a){return a.each(function(){$(this).draggable({disabled:!0})})}},$.fn.draggable.parseOptions=function(a){var b=$(a);return $.extend({},$.parser.parseOptions(b,["cursor","handle","axis",{revert:"boolean",deltaX:"number",deltaY:"number",edge:"number"}]),{disabled:b.attr("disabled")?!0:void 0})},$.fn.draggable.defaults={offsetParent:!0,proxy:null,revert:!1,cursor:"move",deltaX:null,deltaY:null,handle:null,disabled:!1,delay:100,isCheckArea:!0,edge:0,axis:null,onBeforeDrag:function(){},onStartDrag:function(){},onDrag:function(){},onStopDrag:function(){},onRevert:function(){}};var h=!1,i=!1}),define("lib/kui/droppable",[],function(){function a(a){$(a).addClass("droppable"),$(a).bind("_dragenter",function(b,c){b.stopPropagation(),$.data(a,"droppable").options.onDragEnter.apply(a,[b,c])}),$(a).bind("_dragleave",function(b,c){b.stopPropagation(),$.data(a,"droppable").options.onDragLeave.apply(a,[b,c])}),$(a).bind("_dragover",function(b,c){b.stopPropagation(),$.data(a,"droppable").options.onDragOver.apply(a,[b,c])}),$(a).bind("_drop",function(b,c){return b.stopPropagation(),$.data(a,"droppable").options.onDrop.apply(a,[b,c])})}$.fn.droppable=function(b){return"string"==typeof b?$.fn.droppable.methods[b](this):(b=b||{},this.each(function(){var c=$.data(this,"droppable");c?$.extend(c.options,b):(a(this),$.data(this,"droppable",{options:$.extend({},$.fn.droppable.defaults,$.fn.droppable.parseOptions(this),b)}))}))},$.fn.droppable.methods={options:function(a){return $.data(a[0],"droppable").options},enable:function(a){return a.each(function(){$(this).droppable({disabled:!1})})},disable:function(a){return a.each(function(){$(this).droppable({disabled:!0})})}},$.fn.droppable.parseOptions=function(a){return $.extend({},$.parser.parseOptions(a,["accept"]))},$.fn.droppable.defaults={accept:null,onDragEnter:function(){},onDragOver:function(){},onDragLeave:function(){},onDrop:function(){}}}),define("lib/kui/resizable",[],function(){var a=!1;$.fn.resizable=function(b,c){function d(a){var b=a.data,c=$.data(b.target,"resizable").options;if(-1!=b.dir.indexOf("e")){var d=b.startWidth+a.pageX-b.startX;d=Math.min(Math.max(d,c.minWidth),c.maxWidth),b.width=d}if(-1!=b.dir.indexOf("s")){var e=b.startHeight+a.pageY-b.startY;e=Math.min(Math.max(e,c.minHeight),c.maxHeight),b.height=e}if(-1!=b.dir.indexOf("w")){var d=b.startWidth-a.pageX+b.startX;b.left=d>=c.minWidth&&d<=c.maxWidth?b.startLeft+a.pageX-b.startX:b.startLeft+b.startWidth-Math.min(c.minWidth,c.maxWidth),b.width=Math.min(Math.max(d,c.minWidth),c.maxWidth)}if(-1!=b.dir.indexOf("n")){var e=b.startHeight-a.pageY+b.startY;b.top=e>=c.minHeight&&e<=c.maxHeight?b.startTop+a.pageY-b.startY:b.startTop+b.startHeight-Math.min(c.minHeight,c.maxHeight),b.height=Math.min(Math.max(e,c.minHeight),c.maxHeight)}}function e(a){var b=a.data,c=b.target;$(c).css({left:b.left,top:b.top}),$(c)._outerWidth(b.width)._outerHeight(b.height)}function f(b){return a=!0,$.data(b.data.target,"resizable").options.onStartResize.call(b.data.target,b),!1}function g(a){return d(a),0!=$.data(a.data.target,"resizable").options.onResize.call(a.data.target,a)&&e(a),!1}function h(b){return a=!1,d(b,!0),e(b),$.data(b.data.target,"resizable").options.onStopResize.call(b.data.target,b),$(document).unbind(".resizable"),$("body").css("cursor",""),!1}return"string"==typeof b?$.fn.resizable.methods[b](this,c):this.each(function(){function c(a){var b=$(a.data.target),c="",e=b.offset(),f=b.outerWidth(),g=b.outerHeight(),h=d.edge;a.pageY>e.top&&a.pageY<e.top+h?c+="n":a.pageY<e.top+g&&a.pageY>e.top+g-h&&(c+="s"),a.pageX>e.left&&a.pageX<e.left+h?c+="w":a.pageX<e.left+f&&a.pageX>e.left+f-h&&(c+="e");for(var i=d.handles.split(","),j=0;j<i.length;j++){var k=i[j].replace(/(^\s*)|(\s*$)/g,"");if("all"==k||k==c)return c}return""}var d=null,e=$.data(this,"resizable");e?($(this).unbind(".resizable"),d=$.extend(e.options,b||{})):(d=$.extend({},$.fn.resizable.defaults,$.fn.resizable.parseOptions(this),b||{}),$.data(this,"resizable",{options:d})),1!=d.disabled&&$(this).bind("mousemove.resizable",{target:this},function(b){if(!a){var d=c(b);""==d?$(b.data.target).css("cursor",""):$(b.data.target).css("cursor",d+"-resize")}}).bind("mouseleave.resizable",{target:this},function(a){$(a.data.target).css("cursor","")}).bind("mousedown.resizable",{target:this},function(a){function b(b){var c=parseInt($(a.data.target).css(b));return isNaN(c)?0:c}var d=c(a);if(""!=d){var e={target:a.data.target,dir:d,startLeft:b("left"),startTop:b("top"),left:b("left"),top:b("top"),startX:a.pageX,startY:a.pageY,startWidth:$(a.data.target).outerWidth(),startHeight:$(a.data.target).outerHeight(),width:$(a.data.target).outerWidth(),height:$(a.data.target).outerHeight(),deltaWidth:$(a.data.target).outerWidth()-$(a.data.target).width(),deltaHeight:$(a.data.target).outerHeight()-$(a.data.target).height()};$(document).unbind(".resizable"),$(document).bind("mousedown.resizable",e,f),$(document).bind("mousemove.resizable",e,g),$(document).bind("mouseup.resizable",e,h),$("body").css("cursor",d+"-resize")}})})},$.fn.resizable.methods={options:function(a){return $.data(a[0],"resizable").options},enable:function(a){return a.each(function(){$(this).resizable({disabled:!1})})},disable:function(a){return a.each(function(){$(this).resizable({disabled:!0})})}},$.fn.resizable.parseOptions=function(a){var b=$(a);return $.extend({},$.parser.parseOptions(a,["handles",{minWidth:"number",minHeight:"number",maxWidth:"number",maxHeight:"number",edge:"number"}]),{disabled:b.attr("disabled")?!0:void 0})},$.fn.resizable.defaults={disabled:!1,handles:"n, e, s, w, ne, se, sw, nw, all",minWidth:10,minHeight:10,maxWidth:1e4,maxHeight:1e4,edge:5,onStartResize:function(){},onResize:function(){},onStopResize:function(){}}}),define("lib/kui/linkbutton",[],function(){function a(a){var c=$.data(a,"linkbutton").options;$(a).empty(),$(a).addClass("l-btn"),c.id?$(a).attr("id",c.id):$(a).attr("id",""),c.plain?$(a).addClass("l-btn-plain"):$(a).removeClass("l-btn-plain");var d=['<span class="l-btn-left"><span class="l-btn-text">'];if(c.iconCls){var e="";"right"==c.iconAlign&&(e='style="float:right;"'),d.push('<span class="ui-tool-icons '+c.iconCls+'" '+e+"></span>")}c.text&&d.push(c.text),d.push("</span></span>"),$(a).append(d.join("")),$(a).wrap("<div class='l-btn-wrap'>");var f=$("<div class='l-btn-disable-mask'></div>").insertAfter(a);f.attr("linkbutton-name",$(a).attr("name")||$(a).attr("id")),c.disableMask=f,c.btnWrap=$(a).parent(".l-btn-wrap"),c.btnWrap.append(f),$(a).unbind(".linkbutton").bind("focus.linkbutton",function(){c.disabled||$(this).find("span.l-btn-text").addClass("l-btn-focus")}).bind("blur.linkbutton",function(){$(this).find("span.l-btn-text").removeClass("l-btn-focus")}).bind("click.linkbutton",function(){c.onClick.call(this)}),b(a,c.disabled),window&&window.onbeforeunload&&$(a).unbind(".linkbutton").bind("click.linkbutton",function(){return!1}),c.hidden&&$(a).parent().hide()}function b(a,b){var c=$.data(a,"linkbutton");if(b){c.options.disabled=!0;var d=$(a).attr("href");d&&(c.href=d,$(a).attr("href","javascript:void(0)")),a.onclick&&(c.onclick=a.onclick,a.onclick=null),$(a).addClass("l-btn-disabled"),c.options.disableMask.show()}else c.options.disabled=!1,c.href&&$(a).attr("href",c.href),c.onclick&&(a.onclick=c.onclick),$(a).removeClass("l-btn-disabled"),c.options.disableMask.hide()}function c(a,b){if(b){var c=$(a),d=c.find("span.l-btn-text"),e=d.find("span.ui-tool-icons").clone();d.text(b),e.length&&d.prepend(e)}}function d(a,b){if(b){var c=$(a),d=c.find("span.ui-tool-icons");d.length?d.removeClass().addClass("ui-tool-icons "+b):c.find("span.l-btn-text").prepend('<span class="ui-tool-icons '+b+'"></span>')}}function e(a,b){var c=$(a);for(var d in b)switch(d){case"text":var e=c.find("span.l-btn-text"),f=e.find("span.ui-tool-icons").clone();e.text(b[d]),f.length&&e.prepend(f);break;case"iconCls":var f=c.find("span.ui-tool-icons");f.length?f.removeClass().addClass("ui-tool-icons "+b[d]):c.find("span.l-btn-text").prepend('<span class="ui-tool-icons '+b[d]+'"></span>')}}$.fn.linkbutton=function(b){if("string"==typeof b){var c=$.fn.linkbutton.methods[b];if(c)return c.apply(this,[this].concat(Array.prototype.slice.call(arguments,1)))}return this.each(function(){b=b||{};var c=$.data(this,"linkbutton");c?$.extend(c.options,b):($.data(this,"linkbutton",{options:$.extend({},$.fn.linkbutton.defaults,$.fn.linkbutton.parseOptions(this),b)}),$(this).removeAttr("disabled"),a(this))})},$.fn.linkbutton.methods={options:function(a){return $.data(a[0],"linkbutton").options},enable:function(a){return a.each(function(){b(this,!1)})},disable:function(a){return a.each(function(){b(this,!0)})},show:function(a){return a.each(function(){$(this).closest(".l-btn-wrap").show()})},hide:function(a){return a.each(function(){$(this).closest(".l-btn-wrap").hide()})},setText:function(a,b){return a.each(function(){c(this,b)})},setIcon:function(a,b){return a.each(function(){d(this,b)})},resetButtonStyle:function(a,b){return a.each(function(){e(this,b)})},destroy:function(a){return a.each(function(){$(this).parent("div.l-btn-wrap").remove()})}},$.fn.linkbutton.parseOptions=function(a){var b=$(a);return $.extend({},$.parser.parseOptions(a,["id","iconCls","iconAlign",{plain:"boolean"}]),{disabled:b.attr("disabled")?!0:void 0,text:$.trim(b.html())||void 0,iconCls:b.attr("icon")||b.attr("iconCls")||void 0})},$.fn.linkbutton.defaults={id:null,disabled:!1,hidden:!1,plain:!1,text:"",iconCls:null,iconAlign:"left",onClick:function(){}}}),define("lib/kui/progressbar",[],function(){function a(a){return $(a).addClass("progressbar"),$(a).html('<div class="progressbar-text"></div><div class="progressbar-value"><div class="progressbar-text"></div></div>'),$(a)}function b(a,b){var c=$.data(a,"progressbar").options,d=$.data(a,"progressbar").bar;b&&(c.width=b),d._outerWidth(c.width)._outerHeight(c.height),d.find("div.progressbar-text").width(d.width()),d.find("div.progressbar-text,div.progressbar-value").css({height:d.height()+"px",lineHeight:d.height()+"px"})}$.fn.progressbar=function(c,d){var e;if("string"==typeof c){var f=$.fn.progressbar.methods[c];if(f)return f(this,d)}return c=c||{},this.each(function(){e=$.data(this,"progressbar"),e?$.extend(e.options,c):e=$.data(this,"progressbar",{options:$.extend({},$.fn.progressbar.defaults,$.fn.progressbar.parseOptions(this),c),bar:a(this)}),$(this).progressbar("setValue",e.options.value),b(this)})},$.fn.progressbar.methods={options:function(a){return $.data(a[0],"progressbar").options},resize:function(a,c){return a.each(function(){b(this,c)})},getValue:function(a){return $.data(a[0],"progressbar").options.value},setValue:function(a,b){return 0>b&&(b=0),b>100&&(b=100),a.each(function(){var a=$.data(this,"progressbar").options,c=a.text.replace(/{value}/,b),d=a.value;a.value=b,$(this).find("div.progressbar-value").width(b+"%"),$(this).find("div.progressbar-text").html(c),d!=b&&a.onChange.call(this,b,d)})}},$.fn.progressbar.parseOptions=function(a){return $.extend({},$.parser.parseOptions(a,["width","height","text",{value:"number"}]))},$.fn.progressbar.defaults={width:"auto",height:22,value:0,text:"{value}%",onChange:function(){}}}),define("lib/kui/statistics",[],function(require,exports,module){function isShowPanel(a,b){var c=$.data(a,"statistics");if(!c)return alert("无数据统计！"),!1;var d=c.options,e=d.dc.view.find(".datagrid-footer");b?e.show():e.hide(),d.onLoaded.call(a)}function refresh(a){var b=$.data(a,"statistics"),c=b.options;c.refreshed=!1,createPanel(a)}function getAnalyzeData(a,b,c){{var d=getStatisticsType(a),e=$.data(a,"datagrid").options,f=$.Deferred(),g=e.reportParams&&void 0!==e.reportParams.R_LAST_SN&&void 0!==e.reportParams.R_COUNT?!0:!1,h=g?e.reportParams:{R_LAST_SN:0,R_COUNT:e.pageSize*e.pageNumber};Number(h.R_COUNT),Number(h.R_LAST_SN),$.data(a,"statistics").options.arrStatRow||[],g?$.extend([],$.data(a,"datagrid").appendRows):$.extend([],$.data(a,"datagrid").options.originalRowsData)}if("undefined"==typeof Worker||!e.pagination){for(var i=0;i<c.length;i++)for(var j=c[i],k=j.field,l={},m=0;m<b.length;m++){var n=b[m];if($.isNumeric(n[k]))for(var o in d)if(j[o]){var p=d[o].getValue(l,b,n,k,m);m==b.length-1&&d[o].item.push({field:j.field,title:j.title,formatter:j[o+"formatter"],value:isNaN(p)?p+"":Number(p).toFixed(j.fixNum||2)})}}return $.when(d)}return f.promise()}function createPanel(target){var data=$.data(target,"statistics"),opts=data.options,columns=opts.columns,rows=opts.rows,dc=opts.dc,fields=opts.fields,statisField=[],$statistics=dc.view.nextAll(".datagrid-row-statistics"),dataFormatter={};if($statistics.length>0)if($statistics.is(":hidden")){if(opts.refreshed)return $statistics.show(),opts.onLoaded.call(target),!1;$statistics.remove()}else $statistics.remove();var analyzePromise=getAnalyzeData(target,rows,columns),index=0,statistics=[],statistics_title=[],gridOpts=$.data(target,"datagrid").options;analyzePromise.done(function(analyzeData){statistics.push('<table class="datagrid-ftable" cellspacing="0" cellpadding="0" border="0"><tbody>'),statistics_title.push('<table class="datagrid-ftable" cellspacing="0" cellpadding="0" border="0"><tbody>');for(var key in analyzeData)if(analyzeData[key].item.length>0){statistics.push('<tr class="datagrid-header-row" datagrid-row-index="'+index+'">'),statistics_title.push('<tr class="datagrid-header-row" datagrid-row-index="'+index+'">');for(var row={},stsDescField,stsDescFieldIndex=opts.stsDescFieldIndex,i=0;i<analyzeData[key].item.length;i++){var item=analyzeData[key].item[i],value=item.value,field=item.field,formatter=item.formatter;"string"==typeof formatter&&eval("formatter="+formatter),$.isFunction(formatter)&&(value=formatter.call(null,value)),row[field]=value}if(stsDescFieldIndex>=fields.length&&(stsDescFieldIndex=fields.length-1),stsDescField=fields[stsDescFieldIndex],stsDescField=opts.columns.length===fields.length?opts.columns[stsDescFieldIndex].field:opts.columns[fields.length+stsDescFieldIndex].field,gridOpts.rownumbers||opts.columns.length!==fields.length)if(gridOpts.rownumbers)statistics_title.push("<td><div class='datagrid-cell-rownumber datagrid-cell'>"+analyzeData[key].name+"</div></td>"),$.each(gridOpts.frozenColumns[0]||[],function(a,b){statistics_title.push("checkbox"===b.type?"<td title='' field='"+b.field+"'><div style='font-weight: bolder;' class='datagrid-cell-check'></div></td>":"<td title='"+(b[key]?value:"")+"' field='"+b.field+"'><div style='text-align:"+(b.align?b.align:"left")+";font-weight:bolder;' class='datagrid-cell datagrid-cell-c1-"+b.field+"'>"+(b[key]?value:"")+"</div></td>")});else{var firstField=0,frozenColNum=gridOpts.frozenColumns[0].length-1;$.each(gridOpts.frozenColumns[0]||[],function(a,b){"checkbox"===b.type?(frozenColNum>firstField&&firstField++,statistics_title.push("<td title='' field='"+b.field+"'><div style='font-weight: bolder;' class='datagrid-cell-check'>"+(a===firstField?analyzeData[key].name:b[key]?value:"")+"</div></td>")):statistics_title.push("<td title='"+(b[key]?value:"")+"' field='"+b.field+"'><div style='text-align:"+(b.align?b.align:"left")+";font-weight:bolder;' class='datagrid-cell datagrid-cell-c1-"+b.field+"'>"+(a===firstField?analyzeData[key].name:b[key]?value:"")+"</div></td>")})}else row[stsDescField]=analyzeData[key].name;statisField=_.chain(fields).reject(function(a){var b=!1,c=$(target).datagrid("getColumnOption",a);return $.each(analyzeData[key].item,function(c,d){a==d.field&&(b=!0)}),b||c.formatter&&(dataFormatter[a]=c.formatter,c.formatter="",b=!1),"checkbox"===c.type&&statistics.push("<td title='' field='"+a+"'><div style='font-weight: bolder;' class='datagrid-cell-check'>"+(a in row?row[a]:"")+"</div></td>"),"checkbox"===c.type}).value(),statistics.push(opts.view.renderRow.call(this,target,statisField,!1,index,row)),statistics.push("</tr>"),statistics_title.push("</tr>"),index++}$.isEmptyObject(dataFormatter)||($.each(dataFormatter,function(a,b){$(target).datagrid("getColumnOption",a).formatter=b}),dataFormatter={}),statistics.push("</tbody></table>"),statistics_title.push("</tbody></table>");var footer=dc.view.find(".datagrid-view2").find(".datagrid-footer-inner"),footer_title=dc.view.find(".datagrid-view1").find(".datagrid-footer-inner");footer_title.empty(),footer.empty(),$(statistics.join("")).appendTo(footer),$(statistics_title.join("")).appendTo(footer_title),footer.show(),footer_title.show(),opts.refreshed=!0,opts.onLoaded.call(target)})}function getStatisticsType(a){var b=$.data(a,"statistics"),c=b.options,d=c.statisticsTexts||[];return{max:{name:d[0]||"最大值",item:[],getValue:function(a,b,c,d,e){return getMax(a,b,c,d,e)}},min:{name:d[1]||"最小值",item:[],getValue:function(a,b,c,d,e){return getMin(a,b,c,d,e)}},avg:{name:d[2]||"均值",item:[],getValue:function(a,b,c,d,e){return getAvg(a,b,c,d,e)}},sum:{name:d[3]||"合计",item:[],getValue:function(a,b,c,d,e){return getSum(a,b,c,d,e)}}}}function getMax(a,b,c,d){var e="max"+d,f=Number(c[d]),g=a[e]||0;return f>g&&(a[e]=f),a[e]}function getMin(a,b,c,d){var e="min"+d,f=Number(c[d]),g=a[e]||c[d];return g>=f&&(a[e]=f),a[e]}function getAvg(a,b,c,d,e){var f="avg"+d,g=a[f]||0;return a[f]=g+1*c[d],b.length-1==e&&(a[f]=a[f]/b.length),a[f]}function getSum(a,b,c,d){var e="sum"+d,f=a[e]||0;return a[e]=f+1*c[d],a[e]}function caculateCharLength(a){a+="";var b=0;if(!a||""==a)return b;for(i=0;i<a.length;i++)b+=a.charCodeAt(i)>256?14:a.charCodeAt(i)<65?8:9;return b}$.fn.statistics=function(a,b){return"string"==typeof a?$.fn.statistics.methods[a](this,b):(a=a||{},this.each(function(){var b=$.data(this,"statistics");b?$.extend(b.options,a):$.data(this,"statistics",{options:$.extend({},$.fn.statistics.defaults,$.fn.statistics.parseOptions(this),a)}),createPanel(this)}))},$.fn.statistics.methods={options:function(a){return $.data(a[0],"statistics").options},showPanel:function(a){return a.each(function(){isShowPanel(this,!0)})},hidePanel:function(a){return a.each(function(){isShowPanel(this,!1)})},refresh:function(a){return a.each(function(){refresh(this)})}},$.fn.statistics.parseOptions=function(a){return $.extend({},$.parser.parseOptions(a))},$.fn.statistics.defaults={columns:void 0,refreshed:!0,rows:void 0,dc:void 0,onLoaded:function(){}}}),define("lib/kui/localstorage",[],function(){var a,b=!0,c="kjdp_";"undefined"==typeof localStorage||"unknown"==typeof localStorage?b=!1:a=localStorage,$.ls=$.fn.localstorage=function(d,e){if(!b)return!1;var f=/\/([^\/]*)$/.exec(location.href.replace(/&_=[\.0-9]*$/,""))[1],g=c+utils.md5(f+"_"+d);return"undefined"==typeof e?JSON.parse(a.getItem(g)):void(null==e?a.removeItem(g):a.setItem(g,JSON.stringify(e)))
},$.ls.clear=function(){if(!b)return!1;for(var d in localStorage)0==d.indexOf(c)&&a.removeItem(d);return!0}}),define("lib/kui/menu",[],function(require,exports,module){function init(a){function b(c){var d=[];return c.addClass("menu"),c[0].style.width||(c[0].autowidth=!0),d.push(c),c.hasClass("menu-content")||c.children("div").each(function(){var c=$(this).children("div");if(c.length){c.insertAfter(a),this.submenu=c;var e=b(c);d=d.concat(e)}}),d}function c(b){b.hasClass("menu-content")||(b.children("div").each(function(){var b=$(this);if(!b.hasClass("menu-sep")){var c=$.extend({},$.parser.parseOptions(this,["name","iconCls","href"]),{disabled:b.attr("disabled")?!0:void 0});b.attr("name",c.name||"").attr("href",c.href||"");var d=b.addClass("menu-item").html();b.empty().append($('<div class="menu-text"></div>').html(d)),c.iconCls&&$('<div class="menu-icon ui-tool-icons"></div>').addClass(c.iconCls).appendTo(b),c.disabled&&setDisabled(a,b[0],!0),b[0].submenu&&$('<div class="menu-rightarrow"></div>').appendTo(b),bindMenuItemEvent(a,b)}}),$('<div class="menu-line"></div>').prependTo(b)),setMenuWidth(a,b),b.hide(),bindMenuEvent(a,b)}$(a).appendTo("body"),$(a).addClass("menu-top"),$(document).unbind(".menu").bind("mousedown.menu",function(a){var b=$("body>div.menu:visible"),c=$(a.target).closest("div.menu",b);c.length||$("body>div.menu-top:visible").menu("hide")});for(var d=b($(a)),e=0;e<d.length;e++)c(d[e])}function setMenuWidth(a,b){var c=$.data(a,"menu").options,d=b.css("display");b.css({display:"block",left:-1e4});var e=b._outerWidth(),f=0;b.find("div.menu-text").each(function(){f<$(this)._outerWidth()&&(f=$(this)._outerWidth())}),b._outerWidth(Math.max(e,f,c.minWidth)),b.css("display",d)}function bindMenuEvent(a,b){var c=$.data(a,"menu");b.unbind(".menu").bind("mouseenter.menu",function(){c.timer&&(clearTimeout(c.timer),c.timer=null)}).bind("mouseleave.menu",function(){c.timer=setTimeout(function(){hideAll(a)},100)})}function bindMenuItemEvent(a,b){b.unbind(".menu"),b.bind("click.menu",function(){if(!$(this).hasClass("menu-item-disabled")){var b=$(a).menu("getItem",this);if($.data(a,"menu").options.onClick.call(a,b),!this.submenu){hideAll(a);var c=$(this).attr("href");c&&(location.href=c)}}}).bind("mouseenter.menu",function(){if(b.siblings().each(function(){this.submenu&&hideMenu(this.submenu),$(this).removeClass("menu-active")}),b.addClass("menu-active"),$(this).hasClass("menu-item-disabled"))return void b.addClass("menu-active-disabled");var c=b[0].submenu;c&&$(a).menu("show",{menu:c,parent:b})}).bind("mouseleave.menu",function(a){b.removeClass("menu-active menu-active-disabled");var c=b[0].submenu;c?a.pageX>=parseInt(c.css("left"))?b.addClass("menu-active"):hideMenu(c):b.removeClass("menu-active")})}function hideAll(a){var b=$.data(a,"menu");return b&&$(a).is(":visible")&&(hideMenu($(a)),b.options.onHide.call(a)),!1}function showMenu(a,b){var c,d,e=$(b.menu||a);if(e.hasClass("menu-top")){var f=$.data(a,"menu").options;if(c=f.left,d=f.top,b.alignTo){var g=$(b.alignTo);c=g.offset().left,d=g.offset().top+g._outerHeight()}void 0!=b.left&&(c=b.left),void 0!=b.top&&(d=b.top),c+e.outerWidth()>$(window)._outerWidth()+$(document)._scrollLeft()&&(c=$(window)._outerWidth()+$(document).scrollLeft()-e.outerWidth()-5),d+e.outerHeight()>$(window)._outerHeight()+$(document).scrollTop()&&(d-=e.outerHeight())}else{var h=b.parent;c=h.offset().left+h.outerWidth()-2,c+e.outerWidth()+5>$(window)._outerWidth()+$(document).scrollLeft()&&(c=h.offset().left-e.outerWidth()+2);var d=h.offset().top-3;d+e.outerHeight()>$(window)._outerHeight()+$(document).scrollTop()&&(d=$(window)._outerHeight()+$(document).scrollTop()-e.outerHeight()-5)}e.css({left:c,top:d}),e.show(0,function(){e[0].shadow||(e[0].shadow=$('<div class="menu-shadow"></div>').insertAfter(e)),e[0].shadow.css({display:"block",zIndex:$.fn.menu.defaults.zIndex++,left:e.css("left"),top:e.css("top"),width:e.outerWidth(),height:e.outerHeight()}),e.css("z-index",$.fn.menu.defaults.zIndex++),e.hasClass("menu-top")&&$.data(e[0],"menu").options.onShow.call(e[0])})}function hideMenu(a){function b(a){a.stop(!0,!0),a[0].shadow&&a[0].shadow.hide(),a.hide()}a&&(b(a),a.find("div.menu-item").each(function(){this.submenu&&hideMenu(this.submenu),$(this).removeClass("menu-active")}))}function findItem(a,b){function c(f){f.children("div.menu-item").each(function(){var f=$(a).menu("getItem",this),g=e.empty().html(f.text).text();b==$.trim(g)?d=f:this.submenu&&!d&&c(this.submenu)})}var d=null,e=$("<div></div>");return c($(a)),e.remove(),d}function setDisabled(a,b,c){var d=$(b);c?(d.addClass("menu-item-disabled"),b.onclick&&(b.onclick1=b.onclick,b.onclick=null)):(d.removeClass("menu-item-disabled"),b.onclick1&&(b.onclick=b.onclick1,b.onclick1=null))}function appendItem(target,param){var menu=$(target);if(param.parent){if(!param.parent.submenu){var submenu=$('<div class="menu"><div class="menu-line"></div></div>').appendTo("body");submenu[0].autowidth=!0,submenu.hide(),param.parent.submenu=submenu,$('<div class="menu-rightarrow"></div>').appendTo(param.parent)}menu=param.parent.submenu}var item=$('<div class="menu-item"></div>').appendTo(menu);$('<div class="menu-text"></div>').html(param.text).appendTo(item),param.iconCls&&$('<div class="menu-icon ui-tool-icons"></div>').addClass(param.iconCls).appendTo(item),param.id&&item.attr("id",param.id),param.href&&item.attr("href",param.href),param.name&&item.attr("name",param.name),param.onclick&&("string"==typeof param.onclick?item.attr("onclick",param.onclick):item[0].onclick=eval(param.onclick)),param.handler&&(item[0].onclick=eval(param.handler)),bindMenuItemEvent(target,item),param.disabled&&setDisabled(target,item[0],!0),bindMenuEvent(target,menu),setMenuWidth(target,menu)}function removeItem(a,b){function c(a){if(a.submenu){a.submenu.children("div.menu-item").each(function(){c(this)});var b=a.submenu[0].shadow;b&&b.remove(),a.submenu.remove()}$(a).remove()}c(b)}function destroyMenu(a){$(a).children("div.menu-item").each(function(){removeItem(a,this)}),a.shadow&&a.shadow.remove(),$(a).remove()}$.fn.menu=function(a,b){return"string"==typeof a?$.fn.menu.methods[a](this,b):(a=a||{},this.each(function(){var b=$.data(this,"menu");b?$.extend(b.options,a):(b=$.data(this,"menu",{options:$.extend({},$.fn.menu.defaults,$.fn.menu.parseOptions(this),a)}),init(this)),$(this).css({left:b.options.left,top:b.options.top})}))},$.fn.menu.methods={options:function(a){return $.data(a[0],"menu").options},show:function(a,b){return a.each(function(){showMenu(this,b)})},hide:function(a){return a.each(function(){hideAll(this)})},destroy:function(a){return a.each(function(){destroyMenu(this)})},setText:function(a,b){return a.each(function(){$(b.target).children("div.menu-text").html(b.text)})},setIcon:function(a,b){return a.each(function(){var a=$(this).menu("getItem",b.target);a.iconCls?$(a.target).children("div.menu-icon").removeClass(a.iconCls).addClass(b.iconCls):$('<div class="menu-icon ui-tool-icons"></div>').addClass(b.iconCls).appendTo(b.target)})},getItem:function(a,b){var c=$(b),d={target:b,id:c.attr("id"),text:$.trim(c.children("div.menu-text").html()),disabled:c.hasClass("menu-item-disabled"),href:c.attr("href"),name:c.attr("name"),onclick:b.onclick},e=c.children("div.menu-icon");if(e.length){for(var f=[],g=e.attr("class").split(" "),h=0;h<g.length;h++)"menu-icon"!=g[h]&&f.push(g[h]);d.iconCls=f.join(" ")}return d},findItem:function(a,b){return findItem(a[0],b)},appendItem:function(a,b){return a.each(function(){appendItem(this,b)})},removeItem:function(a,b){return a.each(function(){removeItem(this,b)})},enableItem:function(a,b){return a.each(function(){setDisabled(this,b,!1)})},disableItem:function(a,b){return a.each(function(){setDisabled(this,b,!0)})}},$.fn.menu.parseOptions=function(a){return $.extend({},$.parser.parseOptions(a,["left","top",{minWidth:"number"}]))},$.fn.menu.defaults={zIndex:11e4,left:0,top:0,minWidth:120,onShow:function(){},onHide:function(){},onClick:function(){}}}),define("lib/kui/calendar",[],function(){function a(a){var b=$.data(a,"calendar").options,c=$(a);if(1==b.fit){var d=c.parent();b.width=d.width(),b.height=d.height()}var e=c.find(".calendar-header");c._outerWidth(b.width),c._outerHeight(b.height);var f=$(a).find(".calendar-body"),g=$(a).find(".calendar-menu"),h=g.find(".calendar-menu-year-inner"),i=g.find(".calendar-menu-month-inner");f._outerHeight(c.height()-e._outerHeight()),g._outerWidth(f._outerWidth()),g._outerHeight(f._outerHeight()),i._outerHeight(g.height()-h._outerHeight()-(b.selectDay?20:0))}function b(b){var e=$.data(b,"calendar").options;$(b).addClass("calendar").wrapInner('<div class="calendar-header"><div class="calendar-prevmonth"></div><div class="calendar-nextmonth"></div><div class="calendar-prevyear"></div><div class="calendar-nextyear"></div><div class="calendar-title"><span>Aprial 2010</span></div></div><div class="calendar-body"><div class="calendar-menu"><div class="calendar-menu-year-inner"><span class="calendar-menu-prev"></span><span><input class="calendar-menu-year" type="text"/></span><span class="calendar-menu-next"></span></div><div class="calendar-menu-month-inner"></div></div></div>');for(var g=$("<table></table>").appendTo($(b).find(".calendar-menu-month-inner")),h=0,i=0;3>i;i++)for(var j=$("<tr></tr>").appendTo(g),k=0;4>k;k++)$('<td class="calendar-menu-month"></td>').html(e.months[h++]).attr("abbr",h).appendTo(j);$(b).find(".calendar-menu-prev,.calendar-menu-next").hover(function(){$(this).addClass("calendar-menu-hover")},function(){$(this).removeClass("calendar-menu-hover")}),$(b).find(".calendar-menu-next").click(function(){var a=$(b).find(".calendar-menu-year"),c=""==a.val()?e.year:a.val();isNaN(c)||a.val(parseInt(c)+1)}),$(b).find(".calendar-menu-prev").click(function(){var a=$(b).find(".calendar-menu-year"),c=""==a.val()?e.year:a.val();isNaN(c)||a.val(parseInt(c)-1)}),$(b).find(".calendar-menu-year").textinput({maxLength:4}),$(b).find(".calendar-menu-year").keypress(function(a){13==a.keyCode&&setDate();var b=event.keyCode;event.returnValue=b>=48&&57>=b?!0:!1}),$(b).find(".calendar-menu-month").hover(function(){$(this).addClass("calendar-menu-hover")},function(){$(this).removeClass("calendar-menu-hover")}).click(function(){function a(){var a=$(b).find(".calendar-menu"),c=a.find(".calendar-menu-year").val();""==c?c=e.year:c;var d=a.find(".calendar-selected").attr("abbr");isNaN(c)||(e.year=parseInt(c),e.month=parseInt(d),e.selectDay&&f(b)),e.selectDay&&a.hide()}var c=$(b).find(".calendar-menu");c.find(".calendar-selected").removeClass("calendar-selected"),$(this).addClass("calendar-selected"),a(),e.selectDay||e.onSelect.call(b,new Date(e.year,parseInt(e.month)-1))});var l=$(b).find(".calendar-menu"),m=l.find(".calendar-menu-year-inner"),n=l.find(".calendar-menu-month-inner");m.find("input").val(e.year).focus(),n.find("td.calendar-selected").removeClass("calendar-selected"),n.find("td:eq("+(e.month-1)+")").addClass("calendar-selected"),$(b).find(".calendar-title span").hover(function(){$(this).addClass("calendar-menu-hover")},function(){$(this).removeClass("calendar-menu-hover")}).click(function(){if(e.selectDay){var a=$(b).find(".calendar-menu");a.is(":visible")?a.hide():a.show()}}),$(".calendar-prevmonth,.calendar-nextmonth,.calendar-prevyear,.calendar-nextyear",b).hover(function(){$(this).addClass("calendar-nav-hover")},function(){$(this).removeClass("calendar-nav-hover")}),$(b).find(".calendar-nextmonth").click(function(){c(b,1)}),$(b).find(".calendar-prevmonth").click(function(){c(b,-1)}),$(b).find(".calendar-nextyear").click(function(){d(b,1)}),$(b).find(".calendar-prevyear").click(function(){d(b,-1)}),$(b).bind("_resize",function(){return 1==e.fit&&a(b),!1})}function c(a,b){var c=$.data(a,"calendar").options;c.month+=b,c.month>12?(c.year++,c.month=1):c.month<1&&(c.year--,c.month=12),f(a);var d=$(a).find(".calendar-menu-month-inner");d.find("td.calendar-selected").removeClass("calendar-selected"),d.find("td:eq("+(c.month-1)+")").addClass("calendar-selected"),c.onClick.call()}function d(a,b){var c=$.data(a,"calendar").options;c.year+=b,f(a);var d=$(a).find(".calendar-menu-year");d.val(c.year),c.onClick.call()}function e(a,b,c){for(var d=$.data(a,"calendar").options,e=[],f=new Date(b,c,0).getDate(),g=1;f>=g;g++)e.push([b,c,g]);for(var h=[],i=[],j=-1;e.length>0;){var k=e.shift();i.push(k);var l=new Date(k[0],k[1]-1,k[2]).getDay();j==l?l=0:l==(0==d.firstDay?7:d.firstDay)-1&&(h.push(i),i=[]),j=l}i.length&&h.push(i);var m=h[0];if(m.length<7)for(;m.length<7;){var n=m[0],k=new Date(n[0],n[1]-1,n[2]-1);m.unshift([k.getFullYear(),k.getMonth()+1,k.getDate()])}else{for(var n=m[0],i=[],g=1;7>=g;g++){var k=new Date(n[0],n[1]-1,n[2]-g);i.unshift([k.getFullYear(),k.getMonth()+1,k.getDate()])}h.unshift(i)}for(var o=h[h.length-1];o.length<7;){var p=o[o.length-1],k=new Date(p[0],p[1]-1,p[2]+1);o.push([k.getFullYear(),k.getMonth()+1,k.getDate()])}if(h.length<6){for(var p=o[o.length-1],i=[],g=1;7>=g;g++){var k=new Date(p[0],p[1]-1,p[2]+g);i.push([k.getFullYear(),k.getMonth()+1,k.getDate()])}h.push(i)}return h}function f(a){var b=$.data(a,"calendar").options;$(a).find(".calendar-title span").html(b.months[b.month-1]+" "+b.year);var c=$(a).find("div.calendar-body");c.find(">table").remove();for(var d=['<table cellspacing="0" cellpadding="0" border="0"><thead><tr>'],f=b.firstDay;f<b.weeks.length;f++)d.push("<th>"+b.weeks[f]+"</th>");for(var f=0;f<b.firstDay;f++)d.push("<th>"+b.weeks[f]+"</th>");d.push("</thead><tbody>");for(var j=e(a,b.year,b.month),f=0;f<j.length;f++){var k=j[f];d.push("<tr>");for(var l=0;l<k.length;l++){var m=k[l];if(b.year==m[0]&&b.month==m[1]){var n=m[0]+","+m[1]+","+m[2];d.push('<td class="calendar-day" abbr="'+n+'">'+m[2]+"</td>")}else d.push('<td class="calendar-other-month" abbr=""></td>')}d.push("</tr>")}d.push("</tbody></table>");var o=$(d.join(""));o.prependTo(c);var p=new Date,q=p.getFullYear()+","+(p.getMonth()+1)+","+p.getDate();if(o.find('td[abbr="'+q+'"]').addClass("calendar-today"),b.current){o.find(".calendar-selected").removeClass("calendar-selected");var r=b.current.getFullYear()+","+(b.current.getMonth()+1)+","+b.current.getDate();o.find('td[abbr="'+r+'"]').addClass("calendar-selected")}var s=6-b.firstDay,t=s+1;s>=7&&(s-=7),t>=7&&(t-=7),o.find("tr").find("td:eq("+s+")").addClass("calendar-saturday"),o.find("tr").find("td:eq("+t+")").addClass("calendar-sunday"),o.find("td[class*='calendar-day']").hover(function(){$(this).addClass("calendar-hover")},function(){$(this).removeClass("calendar-hover")}).click(function(){o.find(".calendar-selected").removeClass("calendar-selected"),$(this).addClass("calendar-selected");var c=$(this).attr("abbr").split(",");b.current=new Date(c[0],parseInt(c[1])-1,c[2]),b.onSelect.call(a,b.current)}),""!=b.min&&null!=g(b.min)&&h(a,o,g(b.min)),""!=b.max&&null!=g(b.max)&&i(a,o,g(b.max))}function g(a){var b=/(\d{4})\W?(\d{2})\W?(\d{2})/,c=b.exec(a);if(null==c)return null;var d=parseInt(c[1],10),e=parseInt(c[2],10),f=parseInt(c[3],10);return isNaN(d)||isNaN(e)||isNaN(f)?null:new Date(d,e-1,f)}function h(a,b,c){var d=null==c?0:c.getTime(),e=$.data(a,"calendar").options;b.find("td").each(function(){if(""!=$(this).attr("abbr")){var c=$(this).attr("abbr").split(","),f=new Date(c[0],c[1]-1,c[2]);d>f.getTime()?$(this).addClass("calendar-no-min").unbind():$(this).hasClass("calendar-no-min")&&($(this).removeClass("calendar-no-min"),$(this).hover(function(){$(this).addClass("calendar-hover")},function(){$(this).removeClass("calendar-hover")}).click(function(){b.find(".calendar-selected").removeClass("calendar-selected"),$(this).addClass("calendar-selected");var c=$(this).attr("abbr").split(",");e.current=new Date(c[0],parseInt(c[1])-1,c[2]),e.onSelect.call(a,e.current)}))}})}function i(a,b,c){var d=null==c?0:c.getTime(),e=$.data(a,"calendar").options;b.find("td").each(function(){if(""!=$(this).attr("abbr")){var c=$(this).attr("abbr").split(","),f=new Date(c[0],c[1]-1,c[2]);d<f.getTime()?$(this).addClass("calendar-no-max").unbind():$(this).hasClass("calendar-no-max")&&($(this).removeClass("calendar-no-max"),$(this).hover(function(){$(this).addClass("calendar-hover")},function(){$(this).removeClass("calendar-hover")}).click(function(){b.find(".calendar-selected").removeClass("calendar-selected"),$(this).addClass("calendar-selected");var c=$(this).attr("abbr").split(",");e.current=new Date(c[0],parseInt(c[1])-1,c[2]),e.onSelect.call(a,e.current)}))}})}$.fn.calendar=function(c,d){return"string"==typeof c?$.fn.calendar.methods[c](this,d):(c=c||{},this.each(function(){var d=$.data(this,"calendar");d?$.extend(d.options,c):(d=$.data(this,"calendar",{options:$.extend({},$.fn.calendar.defaults,$.fn.calendar.parseOptions(this),c)}),b(this)),0==d.options.border&&$(this).addClass("calendar-noborder"),a(this),f(this),d.options.selectDay?$(this).find("div.calendar-menu").hide():($(this).find("div.calendar-menu").show(),$(this).find(".calendar-body >table:first").hide())}))},$.fn.calendar.methods={options:function(a){return $.data(a[0],"calendar").options},resize:function(b){return b.each(function(){a(this)})},moveTo:function(a,b){return a.each(function(){$(this).calendar({year:b.getFullYear(),month:b.getMonth()+1,current:b})})},setMaxDate:function(a,b){return a.each(function(){var c=$(this).find("div.calendar-body").find(">table"),d=$.data(a[0],"calendar").options;"max"==b&&(b=99999999),d.max=b,i(this,c,g(b))})},setMinDate:function(a,b){return a.each(function(){var c=$(this).find("div.calendar-body").find(">table"),d=$.data(a[0],"calendar").options;"min"==b&&(b=1e7),d.min=b,h(this,c,g(b))})}},$.fn.calendar.parseOptions=function(a){$(a);return $.extend({},$.parser.parseOptions(a,["width","height",{firstDay:"number",fit:"boolean",border:"boolean"}]))},$.fn.calendar.defaults={selectDay:!0,width:180,height:180,fit:!1,border:!0,firstDay:0,weeks:["S","M","T","W","T","F","S"],months:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],year:(new Date).getFullYear(),month:(new Date).getMonth()+1,current:new Date,min:"",max:"",onSelect:function(){}}}),define("lib/kui/validatebox",[],function(require,exports,module){function init(a){var b=$(a),c=$.data(a,"validatebox").options;$(a).addClass("validatebox-text"),c.required&&!c.noWarn&&(b.closest("span.combo").length?b.closest("span.combo").addClass("combo-validatebox-must"):b.addClass("validatebox-must"))}function destroyBox(a){var b=$.data(a,"validatebox");if(b){b.validating=!1;var c=b.tip;c&&c.remove(),$(a).unbind(),$(a).remove()}}function bindEvents(a){var b=$(a),c=b[0].tagName,d=b[0].type,e=$.data(a,"validatebox"),f=$.data(a,"validatebox").options;if(e.validating=!1,b.unbind(".validatebox").bind("keydown.validatebox",function(c){var d=$("<input type=hidden' class='dummy-input'>");if(13===c.keyCode){if(!f.focus2Next)return void d.insertAfter(b).focus().remove();if(c.stopPropagation(),c.preventDefault(),!moveNext(a)){var e=$(this).closest("form").find("a.l-btn:first");e.length||(e=$(this).closest("div.window").find("a.l-btn:first")),e.length||(e=$(this).closest("div.panel").find("a.l-btn:first")),e.length?(e.attr("href")||e.attr("href","javascript:void(0)"),e.focus().click()):d.insertAfter(b).focus().remove()}}}).bind("focus.validatebox",function(){e.validating=!1,b.removeClass("TEXTAREA"==c.toUpperCase()?"varlidataTextarea-invalid ":"validatebox-invalid validatebox-grp-invalid"),f.isFocusRemoveTip&&hideTip(a)}).bind("blur.validatebox",function(){f.removeSingleQuote&&b.val(b.val().replace(/\'*/g,"")),"password"!=d&&b.attr("title",b.val()),e.validating=!0,e.value=void 0,function(){e.validating&&(e.value!=b.val()&&(e.value=b.val(),f.validOnBlur&&validate(a)),setTimeout(function(){e.validating=!1,hideTip(a)},f.setTimeLong))}()}),f.chars&&f.chars.length>0)try{var g=new RegExp("[^"+f.chars+"]","g");b.bind("keyup.validate-permit",function(){this.value=this.value.replace(g,"")})}catch(h){alert("输入项"+f.field+"的chars参数配置错误，正确样例如：<br>\\\\d<br>\\\\w<br>\\\\d.<br>等")}}function showTip(a,b){var c,d,e,f,g=$(a),h=g.offset(),i=$.data(a,"validatebox")||{};0===h.left&&0===h.top||i&&i.tip||(b=b||i.message||"",c=i.tip||$('<div class="validatebox-tip"><div class="validatebox-tip-content"></div><div class="validatebox-tip-pointer"></div></div>').appendTo("body"),i.tip=i.tip||c,e=$(".validatebox-tip-content",c),e.html(b),d=h.top-c.outerHeight(),0>d&&(f=$(".validatebox-tip-pointer",c),e.insertAfter(f),f.removeClass().addClass("validatebox-tip-pointer-down"),d=g.outerHeight()+h.top),c.css({left:h.left,top:d}).show(),g.addClass("validatebox-invalid"),setTimeout(function(){c.fadeOut(),g.removeClass("validatebox-invalid")},i.options.setTimeLong))}function hideTip(a){var b=$.data(a,"validatebox");if(b){var c=b.tip;c&&(c.remove(),b.tip=null)}}function validate(target,keyflag){function setTipMessage(a){$.data(target,"validatebox").message=a}var opts=$.data(target,"validatebox").options;if(!$(target).is(":visible")&&!opts.hideValidFlag||$(target).prop("disabled")||"hidden"===$(target).attr("type"))return!0;var tip=$.data(target,"validatebox").tip,box=$(target),value=box.val()||"";value=value.replace(/(^\s*)|(\s*$)/g,"");var boxTagName=box[0].tagName;if("true"===String(opts.required)&&!keyflag){if(opts.showMessage&&""==value)return"TEXTAREA"==boxTagName.toUpperCase()?box.addClass("varlidataTextarea-invalid"):(box.addClass("validatebox-invalid"),setTimeout(function(){box.removeClass("validatebox-invalid")},opts.setTimeLong)),setTipMessage(opts.missingMessage),showTip(target),!1;if(!opts.showMessage&&""==value)return"TEXTAREA"==boxTagName.toUpperCase()?box.addClass("varlidataTextarea-invalid"):(box.addClass("validatebox-invalid"),setTimeout(function(){box.removeClass("validatebox-invalid")},opts.setTimeLong)),!1}var isOnePass=!1,isAllPass=!0;if(opts.validType)for(var validCfgs=opts.validType.split(";");validCfgs[0];){var result=/([a-zA-Z_]+)(.*)/.exec(validCfgs.shift()),rule=opts.rules[result[1]];if((value||"begDate"==result[1]||"endDate"==result[1])&&rule){"money"!=result[1]&&"date"!=result[1]&&"begDate"!=result[1]&&"endDate"!=result[1]||!opts.groupSeparator||(value=value.replace(new RegExp("\\"+opts.groupSeparator,"g"),""));var param="eqValue"===result[1]?$(target).data("kui-eqValue"):eval(result[2]);if(!rule.validator(value,param,target)){"date"==opts.validType?$(target).parent("span.datebox").addClass("dateboxerror"):box.addClass("TEXTAREA"==boxTagName.toUpperCase()?"varlidataTextarea-invalid":"validatebox-invalid");var message=rule.message;if(param)for(var i=0;i<param.length;i++)message=message.replace(new RegExp("\\{"+i+"\\}","g"),param[i]);opts.showMessage&&(setTipMessage(opts.invalidMessage||message),showTip(target)),isAllPass=!1;continue}isOnePass=!0}isOnePass=!0}var flag=opts.isOnePassValid?isOnePass:isAllPass;return flag&&(box.removeClass("TEXTAREA"==boxTagName.toUpperCase()?"varlidataTextarea-invalid":"validatebox-invalid"),hideTip(target)),flag}function setDisabled(a,b){var c=$.data(a,"validatebox").options;"true"==String(b)||"disabled"==b?(c.disabled=!0,$(a).attr("disabled",!0).addClass("form-input-disabled").removeClass("validatebox-invalid").removeClass("varlidataTextarea-invalid"),hideTip(a)):(c.disabled=!1,$(a).removeAttr("disabled").removeClass("form-input-disabled"))}function setMaxLength(a,b){!isNaN(b)&&$(a).attr("maxLength",b)}function clear(a){a.val("")}function moveNext(a){var b,c=$("input.validatebox-text,textarea,a.l-btn");setTimeout(function(){for(var d=c.index(a)+1,e=c.length;e>d;d++)if((b=$(c[d])).is(":visible")&&"a"!==b[0].tagName.toLowerCase()&&!b.prop("disabled"))return b.focus(),!0},100)}function setValue(a,b){var c=$(a);return b?(c.val(b),void("password"!==c.attr("type")&&c.attr("title",b))):void c.val("").removeAttr("title")}function changeValid(a,b){var c=$.data(a,"validatebox").options;c.validType=b}function changeRequired(a,b){var c=$.data(a,"validatebox").options,d=$(a);c.required=Boolean(b),b&&!c.noWarn?d.closest("span.combo").length?d.closest("span.combo").addClass("combo-validatebox-must"):d.addClass("validatebox-must"):d.closest("span.combo").length?d.closest("span.combo").removeClass("combo-validatebox-must"):d.removeClass("validatebox-must")}function setSize(a,b){$(a)._outerWidth(b)}$.fn.validatebox=function(a){if("string"==typeof a){var b=$.fn.validatebox.methods[a],c=[this];if(b)return b.apply(this,c.concat(Array.prototype.slice.call(arguments,1)))}return this.each(function(){a=a||{};var b=$.data(this,"validatebox");b?$.extend(b.options,a):(b=$.data(this,"validatebox",{options:$.extend(!0,{},$.fn.validatebox.defaults,$.fn.validatebox.parseOptions(this),a)}),init(this),$(this).removeAttr("disabled"),$(this).attr("maxLength")&&$(this).removeAttr("maxLength")),bindEvents(this),setDisabled(this,b.options.disabled),setMaxLength(this,b.options.maxLength)})},$.fn.validatebox.methods={destroy:function(a){return a.each(function(){destroyBox(this)})},validate:function(a){return a.each(function(){validate(this)})},isValid:function(a){return validate(a[0])},disabled:function(a){return a.each(function(){setDisabled(this,"true")})},enabled:function(a){return a.each(function(){setDisabled(this,"false")})},getValue:function(a){return $.trim(a.val())},setValue:function(a,b){return a.each(function(){$(this).val(b).attr("title",b)})},clear:function(a){return a.each(function(){clear(a)})},moveNext:function(a){return a.each(function(){moveNext(a)})},changeValid:function(a,b){return a.each(function(){changeValid(this,b)})},changeRequired:function(a,b){return a.each(function(){changeRequired(this,b)})},resize:function(a,b){return a.each(function(){setSize(this,b)})},showTip:function(a,b){return a.each(function(){showTip(this,b)})},hideTip:function(a){return a.each(function(){hideTip(this)})}},$.fn.validatebox.methods.enable=$.fn.validatebox.methods.enabled,$.fn.validatebox.methods.disable=$.fn.validatebox.methods.disabled,$.fn.validatebox.parseOptions=function(a){var b=$(a);return $.extend({},$.parser.parseOptions(a,["validType","missingMessage","invalidMessage",{showMessage:"boolean"},"maxLength"]),{required:"true"==String(b.attr("required"))?!0:void 0,disabled:1==b.attr("disabled")?b.attr("disabled"):void 0})},$.fn.validatebox.defaults={isOnePassValid:!1,removeSingleQuote:!0,validOnBlur:!0,required:!1,validType:null,hideValidFlag:!1,speTxt:null,disabled:!1,showMessage:!0,missingMessage:"该项为必输项",invalidMessage:null,isFocusRemoveTip:!0,setTimeLong:5e3,focus2Next:!0,rules:{email:{validator:function(a,b){function c(a){return a.replace(/[^\x00-\xff]/g,"**")}var d=c(a).length;return b&&b.length>0?d<=b[0]&&/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i.test(a):/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i.test(a)},message:"请输入正确的邮箱地址",tipMessage:"emailTipMessage"},url:{validator:function(a){return/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(a)},message:"请输入正确的路径"},ip:{validator:function(a){return/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])|\*)\.((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])|\*)\.((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])|\*)\.((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])|\*)$/.exec(a)},message:"请输入正确的IP"},eqValue:{validator:function(a,b){return a==b},message:"两次输入不一致"},length:{validator:function(a,b){function c(a){return a.replace(/[^\x00-\xff]/g,"**")}var d=c(a).length;return d>=b[0]&&d<=b[1]},message:"请输入{0}到{1}个字符(一个中文算两个字符)",tipMessage:"输入{0}到{1}个字符(一个中文算两个字符)"},eqLength:{validator:function(a,b){function c(a){return a.replace(/[^\x00-\xff]/g,"**")}return c(a).length===b[0]},message:"请输入{0}个字符(一个中文算两个字符)",tipMessage:"输入{0}个字符(一个中文算两个字符)"},mobile:{validator:function(a){return/^([+]?[\d]{1,3}-|[ ])?((13[0-9]{9})|(18[0-9]{9})|(15[0-9]{9})|(14[0-9]{9})|(17[0-9]{9}))$/.exec(a)},message:"请输入正确的手机号码"},tel:{validator:function(a){return/^(([0\+]\d{2,3}-?)?(0\d{2,3})-?)?(\d{7,8})(-(\d{1,}))?$/.exec(a)},message:"请输入正确的电话号码"},mobileortel:{validator:function(a){var b=/^([+]?[\d]{1,3}-|[ ])?((13[0-9]{9})|(18[0-9]{9})|(15[0-9]{9})|(14[0-9]{9})|(17[0-9]{9}))$/,c=/^(([0\+]\d{2,3}-?)?(0\d{2,3})-?)?(\d{7,8})(-(\d{1,}))?$/;return b.test(a)||c.test(a)},message:"请输入正确的手机号码或者电话号码"},numchar:{validator:function(a,b){function c(a){var b=/^([\w])+$/;return b.test(a)}function d(a){return a.replace(/[^\x00-\xff]/g,"**")}if(1==b.length&&(this.message="请输入{0}个字符,只能输入数字或英文字符"),c(a)){var e=d(a).length;return 1==b.length?e==b[0]:e>=b[0]&&e<=b[1]}return!1},message:"请输入{0}到{1}个字符,只能输入数字或英文字符"},numCharMinus:{validator:function(a,b){function c(a){var b=/^([\w\-])+$/;return b.test(a)}function d(a){return a.replace(/[^\x00-\xff]/g,"**")}if(c(a)){var e=d(a).length;return e>=b[0]&&e<=b[1]}return!1},message:"请输入{0}到{1}个字符,只能输入数字或英文字符或者'-'"},enChar:{validator:function(a,b){function c(a){var b=/[a-zA-Z]/;return b.test(a)}function d(a){return a.replace(/[^\x00-\xff]/g,"**")}if(c(a)){var e=d(a).length;return e>=b[0]&&e<=b[1]}return!1},message:"请输入{0}到{1}个字符,只能英文字符"},endDate:{validator:function(a,b,c){var d=$($(c)[0].form),e=$('input[name="'+b+'"]',d).val(),f=$('input[comboname="'+b+'"]',d);if(f.data("datebox").options.separator&&(e=e.replace(new RegExp("\\"+f.data("datebox").options.separator,"g"),"")),$(c).hasClass("kui-timespinner")&&(a=$(c).timespinner("getValue")),a){if(""!=e&&e>a)return!1;if(f.length>0){var g=f.datebox("calendar");g.calendar("setMaxDate",a)
}return!0}if(f.length>0){var g=f.datebox("calendar");g.calendar("setMaxDate","max")}return!0},message:"截止日期不能小于起始日期"},begDate:{validator:function(a,b,c){var d=$($(c)[0].form),e=$('input[name="'+b+'"]',d).val(),f=$('input[comboname="'+b+'"]',d);if(f.data("datebox").options.separator&&(e=e.replace(new RegExp("\\"+f.data("datebox").options.separator,"g"),"")),a){if(""!=e&&a>e)return!1;if(f.length>0){var g=f.datebox("calendar");g.calendar("setMinDate",a)}return!0}if(f.length>0){var g=f.datebox("calendar");g.calendar("setMinDate","min")}return!0},message:"起始日期不能大于截止日期"},begTime:{validator:function(a,b,c){var d=$($(c)[0].form),e=$('input[spinnername="'+b[0]+'"]',d).timespinner("options"),f=$('input[spinnername="'+b[0]+'"]',d).timespinner("getValue");e.suffixStr&&(f=f.slice(0,f.length-2));var g=a.replace(/:/g,"");return f&&""!=f&&g>f?!1:!0},message:"起始时间不能晚于截止时间！"},endTime:{validator:function(a,b,c){var d=$($(c)[0].form),e=$('input[spinnername="'+b[0]+'"]',d).timespinner("options"),f=$('input[spinnername="'+b[0]+'"]',d).timespinner("getValue");e.suffixStr&&(f=f.slice(0,f.length-2));var g=a.replace(/:/g,"");return f&&""!=f&&f>g?!1:!0},message:"截止时间不能早于起始时间！"},begNum:{validator:function(a,b,c){var d=$($(c)[0].form),e=$('input[name="'+b[0]+'"]',d).numberbox("getValue");return e&&""!=e&&parseFloat(a)>parseFloat(e)?!1:!0},message:"起始值不能大于结束值！"},endNum:{validator:function(a,b,c){var d=$($(c)[0].form),e=$('input[name="'+b[0]+'"]',d).numberbox("getValue");return e&&""!=e&&parseFloat(a)<parseFloat(e)?!1:!0},message:"结束值不能小于起始值！"},valFirst:{validator:function(a,b){function c(){return/(^[\u4e00-\u9fa5a-zA-Z]+)([^\n]*)$/.test(a)}function d(a){return a.replace(/[^\x00-\xff]/g,"**")}if(c(a)){var e=(d(a),d(a).length);return e>=b[0]&&e<=b[1]}return!1},message:"请输入{0}到{1}个字符,且必须输入以字符开头"},val:{validator:function(a,b){function c(a,b){return $.each(b,function(c){a=a.replace(b[c]," ")}),a}function d(a){var b=/^[^@。，,？?【】《》<>：；\[\]{}!！+=—~|\/\'\\\"#$%&\^\*]+$/;return b.test(a)}function e(a){return a.replace(/[^\x00-\xff]/g,"**")}var f=$.data(arguments[2],"validatebox").options,g=null!==f.speTxt?c(a,f.speTxt):a;if(d(g)){var h=e(g).length;return h>=b[0]&&h<=b[1]}return!1},message:"请输入{0}到{1}个字符(一个中文算两个字符),且不能输入特殊字符"},address:{validator:function(a,b){function c(a){var b=/^[^@。，,？?【】《》<>：；\[\]{}!！+=~|\/\'\\\"$%&\^\*]+$/;return b.test(a)}function d(a){return a.replace(/[^\x00-\xff]/g,"**")}if(c(a)){var e=d(a),f=e.length;return f>=b[0]&&f<=b[1]}return!1},message:"请输入{0}到{1}个字符(一个中文算两个字符),且不能输入除（‘#’、‘-’、‘.’、‘（）’）以外的特殊字符"},en_ch:{validator:function(a,b){function c(a){var b=/[^\u4e00-\u9fa5a-zA-Z\-\_\.]+/;return!b.test(a)}function d(a){return a.replace(/[^\x00-\xff]/g,"**")}if(c(a)){var e=(d(a),d(a).length);return e>=b[0]&&e<=b[1]}return!1},message:"请输入{0}到{1}个字符(一个中文算两个字符),只能输入中文或英文且不能输入特殊字符"},number:{validator:function(value,param){function isnumber(s,p1,p2){var regularExpression="/^(-)?(\\d){1,"+parseFloat(p1)+"}(\\.)?(\\d){0,"+parseFloat(p2)+"}$/";return eval(regularExpression).test(s)}function isnumber2(s,p1){var regularExpression="/^(-)?(\\d){1,"+parseInt(p1)+"}$/";return eval(regularExpression).test(s)}var value=$.trim(value);param&&1===param.length?this.message="请输入正确的数字, 整数位最多{0}位":param&&2===param.length&&(this.message="请输入正确的数字, 整数位最多{0}位, 小数位最多{1}位");var flag=-1!=value.indexOf(".")?isnumber(value,param[0],param[1]):isnumber2(value,param[0]);return flag?value.indexOf(".")==value.length-1?!1:!0:!1},message:"请输入正确的数字"},numberex:{validator:function(value,param){function isnumber(a,b,c,d){if("0"!=b&&b){if("10"==b){var e="^(\\d){1,"+parseFloat(c)+"}(\\.)(\\d){0,"+parseFloat(d)+"}$",f="^(\\d){1,"+parseFloat(c)+"}$";return new RegExp(e).test(a)||new RegExp(f).test(a)}if("-10"==b){var e="^(-)(\\d){1,"+parseFloat(c)+"}(\\.)(\\d){0,"+parseFloat(d)+"}$",f="^(-)(\\d){1,"+parseFloat(c)+"}$";return new RegExp(e).test(a)||new RegExp(f).test(a)}if("1"==b){var e="^(\\d){1,"+parseFloat(c)+"}(\\.)(\\d){0,"+parseFloat(d)+"}$",f="^(\\d){1,"+parseFloat(c)+"}$";return(new RegExp(e).test(a)||new RegExp(f).test(a))&&Number(a)>0}if("-1"==b){var e="^(-)(\\d){1,"+parseFloat(c)+"}(\\.)(\\d){1,"+parseFloat(d)+"}$",f="^(-)(\\d){1,"+parseFloat(c)+"}$";return(new RegExp(e).test(a)||new RegExp(f).test(a))&&Number(a)<0}if("2"==b){if(1>value&&value>=0){var e="^(\\d){1,"+parseFloat(c)+"}(\\.)?(\\d){0,"+parseFloat(d)+"}$";return new RegExp(e).test(a)}return!1}if("3"==b){if(1>=value&&value>0){var e="^(\\d){1,"+parseFloat(c)+"}(\\.)(\\d){0,"+parseFloat(d)+"}$",f="^(\\d){1,"+parseFloat(c)+"}$";return(new RegExp(e).test(a)||new RegExp(f).test(a))&&Number(a)>0}return!1}if("4"==b){if(1>value&&value>0){var e="^(\\d){1,"+parseFloat(c)+"}(\\.)(\\d){0,"+parseFloat(d)+"}$";return new RegExp(e).test(a)}return!1}if("5"==b){if(1>=value&&value>=0){var e="^(\\d){1,"+parseFloat(c)+"}(\\.)?(\\d){0,"+parseFloat(d)+"}$";return new RegExp(e).test(a)}return!1}return!1}var e="^(-)?(\\d){1,"+parseFloat(c)+"}(\\.)(\\d){0,"+parseFloat(d)+"}$",f="^(-)?(\\d){1,"+parseFloat(c)+"}$";return new RegExp(e).test(a)||new RegExp(f).test(a)}function isnumber2(s,p0,p1){if("0"!=p0&&p0){if("10"==p0){var regularExpression="/^(\\d){1,"+parseInt(p1)+"}$/";return eval(regularExpression).test(s)}if("-10"==p0){var regularExpression="/(^0$)|(^(-)(\\d){1,"+parseInt(p1)+"}$)/";return eval(regularExpression).test(s)}if("1"==p0){var regularExpression="/^[1-9](\\d){0,"+(parseInt(p1)-1)+"}$/";return eval(regularExpression).test(s)}if("-1"==p0){var regularExpression="/^(-)[1-9](\\d){1,"+(parseInt(p1)-1)+"}$/";return eval(regularExpression).test(s)}return"2"==p0&&1>value&&value>=0?!0:!1}var regularExpression="/^(-)?(\\d){1,"+parseInt(p1)+"}$/";return eval(regularExpression).test(s)}function getMessage(a){return 2===a.length?"0"==a[0]?"请输入正确的整数，最多{1}位":"10"==a[0]?"请输入大于等于0的整数，最多{1}位":"-10"==a[0]?"请输入小于等于0的整数，最多{1}位":"1"==a[0]?"请输入正确的正整数，最多{1}位":"-1"==a[0]?"请输入正确的负整数，最多{1}位":"2"==a[0]?"请输入大于0且小于1的数字":"请输入正确的数字":3===a.length?"0"==a[0]?"请输入正确的数字，小数点前最多{1}位，小数点后最多{2}位":"10"==a[0]?"请输入大于等于0的数字，小数点前最多{1}位，小数点后最多{2}位":"-10"==a[0]?"请输入小于等于0的数字，小数点前最多{1}位，小数点后最多{2}位":"1"==a[0]?"请输入大于0的数字，小数点前最多{1}位，小数点后最多{2}位":"-1"==a[0]?"请输入小于0的数字，小数点前最多{1}位，小数点后最多{2}位":"2"==a[0]?"请输入大于等于0且小于1的数字，小数点前最多{1}位，小数点后最多{2}位":"3"==a[0]?"请输入大于0且小于等于1的数字，小数点前最多{1}位，小数点后最多{2}位":"4"==a[0]?"请输入大于0且小于1的数字，小数点前最多{1}位，小数点后最多{2}位":"5"==a[0]?"请输入大于等于0且小于等于1的数字，小数点前最多{1}位，小数点后最多{2}位":"请输入正确的数字":"请输入正确的数字"}this.message=getMessage(param);var value=$.trim(value);if(!/^(\+|-)?(\d+)(,\d{3})*(\.\d+)?$/.test(value))return!1;value.indexOf(",")>0&&(value=value.replace(/,/g,""));var flag=param.length>2?isnumber(value,param[0],param[1],param[2]||0):isnumber2(value,param[0],param[1]);return flag?value.indexOf(".")==value.length-1?!1:!0:!1},message:"请输入正确的数字"},money:{validator:function(value,param){function isnumber(s,p1,p2){var regularExpression="/^(-)?(\\d){1,"+parseFloat(p1)+"}(\\.)?(\\d){0,"+parseFloat(p2)+"}$/";return eval(regularExpression).test(s)}function isnumber2(s,p1){var regularExpression="/^(-)?[1-9](\\d){0,"+(parseInt(p1)-1)+"}$/";return eval(regularExpression).test(s)}var value=$.trim(value),flag=-1!=value.indexOf(".")?isnumber(value,param[0],param[1]):isnumber2(value,param[0]);return flag?value.indexOf(".")==value.length-1?!1:!0:!1},message:"请输入正确的金额"},"int":{validator:function(a,b){function c(a){var b=/^(-)?\d*$/;return b.test(a)}if(a.indexOf(",")>0&&(a=a.replace(/,/g,"")),c(a)){var d=a.length;return d>b[0]?!1:!0}return!1},message:"请输入正确的整数,最大{0}位"},zint:{validator:function(a,b){function c(a){var b=/^[1-9]\d*$/;return b.test(a)}if(a.indexOf(",")>0&&(a=a.replace(/,/g,"")),c(a)){var d=a.length;return d>b[0]?!1:!0}return!1},message:"请输入正确的正整数,最大{0}位"},intex:{validator:function(a,b){function c(a,b){if("10"==b){var c=/^[0-9]\d*$/;return c.test(a)}if("-10"==b){var c=/^(-)[0-9]\d*$/;return c.test(a)}if("1"==b){var c=/^[1-9]\d*$/;return c.test(a)}if("-1"==b){var c=/^(-)[1-9]\d*$/;return c.test(a)}return!1}if(!/^(\+|-)?(\d+)(,\d{3})*(\.\d+)?$/.test(a))return!1;if(a.indexOf(",")>0&&(a=a.replace(/,/g,"")),c(a,b[1])){var d=a.length;return d>b[0]?!1:!0}return!1},message:"请输入正确的整数"},num:{validator:function(value,param){function isnum(s,data){var regularExpression="/^(\\d){"+parseFloat(data)+"}$/";return eval(regularExpression).test(s)}function isnum1(s,data){var regularExpression="/^(\\d){"+parseFloat(param[0])+","+parseFloat(param[1])+"}$/";return eval(regularExpression).test(s)}function change2star(a){return a.replace(/[^\x00-\xff]/g,"**")}var value=$.trim(value);if(1==param.length){if(isnum(value,param[0])){var itemValue=change2star(value);return itemValue.length>=param[0]?!0:(this.message="请输入{0}位数字",!1)}return this.message="请输入{0}位数字",!1}var itemValue=change2star(value);return isnum1(value,param[0])&&itemValue.length>=param[0]&&itemValue.length<=param[1]?!0:(this.message="请输入{0} 到 {1}位数字",!1)},message:"请输入{0} 到 {1}位数字"},unhan:{validator:function(a,b){function c(a){var b=/[\x00-\xff]/;return b.test(a)}function d(a){return a.replace(/[^\x00-\xff]/g,"**")}var a=$.trim(a);return c(a)&&d(a).length<=parseFloat(b)?!0:!1},message:"请输入{0}个字符(1个中文算2个字符),且不能以汉字开头!"},date:{validator:function(value){function isdate(dayString){var digit="0123456789",datelist=new Array(31,29,31,30,31,30,31,31,30,31,30,31);if(8!=dayString.length)return!1;for(var i=0;8>i;i++)if(-1==digit.indexOf(dayString.charAt(i),0))return!1;var year=dayString.substr(0,4),month=dayString.substr(4,2),date=dayString.substr(6,2);if(year>3e3||1900>year||month>12||1>month||date>31||1>date)return!1;if(date>datelist[month-1])return!1;var yyyy=eval(year);if("02"==month)if(yyyy%400==0){if(date>29)return!1}else if(yyyy%4==0&&yyyy%100!=0){if(date>29)return!1}else if(date>28)return!1;return!0}var value=$.trim(value).replace(/[^0-9]/g,"");return isdate(value)?!0:!1},message:"请输入正确的日期",tipMessage:"20100101"},time:{validator:function(a){function b(a){var b=/^(((([0-1][0-9])|(2[0-3])):(([0-5][0-9])):(([0-5][0-9])))|((([0-1][0-2])|[0-9]):(([0-5][0-9])):(([0-5][0-9]))\s[ap]m))$/;return b.test(a)}var a=$.trim(a);return b(a)?!0:!1},message:"请输入正确的时间"},postcode:{validator:function(a){function b(a){var b=/^[0-9]\d{5}$/;return b.exec(a)?!0:!1}var a=$.trim(a);return b(a)?!0:!1},message:"请输入正确的邮政编码"},cardno:{validator:function(a,b){function c(a){var c,d,e,f,g={11:"北京",12:"天津",13:"河北",14:"山西",15:"内蒙古",21:"辽宁",22:"吉林",23:"黑龙江",31:"上海",32:"江苏",33:"浙江",34:"安徽",35:"福建",36:"江西",37:"山东",41:"河南",42:"湖北",43:"湖南",44:"广东",45:"广西",46:"海南",50:"重庆",51:"四川",52:"贵州",53:"云南",54:"西藏",61:"陕西",62:"甘肃",63:"青海",64:"宁夏",65:"新疆",71:"台湾",81:"香港",82:"澳门",91:"国外"},h=a,i=new Array;if(i=h.split(""),null==g[parseInt(h.substr(0,2))])return!1;switch(h.length){case 15:return b&&b[0]?!1:(ereg=(parseInt(h.substr(6,2))+1900)%4==0||(parseInt(h.substr(6,2))+1900)%100==0&&(parseInt(h.substr(6,2))+1900)%4==0?/^[1-9][0-9]{5}[0-9]{2}((01|03|05|07|08|10|12)(0[1-9]|[1-2][0-9]|3[0-1])|(04|06|09|11)(0[1-9]|[1-2][0-9]|30)|02(0[1-9]|[1-2][0-9]))[0-9]{3}$/:/^[1-9][0-9]{5}[0-9]{2}((01|03|05|07|08|10|12)(0[1-9]|[1-2][0-9]|3[0-1])|(04|06|09|11)(0[1-9]|[1-2][0-9]|30)|02(0[1-9]|1[0-9]|2[0-8]))[0-9]{3}$/,ereg.test(h)?!0:!1);case 18:return ereg=parseInt(h.substr(6,4))%4==0||parseInt(h.substr(6,4))%100==0&&parseInt(h.substr(6,4))%4==0?/^[1-9][0-9]{5}(19|20)[0-9]{2}((01|03|05|07|08|10|12)(0[1-9]|[1-2][0-9]|3[0-1])|(04|06|09|11)(0[1-9]|[1-2][0-9]|30)|02(0[1-9]|[1-2][0-9]))[0-9]{3}[0-9Xx]$/:/^[1-9][0-9]{5}(19|20)[0-9]{2}((01|03|05|07|08|10|12)(0[1-9]|[1-2][0-9]|3[0-1])|(04|06|09|11)(0[1-9]|[1-2][0-9]|30)|02(0[1-9]|1[0-9]|2[0-8]))[0-9]{3}[0-9Xx]$/,ereg.test(h)?(e=7*(parseInt(i[0])+parseInt(i[10]))+9*(parseInt(i[1])+parseInt(i[11]))+10*(parseInt(i[2])+parseInt(i[12]))+5*(parseInt(i[3])+parseInt(i[13]))+8*(parseInt(i[4])+parseInt(i[14]))+4*(parseInt(i[5])+parseInt(i[15]))+2*(parseInt(i[6])+parseInt(i[16]))+1*parseInt(i[7])+6*parseInt(i[8])+3*parseInt(i[9]),c=e%11,f="F",d="10X98765432",f=d.substr(c,1),f==i[17]?!0:!1):!1;default:return!1}}var a=$.trim(a);return c(a)?!0:!1},message:"请输入正确的身份证号"},orgcode:{validator:function(a){var b=/^[1-9]\d*$/;return b.test(a)&&32767>a?!0:!1},message:""},remote:{validator:function(a,b){var c={};c[b[1]]=a;var d=$.ajax({url:b[0],dataType:"json",data:c,async:!1,cache:!1,type:"post"}).responseText;return"true"==d},message:"Please fix this field."},equalTo:{validator:function(a,b){return $(b[0]).val()==a},message:"字段不匹配"},normalchar:{validator:function(a){return!/[\'\"]/.test(a)},message:"输入字符中包含非法字符"},ch_en_num:{validator:function(a,b){function c(a){var b=/[^\u4e00-\u9fa5a-zA-Z\d]+/;return!b.test(a)}function d(a){return a.replace(/[^\x00-\xff]/g,"**")}if(c(a)){var e=(d(a),d(a).length);return e>=b[0]&&e<=b[1]}return!1},message:"请输入{0}到{1}个字符(一个中文算两个字符),只能输入中文、英文和数字且不能输入特殊字符"},cnchar:{validator:function(a){return/^[\u4e00-\u9fa5]+$/.test(a)},message:"只能输入中文字符"},name:{validator:function(a){return/^((([\u4e00-\u9fa5a-zA-Z\-\_\.\s])+)·?)+$/.test(a)},message:"请输入正确的姓名"},u_time_valid:{validator:function(a){if(!/^BEG:\d{2}:\d{2}:\d{2},END:\d{2}:\d{2}:\d{2}$/.test(a))return!1;var b=a.substr(4,8),c=b.split(":"),d=a.substr(17,8),e=d.split(":");return c[0]>24||c[1]>59||c[2]>59||e[0]>24||e[1]>59||e[2]>59||b>d?!1:!0},message:"起止时间格式不正确（时间格式：BEG:00:00:00,END:23:59:59）"},cnname:{validator:function(a){return/^[\u4e00-\u9fa5]+(·[\u4e00-\u9fa5]+){0,3}[\u4e00-\u9fa5]$/.test(a)},message:"请输入正确的中文姓名"}}},$.fn.validatebox.defaults.rules.len=$.fn.validatebox.defaults.rules.length}),define("lib/kui/flowlite",[],function(){var a={freeTodoNode:!1,readonly:!1,data:null,onDoneNodeClick:$.noop,onSelectedNodeClick:$.noop,onIngNodeClick:$.noop,onTodoNodeClick:$.noop,onBeforeNodeJump:$.noop,onNodeJumpSuccess:$.noop,scrollPixel:150,scrollSpeed:200},b={parseOptions:function(a){return $.extend({},$.parser.parseOptions(a))},init:function(a){var c,d,e=a.data("flowlite").options;e.data||(e.data=[],a.find(">div").each(function(){c=$(this).text(),d=$.parser.parseOptions(this),d.text=c?c:d.text,e.data.push(d)})),e.data.length&&(a.empty(),e.ui={flowPanel:a.addClass("flow-panel"),scrollLeftBtn:$("<div class='flow-scroll flow-scroll-left' title='向左滚动'></div>").appendTo(a),flowCenter:$("<div class='flow-center'></div>").appendTo(a),flowNodes:$("<div class='flow-nodes'></div>").appendTo(a.find(".flow-center")),scrollRightBtn:$("<div class='flow-scroll flow-scroll-right' title='向右滚动'></div>").appendTo(a)},b.render(a))},render:function(a){for(var c,d,e,f,g=a.data("flowlite").options,h=g.data,i=0,j=h.length,k=0;j>i;i++){c=h[i],c.index=i,e=$("<div class='flow-arrow'>"),f=$("<div class='flow-node'></div>");for(var l in c)f.data(l,c[l]);f.text(c.text).attr("title",c.text).attr("data-index",i),c.isCurrent&&(d=i),"number"===$.type(d)?i===d?(e.addClass("flow-arrow-done"),f.addClass("flow-node-ing").addClass("node-selected")):(e.addClass("flow-arrow-todo"),f.addClass("flow-node-todo")):(f.addClass("flow-node-done"),e.addClass("flow-arrow-done")),i>0&&g.ui.flowNodes.append(e),g.ui.flowNodes.append(f),k+=e.outerWidth(!0)+f.outerWidth(!0)}g.ui.flowNodes.width(k+1),b.resize(a),b.regEvents(a)},resize:function(a){var c=a.data("flowlite").options,d=c.ui,e=$(d.flowPanel.parent()).width(),f=d.flowNodes.width(),g=e-d.scrollLeftBtn.outerWidth(!0)-d.scrollRightBtn.outerWidth(!0);g=g>f?f:g,d.flowCenter.width(g),b.toggleScroll(a)},toggleScroll:function(a){function b(a){$(this).css("visibility",a?"visible":"hidden")}var c=a.data("flowlite").options,d=c.ui,e=d.flowCenter.width(),f=d.flowNodes.width(),g=d.flowCenter.scrollLeft();b.call(d.scrollLeftBtn,!!g),b.call(d.scrollRightBtn,f>e&&f-e>g)},regEvents:function(a){var c=a.data("flowlite").options,d=c.ui;d.flowNodes.find(".flow-node").hover(function(c){var d=$(c.target);b.isNodeEnabled(a,d)&&d.addClass("node-pointer")},function(){$(this).removeClass("node-pointer")}),d.flowPanel.find(".flow-scroll").click(function(){b.scroll(a,$(this).hasClass("flow-scroll-right")?c.scrollPixel:-c.scrollPixel)}),d.flowNodes.click(function(d){var e=$(d.target);return b.isNode(e)&&b.isNodeEnabled(a,e)?e.hasClass("node-selected")?(c.onSelectedNodeClick.call(e,d,b.getNodeData(a,e)),!1):void(e.hasClass("flow-node-done")?c.onDoneNodeClick.call(e,d,b.getNodeData(a,e),a):e.hasClass("flow-node-ing")?c.onIngNodeClick.call(e,d,b.getNodeData(a,e),a):e.hasClass("flow-node-todo")&&c.onTodoNodeClick.call(e,d,b.getNodeData(a,e),a)):!1})},scroll:function(a,c){var d=a.data("flowlite").options,e=d.ui,f=e.flowCenter.scrollLeft();e.flowCenter.animate({scrollLeft:f+c},d.scrollSpeed,function(){b.toggleScroll(a)})},isNodeEnabled:function(a,c){var d=a.data("flowlite").options,e=b.getNodeData(a,c),f=c.prev().prev(),g=b.getNodeData(a,f);return d.readonly?!1:d.freeTodoNode||!!c.length&&(c.hasClass("flow-node-done")&&!1!==e.revisit||c.hasClass("flow-node-ing")||f.hasClass("flow-node-ing")&&f.hasClass("node-selected")&&!g.isEnd)},getNodeData:function(a,b){var c=a.data("flowlite").options.data;return b?c["number"===$.type(b)?b:$(b).data("index")]:c},getCurrentNode:function(a){return a.find(".flow-node-ing")},getSelectedNode:function(a){return a.find(".node-selected")},isNode:function(a){return a.hasClass("flow-node")},isIngNode:function(a){return this.isNode(a)&&a.hasClass("flow-node-ing")},isDoneNode:function(a){return this.isNode(a)&&a.hasClass("flow-node-done")},isTodoNode:function(a){return this.isNode(a)&&a.hasClass("flow-node-todo")},isSelectedNode:function(a){return this.isNode(a)&&a.hasClass("node-selected")},getPrevNode:function(a,c){var d=a.data("flowlite").options;return c=c?c.prev().prev():b.getSelectedNode(a).prev().prev(),!c.length||d.readonly||b.isNodeEnabled(a,c)?c:b.getPrevNode(a,c)},getNextNode:function(a,c){var d=a.data("flowlite").options;return c=c?c.next().next():b.getSelectedNode(a).next().next(),!c.length||d.readonly||b.isNodeEnabled(a,c)?c:b.getNextNode(a,c)},go2Node:function(a,c,d){var e,f=a.data("flowlite").options,g=b.getSelectedNode(a).offset(),h=g?c.offset().left-g.left:0;!1!==f.onBeforeNodeJump.call(c,b.getNodeData(a,c))&&(c.prevAll("div").each(function(){e=$(this),b.isNode(e)?(b.isSelectedNode(e)&&e.removeClass("node-selected"),b.isIngNode(e)&&e.removeClass("flow-node-ing").addClass("flow-node-done"),b.isTodoNode(e)&&e.removeClass("flow-node-todo").addClass("flow-node-done")):e.hasClass("flow-arrow-todo")&&e.removeClass("flow-arrow-todo").addClass("flow-arrow-done")}),c.nextAll("div").each(function(){e=$(this),b.isNode(e)?(b.isSelectedNode(e)&&e.removeClass("node-selected"),d&&b.isDoneNode(e)&&e.removeClass("flow-node-done").addClass("flow-node-todo"),d&&b.isIngNode(e)&&e.removeClass("flow-node-ing").addClass("flow-node-todo")):d&&e.hasClass("flow-arrow-done")&&e.removeClass("flow-arrow-done").addClass("flow-arrow-todo")}),c.addClass("node-selected"),(d||b.isTodoNode(c))&&c.removeClass("flow-node-todo").addClass("flow-node-ing"),f.onNodeJumpSuccess.call(c,b.getNodeData(a,c)),b.scroll(a,h))}},c={options:function(){return this.data("flowlite").options},getNodeData:function(a){return b.getNodeData(this,a)},resize:function(){this.each(function(){b.resize($(this))})},getPrevNode:function(a){return b.getPrevNode(this,a)},getNextNode:function(a){return b.getNextNode(this,a)},go2Node:function(a,c){b.go2Node(this,a,c)},isDoneNode:function(a){return b.isDoneNode(a)},isIngNode:function(a){return b.isIngNode(a)},isTodoNode:function(a){return b.isTodoNode(a)},destroy:function(){this.removeClass("flow-panel").empty()},getCurrentNode:function(){return b.getCurrentNode(this)},getSelectedNode:function(){return b.getSelectedNode(this)},isNodeEnabled:function(a){return b.isNodeEnabled(a)}};$.fn.flowlite=function(d){var e,f=Array.prototype.slice;return"string"===$.type(d)?c[d].apply(this,f.call(arguments,1)):this.each(function(){e=$(this),e.data("flowlite")||e.data("flowlite",{options:$.extend({},a,b.parseOptions(this),d)}),b.init(e)})},$.fn.flowlite.methods=c,$.fn.flowlite.defaults=a}),define("lib/kui/mousewheel",[],function(){function a(a){var b=a||window.event,c=[].slice.call(arguments,1),d=0,e=0,f=0;return a=$.event.fix(b),a.type="mousewheel",b.wheelDelta&&(d=b.wheelDelta/120),b.detail&&(d=-b.detail/3),f=d,void 0!==b.axis&&b.axis===b.HORIZONTAL_AXIS&&(f=0,e=-1*d),void 0!==b.wheelDeltaY&&(f=b.wheelDeltaY/120),void 0!==b.wheelDeltaX&&(e=-1*b.wheelDeltaX/120),c.unshift(a,d,e,f),($.event.dispatch||$.event.handle).apply(this,c)}var b=["DOMMouseScroll","mousewheel"];if($.event.fixHooks)for(var c=b.length;c;)$.event.fixHooks[b[--c]]=$.event.mouseHooks;$.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var c=b.length;c;)this.addEventListener(b[--c],a,!1);else this.onmousewheel=a},teardown:function(){if(this.removeEventListener)for(var c=b.length;c;)this.removeEventListener(b[--c],a,!1);else this.onmousewheel=null}},$.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}})}),define("lib/kui/sibar",[],function(){function a(a,b){var c=$.data(a,"sibar");if(c&&c.options){var d=$.extend({level:1,title:"",parNode:0,parTitle:void 0,index:0,content:"",collapse:!0},b);if(o["level"+d.level])return o["level"+d.level](c.options,d)}}function b(a,b,c){return a.find(b?"li.sibar-side-level1:contains("+b+")":"li.sibar-side-level1:eq("+c+")")}function c(a,c){var d=$.data(a,"sibar");if(d&&d.options){var e=$.extend({level:1,index:0,parTitle:void 0,parNode:0,title:void 0},c),f=d.options;if(1==e.level){var g=b(f.$side,c.title,c.index);if(1==g.length){var h=g.remove().attr("href"),i=$(h).closest("div.panel");i=i.length>0?i:$(h),i.remove()}}else if(2==e.level){var j=b(f.$side,c.parTitle,c.parNode);if(1==j.length){var h=j.nextAll("li.sibar-side-level2:eq("+c.index+")").remove().attr("href"),i=$(h),k=i.prev();i.remove(),k.is("div.detail-tip")&&k.remove()}}}}function d(a){var b=$.data(a,"sibar").options,c=$(a);b.sideWidthBack=b.sideWidth;var d,f=b.tabs,g=0;c.find(">div[title]").each(function(){if(d=$.parser.parseOptions(this,n),d.id=m+g++,d.level=1,this.id=d.id,f.push(d),d.minHeight){var a=d,c=$(this).css({position:"relative",overflow:"hidden",height:a.minHeight+"px"});$('<div class="sibar-toggle"><span class="detail-icon"></span>展开</div>').prependTo(c).click(function(){var b=$(this).hasClass("hover"),c=b?a.minHeight-32:a.maxHeight||"auto",d=b?"展开":"收起",e=b?a.onShrink:a.onExpansion;$(this).toggleClass("hover").html('<span class="detail-icon"></span>'+d).closest("div.panel-body").height(c),e&&$.isFunction(e)&&e($("#"+a.id),a)})}d.child&&$(this).find(">*[title]").each(function(){d=$.parser.parseOptions(this,n),d.id=m+g++,d.level=2,this.id=d.id,f.push(d);var a=$('<div class="detail-tip"><span class="detail-shrink"></span><span class="detail-icon">&nbsp;&nbsp;</span><span>'+d.title+"</span></div>").prependTo(this).click(function(){$(this).next().toggle(b.slideSpeed).end().find("span:first").toggleClass("detail-shrinked")});d.collapse&&a.click()})}),b.index=g;for(var i=['<div class="sibar-side-title">'+b.title+'</div><div class="sibar-side-hide"></div><ul><li class="sibar-side-start"><span class="sibar-side-left"></span></li>'],j=0,k=f.length;k>j;j++)i.push('<li class="sibar-side-level'+f[j].level+'" href=#'+(m+j)+'><span class="sibar-side-left"></span><div class="sibar-side-content"><span class="sibar-side-right"></span>'+f[j].title+"</div></li>");i.push('<li class="sibar-side-end"><span class="sibar-side-left"></span></li></ul>'),b.$side=$('<div class="sibar-side" style="position:fixed;"></div>').appendTo("body").html(i.join("")),h(a),e(a,!0)}function e(a,b){var c=$(a),d=$.data(a,"sibar").options,e=c.position();d.baseTop=e.top,d.baseLeft=e.left;var f=$(a).parent();b?(d.width=f.width(),d.height=f.height()):(d.width=f.width()+18,d.height=f.height());var g;if("left"==d.sideAlign){d.$side.css({top:d.baseTop+d.sideTop,width:d.sideWidth,left:d.baseLeft+d.sideLeft});var h=d.sideLeft+d.sideWidth+d.sideInterval;contentWidh=d.width-h-d.rightInterval,c.css("padding-left",h).width(d.width-h)}else if("right"==d.sideAlign){var i=d.sideLeft+d.sideWidth+d.sideInterval;g=d.width-i-d.rightInterval,c.css("padding-left",d.rightInterval).width(d.width-d.rightInterval),d.$side.css({top:d.baseTop+d.sideTop,width:d.sideWidth,left:d.baseLeft+d.width-i+d.sideInterval})}c.width(g+d.sideInterval+d.rightInterval-10).find(">*").width(g).find(">div.panel-header").width(g-10).next().width(g-8),d.onResize.call(a)}function f(a){var b=$.data(a,"sibar").options,c=b.$side,d=!0;return c.find("li[href]").each(function(){d=g($($(this).attr("href")),$(this))&&d}),d||c.find("li.wrong:first").trigger("click.sibar"),d}function g(a,b){var c=!0;return a.find("form:visible").each(function(){return c=$.data(this,"form")&&$(this).form("validate")}).length>0?c?b.removeClass("wrong").addClass("right"):b.removeClass("right").addClass("wrong"):b.removeClass("right").removeClass("wrong"),c}function h(a){function b(b,f){var h=c(r.removeClass("hover")),i=c($(this)),j=$(this).attr("href");k&&1==k.removeClass("sibar-content-hover").length&&(d(h,"onBlur",i),r[0]!=this&&g(k,r)),r=$(this).addClass("hover"),k=$(j).closest("div.panel").addClass("sibar-content-hover"),k.length<1&&(k=$(j)),f||(n=k.position().top,q.stop().animate({scrollTop:n},o.scrollSpeed)),d(i,"onFocus",h),l()<=1024&&($(".sibar-side-hide").addClass("side-hide"),o.sideWidth=o.sideHideWidth,e(a),o.onSideHide.call(a))}function c(a){return p[a.attr("href").match(/\d*$/)[0]]}function d(b,c,d,e){$.isFunction(b[c])&&b[c].call(a,b,d,e)}function f(a){h($(this).attr("id"),!0),a.stopPropagation()}function h(a,b){o.$side.find("li[href=#"+a+"]").trigger("click.sibar",b)}var k,n,o=$.data(a,"sibar").options,p=o.tabs,q=$("html,body"),r=o.$side.find("li[href]").off("click.sibar").on("click.sibar",b);setTimeout(function(){r.filter(":first").trigger("click.sibar")},0),$(a).on("click.sibar","*[id^="+m+"]",f),$("input.validatebox-text").live("focus.sibar",function(){var a=$(this).closest("*[id^="+m+"]").attr("id");h(a,!0)}),o.$side.find(">div.sibar-side-hide").click(function(){$(this).toggleClass("side-hide"),$(this).hasClass("side-hide")?i(a):j(a)}),o.liEvent=b,o.divEvent=f,o.fit&&$(window).bind("resize.sibar",function(){e(a)})}function i(a){var b=$.data(a,"sibar").options;b.sideWidth=b.sideHideWidth,e(a),b.onSideHide.call(a)}function j(a){var b=$.data(a,"sibar").options;b.sideWidth=b.sideWidthBack,e(a),b.onSideShow.call(a)}function k(a,c,d){var e=$.data(a,"sibar").options,f=typeof c;"number"==f?b(e.$side,void 0,c).trigger("click.sibar",d):"string"==f&&b(e.$side,c).trigger("click.sibar",d)}function l(){var a=0;return window.innerWidth?a=window.innerWidth:document.body&&document.body.clientWidth&&(a=document.body.clientWidth),a}$.fn.sibar=function(a,b){return"string"==typeof a?$.fn.sibar.methods[a](this,b):(a=a||{},this.each(function(){$.data(this,"sibar")||$.data(this,"sibar",{options:$.extend({},$.extend({},$.fn.sibar.defaults),$.fn.sibar.parseOptions(this),a)}),d(this)}))},$.fn.sibar.parseOptions=function(a){return $.extend({},$.parser.parseOptions(a))},$.fn.sibar.methods={options:function(a){return $.data(a[0],"sibar").options},sideClick:function(a,b){return a.each(function(){k(this,b)})},sideHide:function(a){return a.each(function(){i(this)})},sideShow:function(a){return a.each(function(){j(this)})},resize:function(a){return a.each(function(){e(this)})},addNode:function(b,c){return a(b[0],c)},delNode:function(a,b){return c(a[0],b)},validate:function(a,b){return f(a[0],b)}},$.fn.sibar.defaults={sideAlign:"right",sideTop:0,sideLeft:0,sideWidth:180,sideInterval:10,rightInterval:10,scrollSpeed:360,slideSpeed:180,title:"信息填写导航",fit:!0,tabs:[],width:0,height:0,baseTop:0,baseLeft:0,sideHideWidth:50,onSideHide:function(){},onSideShow:function(){},onResize:function(){}};var m="sibar-content-",n=["title",{child:"boolean",collapse:"boolean"}],o={level1:function(){},level2:function(a,c){c.id=m+a.index++;var d=b(a.$side,c.parTitle,c.parNode);o.addNavigation(d,a,c.level,c.id,c.title);var e=d.attr("href"),f=$('<div class="detail-tip"><span class="detail-shrink"></span><span class="detail-icon">&nbsp;&nbsp;</span><span>'+c.title+"</span></div>").appendTo($(e)).click(function(){$(this).next().toggle(a.slideSpeed).end().find("span:first").toggleClass("detail-shrinked")}).after($('<div id="'+c.id+'"></div>').append(c.content));return c.collapse||f.click(),$.parser.director(f.next().on("click.sibar,focus.sibar",a.divEvent)),a.tabs[a.index-1]=c,f.next()},addNavigation:function(a,b,c,d,e){var f=a.nextUntil("li.sibar-side-level1");return f=f.length>0?f.last():a,$('<li class="sibar-side-level'+c+'" href="#'+d+'"><span class="sibar-side-left"></span><div class="sibar-side-content"><span class="sibar-side-right"></span>'+e+"</div></li>").insertAfter(f).on("click.sibar",b.liEvent)}}}),define("lib/kui/uploadify",[],function(require,exports,module){$.fn.uploadify=function(a){return methods[a]?methods[a].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof a&&a?void $.error("The method "+a+" does not exist in $.uploadify"):this.each(function(){methods.init.call(this,$.extend({},$.fn.uploadify.defaults,$.fn.uploadify.parseOptions(this),a))})},$.fn.uploadify.parseOptions=function(a){var b=$(a);return $.extend({},$.parser.parseOptions(a,["id","butonText","fileTypeDesc","fileTypeExts","fileSizeLimit",{multi:"boolean"}]),{id:b.attr("id")})},$.fn.uploadify.defaults={showResult:!0,enableHtml5Upload:!1,auto:!0,width:100,height:30,dir:"",readfile:"false",uploadUrl:"../../kjdp_upload",buttonClass:"",buttonImage:"",buttonText:"请选择文件",fileTypeDesc:"请选择doc,docx,xls,xlsx,pdf,txt,jpg,gif,jpge,ppt,rar,zip文件",fileTypeExts:"*.doc;*.docx;*.xls;*.xlsx;*.pdf;*.txt;*.jpg;*.gif;*.jpge;*.ppt;*.rar;*.zip",fileSizeLimit:"10MB",multi:!1,IS_IMAGE_RESOURCE:"false",LOCAL_RESOURCE:"false",UN_RENAME:"false",fileData:[],fileNumLimit:0,onlyView:!1,autoCheck:!0,showButton:!0,showQueue:!0,onDialogOpen:function(){},onInit:function(){},onUploadSuccess:function(){},onDeleteSuccess:function(){}};var methods={isFlashAvailable:function(){var a=swfobject.getFlashPlayerVersion();return a.major&&a.major>=9},init:function(a){var b=$(this).attr("id"),c=null;a.uploadUrl=a.uploadUrl+(a.uploadUrl.indexOf("?")<0?"?":"&")+"DIR="+a.dir+"&READFILE="+a.readfile+"&IS_IMAGE_RESOURCE="+a.IS_IMAGE_RESOURCE+"&LOCAL_RESOURCE="+a.LOCAL_RESOURCE+"&UN_RENAME="+a.UN_RENAME,c=a.enableHtml5Upload&&"undefined"!=typeof Worker?new Html5Upload:new FlashUpload,c.init($(this),a),$.data($("#"+b)[0],"uploader",c)},cancel:function(a,b){var c=$.data(this,"uploader");c.cancel.call(this,a,b)},disable:function(a){var b=$(this).data("uploader");b&&b.disable.call(this,a)},upload:function(){var a=$.data($(this)[0],"uploader"),b=arguments;a.upload.apply(this,b)},clear:function(){var a=$.data($(this)[0],"uploader");a.clear.call(this)},destroy:function(){var a=$.data($(this)[0],"uploader");a.destroy($(this))}},Html5Upload=function(){var a=this;Html5Upload=function(){return a}};Html5Upload.prototype.init=function(target,c){var $this=$(target),self=this;$this.data("uploadify",{inputs:{},inputCount:0,fileID:0,queue:{count:0,selected:0,replaced:0,errors:0,queued:0,cancelled:0,downloaded:0},uploads:{current:0,attempts:0,successful:0,errors:0,count:0}});var d=$this.data("uploadify"),f=d.settings=$.extend({auto:!1,buttonClass:!1,buttonText:"请选择文件",checkScript:!1,dnd:!0,dropTarget:!1,fileObjName:"Filedata",fileSizeLimit:"0",fileType:!1,formData:{},height:30,itemTemplate:!1,method:"post",multi:!0,overrideEvents:[],queueID:!1,fileNumLimit:0,removeCompleted:!1,simUploadLimit:0,truncateLength:0,uploadLimit:0,uploadUrl:"uploadify.php",width:100,fileType:{image:["jpg","png","bmp","gif","jpeg","tif"]}},c);if(f.basefileSizeLimit=f.fileSizeLimit,isNaN(f.fileSizeLimit)){var e=1.024*parseInt(f.fileSizeLimit);f.fileSizeLimit.indexOf("KB")>-1?f.fileSizeLimit=1e3*e:f.fileSizeLimit.indexOf("MB")>-1?f.fileSizeLimit=1e6*e:f.fileSizeLimit.indexOf("GB")>-1&&(f.fileSizeLimit=1e9*e)}else f.fileSizeLimit=1024*f.fileSizeLimit;if(d.inputTemplate=$('<input type="file">').css({"font-size":f.height+"px",opacity:0,position:"absolute",right:"-3px",top:"-3px","z-index":999,cursor:"pointer"}),d.createInput=function(){var a=d.inputTemplate.clone(),b=a.name="input"+d.inputCount++;
if(f.multi&&a.attr("multiple",!0),f.fileTypeExts){var c=[];for(var e in f.fileType)if(f.fileType.hasOwnProperty(e))for(var g=f.fileType[e],h=0,i=g.length;i>h;h++)f.fileTypeExts.indexOf(g[h])>0&&c.push(e+"/"+g[h]);a.attr("accept",c.join(","))}a.bind("change",function(){d.queue.selected=0,d.queue.replaced=0,d.queue.errors=0,d.queue.queued=0;var a=this.files.length;if(d.queue.selected=a,d.queue.count+a>f.fileNumLimit&&0!==f.fileNumLimit)$.inArray("onError",f.overrideEvents)<0&&alert("选定的文件数量超过设置的上传文件数 ("+f.fileNumLimit+")！"),"function"==typeof f.onError&&f.onError.call($this,"QUEUE_LIMIT_EXCEEDED");else{for(var c=function(a){var b=!0;if(f.fileTypeExts){var c=a.name.split(".")[1],d=f.fileTypeExts.split(";");b=!1;for(var e=0,g=d.length;g>e;e++)if(d[e].split(".")[1]==c){b=!0;break}}return b},e=0;a>e;e++){if(file=this.files[e],!c(file))return alert('这个文件 "'+file.name+'" 文件类型不支持 ('+f.fileTypeDesc+")."),!1;d.addQueueItem(file)}d.inputs[b]=this,d.createInput()}f.auto&&self.upload.call($this),"function"==typeof f.onSelect&&f.onSelect.call($this,d.queue)}),d.currentInput&&d.currentInput.hide(),d.button.append(a),d.currentInput=a},d.destroyInput=function(a){$(d.inputs[a]).remove(),delete d.inputs[a],d.inputCount--},d.drop=function(a){d.queue.selected=0,d.queue.replaced=0,d.queue.errors=0,d.queue.queued=0;var b=a.dataTransfer,c=b.name="input"+d.inputCount++,e=b.files.length;if(d.queue.selected=e,d.queue.count+e>f.fileNumLimit&&0!==f.fileNumLimit)$.inArray("onError",f.overrideEvents)<0&&alert("选定的文件数量超过设置的上传文件数  ("+f.fileNumLimit+")！"),"function"==typeof f.onError&&f.onError.call($this,"QUEUE_LIMIT_EXCEEDED");else{for(var g=0;e>g;g++)file=b.files[g],d.addQueueItem(file);d.inputs[c]=b}f.auto&&self.upload($this),"function"==typeof f.onDrop&&f.onDrop.call($this,b.files,b.files.length),a.preventDefault(),a.stopPropagation()},d.fileExistsInQueue=function(a){for(var b in d.inputs){input=d.inputs[b],limit=input.files.length;for(var c=0;c<limit;c++)if(existingFile=input.files[c],existingFile.name==a.name&&!existingFile.complete)return!0}return!1},d.removeExistingFile=function(a){for(var b in d.inputs){input=d.inputs[b],limit=input.files.length;for(var c=0;c<limit;c++)existingFile=input.files[c],existingFile.name!=a.name||existingFile.complete||(d.queue.replaced++,self.cancel($this,existingFile,!0))}},d.queueItem=$(0==f.itemTemplate?'<div class="uploadify-queue-item"><div class="cancel"><a class="close" href="#"></a></div><div><span class="filename"></span><span class="fileinfo"></span></div><div class="uploadify-progress"><div class="uploadify-progress-bar"></div></div></div>':f.itemTemplate),d.addQueueItem=function(a){if($.inArray("onAddQueueItem",f.overrideEvents)<0){d.removeExistingFile(a),a.queueItem=d.queueItem.clone();var b=f.id+"-file-"+d.fileID++;a.queueItem.attr("id",b),a.queueItem.find(".close").bind("click",function(){return self.cancel($this,a),!1}),a.queueItem.find(".filename").html(a.name),a.queueItem.data("file",a),d.queueEl.append(a.queueItem),f.showQueue||$("#"+b).hide()}if("function"==typeof f.onAddQueueItem&&f.onAddQueueItem.call($this,a),f.fileTypeExts){for(var c=a.name.split("."),e=c[c.length-1],g=f.fileTypeExts.split(";"),h=!1,i=0,j=g.length;j>i;i++)if(g[i].split(".")[1]==e){h=!0;break}h||d.error("FORBIDDEN_FILE_TYPE",a)}d.queue.count+1>f.fileNumLimit&&0!==f.fileNumLimit&&$.inArray("onError",f.overrideEvents)<0&&d.error("FILE_NUM_LIMIT_EXCEEDED",a,f),a.size>f.fileSizeLimit&&0!=f.fileSizeLimit?d.error("FILE_SIZE_LIMIT_EXCEEDED",a,f):(d.queue.queued++,d.queue.count++)},d.removeQueueItem=function(a,b,c){c||(c=0);var e=b?0:500;if(a.queueItem){" - Completed"!=a.queueItem.find(".fileinfo").html()&&a.queueItem.find(".fileinfo").html(" - Cancelled"),a.queueItem.find(".uploadify-progress-bar").width(0),a.queueItem.delay(c).fadeOut(e,function(){$(this).remove()});var g=window.document.location.href,h=window.document.location.pathname,i=g.indexOf(h),j=g.substring(0,i),k=h.substring(0,h.substr(1).indexOf("/")+1),l=j+k+"/servlet/Delete";xhr=c.xhr=new XMLHttpRequest,xhr.open("POST",l,!0);var m=a.name;xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),xhr.send("name="+m),delete a.queueItem,d.queue.count--,"function"==typeof f.onDeleteSuccess&&f.onDeleteSuccess.call($this,m)}},d.filesToUpload=function(){var a=0;for(var b in d.inputs){input=d.inputs[b],limit=input.files.length;for(var c=0;c<limit;c++)file=input.files[c],file.skip||file.complete||a++}return a},d.checkExists=function(a){if($.inArray("onCheck",f.overrideEvents)<0){$.ajaxSetup({async:!1});var b=$.extend(f.formData,{filename:a.name});if($.post(f.checkScript,b,function(b){a.exists=parseInt(b)}),a.exists&&!confirm("A file named "+a.name+" already exists in the upload folder.\nWould you like to replace it?"))return self.cancel($this,a),!0}return"function"==typeof f.onCheck&&f.onCheck.call($this,a,a.exists),!1},d.uploadFile=function(a,b){if(!a.skip&&!a.complete&&!a.uploading)if(a.uploading=!0,d.uploads.current++,d.uploads.attempted++,xhr=a.xhr=new XMLHttpRequest,"function"==typeof FormData||"object"==typeof FormData){var c=new FormData;c.append(f.fileObjName,a);for(i in f.formData)c.append(i,f.formData[i]);xhr.open(f.method,f.uploadUrl,!0),xhr.upload.addEventListener("progress",function(b){b.lengthComputable&&d.progress(b,a)},!1),xhr.addEventListener("load",function(c){4==this.readyState&&(a.uploading=!1,200==this.status?"Invalid file type."!==a.xhr.responseText?d.uploadComplete(c,a,b):d.error(a.xhr.responseText,a,b):404==this.status?d.error("404_FILE_NOT_FOUND",a,b):403==this.status?d.error("403_FORBIDDEN",a,b):d.error("Unknown Error",a,b))}),xhr.send(c)}else{var e=new FileReader;e.onload=function(c){var e="-------------------------"+(new Date).getTime(),g="--",h="\r\n",i="";i+=g+e+h,i+='Content-Disposition: form-data; name="'+f.fileObjName+'"',a.name&&(i+='; filename="'+a.name+'"'),i+=h,i+="Content-Type: application/octet-stream"+h+h,i+=c.target.result+h;for(key in f.formData)i+=g+e+h,i+='Content-Disposition: form-data; name="'+key+'"'+h+h,i+=f.formData[key]+h;i+=g+e+g+h,xhr.upload.addEventListener("progress",function(b){d.progress(b,a)},!1),xhr.addEventListener("load",function(c){a.uploading=!1;var e=this.status;404==e?d.error("404_FILE_NOT_FOUND",a,b):"Invalid file type."!=a.xhr.responseText?d.uploadComplete(c,a,b):d.error(a.xhr.responseText,a,b)},!1);var j=f.uploadUrl;if("get"==f.method){var k=$(f.formData).param();j+=k}xhr.open(f.method,f.uploadUrl,!0),xhr.setRequestHeader("Content-Type","multipart/form-data; boundary="+e),"function"==typeof f.onUploadFile&&f.onUploadFile.call($this,a),xhr.sendAsBinary(i)},e.readAsBinaryString(a)}},d.progress=function(a,b){if($.inArray("onProgress",f.overrideEvents)<0){if(a.lengthComputable)var c=Math.round(a.loaded/a.total*100);b.queueItem.find(".fileinfo").html(" - "+c+"%"),b.queueItem.find(".uploadify-progress-bar").css("width",c+"%")}"function"==typeof f.onProgress&&f.onProgress.call($this,b,a)},d.error=function(a,b,c){var e=-1;if($.inArray("onError",f.overrideEvents)<0){switch(a){case"404_FILE_NOT_FOUND":errorMsg="404 Error";break;case"403_FORBIDDEN":errorMsg="403 Forbidden";break;case"FORBIDDEN_FILE_TYPE":errorMsg="Forbidden File Type",errorMsg='这个文件 "'+b.name+'" 文件类型不支持 ('+f.fileTypeDesc+").";break;case"FILE_SIZE_LIMIT_EXCEEDED":errorMsg="大小不能超过"+c.basefileSizeLimit;break;case"FILE_NUM_LIMIT_EXCEEDED":default:errorMsg="Unknown Error"}b.queueItem.addClass("error").find(".fileinfo").html(" - "+errorMsg),b.queueItem.find(".progress").remove(),alert(errorMsg),b.queueItem.delay(1e3+100*e).fadeOut(500,function(){$(this).remove()})}"function"==typeof f.onError&&f.onError.call($this,a,b),b.skip=!0,"404_FILE_NOT_FOUND"==a?d.uploads.errors++:d.queue.errors++,c&&self.upload($this,null,!0)},d.uploadComplete=function(l,j,k){$.inArray("onUploadSuccess",f.overrideEvents)<0&&(j.queueItem.find(".uploadify-progress-bar").css("width","100%"),j.queueItem.find(".fileinfo").html(" - 完成"),j.queueItem.find(".progress").slideUp(250),j.queueItem.addClass("complete"));var data=j.xhr.responseText,fileData=eval("("+data+")"),target=$("#"+f.id),targetName=$(target).attr("name");"function"==typeof f.onUploadSuccess&&f.onUploadSuccess.call($this,fileData.length?fileData[0]:{});for(var i=0;i<fileData.length;i++){var file=fileData[i];if(!file.FILENAME)return!1;var fileLength=file.FILENAME.length;fileLength>24&&(file.FILENAME=file.FILENAME.substring(0,8)+"..."+file.FILENAME.substring(file.FILENAME.lastIndexOf(".")-3,file.FILENAME.length));var fileWrapper=$('<div class="uploadify-queue-item" FILENAME="'+file.FILENAME+'" FILECON="'+file.FILECON+'"/>'),fileSpan=$('<span class="FILENAME"/>'),cancel=$('<div class="cancel"><a href="javascript:void(0)" ATT_ID="'+file.ATT_ID+'" FILENAME="'+file.FILENAME+'" FILECON="'+file.FILECON+'"></a></div>');fileSpan.append('<a href="javascript:void(0)" FILENAME="'+file.FILENAME+'" FILECON="'+file.FILECON+'">'+file.FILENAME+"    ("+file.FILESIZE+")</a>"),fileWrapper.append(cancel).append(fileSpan).addClass("complete"),d.queueEl.append(fileWrapper);var hiddenIpt=$(target).find("input[name][name="+targetName+"]");hiddenIpt.val(""!=hiddenIpt.val()&&void 0!=file.ATT_ID?hiddenIpt.val()+","+file.ATT_ID:file.ATT_ID),j.queueItem.fadeOut(500,function(){$(this).remove()}),"function"==typeof f.onUploadSuccess&&f.onUploadSuccess.call(this,file,data,k)}d.queueEl.find("span a").click(function(){window.open("/kjdp_download?DIR="+f.dir+"&FILENAME="+$(this).attr("FILENAME")+"&FILECON="+$(this).attr("FILECON")+"&IS_IMAGE_RESOURCE="+f.IS_IMAGE_RESOURCE+"&LOCAL_RESOURCE"+f.LOCAL_RESOURCE+"&UN_RENAME="+f.UN_RENAME)});var $this=this;d.queueEl.find("div.cancel:last a").click(function(a){var b=$(this).attr("FILECON"),c=$(this).attr("FILENAME"),e=$(this).attr("ATT_ID");return $.get("/kjdp_delete?DIR="+f.dir+"&FILENAME="+c+"&FILECON="+b+"&ATT_ID="+e+"&IS_IMAGE_RESOURCE="+f.IS_IMAGE_RESOURCE+"&LOCAL_RESOURCE="+f.LOCAL_RESOURCE+"&UN_RENAME="+f.UN_RENAME+"&SERVICE=P0004014",{},function(){var a=$(target).find("input[name][name="+targetName+"]"),b=a.val();if(b&&""!=b){var c=b.split(","),d=$.grep(c,function(a){return a!=e});a.val(d.join(","))}else a.val("")}),d.queue.count+l>f.fileNumLimit&&0!==f.fileNumLimit&&$(target).uploadify("disable",!1),$(this).parent().parent().remove(),a&&a.preventDefault?a.preventDefault():window.event.returnValue=!1,"function"==typeof f.onDeleteSuccess&&f.onDeleteSuccess.call(this,file,data,k),!1}),f.removeCompleted&&setTimeout(function(){self.cancel($this,j)},3e3),j.complete=!0,d.uploads.successful++,d.uploads.count++,d.uploads.current--,delete j.xhr},d.queueComplete=function(){"function"==typeof f.onQueueComplete&&f.onQueueComplete.call($this,d.uploads)},d.disable=function(a){var b=$(".uploadify-button"),c=$(".uploadify").find("input[type='file']");a?(b.addClass("disabled"),c.attr("disabled",!0)):(c.removeAttr("disabled"),b.removeClass("disabled"))},!(window.File&&window.FileList&&window.Blob&&(window.FileReader||window.FormData)))return"function"==typeof f.onFallback&&f.onFallback.call($this),!1;f.id="uploadify-"+$this.attr("id");var textStr=f.showButton?f.buttonText:"";d.button=$('<div id="'+f.id+'">'+textStr+"</div>"),f.showButton&&(d.button.addClass("uploadify-button"),f.buttonClass&&d.button.addClass(f.buttonClass));var css={height:f.height,"line-height":f.height+"px",overflow:"hidden",position:"relative","text-align":"center",width:f.width};d.button.css(css);var box=$("<div></div>");if(box.addClass("uploadify"),box.css({height:f.height,width:f.width}),f.onlyView&&box.attr("style","visibility:hidden"),box.append(d.button),$this.before(box).appendTo(box).hide(),d.createInput.call($this),box.find("input[type='file']").bind("click",function(){var a=$.Event("openDialog");$(target).trigger(a,$this)}),f.queueID?d.queueEl=$("#"+f.queueID):(f.queueID=f.id+"-queue",d.queueEl=$('<div id="'+f.queueID+'" class="uploadify-queue" />'),box.after(d.queueEl)),f.dnd){var h=f.dropTarget?$(f.dropTarget):d.queueEl.get(0);h.addEventListener("dragleave",function(a){a.preventDefault(),a.stopPropagation()},!1),h.addEventListener("dragenter",function(a){a.preventDefault(),a.stopPropagation()},!1),h.addEventListener("dragover",function(a){a.preventDefault(),a.stopPropagation()},!1),h.addEventListener("drop",d.drop,!1)}XMLHttpRequest.prototype.sendAsBinary||(XMLHttpRequest.prototype.sendAsBinary=function(a){function b(a){return 255&a.charCodeAt(0)}var c=Array.prototype.map.call(a,b),d=new Uint8Array(c);this.send(d.buffer)}),"function"==typeof f.onInit&&f.onInit.call($this)},Html5Upload.prototype.clearQueue=function(a){var b=this,c=a.data("uploadify"),d=c.settings;for(var e in c.inputs)for(input=c.inputs[e],limit=input.files.length,i=0;i<limit;i++)file=input.files[i],b.cancel(a,file);"function"==typeof d.onClearQueue&&d.onClearQueue.call(f,$("#"+c.settings.queueID))},Html5Upload.prototype.cancel=function(a,b,c){var d=this,e=a.data("uploadify"),f=e.settings;"string"==typeof b&&(isNaN(b)||(fileID="uploadify-"+a.attr("id")+"-file-"+b),b=$("#"+fileID).data("file")),b.skip=!0,e.filesCancelled++,b.uploading&&(e.uploads.current--,b.uploading=!1,b.xhr.abort(),delete b.xhr,d.upload(a)),$.inArray("onCancel",f.overrideEvents)<0&&e.removeQueueItem(b,c),"function"==typeof f.onCancel&&f.onCancel.call($this,b)},Html5Upload.prototype.upload=function(a,b,c){var d=$(this).data("uploadify"),e=d.settings;if(b)d.uploadFile.call(a,b);else if(d.uploads.count+d.uploads.current<e.uploadLimit||0==e.uploadLimit){if(!c){d.uploads.attempted=0,d.uploads.successsful=0,d.uploads.errors=0;var f=d.filesToUpload();"function"==typeof e.onUpload&&e.onUpload.call(f,f)}$("#"+e.queueID).find(".uploadify-queue-item").not(".error, .complete").each(function(){return _file=$(this).data("file"),d.uploads.current>=e.simUploadLimit&&0!==e.simUploadLimit||d.uploads.current>=e.uploadLimit&&0!==e.uploadLimit||d.uploads.count>=e.uploadLimit&&0!==e.uploadLimit?!1:void(e.checkScript?(_file.checking=!0,skipFile=d.checkExists(_file),_file.checking=!1,skipFile||d.uploadFile(_file,!0)):d.uploadFile(_file,!0))}),0==$("#"+e.queueID).find(".uploadify-queue-item").not(".error, .complete").size()&&d.queueComplete()}else 0==d.uploads.current&&($.inArray("onError",e.overrideEvents)<0&&d.filesToUpload()>0&&0!=e.uploadLimit&&alert("The maximum upload limit has been reached."),"function"==typeof e.onError&&e.onError.call(f,"UPLOAD_LIMIT_EXCEEDED",d.filesToUpload()))},Html5Upload.prototype.destroy=function(a){var b=this,c=a.data("uploadify"),d=c.settings;b.clearQueue(a),d.queueID||$("#"+d.queueID).remove(),a.siblings("input").remove(),a.show().insertBefore(c.button),c.button.remove(),"function"==typeof d.onDestroy&&d.onDestroy.call(a)},Html5Upload.prototype.disable=function(a){var b=$(this).data("uploadify");b.disable(a)},Html5Upload.prototype.clear=function(){var a=$(this).data("uploadify"),b=a.settings;return $(this).each(function(){$("#"+b.queueID).find("div.uploadify-queue-item").remove()})};var FlashUpload=function(){var a=this;FlashUpload=function(){return a}};FlashUpload.prototype.init=function(a,b,c){if(b.autoCheck&&!methods.isFlashAvailable())return alert(b.configFlash),b.onFallback&&b.onFallback.call(e),!1;var d=this,e=a,f=($.data(e[0],"uploader"),e.attr("id")),g=this.getHandlers();if(!e.is("input"))return void alert(b.definedInput);if("undefined"==typeof f)return void alert(b.definedId);if("undefined"==typeof e.attr("type")||"file"!=e.attr("type"))return void alert(b.definedType);($.browser.msie||$.browser.webkit)&&$(window).unload(function(){$("object[id*=SWFUpload_]","body").parent().remove(".swfupload")});b.dir||"",b.readfile;return e.each(function(){var a=e.clone(),h=$.extend({id:f,swf:consts.WEB_BASE+"lib/kui/swf/uploadify.swf",auto:!0,buttonCursor:"hand",checkExisting:!1,debug:!1,fileObjName:"Filedata",fileSizeLimit:0,itemTemplate:!1,method:"post",formData:{},preventCaching:!0,progressData:"percentage",queueID:!1,fileNumLimit:999,removeCompleted:!0,removeTimeout:3,requeueErrors:!1,successTimeout:30,uploadLimit:0,overrideEvents:[]},b),i={assume_success_timeout:h.successTimeout,button_placeholder_id:h.id,button_width:h.width,button_height:h.height,button_text:null,button_text_style:null,button_text_top_padding:0,button_text_left_padding:0,button_action:h.multi?SWFUpload.BUTTON_ACTION.SELECT_FILES:SWFUpload.BUTTON_ACTION.SELECT_FILE,button_disabled:!1,button_cursor:"arrow"==h.buttonCursor?SWFUpload.CURSOR.ARROW:SWFUpload.CURSOR.HAND,button_window_mode:SWFUpload.WINDOW_MODE.TRANSPARENT,debug:h.debug,requeue_on_error:h.requeueErrors,file_post_name:h.fileObjName,file_size_limit:h.fileSizeLimit,file_types:h.fileTypeExts,file_types_description:h.fileTypeDesc,file_queue_limit:h.fileNumLimit,file_upload_limit:h.uploadLimit,flash_url:h.swf,prevent_swf_caching:h.preventCaching,post_params:h.formData,upload_url:h.uploadUrl,use_query_string:"get"==h.method,file_dialog_complete_handler:g.onDialogClose,file_dialog_start_handler:g.onDialogOpen,file_queued_handler:g.onSelect,file_queue_error_handler:g.onSelectError,swfupload_loaded_handler:h.onSWFReady,upload_complete_handler:g.onUploadComplete,upload_error_handler:g.onUploadError,upload_progress_handler:g.onUploadProgress,upload_start_handler:g.onUploadStart,upload_success_handler:g.onUploadSuccess};c&&(i=$.extend(i,c)),i=$.extend(i,h),window["uploadify_"+h.id]=new SWFUpload(i);var j=window["uploadify_"+h.id];$.data($(this)[0],"uploadify",j);var k=$("<div />",{id:h.id,name:e.attr("name"),"class":"uploadify",css:{height:h.height+"px",width:h.width+"px"}});if($("#"+j.movieName).wrap(k),k=$("#"+h.id),k.data("uploadify",j),h.showButton){var l=$("<div/>",{id:h.id+"-button","class":"uploadify-button "+h.buttonClass});h.buttonImage&&l.css({"background-image":"url('"+h.buttonImage+"')","text-indent":"-9999px"}),l.html('<span class="uploadify-button-text">'+h.buttonText+"</span>").css({height:h.height+"px","line-height":h.height+"px",width:h.width+"px"}).click(function(){$(this).hasClass("disabled")&&$alert("您上传的的文件数量已经达到最大值，不能再继续上传！请先删除已上传的文件后再试。")})}else l=$();k.append(l);var m=$('<input type="hidden" name="'+e.attr("name")+'">');if(k.append(m),$("#"+j.movieName).css({position:"absolute","z-index":1,right:0}),h.movieClass&&$("#"+j.movieName).addClass(h.movieClass),!h.queueID){var n=h.showQueue?$('<div style="width:auto;"/>').attr("id",h.id+"-queue").attr("class","uploadify-queue"):$();k.after(n),j.settings.queueID=h.id+"-queue",j.settings.defaultQueue=!0}return j.queueData={files:{},filesSelected:0,filesQueued:0,filesReplaced:0,filesCancelled:0,filesErrored:0,uploadsSuccessful:0,uploadsErrored:0,averageSpeed:0,queueLength:0,queueSize:0,uploadSize:0,queueBytesUploaded:0,uploadQueue:[],errorMsg:"文件没有添加到队列"},j.original=a,j.wrapper=k,j.button=l,j.queue=n,h.onlyView&&(k.hide(),j.queue.find("div.cancel").hide()),h.fileData&&h.fileData.length?(m.val(""+h.fileData),d.showFiles.call(e,h.fileData)):void(h.onInit&&h.onInit.call(e,j))})},FlashUpload.prototype.getHandlers=function(){return{onDialogOpen:function(){var a=this.settings;this.queueData.errorMsg="文件没有添加到队列",this.queueData.filesReplaced=0,this.queueData.filesCancelled=0,a.onDialogOpen&&a.onDialogOpen.call(this)},onDialogClose:function(a,b,c){var d=this.settings;this.queueData.filesErrored=a-b,this.queueData.filesSelected=a,this.queueData.filesQueued=b-this.queueData.filesCancelled,this.queueData.queueLength=c,$.inArray("onDialogClose",d.overrideEvents)<0&&this.queueData.filesErrored>0&&alert(this.queueData.errorMsg),d.onDialogClose&&d.onDialogClose.call(this,this.queueData),d.auto&&$("#"+d.id).uploadify("upload","*")},onSelect:function(a){var b=this.settings,c={};for(var d in this.queueData.files)if(c=this.queueData.files[d],1!=c.uploaded&&c.name==a.name){var e=$.message.confirm("提示",'文件名为"'+a.name+'"的文件已经存在队列中.\n你想替换队列中存在着的文件吗?');if(!e)return this.cancelUpload(a.id),this.queueData.filesCancelled++,!1;$("#"+c.id).remove(),this.cancelUpload(c.id),this.queueData.filesReplaced++}var f=Math.round(a.size/1024),g="KB";f>1e3&&(f=Math.round(f/1e3),g="MB");var h=f.toString().split(".");f=h[0],h.length>1&&(f+="."+h[1].substr(0,2)),f+=g;var i=a.name;if(i.length>25&&(i=i.substr(0,25)+"..."),itemData={fileID:a.id,instanceID:b.id,FILENAME:i,fileSize:f},0==b.itemTemplate&&(b.itemTemplate='<div id="${fileID}" class="uploadify-queue-item">    					<div class="cancel">    						<a href="javascript:$(\'#${instanceID}\').uploadify(\'cancel\', \'${fileID}\')"></a>    					</div>    					<span class="FILENAME">${FILENAME}</span><span class="data"></span>    					<div class="uploadify-progress">    						<div class="uploadify-progress-bar"><!--Progress Bar--></div>    					</div>    				</div>'),$.inArray("onSelect",b.overrideEvents)<0){itemHTML=b.itemTemplate;for(var j in itemData)itemHTML=itemHTML.replace(new RegExp("\\$\\{"+j+"\\}","g"),itemData[j]);$("#"+b.queueID).append(itemHTML)}this.queueData.queueSize+=a.size,this.queueData.files[a.id]=a,b.onSelect&&b.onSelect.apply(this,arguments)},onSelectError:function(a,b,c){var d=this.settings;if($.inArray("onSelectError",d.overrideEvents)<0)switch(b){case SWFUpload.QUEUE_ERROR.QUEUE_LIMIT_EXCEEDED:this.queueData.errorMsg+=d.fileNumLimit>c?"\n选定的文件数量超过剩余的上传限制 ("+c+").":"\n选定的文件数量超过该队列的大小限制 ("+d.fileNumLimit+").";break;case SWFUpload.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT:this.queueData.errorMsg+='\n这个文件"'+a.name+'" 大小不能超过 ('+d.fileSizeLimit+").";break;case SWFUpload.QUEUE_ERROR.ZERO_BYTE_FILE:this.queueData.errorMsg+='\n这个文件"'+a.name+'"的内容为空.';break;case SWFUpload.QUEUE_ERROR.INVALID_FILETYPE:this.queueData.errorMsg+='\n这个文件 "'+a.name+'" 文件类型不支持 ('+d.fileTypeDesc+")."}b!=SWFUpload.QUEUE_ERROR.QUEUE_LIMIT_EXCEEDED&&delete this.queueData.files[a.id],d.onSelectError&&d.onSelectError.apply(this,arguments)},onQueueComplete:function(){this.settings.onQueueComplete&&this.settings.onQueueComplete.call(this,this.settings.queueData)},onUploadComplete:function(a){var b=this.settings,c=this,d=this.getStats();if(this.queueData.queueLength=d.files_queued,"*"==this.queueData.uploadQueue[0]?this.queueData.queueLength>0?this.startUpload():(this.queueData.uploadQueue=[],b.onQueueComplete&&b.onQueueComplete.call(this,this.queueData)):this.queueData.uploadQueue.length>0?this.startUpload(this.queueData.uploadQueue.shift()):(this.queueData.uploadQueue=[],b.onQueueComplete&&b.onQueueComplete.call(this,this.queueData)),$.inArray("onUploadComplete",b.overrideEvents)<0)if(b.removeCompleted)switch(a.filestatus){case SWFUpload.FILE_STATUS.COMPLETE:setTimeout(function(){$("#"+a.id)&&(c.queueData.queueSize-=a.size,c.queueData.queueLength-=1,delete c.queueData.files[a.id],$("#"+a.id).fadeOut(500,function(){$(this).remove()}))},100*b.removeTimeout);break;case SWFUpload.FILE_STATUS.ERROR:b.requeueErrors||setTimeout(function(){$("#"+a.id)&&(c.queueData.queueSize-=a.size,c.queueData.queueLength-=1,delete c.queueData.files[a.id],$("#"+a.id).fadeOut(500,function(){$(this).remove()}))},100*b.removeTimeout)}else a.uploaded=!0;b.onUploadComplete&&b.onUploadComplete.call(this,a)},onUploadError:function(a,b,c){var d=this.settings,e="Error";switch(b){case SWFUpload.UPLOAD_ERROR.HTTP_ERROR:e="HTTP Error ("+c+")";break;case SWFUpload.UPLOAD_ERROR.MISSING_UPLOAD_URL:e="Missing Upload URL";break;case SWFUpload.UPLOAD_ERROR.IO_ERROR:e="IO Error";break;case SWFUpload.UPLOAD_ERROR.SECURITY_ERROR:e="Security Error";break;case SWFUpload.UPLOAD_ERROR.UPLOAD_LIMIT_EXCEEDED:e="Exceeds Upload Limit";break;case SWFUpload.UPLOAD_ERROR.UPLOAD_FAILED:e="Failed";break;case SWFUpload.UPLOAD_ERROR.SPECIFIED_FILE_ID_NOT_FOUND:break;case SWFUpload.UPLOAD_ERROR.FILE_VALIDATION_FAILED:e="Validation Error";break;case SWFUpload.UPLOAD_ERROR.FILE_CANCELLED:e="Cancelled",this.queueData.queueSize-=a.size,this.queueData.queueLength-=1,(a.status==SWFUpload.FILE_STATUS.IN_PROGRESS||$.inArray(a.id,this.queueData.uploadQueue)>=0)&&(this.queueData.uploadSize-=a.size),d.onCancel&&d.onCancel.call(this,a),delete this.queueData.files[a.id];break;case SWFUpload.UPLOAD_ERROR.UPLOAD_STOPPED:e="Stopped"}$.inArray("onUploadError",d.overrideEvents)<0&&(b!=SWFUpload.UPLOAD_ERROR.FILE_CANCELLED&&b!=SWFUpload.UPLOAD_ERROR.UPLOAD_STOPPED&&$("#"+a.id).addClass("uploadify-error"),$("#"+a.id).find(".uploadify-progress-bar").css("width","1px"),b!=SWFUpload.UPLOAD_ERROR.SPECIFIED_FILE_ID_NOT_FOUND&&a.status!=SWFUpload.FILE_STATUS.COMPLETE&&$("#"+a.id).find(".data").html(" - "+e));var f=this.getStats();this.queueData.uploadsErrored=f.upload_errors,d.onUploadError&&d.onUploadError.call(this,a,b,c,e)},onUploadProgress:function(a,b,c){var d=this.settings,e=new Date,f=e.getTime(),g=f-this.timer;g>500&&(this.timer=f);var h=b-this.bytesLoaded;this.bytesLoaded=b;var i=this.queueData.queueBytesUploaded+b,j=Math.round(b/c*100),k="KB/s",l=0,m=h/1024/(g/1e3);m=Math.floor(10*m)/10,this.queueData.averageSpeed=Math.floor(this.queueData.averageSpeed>0?(this.queueData.averageSpeed+m)/2:m),m>1e3&&(l=.001*m,this.queueData.averageSpeed=Math.floor(l),k="MB/s"),$.inArray("onUploadProgress",d.overrideEvents)<0&&("percentage"==d.progressData?$("#"+a.id).find(".data").html(" - "+j+"%"):"speed"==d.progressData&&g>500&&$("#"+a.id).find(".data").html(" - "+this.queueData.averageSpeed+k),$("#"+a.id).find(".uploadify-progress-bar").css("width",j+"%")),d.onUploadProgress&&d.onUploadProgress.call(this,a,b,c,i,this.queueData.uploadSize)},onUploadStart:function(a){var b=this.settings,c=new Date;this.timer=c.getTime(),this.bytesLoaded=0,0==this.queueData.uploadQueue.length&&(this.queueData.uploadSize=a.size),b.checkExisting&&$.ajax({type:"POST",async:!1,url:b.checkExisting,data:{FILENAME:a.name},success:function(b){if(1==b){var c=confirm('A file with the name "'+a.name+'" already exists on the server.\nWould you like to replace the existing file?');c||(this.cancelUpload(a.id),$("#"+a.id).remove(),this.queueData.uploadQueue.length>0&&this.queueData.queueLength>0&&("*"==this.queueData.uploadQueue[0]?this.startUpload():this.startUpload(this.queueData.uploadQueue.shift())))}}}),b.onUploadStart&&b.onUploadStart.call(this,a)},onUploadSuccess:function(file,data,response){if(!$.trim(data))return void alert("未获取到服务器返回的数据！",alert.ERROR);var settings=this.settings,stats=this.getStats();this.queueData.uploadsSuccessful=stats.successful_uploads,this.queueData.queueBytesUploaded+=file.size,$.inArray("onUploadSuccess",settings.overrideEvents)<0&&$("#"+file.id).find(".data").html(" - 完成");var target=$("#"+settings.id),targetName=$(target).attr("name"),fileData=eval("("+data+")");if("object"==typeof fileData&&"false"===fileData.flag)return void alert(fileData.msg);if(!settings.showResult)return settings.fileNumLimit&&this.queueData.queueLength>=settings.fileNumLimit&&$(target).uploadify("disable",!0),void($.isFunction(settings.onUploadSuccess)&&settings.onUploadSuccess.call(this,file,data,response));for(var i=0;i<fileData.length;i++){var file=fileData[i],fileLength=file.FILENAME.length;fileLength>24&&(file.FILENAME=file.FILENAME.substring(0,8)+"..."+file.FILENAME.substring(file.FILENAME.lastIndexOf(".")-3,file.FILENAME.length));var fileWrapper=$('<div class="uploadify-queue-item" FILENAME="'+file.FILENAME+'" FILECON="'+file.FILECON+'"/>'),fileSpan=$('<span class="FILENAME"/>'),cancel=$('<div class="cancel"><a href="javascript:void(0)" ATT_ID="'+file.ATT_ID+'" FILENAME="'+file.FILENAME+'" FILECON="'+file.FILECON+'"></a></div>');fileSpan.append('<a href="javascript:void(0)" FILENAME="'+file.FILENAME+'" FILECON="'+file.FILECON+'">'+file.FILENAME+"    ("+file.FILESIZE+")</a>"),fileWrapper.append(cancel).append(fileSpan),this.queue.append(fileWrapper);var hiddenIpt=$(target).find("input[name][name="+targetName+"]");hiddenIpt.val(""!=hiddenIpt.val()&&void 0!=file.ATT_ID?hiddenIpt.val()+","+file.ATT_ID:file.ATT_ID)}this.queue.find("span:last a").click(function(){window.open("/kjdp_download?DIR="+settings.dir+"&FILENAME="+$(this).attr("FILENAME")+"&FILECON="+$(this).attr("FILECON")+"&IS_IMAGE_RESOURCE="+settings.IS_IMAGE_RESOURCE+"&LOCAL_RESOURCE="+settings.LOCAL_RESOURCE+"&UN_RENAME="+settings.UN_RENAME)});var $this=this;this.queue.find("div.cancel:last a").click(function(a){var b=$(this).attr("FILECON"),c=$(this).attr("FILENAME"),d=$(this).attr("ATT_ID");return $.get("/kjdp_delete?DIR="+settings.dir+"&FILENAME="+c+"&FILECON="+b+"&ATT_ID="+d+"&IS_IMAGE_RESOURCE="+settings.IS_IMAGE_RESOURCE+"&LOCAL_RESOURCE="+settings.LOCAL_RESOURCE+"&UN_RENAME="+settings.UN_RENAME+"&SERVICE=P0004014",{},function(){var a=$(target).find("input[name][name="+targetName+"]"),b=a.val();if(""!=b){var c=b.split(","),e=$.grep(c,function(a){return a!=d});a.val(e.join(","))}else a.val("")}),settings.fileNumLimit&&$this.queueData.queueLength<settings.fileNumLimit&&$(target).uploadify("disable",!1),$(this).parent().parent().remove(),a&&a.preventDefault?a.preventDefault():window.event.returnValue=!1,settings.onDeleteSuccess&&settings.onDeleteSuccess.call(this,file,data,response),!1}),settings.fileNumLimit&&this.queueData.queueLength>=settings.fileNumLimit&&$(target).uploadify("disable",!0),settings.onUploadSuccess&&settings.onUploadSuccess.call(this,file,data,response)}}},FlashUpload.prototype.cancel=function(){var a=arguments;this.each(function(){var b=$(this),c=$.data($(this)[0],"uploadify"),d=c.settings,e=-1;if(a[0])if("*"==a[0]){var f=c.queueData.queueLength;$("#"+d.queueID).find(".uploadify-queue-item").each(function(){e++,a[1]===!0?c.cancelUpload($(this).attr("id"),!1):c.cancelUpload($(this).attr("id")),$(this).find(".data").removeClass("data").html(" - Cancelled"),$(this).find(".uploadify-progress-bar").remove(),$(this).delay(1e3+100*e).fadeOut(500,function(){$(this).remove()})}),c.queueData.queueSize=0,c.queueData.queueLength=0,d.onClearQueue&&d.onClearQueue.call(b,f)}else for(var g=0;g<a.length;g++)a[g]&&(c.cancelUpload(a[g]),$("#"+a[g]).find(".data").removeClass("data").html(" - Cancelled"),$("#"+a[g]).find(".uploadify-progress-bar").remove(),$("#"+a[g]).delay(1e3+100*g).fadeOut(500,function(){$(this).remove()}));else{var h=$("#"+d.queueID).find(".uploadify-queue-item").get(0);$item=$(h),c.cancelUpload($item.attr("id")),$item.find(".data").removeClass("data").html(" - Cancelled"),$item.find(".uploadify-progress-bar").remove(),$item.delay(1e3).fadeOut(500,function(){$(this).remove()})}})},FlashUpload.prototype.destroy=function(a){a.each(function(){var a=($(this),$.data($(this)[0],"uploadify")),b=a.settings;a.destroy(),b.defaultQueue&&$("#"+b.queueID).remove(),$("#"+b.id).replaceWith(a.original),b.onDestroy&&b.onDestroy.call(this),delete a})},FlashUpload.prototype.disable=function(a){this.each(function(){var b=($(this),$.data($(this)[0],"uploadify")),c=b.settings;a?(b.button.addClass("disabled").css("z-index","100"),c.onDisable&&c.onDisable.call(this)):(b.button.removeClass("disabled").css("z-index","0"),c.onEnable&&c.onEnable.call(this)),b.setButtonDisabled(a)})},FlashUpload.prototype.settings=function(a,b,c,d){var e=arguments,f=c;return a.each(function(){var a=($(this),$.data($(this)[0],"uploadify"));if(settings=a.settings,"object"==typeof e[0])for(var g in c)setData(g,c[g]);if(1===e.length)f=settings[b];else{switch(b){case"uploadUrl":a.setUploadURL(c);break;case"formData":d||(c=$.extend(settings.formData,c)),a.setPostParams(settings.formData);break;case"method":a.setUseQueryString("get"==c?!0:!1);break;case"fileObjName":a.setFilePostName(c);break;case"fileTypeExts":a.setFileTypes(c,settings.fileTypeDesc);break;case"fileTypeDesc":a.setFileTypes(settings.fileTypeExts,c);break;case"fileSizeLimit":a.setFileSizeLimit(c);break;case"uploadLimit":a.setFileUploadLimit(c);break;case"fileNumLimit":a.setFileQueueLimit(c);break;case"buttonImage":a.button.css("background-image",settingValue);break;case"buttonCursor":a.setButtonCursor("arrow"==c?SWFUpload.CURSOR.ARROW:SWFUpload.CURSOR.HAND);break;case"buttonText":$("#"+settings.id+"-button").find(".uploadify-button-text").html(c);break;case"width":a.setButtonDimensions(c,settings.height);break;case"height":a.setButtonDimensions(settings.width,c);break;case"multi":a.setButtonAction(c?SWFUpload.BUTTON_ACTION.SELECT_FILES:SWFUpload.BUTTON_ACTION.SELECT_FILE)}settings[b]=c}}),1===e.length?f:void 0
},FlashUpload.prototype.stop=function(a){a.each(function(){var a=($(this),$.data($(this)[0],"uploadify"));a.queueData.averageSpeed=0,a.queueData.uploadSize=0,a.queueData.bytesUploaded=0,a.queueData.uploadQueue=[],a.stopUpload()})},FlashUpload.prototype.showFiles=function(){var a=arguments;this.each(function(){var b=($(this),$.data($(this)[0],"uploadify")),c=b.settings,d=$("#"+c.id),e=$(d).attr("name"),f=$(d).find("input[name][name="+e+"]");if(a[0]&&a[0]instanceof Array){for(var g=a[0],h=0;h<g.length;h++){var i=g[h],j=i.FILENAME.length;j>24&&(i.FILENAME=i.FILENAME.substring(0,8)+"..."+i.FILENAME.substring(i.FILENAME.lastIndexOf("."),i.FILENAME.length));var k=$('<div class="uploadify-queue-item" FILENAME="'+i.FILENAME+'" FILECON="'+i.FILECON+'"/>'),l=$('<span class="FILENAME"/>'),m=$('<div class="cancel"><a href="javascript:void(0)" ATT_ID="'+i.ATT_ID+'" FILENAME="'+i.FILENAME+'" FILECON="'+i.FILECON+'"></a></div>');l.append('<a href="javascript:void(0)" ATT_ID="'+i.ATT_ID+'" FILENAME="'+i.FILENAME+'" FILECON="'+i.FILECON+'">'+i.FILENAME+"    ("+i.FILESIZE+")</a>"),k.append(m).append(l),c.onlyView===!0&&(b.wrapper.hide(),m.hide()),b.queue.append(k),f.val(""!=f.val()&&void 0!=i.ATT_ID?i.ATT_ID:f.val()+","+i.ATT_ID)}b.queue.find("span a").click(function(){window.open("/kjdp_download?DIR="+c.dir+"&FILENAME="+$(this).attr("FILENAME")+"&FILECON="+$(this).attr("FILECON")+"&IS_IMAGE_RESOURCE="+c.IS_IMAGE_RESOURCE+"&LOCAL_RESOURCE="+c.LOCAL_RESOURCE+"&UN_RENAME="+c.UN_RENAME)}),b.queue.find("div.cancel a").click(function(a){var b=$(this).attr("FILECON"),d=$(this).attr("FILENAME"),e=$(this).attr("ATT_ID");return $.get("/kjdp_delete?DIR="+c.dir+"&FILENAME="+d+"&FILECON="+b+"&ATT_ID="+e+"&IS_IMAGE_RESOURCE="+c.IS_IMAGE_RESOURCE+"&LOCAL_RESOURCE="+c.LOCAL_RESOURCE+"&UN_RENAME="+c.UN_RENAME+"&SERVICE=P0004014",{},function(){var a=f.val();if(""!=a)if(-1==a.indexOf(","))f.val("");else{var b=a.split(","),c=$.grep(b,function(a){return a!=e});f.val(c.join(","))}else f.val("")}),$(this).parent().parent().remove(),a&&a.preventDefault?a.preventDefault():window.event.returnValue=!1,c.onDeleteSuccess&&c.onDeleteSuccess.call(this,i,data,response),!1})}})},FlashUpload.prototype.upload=function(){var a=arguments;this.each(function(){{var b=($(this),$.data($(this)[0],"uploadify"));b.settings}if(b.queueData.averageSpeed=0,b.queueData.uploadSize=0,b.queueData.bytesUploaded=0,b.queueData.uploadQueue=[],a[0])if("*"==a[0])b.queueData.uploadSize=b.queueData.queueSize,b.queueData.uploadQueue.push("*"),b.startUpload();else{for(var c=0;c<a.length;c++)b.queueData.uploadSize+=b.queueData.files[a[c]].size,b.queueData.uploadQueue.push(a[c]);b.startUpload(b.queueData.uploadQueue.shift())}else b.startUpload()})},FlashUpload.prototype.onlyView=function(a,b){var c=$.data($(a)[0],"uploadify");return a.each(function(){1==b?(c.wrapper.hide(),c.queue.find("div.cancel").hide()):(c.wrapper.show(),c.queue.find("div.cancel").show())})},FlashUpload.prototype.clear=function(){var a=$.data($(this)[0],"uploadify");return $(this).each(function(){a.queue.find("div.uploadify-queue-item").remove()})};var SWFUpload;"undefined"==typeof SWFUpload&&(SWFUpload=function(a){this.initSWFUpload(a)}),SWFUpload.prototype.initSWFUpload=function(a){try{this.customSettings={},this.settings=a,this.eventQueue=[],this.movieName="SWFUpload_"+SWFUpload.movieCount++,this.movieElement=null,SWFUpload.instances[this.movieName]=this,this.initSettings(),this.loadFlash(),this.displayDebugInfo()}catch(b){throw delete SWFUpload.instances[this.movieName],b}},SWFUpload.instances={},SWFUpload.movieCount=0,SWFUpload.version="2.2.0 2009-03-25",SWFUpload.QUEUE_ERROR={QUEUE_LIMIT_EXCEEDED:-100,FILE_EXCEEDS_SIZE_LIMIT:-110,ZERO_BYTE_FILE:-120,INVALID_FILETYPE:-130},SWFUpload.UPLOAD_ERROR={HTTP_ERROR:-200,MISSING_UPLOAD_URL:-210,IO_ERROR:-220,SECURITY_ERROR:-230,UPLOAD_LIMIT_EXCEEDED:-240,UPLOAD_FAILED:-250,SPECIFIED_FILE_ID_NOT_FOUND:-260,FILE_VALIDATION_FAILED:-270,FILE_CANCELLED:-280,UPLOAD_STOPPED:-290},SWFUpload.FILE_STATUS={QUEUED:-1,IN_PROGRESS:-2,ERROR:-3,COMPLETE:-4,CANCELLED:-5},SWFUpload.BUTTON_ACTION={SELECT_FILE:-100,SELECT_FILES:-110,START_UPLOAD:-120},SWFUpload.CURSOR={ARROW:-1,HAND:-2},SWFUpload.WINDOW_MODE={WINDOW:"window",TRANSPARENT:"transparent",OPAQUE:"opaque"},SWFUpload.completeURL=function(a){if("string"!=typeof a||a.match(/^https?:\/\//i)||a.match(/^\//))return a;var b=(window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""),window.location.pathname.lastIndexOf("/"));return path=0>=b?"/":window.location.pathname.substr(0,b)+"/",path+a},SWFUpload.prototype.initSettings=function(){this.ensureDefault=function(a,b){this.settings[a]=void 0==this.settings[a]?b:this.settings[a]},this.ensureDefault("upload_url",""),this.ensureDefault("preserve_relative_urls",!1),this.ensureDefault("file_post_name","Filedata"),this.ensureDefault("post_params",{}),this.ensureDefault("use_query_string",!1),this.ensureDefault("requeue_on_error",!1),this.ensureDefault("http_success",[]),this.ensureDefault("assume_success_timeout",0),this.ensureDefault("file_types","*.*"),this.ensureDefault("file_types_description","All Files"),this.ensureDefault("file_size_limit",0),this.ensureDefault("file_upload_limit",0),this.ensureDefault("file_queue_limit",0),this.ensureDefault("flash_url","swfupload.swf"),this.ensureDefault("prevent_swf_caching",!0),this.ensureDefault("button_image_url",""),this.ensureDefault("button_width",1),this.ensureDefault("button_height",1),this.ensureDefault("button_text",""),this.ensureDefault("button_text_style","color: #000000; font-size: 16pt;"),this.ensureDefault("button_text_top_padding",0),this.ensureDefault("button_text_left_padding",0),this.ensureDefault("button_action",SWFUpload.BUTTON_ACTION.SELECT_FILES),this.ensureDefault("button_disabled",!1),this.ensureDefault("button_placeholder_id",""),this.ensureDefault("button_placeholder",null),this.ensureDefault("button_cursor",SWFUpload.CURSOR.ARROW),this.ensureDefault("button_window_mode",SWFUpload.WINDOW_MODE.WINDOW),this.ensureDefault("debug",!1),this.settings.debug_enabled=this.settings.debug,this.settings.return_upload_start_handler=this.returnUploadStart,this.ensureDefault("swfupload_loaded_handler",null),this.ensureDefault("file_dialog_start_handler",null),this.ensureDefault("file_queued_handler",null),this.ensureDefault("file_queue_error_handler",null),this.ensureDefault("file_dialog_complete_handler",null),this.ensureDefault("upload_start_handler",null),this.ensureDefault("upload_progress_handler",null),this.ensureDefault("upload_error_handler",null),this.ensureDefault("upload_success_handler",null),this.ensureDefault("upload_complete_handler",null),this.ensureDefault("debug_handler",this.debugMessage),this.ensureDefault("custom_settings",{}),this.customSettings=this.settings.custom_settings,this.settings.prevent_swf_caching&&(this.settings.flash_url=this.settings.flash_url+(this.settings.flash_url.indexOf("?")<0?"?":"&")+"preventswfcaching="+(new Date).getTime()),this.settings.preserve_relative_urls||(this.settings.upload_url=SWFUpload.completeURL(this.settings.upload_url),this.settings.button_image_url=this.settings.button_image_url?SWFUpload.completeURL(this.settings.button_image_url):""),delete this.ensureDefault},SWFUpload.prototype.loadFlash=function(){var a,b;if(null!==document.getElementById(this.movieName))throw"ID "+this.movieName+" is already in use. The Flash Object could not be added";if(a=document.getElementById(this.settings.button_placeholder_id)||this.settings.button_placeholder,void 0==a)throw"Could not find the placeholder element: "+this.settings.button_placeholder_id;b=document.createElement("div"),b.innerHTML=this.getFlashHTML(),a.parentNode.replaceChild(b.firstChild,a),void 0==window[this.movieName]&&(window[this.movieName]=this.getMovieElement())},SWFUpload.prototype.getFlashHTML=function(){var a=['<object id="',this.movieName,'"'];return $.browser.msie||a.push('data="',this.settings.flash_url,'"'),a.push(' type="application/x-shockwave-flash" width="',this.settings.button_width,'" height="',this.settings.button_height,'" class="swfupload">'),a.push('<param name="wmode" value="',this.settings.button_window_mode,'" />'),$.browser.msie&&a.push('<param name="movie" value="',this.settings.flash_url,'" />'),a.push('<param name="quality" value="high" />'),a.push('<param name="menu" value="false" />'),a.push('<param name="allowScriptAccess" value="always" />'),a.push('<param name="flashvars" value="'+this.getFlashVars()+'" />'),a.push("</object>"),a.join("")},SWFUpload.prototype.getFlashVars=function(){var a=this.buildParamString(),b=this.settings.http_success.join(",");return["movieName=",encodeURIComponent(this.movieName),"&amp;uploadURL=",encodeURIComponent(this.settings.upload_url),"&amp;useQueryString=",encodeURIComponent(this.settings.use_query_string),"&amp;requeueOnError=",encodeURIComponent(this.settings.requeue_on_error),"&amp;httpSuccess=",encodeURIComponent(b),"&amp;assumeSuccessTimeout=",encodeURIComponent(this.settings.assume_success_timeout),"&amp;params=",encodeURIComponent(a),"&amp;filePostName=",encodeURIComponent(this.settings.file_post_name),"&amp;fileTypes=",encodeURIComponent(this.settings.file_types),"&amp;fileTypesDescription=",encodeURIComponent(this.settings.file_types_description),"&amp;fileSizeLimit=",encodeURIComponent(this.settings.file_size_limit),"&amp;fileUploadLimit=",encodeURIComponent(this.settings.file_upload_limit),"&amp;fileQueueLimit=",encodeURIComponent(this.settings.file_queue_limit),"&amp;debugEnabled=",encodeURIComponent(this.settings.debug_enabled),"&amp;buttonImageURL=",encodeURIComponent(this.settings.button_image_url),"&amp;buttonWidth=",encodeURIComponent(this.settings.button_width),"&amp;buttonHeight=",encodeURIComponent(this.settings.button_height),"&amp;buttonText=",encodeURIComponent(this.settings.button_text),"&amp;buttonTextTopPadding=",encodeURIComponent(this.settings.button_text_top_padding),"&amp;buttonTextLeftPadding=",encodeURIComponent(this.settings.button_text_left_padding),"&amp;buttonTextStyle=",encodeURIComponent(this.settings.button_text_style),"&amp;buttonAction=",encodeURIComponent(this.settings.button_action),"&amp;buttonDisabled=",encodeURIComponent(this.settings.button_disabled),"&amp;buttonCursor=",encodeURIComponent(this.settings.button_cursor)].join("")},SWFUpload.prototype.getMovieElement=function(){if(void 0==this.movieElement&&(this.movieElement=document.getElementById(this.movieName)),null===this.movieElement)throw"Could not find Flash element";return this.movieElement},SWFUpload.prototype.buildParamString=function(){var a=this.settings.post_params,b=[];if("object"==typeof a)for(var c in a)a.hasOwnProperty(c)&&b.push(encodeURIComponent(c.toString())+"="+encodeURIComponent(a[c].toString()));return b.join("&amp;")},SWFUpload.prototype.destroy=function(){try{this.cancelUpload(null,!1);var a=null;if(a=this.getMovieElement(),a&&"unknown"==typeof a.CallFunction){for(var b in a)try{"function"==typeof a[b]&&(a[b]=null)}catch(c){}try{a.parentNode.removeChild(a)}catch(d){}}return window[this.movieName]=null,SWFUpload.instances[this.movieName]=null,delete SWFUpload.instances[this.movieName],this.movieElement=null,this.settings=null,this.customSettings=null,this.eventQueue=null,this.movieName=null,!0}catch(e){return!1}},SWFUpload.prototype.displayDebugInfo=function(){this.debug(["---SWFUpload Instance Info---\n","Version: ",SWFUpload.version,"\n","Movie Name: ",this.movieName,"\n","Settings:\n","	","upload_url:               ",this.settings.upload_url,"\n","	","flash_url:                ",this.settings.flash_url,"\n","	","use_query_string:         ",this.settings.use_query_string.toString(),"\n","	","requeue_on_error:         ",this.settings.requeue_on_error.toString(),"\n","	","http_success:             ",this.settings.http_success.join(", "),"\n","	","assume_success_timeout:   ",this.settings.assume_success_timeout,"\n","	","file_post_name:           ",this.settings.file_post_name,"\n","	","post_params:              ",this.settings.post_params.toString(),"\n","	","file_types:               ",this.settings.file_types,"\n","	","file_types_description:   ",this.settings.file_types_description,"\n","	","file_size_limit:          ",this.settings.file_size_limit,"\n","	","file_upload_limit:        ",this.settings.file_upload_limit,"\n","	","file_queue_limit:         ",this.settings.file_queue_limit,"\n","	","debug:                    ",this.settings.debug.toString(),"\n","	","prevent_swf_caching:      ",this.settings.prevent_swf_caching.toString(),"\n","	","button_placeholder_id:    ",this.settings.button_placeholder_id.toString(),"\n","	","button_placeholder:       ",this.settings.button_placeholder?"Set":"Not Set","\n","	","button_image_url:         ",this.settings.button_image_url.toString(),"\n","	","button_width:             ",this.settings.button_width.toString(),"\n","	","button_height:            ",this.settings.button_height.toString(),"\n","	","button_text:              ",this.settings.button_text.toString(),"\n","	","button_text_style:        ",this.settings.button_text_style.toString(),"\n","	","button_text_top_padding:  ",this.settings.button_text_top_padding.toString(),"\n","	","button_text_left_padding: ",this.settings.button_text_left_padding.toString(),"\n","	","button_action:            ",this.settings.button_action.toString(),"\n","	","button_disabled:          ",this.settings.button_disabled.toString(),"\n","	","custom_settings:          ",this.settings.custom_settings.toString(),"\n","Event Handlers:\n","	","swfupload_loaded_handler assigned:  ",("function"==typeof this.settings.swfupload_loaded_handler).toString(),"\n","	","file_dialog_start_handler assigned: ",("function"==typeof this.settings.file_dialog_start_handler).toString(),"\n","	","file_queued_handler assigned:       ",("function"==typeof this.settings.file_queued_handler).toString(),"\n","	","file_queue_error_handler assigned:  ",("function"==typeof this.settings.file_queue_error_handler).toString(),"\n","	","upload_start_handler assigned:      ",("function"==typeof this.settings.upload_start_handler).toString(),"\n","	","upload_progress_handler assigned:   ",("function"==typeof this.settings.upload_progress_handler).toString(),"\n","	","upload_error_handler assigned:      ",("function"==typeof this.settings.upload_error_handler).toString(),"\n","	","upload_success_handler assigned:    ",("function"==typeof this.settings.upload_success_handler).toString(),"\n","	","upload_complete_handler assigned:   ",("function"==typeof this.settings.upload_complete_handler).toString(),"\n","	","debug_handler assigned:             ",("function"==typeof this.settings.debug_handler).toString(),"\n"].join(""))},SWFUpload.prototype.addSetting=function(a,b,c){return this.settings[a]=void 0==b?c:b},SWFUpload.prototype.getSetting=function(a){return void 0!=this.settings[a]?this.settings[a]:""},SWFUpload.prototype.callFlash=function(functionName,argumentArray){argumentArray=argumentArray||[];var movieElement=this.getMovieElement(),returnValue,returnString;try{returnString=movieElement.CallFunction('<invoke name="'+functionName+'" returntype="javascript">'+__flash__argumentsToXML(argumentArray,0)+"</invoke>"),returnValue=eval(returnString)}catch(ex){throw"Call to "+functionName+" failed"+ex}return void 0!=returnValue&&"object"==typeof returnValue.post&&(returnValue=this.unescapeFilePostParams(returnValue)),returnValue},SWFUpload.prototype.selectFile=function(){this.callFlash("SelectFile")},SWFUpload.prototype.selectFiles=function(){this.callFlash("SelectFiles")},SWFUpload.prototype.startUpload=function(a){this.callFlash("StartUpload",[a])},SWFUpload.prototype.cancelUpload=function(a,b){b!==!1&&(b=!0),this.callFlash("CancelUpload",[a,b])},SWFUpload.prototype.stopUpload=function(){this.callFlash("StopUpload")},SWFUpload.prototype.getStats=function(){return this.callFlash("GetStats")},SWFUpload.prototype.setStats=function(a){this.callFlash("SetStats",[a])},SWFUpload.prototype.getFile=function(a){return"number"==typeof a?this.callFlash("GetFileByIndex",[a]):this.callFlash("GetFile",[a])},SWFUpload.prototype.addFileParam=function(a,b,c){return this.callFlash("AddFileParam",[a,b,c])},SWFUpload.prototype.removeFileParam=function(a,b){this.callFlash("RemoveFileParam",[a,b])},SWFUpload.prototype.setUploadURL=function(a){this.settings.upload_url=a.toString(),this.callFlash("SetUploadURL",[a])},SWFUpload.prototype.setPostParams=function(a){this.settings.post_params=a,this.callFlash("SetPostParams",[a])},SWFUpload.prototype.addPostParam=function(a,b){this.settings.post_params[a]=b,this.callFlash("SetPostParams",[this.settings.post_params])},SWFUpload.prototype.removePostParam=function(a){delete this.settings.post_params[a],this.callFlash("SetPostParams",[this.settings.post_params])},SWFUpload.prototype.setFileTypes=function(a,b){this.settings.file_types=a,this.settings.file_types_description=b,this.callFlash("SetFileTypes",[a,b])},SWFUpload.prototype.setFileSizeLimit=function(a){this.settings.file_size_limit=a,this.callFlash("SetFileSizeLimit",[a])},SWFUpload.prototype.setFileUploadLimit=function(a){this.settings.file_upload_limit=a,this.callFlash("SetFileUploadLimit",[a])},SWFUpload.prototype.getFileUploadLimit=function(){return this.callFlash("GetFileUploadLimit")},SWFUpload.prototype.setFileQueueLimit=function(a){this.settings.file_queue_limit=a,this.callFlash("SetFileQueueLimit",[a])},SWFUpload.prototype.setFilePostName=function(a){this.settings.file_post_name=a,this.callFlash("SetFilePostName",[a])},SWFUpload.prototype.setUseQueryString=function(a){this.settings.use_query_string=a,this.callFlash("SetUseQueryString",[a])},SWFUpload.prototype.setRequeueOnError=function(a){this.settings.requeue_on_error=a,this.callFlash("SetRequeueOnError",[a])},SWFUpload.prototype.setHTTPSuccess=function(a){"string"==typeof a&&(a=a.replace(" ","").split(",")),this.settings.http_success=a,this.callFlash("SetHTTPSuccess",[a])},SWFUpload.prototype.setAssumeSuccessTimeout=function(a){this.settings.assume_success_timeout=a,this.callFlash("SetAssumeSuccessTimeout",[a])},SWFUpload.prototype.setDebugEnabled=function(a){this.settings.debug_enabled=a,this.callFlash("SetDebugEnabled",[a])},SWFUpload.prototype.setButtonImageURL=function(a){void 0==a&&(a=""),this.settings.button_image_url=a,this.callFlash("SetButtonImageURL",[a])},SWFUpload.prototype.setButtonDimensions=function(a,b){this.settings.button_width=a,this.settings.button_height=b;var c=this.getMovieElement();void 0!=c&&(c.style.width=a+"px",c.style.height=b+"px"),this.callFlash("SetButtonDimensions",[a,b])},SWFUpload.prototype.setButtonText=function(a){this.settings.button_text=a,this.callFlash("SetButtonText",[a])},SWFUpload.prototype.setButtonTextPadding=function(a,b){this.settings.button_text_top_padding=b,this.settings.button_text_left_padding=a,this.callFlash("SetButtonTextPadding",[a,b])},SWFUpload.prototype.setButtonTextStyle=function(a){this.settings.button_text_style=a,this.callFlash("SetButtonTextStyle",[a])},SWFUpload.prototype.setButtonDisabled=function(a){this.settings.button_disabled=a,this.callFlash("SetButtonDisabled",[a])},SWFUpload.prototype.setButtonAction=function(a){this.settings.button_action=a,this.callFlash("SetButtonAction",[a])},SWFUpload.prototype.setButtonCursor=function(a){this.settings.button_cursor=a,this.callFlash("SetButtonCursor",[a])},SWFUpload.prototype.queueEvent=function(a,b){void 0==b?b=[]:b instanceof Array||(b=[b]);var c=this;if("function"==typeof this.settings[a])this.eventQueue.push(function(){this.settings[a].apply(this,b)}),setTimeout(function(){c.executeNextEvent()},0);else if(null!==this.settings[a])throw"Event handler "+a+" is unknown or is not a function"},SWFUpload.prototype.executeNextEvent=function(){var a=this.eventQueue?this.eventQueue.shift():null;"function"==typeof a&&a.apply(this)},SWFUpload.prototype.unescapeFilePostParams=function(a){var b,c=/[$]([0-9a-f]{4})/i,d={};if(void 0!=a){for(var e in a.post)if(a.post.hasOwnProperty(e)){b=e;for(var f;null!==(f=c.exec(b));)b=b.replace(f[0],String.fromCharCode(parseInt("0x"+f[1],16)));d[b]=a.post[e]}a.post=d}return a},SWFUpload.prototype.testExternalInterface=function(){try{return this.callFlash("TestExternalInterface")}catch(a){return!1}},SWFUpload.prototype.flashReady=function(){var a=this.getMovieElement();return a?(this.cleanUp(a),void this.queueEvent("swfupload_loaded_handler")):void this.debug("Flash called back ready but the flash movie can't be found.")},SWFUpload.prototype.cleanUp=function(a){try{if(this.movieElement&&"unknown"==typeof a.CallFunction){this.debug("Removing Flash functions hooks (this should only run in IE and should prevent memory leaks)");for(var b in a)try{"function"==typeof a[b]&&(a[b]=null)}catch(c){}}}catch(d){}window.__flash__removeCallback=function(a,b){try{a&&(a[b]=null)}catch(c){}}},SWFUpload.prototype.fileDialogStart=function(){this.queueEvent("file_dialog_start_handler")},SWFUpload.prototype.fileQueued=function(a){a=this.unescapeFilePostParams(a),this.queueEvent("file_queued_handler",a)},SWFUpload.prototype.fileQueueError=function(a,b,c){a=this.unescapeFilePostParams(a),this.queueEvent("file_queue_error_handler",[a,b,c])},SWFUpload.prototype.fileDialogComplete=function(a,b,c){this.queueEvent("file_dialog_complete_handler",[a,b,c])},SWFUpload.prototype.uploadStart=function(a){a=this.unescapeFilePostParams(a),this.queueEvent("return_upload_start_handler",a)},SWFUpload.prototype.returnUploadStart=function(a){var b;if("function"==typeof this.settings.upload_start_handler)a=this.unescapeFilePostParams(a),b=this.settings.upload_start_handler.call(this,a);else if(void 0!=this.settings.upload_start_handler)throw"upload_start_handler must be a function";void 0===b&&(b=!0),b=!!b,this.callFlash("ReturnUploadStart",[b])},SWFUpload.prototype.uploadProgress=function(a,b,c){a=this.unescapeFilePostParams(a),this.queueEvent("upload_progress_handler",[a,b,c])},SWFUpload.prototype.uploadError=function(a,b,c){a=this.unescapeFilePostParams(a),this.queueEvent("upload_error_handler",[a,b,c])},SWFUpload.prototype.uploadSuccess=function(a,b,c){a=this.unescapeFilePostParams(a),this.queueEvent("upload_success_handler",[a,b,c])},SWFUpload.prototype.uploadComplete=function(a){a=this.unescapeFilePostParams(a),this.queueEvent("upload_complete_handler",a)},SWFUpload.prototype.debug=function(a){this.queueEvent("debug_handler",a)},SWFUpload.prototype.debugMessage=function(a){if(this.settings.debug){var b,c=[];if("object"==typeof a&&"string"==typeof a.name&&"string"==typeof a.message){for(var d in a)a.hasOwnProperty(d)&&c.push(d+": "+a[d]);b=c.join("\n")||"",c=b.split("\n"),b="EXCEPTION: "+c.join("\nEXCEPTION: "),SWFUpload.Console.writeLine(b)}else SWFUpload.Console.writeLine(a)}},SWFUpload.Console={},SWFUpload.Console.writeLine=function(a){var b,c;try{b=document.getElementById("SWFUpload_Console"),b||(c=document.createElement("form"),document.getElementsByTagName("body")[0].appendChild(c),b=document.createElement("textarea"),b.id="SWFUpload_Console",b.style.fontFamily="monospace",b.setAttribute("wrap","off"),b.wrap="off",b.style.overflow="auto",b.style.width="700px",b.style.height="350px",b.style.margin="5px",c.appendChild(b)),b.value+=a+"\n",b.scrollTop=b.scrollHeight-b.clientHeight}catch(d){alert("Exception: "+d.name+" Message: "+d.message)}};var swfobject=function(){function a(){if(!R){try{var a=K.getElementsByTagName("body")[0].appendChild(q("span"));a.parentNode.removeChild(a)}catch(b){return}R=!0;for(var c=N.length,d=0;c>d;d++)N[d]()}}function b(a){R?a():N[N.length]=a}function c(a){if(typeof J.addEventListener!=C)J.addEventListener("load",a,!1);else if(typeof K.addEventListener!=C)K.addEventListener("load",a,!1);else if(typeof J.attachEvent!=C)r(J,"onload",a);else if("function"==typeof J.onload){var b=J.onload;J.onload=function(){b(),a()}}else J.onload=a}function d(){M?e():f()}function e(){var a=K.getElementsByTagName("body")[0],b=q(D);b.setAttribute("type",G);var c=a.appendChild(b);if(c){var d=0;!function(){if(typeof c.GetVariable!=C){var e=c.GetVariable("$version");e&&(e=e.split(" ")[1].split(","),U.pv=[parseInt(e[0],10),parseInt(e[1],10),parseInt(e[2],10)])}else if(10>d)return d++,void setTimeout(arguments.callee,10);a.removeChild(b),c=null,f()}()}else f()}function f(){var a=O.length;if(a>0)for(var b=0;a>b;b++){var c=O[b].id,d=O[b].callbackFn,e={success:!1,id:c};if(U.pv[0]>0){var f=p(c);if(f)if(!s(O[b].swfVersion)||U.wk&&U.wk<312)if(O[b].expressInstall&&h()){var k={};k.data=O[b].expressInstall,k.width=f.getAttribute("width")||"0",k.height=f.getAttribute("height")||"0",f.getAttribute("class")&&(k.styleclass=f.getAttribute("class")),f.getAttribute("align")&&(k.align=f.getAttribute("align"));for(var l={},m=f.getElementsByTagName("param"),n=m.length,o=0;n>o;o++)"movie"!=m[o].getAttribute("name").toLowerCase()&&(l[m[o].getAttribute("name")]=m[o].getAttribute("value"));i(k,l,c,d)}else j(f),d&&d(e);else u(c,!0),d&&(e.success=!0,e.ref=g(c),d(e))}else if(u(c,!0),d){var q=g(c);q&&typeof q.SetVariable!=C&&(e.success=!0,e.ref=q),d(e)}}}function g(a){var b=null,c=p(a);if(c&&"OBJECT"==c.nodeName)if(typeof c.SetVariable!=C)b=c;else{var d=c.getElementsByTagName(D)[0];d&&(b=d)}return b}function h(){return!S&&s("6.0.65")&&(U.win||U.mac)&&!(U.wk&&U.wk<312)}function i(a,b,c,d){S=!0,y=d||null,z={success:!1,id:c};var e=p(c);if(e){"OBJECT"==e.nodeName?(w=k(e),x=null):(w=e,x=c),a.id=H,(typeof a.width==C||!/%$/.test(a.width)&&parseInt(a.width,10)<310)&&(a.width="310"),(typeof a.height==C||!/%$/.test(a.height)&&parseInt(a.height,10)<137)&&(a.height="137"),K.title=K.title.slice(0,47)+" - Flash Player Installation";var f=U.ie&&U.win?"ActiveX":"PlugIn",g="MMredirectURL="+J.location.toString().replace(/&/g,"%26")+"&MMplayerType="+f+"&MMdoctitle="+K.title;if(typeof b.flashvars!=C?b.flashvars+="&"+g:b.flashvars=g,U.ie&&U.win&&4!=e.readyState){var h=q("div");c+="SWFObjectNew",h.setAttribute("id",c),e.parentNode.insertBefore(h,e),e.style.display="none",function(){4==e.readyState?e.parentNode.removeChild(e):setTimeout(arguments.callee,10)}()}l(a,b,c)}}function j(a){if(U.ie&&U.win&&4!=a.readyState){var b=q("div");a.parentNode.insertBefore(b,a),b.parentNode.replaceChild(k(a),b),a.style.display="none",function(){4==a.readyState?a.parentNode.removeChild(a):setTimeout(arguments.callee,10)}()}else a.parentNode.replaceChild(k(a),a)}function k(a){var b=q("div");if(U.win&&U.ie)b.innerHTML=a.innerHTML;else{var c=a.getElementsByTagName(D)[0];if(c){var d=c.childNodes;if(d)for(var e=d.length,f=0;e>f;f++)1==d[f].nodeType&&"PARAM"==d[f].nodeName||8==d[f].nodeType||b.appendChild(d[f].cloneNode(!0))}}return b}function l(a,b,c){var d,e=p(c);if(U.wk&&U.wk<312)return d;if(e)if(typeof a.id==C&&(a.id=c),U.ie&&U.win){var f="";for(var g in a)a[g]!=Object.prototype[g]&&("data"==g.toLowerCase()?b.movie=a[g]:"styleclass"==g.toLowerCase()?f+=' class="'+a[g]+'"':"classid"!=g.toLowerCase()&&(f+=" "+g+'="'+a[g]+'"'));var h="";for(var i in b)b[i]!=Object.prototype[i]&&(h+='<param name="'+i+'" value="'+b[i]+'" />');e.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+f+">"+h+"</object>",P[P.length]=a.id,d=p(a.id)}else{var j=q(D);j.setAttribute("type",G);for(var k in a)a[k]!=Object.prototype[k]&&("styleclass"==k.toLowerCase()?j.setAttribute("class",a[k]):"classid"!=k.toLowerCase()&&j.setAttribute(k,a[k]));for(var l in b)b[l]!=Object.prototype[l]&&"movie"!=l.toLowerCase()&&m(j,l,b[l]);e.parentNode.replaceChild(j,e),d=j}return d}function m(a,b,c){var d=q("param");d.setAttribute("name",b),d.setAttribute("value",c),a.appendChild(d)}function n(a){var b=p(a);b&&"OBJECT"==b.nodeName&&(U.ie&&U.win?(b.style.display="none",function(){4==b.readyState?o(a):setTimeout(arguments.callee,10)}()):b.parentNode.removeChild(b))}function o(a){var b=p(a);if(b){for(var c in b)"function"==typeof b[c]&&(b[c]=null);b.parentNode.removeChild(b)}}function p(a){var b=null;try{b=K.getElementById(a)}catch(c){}return b}function q(a){return K.createElement(a)}function r(a,b,c){a.attachEvent(b,c),Q[Q.length]=[a,b,c]}function s(a){var b=U.pv,c=a.split(".");return c[0]=parseInt(c[0],10),c[1]=parseInt(c[1],10)||0,c[2]=parseInt(c[2],10)||0,b[0]>c[0]||b[0]==c[0]&&b[1]>c[1]||b[0]==c[0]&&b[1]==c[1]&&b[2]>=c[2]?!0:!1}function t(a,b,c,d){if(!U.ie||!U.mac){var e=K.getElementsByTagName("head")[0];if(e){var f=c&&"string"==typeof c?c:"screen";if(d&&(A=null,B=null),!A||B!=f){var g=q("style");g.setAttribute("type","text/css"),g.setAttribute("media",f),A=e.appendChild(g),U.ie&&U.win&&typeof K.styleSheets!=C&&K.styleSheets.length>0&&(A=K.styleSheets[K.styleSheets.length-1]),B=f}U.ie&&U.win?A&&typeof A.addRule==D&&A.addRule(a,b):A&&typeof K.createTextNode!=C&&A.appendChild(K.createTextNode(a+" {"+b+"}"))}}}function u(a,b){if(T){var c=b?"visible":"hidden";R&&p(a)?p(a).style.visibility=c:t("#"+a,"visibility:"+c)}}function v(a){var b=/[\\\"<>\.;]/,c=null!=b.exec(a);return c&&typeof encodeURIComponent!=C?encodeURIComponent(a):a}{var w,x,y,z,A,B,C="undefined",D="object",E="Shockwave Flash",F="ShockwaveFlash.ShockwaveFlash",G="application/x-shockwave-flash",H="SWFObjectExprInst",I="onreadystatechange",J=window,K=document,L=navigator,M=!1,N=[d],O=[],P=[],Q=[],R=!1,S=!1,T=!0,U=function(){var a=typeof K.getElementById!=C&&typeof K.getElementsByTagName!=C&&typeof K.createElement!=C,b=L.userAgent.toLowerCase(),c=L.platform.toLowerCase(),d=/win/.test(c?c:b),e=/mac/.test(c?c:b),f=/webkit/.test(b)?parseFloat(b.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1,g=!1,h=[0,0,0],i=null;if(typeof L.plugins!=C&&typeof L.plugins[E]==D)i=L.plugins[E].description,!i||typeof L.mimeTypes!=C&&L.mimeTypes[G]&&!L.mimeTypes[G].enabledPlugin||(M=!0,g=!1,i=i.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),h[0]=parseInt(i.replace(/^(.*)\..*$/,"$1"),10),h[1]=parseInt(i.replace(/^.*\.(.*)\s.*$/,"$1"),10),h[2]=/[a-zA-Z]/.test(i)?parseInt(i.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0);else if(typeof J.ActiveXObject!=C)try{var j=new ActiveXObject(F);j&&(i=j.GetVariable("$version"),i&&(g=!0,i=i.split(" ")[1].split(","),h=[parseInt(i[0],10),parseInt(i[1],10),parseInt(i[2],10)]))}catch(k){}return{w3:a,pv:h,wk:f,ie:g,win:d,mac:e}}();!function(){U.w3&&((typeof K.readyState!=C&&"complete"==K.readyState||typeof K.readyState==C&&(K.getElementsByTagName("body")[0]||K.body))&&a(),R||(typeof K.addEventListener!=C&&K.addEventListener("DOMContentLoaded",a,!1),U.ie&&U.win&&(K.attachEvent(I,function(){"complete"==K.readyState&&(K.detachEvent(I,arguments.callee),a())}),J==top&&!function(){if(!R){try{K.documentElement.doScroll("left")}catch(b){return void setTimeout(arguments.callee,0)}a()}}()),U.wk&&!function(){return R?void 0:/loaded|complete/.test(K.readyState)?void a():void setTimeout(arguments.callee,0)}(),c(a)))}(),function(){U.ie&&U.win&&window.attachEvent("onunload",function(){for(var a=Q.length,b=0;a>b;b++)Q[b][0].detachEvent(Q[b][1],Q[b][2]);for(var c=P.length,d=0;c>d;d++)n(P[d]);for(var e in U)U[e]=null;U=null;for(var f in swfobject)swfobject[f]=null;swfobject=null})}()}return{registerObject:function(a,b,c,d){if(U.w3&&a&&b){var e={};e.id=a,e.swfVersion=b,e.expressInstall=c,e.callbackFn=d,O[O.length]=e,u(a,!1)}else d&&d({success:!1,id:a})},getObjectById:function(a){return U.w3?g(a):void 0},embedSWF:function(a,c,d,e,f,g,j,k,m,n){var o={success:!1,id:c};U.w3&&!(U.wk&&U.wk<312)&&a&&c&&d&&e&&f?(u(c,!1),b(function(){d+="",e+="";var b={};if(m&&typeof m===D)for(var p in m)b[p]=m[p];b.data=a,b.width=d,b.height=e;var q={};if(k&&typeof k===D)for(var r in k)q[r]=k[r];if(j&&typeof j===D)for(var t in j)typeof q.flashvars!=C?q.flashvars+="&"+t+"="+j[t]:q.flashvars=t+"="+j[t];if(s(f)){var v=l(b,q,c);b.id==c&&u(c,!0),o.success=!0,o.ref=v}else{if(g&&h())return b.data=g,void i(b,q,c,n);u(c,!0)}n&&n(o)})):n&&n(o)},switchOffAutoHideShow:function(){T=!1},ua:U,getFlashPlayerVersion:function(){return{major:U.pv[0],minor:U.pv[1],release:U.pv[2]}},hasFlashPlayerVersion:s,createSWF:function(a,b,c){return U.w3?l(a,b,c):void 0},showExpressInstall:function(a,b,c,d){U.w3&&h()&&i(a,b,c,d)
},removeSWF:function(a){U.w3&&n(a)},createCSS:function(a,b,c,d){U.w3&&t(a,b,c,d)},addDomLoadEvent:b,addLoadEvent:c,getQueryParamValue:function(a){var b=K.location.search||K.location.hash;if(b){if(/\?/.test(b)&&(b=b.split("?")[1]),null==a)return v(b);for(var c=b.split("&"),d=0;d<c.length;d++)if(c[d].substring(0,c[d].indexOf("="))==a)return v(c[d].substring(c[d].indexOf("=")+1))}return""},expressInstallCallback:function(){if(S){var a=p(H);a&&w&&(a.parentNode.replaceChild(w,a),x&&(u(x,!0),U.ie&&U.win&&(w.style.display="block")),y&&y(z)),S=!1}}}}();window.swfobject=swfobject,window.SWFUpload=SWFUpload}),define("lib/kui/fieldset",[],function(){function a(a){var d=$(a),f=$.data(a,"fieldset").options,g=d.children("legend").length?d.children("legend"):$("<legend>"+f.title+"</legend>").appendTo(d);d.addClass("fieldset"),f.showTitle||g.hide(),f.closable&&(g.addClass("collapse-enable").append("<span class='closable-span'></span>"),b(a),f.collapsed&&c(a)),e(a)}function b(a){var b=$.data(a,"fieldset").options,e=$(a),f=e.children("legend");f.unbind("click.fieldset"),b.closable&&f.bind("click.fieldset",function(){e.hasClass("collapsed")?d(a):c(a)})}function c(a){for(var b=$.data(a,"fieldset").options,c=$(a).children(":not(legend)"),d=1,e=0;e<c.length;e++){var f=c[e];b.animation?$(f).slideUp(b.speed,function(){d==c.length?b.closeCallback.call(a,a):d++}):$(f).hide()}b.collapsed=!0,$(a).addClass("collapsed")}function d(a){for(var b=$.data(a,"fieldset").options,c=$(a).children(":not(legend)"),d=1,e=0;e<c.length;e++){var f=c[e];b.animation?$(f).slideDown(b.speed,function(){d==c.length?b.expendCallback.call(a,a):d++}):$(f).show()}b.collapsed=!1,$(a).removeClass("collapsed")}function e(a,b){var c=$.data(a,"fieldset").options;if(1==c.fit){var d=$(a).parent();c.width=d.width(),c.height=d.height()}b&&(b.width&&(c.width=b.width),b.height&&(c.height=b.height)),c.width&&$(a).width(c.width),c.height&&$(a).height(c.height-$(a).children("legend").height())}$.fn.fieldset=function(b){if("string"==typeof b){var c=$.fn.fieldset.methods[b];if(c)return c.apply(this,[this].concat(Array.prototype.slice.call(arguments,1)))}return this.each(function(){b=b||{};var c=$.data(this,"fieldset");c?$.extend(c.options,b):($.data(this,"fieldset",{options:$.extend(!0,{},$.fn.fieldset.defaults,$.fn.fieldset.parseOptions(this),b)}),a(this))})},$.fn.fieldset.methods={options:function(a){return $.data(a[0],"fieldset").options},resize:function(a,b){return a.each(function(){e(this,b)})},hideField:function(a){return a.each(function(){c(this)})},showField:function(a){return a.each(function(){d(this)})}},$.fn.fieldset.parseOptions=function(a){return $.parser.parseOptions(a)},$.fn.fieldset.defaults={title:"",fit:!1,width:"",height:"",showTitle:!0,closable:!1,collapsed:!1,animation:!0,speed:"fast",closeCallback:$.noop,expendCallback:$.noop}}),define("lib/kui/obviousbox",[],function(require,exports,module){function init(a){var b=$.data(a,"obviousbox").options;$(a).hide(),$(a).addClass("obviousbox-f");var c=['<div class="obviousbox">','<div class="ovs-box-options">',b.title?"<div class='ovs-box-title'><span>"+b.title+"：</span></div>":"","</div>","</div>"];if($(c.join("")).insertAfter($(a)),b&&b.data&&loadData(a,b.data),b&&b.toolbar){var d='<div class="ovs-item-clear" style="display:none"><a class="ovs-clear-button">清空</a></div>';$(".ovs-box-options",$(a).next()).append(d)}}function request(a,b,c,d){var e=$.data(a,"obviousbox").options;b&&(e.url=b),c=c||{},0!=e.onBeforeLoad.call(a,c)&&e.loader.call(a,c,function(b){loadData(a,b,d)},function(){e.onLoadError.apply(this,arguments)})}function loadData(target,data){if(data&&!$.isEmptyObject(data)){var options=new Array,option;option="string"==typeof data?eval("("+data+")"):data;var opts=$.data(target,"obviousbox").options;option=opts.loadFilter.call(target,option),$(".ovs-box-options",$(target).next()).css("height","").find(".ovs-item").remove(),$(".combo-value",$(target).next()).remove();var dft=opts.dftValue;if(dft){options.push('<div class="ovs-item" style="width:'+(opts.itemWidth?opts.itemWidth+"px":"")+'">');for(k in dft)options.push('<a data-value="'+k+'" class="ovs-item-a ovs-item-dft ovs-item-a-on">'+dft[k]+"</a>");options.push("</div>")}$.each(option,function(a,b){options.push('<div class="ovs-item" style="width:'+(opts.itemWidth?opts.itemWidth+"px":"")+'">'),opts.checkbox&&options.push("<input type='checkbox' class='item-checkbox' value='"+b[opts.valueField]+"' name='"+b[opts.valueField]+"'/>");var c="";if(opts.textField)for(var d=opts.textField.split(","),e=0,f=d.length;f>e;e++)c+=b[d[e]],e+1!=f&&(c+="-");options.push('<a data-value="'+b[opts.valueField]+'" class="ovs-item-a">'+c+"</a>"),options.push("</div>")}),$(".ovs-box-options",$(target).next()).append(options.join("")),$(target).next().append($('<input class="combo-value" type="hidden" name="'+$(target).attr("name")+'" value=""/>')),setSize(target),bindEvents(target)}}function bindEvents(a){function b(b,c){b.hasClass("more-expand")?(c.css({overflow:"auto",height:"72px"}),b.removeClass().addClass("ovs-item-more more-close"),b.find("a.ovs-more-button").text("收起").append("<b></b>"),$(".ovs-box-title").css("height",$(".ovs-box-options",$(a).next())[0].scrollHeight+20+"px")):(c.css({overflow:"hidden",height:"36px"}),b.removeClass().addClass("ovs-item-more more-expand"),b.find("a.ovs-more-button").text("展开").append("<b></b>"),$(".ovs-box-options",$(a).next()).scrollTop(0),$(".ovs-box-title").css("height","100%"))}$(".ovs-box-options",$(a).next()).unbind(".obviousbox").bind("click.obviousbox",function(c){var d=$(c.target),e=$.data(a,"obviousbox").options,f=$(".ovs-box-options",$(a).next()),g=getClickItemData(a,d.attr("value"));if(d.hasClass("ovs-item-a")){var h=d.prev("input:checkbox");e.isDevFlag=!0,!h.prop("disabled")&&h.click()}else if(d.hasClass("item-checkbox"))d.is(":checked")&&e.isDevFlag?(d.removeClass().addClass("item-checkbox"),e.loaded&&e.multiple&&(isInBaseData(a,d.attr("value"))?d.next().addClass("item-change-deleted"):d.next().removeClass().addClass("ovs-item-a")),e.onUnSelect.call(a,d.attr("value"),g)):d.is(":checked")||e.isDevFlag?(d.addClass("item-checkbox-checked"),e.toolbar&&$(".ovs-item-clear",$(a).next()).show(),e.multiple||d.parent().siblings("div.ovs-item").find("input.item-checkbox-checked").each(function(){$(this).attr("checked",!1),$(this).removeClass().addClass("item-checkbox")}),e.loaded&&e.multiple&&(isInBaseData(a,d.attr("value"))?d.next().removeClass().addClass("ovs-item-a"):d.next().addClass("item-change-added")),e.onSelect.call(a,d.attr("value"),g)):(d.removeClass().addClass("item-checkbox"),e.loaded&&e.multiple&&(isInBaseData(a,d.attr("value"))?d.next().addClass("item-change-deleted"):d.next().removeClass().addClass("ovs-item-a")),e.onUnSelect.call(a,d.attr("value"),g)),e.isDevFlag=!1,$(a).next().find("input.combo-value").attr("value",getSelected(a));else if(d.hasClass("ovs-clear-button"))reset(a,!0),d.parent().hide(),$(a).next().find("input.combo-value").attr("value",""),e.selected=[];else if(d.hasClass("ovs-more-button")){var i=d.parent();b(i,f)}else if("B"==d[0].nodeName){var i=d.closest("div.ovs-item-more");b(i,f)}!$(this).find(".item-checkbox-checked").length&&$(".ovs-item-clear",$(a).next()).hide()})}function setDict(){}function isInBaseData(a,b){for(var c=$.data(a,"obviousbox").options,d=c.data,e=0,f=d.length;f>e;e++)if(d[e]==b)return!0;return!1}function getClickItemData(a,b){for(var c=$.data(a,"obviousbox").options,d=c.data,e=0,f=d.length;f>e;e++)if(d[e][c.valueField]==b)return d[e];return d}function hasChanged(a){return $("a[class*='item-change']",$(a).next()).length>0}function getAddedItem(a){var b=[];return $(".item-change-added",$(a).next()).each(function(){b.push($(this).attr("data-value"))}),b}function getDeletedItem(a){var b=[];return $(".item-change-deleted",$(a).next()).each(function(){b.push($(this).attr("data-value"))}),b}function selectAll(a){var b=$.data(a,"obviousbox").options;$(".item-checkbox",$(a).next()).each(function(){$(this).is(":checked")||(b.isDevFlag=!0,$(this).click())})}function unSelectAll(a){var b=$.data(a,"obviousbox").options;$(".item-checkbox",$(a).next()).each(function(){$(this).is(":checked")&&(b.isDevFlag=!0,$(this).click())})}function getSelected(a){var b=[];return $(".ovs-box-options",$(a).next()).find("input.item-checkbox-checked").each(function(){b.push($(this).val())}),b}function getSelections(a){var b=[];return $(".ovs-box-options",$(a).next()).find("input.item-checkbox-checked").each(function(c,d){b.push(getClickItemData(a[0],$(d).val()))}),b}function reverse(a){var b=$.data(a,"obviousbox").options;$("input.item-checkbox",$(a).next()).each(function(){b.isDevFlag=!0,$(this).click()})}function setValue(a,b){var c=$.data(a,"obviousbox").options;c.isDevFlag=!0,$(".item-checkbox[value='"+b+"']",$(a).next()).click()}function setValues(a,b){var c=$.data(a,"obviousbox").options;if(c.loaded=!0,b&&0!=b.length){c.data=b;for(var d=0;d<b.length;d++)c.isDevFlag=!0,$(".item-checkbox[name='"+b[d]+"']",$(a).next()).click()}}function reset(a,b){b="undefined"===$.type(b)?!0:!!b;var c=$.data(a,"obviousbox").options,d=$(".item-checkbox-checked",$(a).next());b?(c.loaded=!1,c.data=[],d.each(function(){c.isDevFlag=!0,$(this).click()}),$("a[class*='item-change']",$(a).next()).each(function(){$(this).removeClass().addClass("ovs-item-a")})):d.each(function(){c.isDevFlag=!0,$(this).click()}),c.onClear.call(a)}function setSize(a){var b=$.data(a,"obviousbox").options,c=$(".ovs-box-options",$(a).next()),d=c.outerHeight();if(d>48&&b.toolbar){c.css({overflow:"hidden",height:"36px"});var e=$('<div class="ovs-item-more more-expand"><a class="ovs-more-button"><b></b>展开</a></div>');c.prepend(e)}else{b.scrollHeight||d}}$.fn.obviousbox=function(a,b){if("string"==typeof a){var c=$.fn.obviousbox.methods[a];return c?c(this,b):$.fn.combo.methods[a](this,b)}return a=a||{},this.each(function(){var b=$.data(this,"obviousbox");b?$.extend(b.options,a):b=$.data(this,"obviousbox",{options:$.extend({},$.fn.obviousbox.defaults,$.fn.obviousbox.parseOptions(this),a)}),init(this),b.options.dict?setDict(this,b.options.dict):request(this)})},$.fn.obviousbox.parseOptions=function(target){var jq=$(target);return $.extend({},$.parser.parseOptions(target,[{colNumbers:"number"}],{req:jq.attr("req")?eval(jq.attr("req")):void 0}))},$.fn.obviousbox.methods={options:function(a){var b=$.data(a[0],"obviousbox").options;return b},submit:function(a,b){return a.each(function(){ajaxSubmit(this,$.extend({},$.fn.form.defaults,b||{}))})},loadData:function(a,b){return a.each(function(){loadData(this,b)})},setValue:function(a,b){return a.each(function(){setValue(this,b)})},setValues:function(a,b){return a.each(function(){setValues(this,b)})},selectAll:function(a){return a.each(function(){selectAll(this)})},unSelectAll:function(a){return a.each(function(){unSelectAll(this)})},getSelected:function(a){return getSelected(a)},getSelections:function(a){return getSelections(a)},reverse:function(a){return a.each(function(){reverse(this)})},reset:function(a,b){return a.each(function(){reset(this,b)})},hasChanged:function(a){return hasChanged(a[0])},getAddedItem:function(a){return getAddedItem(a[0])},getDeletedItem:function(a){return getDeletedItem(a[0])}},$.fn.obviousbox.defaults={url:null,req:[],autoSubmit:!0,multiple:!1,valueField:null,textField:null,toolbar:!0,data:[],loaded:!1,maxRows:100,selected:[],isDevFlag:!1,dftValue:null,onSubmit:function(){},success:function(){},onBeforeLoad:function(){},onLoadSuccess:function(){},onLoadError:function(){},onSelect:function(){},onUnSelect:function(){},loader:function(a,b,c){var d=$(this).obviousbox("options");if(!(d.url||d.req&&0!=d.req.length))return!1;d.req&&d.req.length>0&&(d.req[0].service||(d.req[0].service="P9999999"));var e=function(a){var c=a[0];b(c)},f={url:d.url,type:d.method,dataType:"xml",async:!0,responseType:"xml",func:e,error:function(){c.apply(this,arguments)},req:d.req||[]};ajaxRequest(f)},loadFilter:function(a){return a},onClear:function(){}}}),define("lib/kui/scrollbox",[],function(){var a={overflow:"auto",deltaX:20,deltaY:20,scrollSize:7},b={init:function(a){var c=a.data("scrollbox").options;c.ui=b.render(a),c.interval=setInterval(function(){try{b.setSize(a,{width:c.width,height:c.height})}catch(d){clearInterval(c.interval)}},100),b.bindEvents(a)},render:function(a){var b,c=a.data("scrollbox").options,d=$("<div class='scrollbox'></div>"),e=$("<div class='scroll-view'></div>"),f=$("<div class='scrollbar scrollbar-x'></div>"),g=$("<div class='scrollbar scrollbar-y'></div>");switch(a.addClass("scroll-panel").wrap(e),e=a.parent(),e.wrap(d),d=e.parent(),b={scrollBox:d,scrollView:e},c.overflow.toLowerCase()){case"auto":f.appendTo(d),g.appendTo(d),b.scrollX=f,b.scrollY=g;break;case"x":f.appendTo(d),b.scrollX=f,b.scrollY=$();break;case"y":g.appendTo(d),b.scrollX=$(),b.scrollY=g;break;case"hidden":b.scrollX=$(),b.scrollY=$();break;default:f.appendTo(d),g.appendTo(d),b.scrollX=f,b.scrollY=g}return f.hide().height(c.scrollSize),g.hide().width(c.scrollSize),b},setSize:function(a,b){var c,d,e=a.data("scrollbox").options,f=e.ui,g=f.scrollX||$(),h=f.scrollY||$(),i=a[0].scrollWidth||a.outerWidth(!0),j=a[0].scrollHeight||a.outerHeight(!0);$.each([f.scrollView,f.scrollBox],function(){$(this).css({width:b.width||f.scrollBox.parent().width(),height:b.height||f.scrollBox.parent().height()})}),c=f.scrollView.width(),d=f.scrollView.height(),g.css({width:c>=i?0:c*c/i,top:f.scrollView.innerHeight()-g.height(),left:c*f.scrollView.scrollLeft()/i}),h.css({height:d>=j?0:d*d/j,top:d*f.scrollView.scrollTop()/j,left:f.scrollView.innerWidth()-h.width()})},bindEvents:function(a){var c=a.data("scrollbox").options,d=c.ui,e=!1;d.scrollView.mousewheel(function(f,g){g=(g>0?-1:1)*c.deltaX,e?b.scrollLeft(a,d.scrollView.scrollLeft()+g):b.scrollTop(a,d.scrollView.scrollTop()+g),f.stopPropagation(),f.preventDefault()}),$(document).keydown(function(a){16===a.keyCode&&(e=!0)}).keyup(function(a){16===a.keyCode&&(e=!1)}),d.scrollBox.hover(function(){d.scrollX.fadeIn(100),d.scrollY.fadeIn(100)},function(){d.scrollX.fadeOut(100),d.scrollY.fadeOut(100)}),d.scrollX.draggable({cursor:"cursor",axis:"h",onDrag:function(c){var e=d.scrollX.width(),f=d.scrollView.width();c.data.left<0&&(c.data.left=0),f<c.data.left+e&&(c.data.left=f-e),b.scrollLeft(a,(a[0].scrollWidth||a.outerWidth(!0))*d.scrollX.position().left/f)}}),d.scrollY.draggable({cursor:"cursor",axis:"v",onDrag:function(c){var e=d.scrollY.height(),f=d.scrollView.height();c.data.top<0&&(c.data.top=0),f<c.data.top+e&&(c.data.top=f-e),b.scrollTop(a,(a[0].outerHeight||a.outerHeight(!0))*d.scrollY.position().top/f)}})},scrollTop:function(a,c){var d=a.data("scrollbox").options.ui;return"undefined"==typeof c?d.scrollView.scrollTop():(d.scrollView.scrollTop(c),void b.moveY(a,d.scrollView.height()*c/a.outerHeight(!0)))},moveY:function(a,b){var c=a.data("scrollbox").options.ui,d=0,e=c.scrollView.height()-c.scrollY.height();d>=b?b=d:b>=e&&(b=e),c.scrollY.css("top",b)},scrollLeft:function(a,c){var d=a.data("scrollbox").options.ui;return"undefined"==typeof c?d.scrollView.scrollLeft():(d.scrollView.scrollLeft(c),void b.moveX(a,d.scrollView.width()*c/a.outerWidth(!0)))},moveX:function(a,b){var c=a.data("scrollbox").options.ui,d=0,e=c.scrollView.width()-c.scrollX.width();d>=b?b=d:b>=e&&(b=e),c.scrollX.css("left",b)}},c={resize:function(a){b.setSize(this,a||{})},scrollLeft:function(a){return"undefined"==typeof a?b.scrollTop(this):void b.scrollLeft(this,a)},scrollTop:function(a){return"undefined"==typeof a?b.scrollTop(this):void b.scrollTop(this,a)}};$.fn.scrollbox=function(d){var e,f=Array.prototype.slice;return"string"===$.type(d)?c[d].apply(this,f.call(arguments,1)):this.each(function(){e=$(this),e.data("scrollbox")||e.data("scrollbox",{options:$.extend({},a,$.parser.parseOptions(this),d)}),b.init(e)})},$.fn.scrollbox.methods=c,$.fn.scrollbox.defaults=a}),define("lib/kui/slider",[],function(require,exports,module){function init(a){var b=$('<div class="slider"><div class="slider-inner"><a href="javascript:void(0)" class="slider-handle"></a><span class="slider-tip"></span></div><div class="slider-rule"></div><div class="slider-rulelabel"></div><div style="clear:both"></div><input type="hidden" class="slider-value"></div>').insertAfter(a),c=$(a).hide().attr("name");return c&&(b.find("input.slider-value").attr("name",c),$(a).removeAttr("name").attr("sliderName",c)),b}function setSize(a,b){var c=$.data(a,"slider").options,d=$.data(a,"slider").slider;b&&(b.width&&(c.width=b.width),b.height&&(c.height=b.height)),"h"==c.mode?(d.css("height",""),d.children("div").css("height",""),isNaN(c.width)||d.width(c.width)):(d.css("width",""),d.children("div").css("width",""),isNaN(c.height)||(d.height(c.height),d.find("div.slider-rule").height(c.height),d.find("div.slider-rulelabel").height(c.height),d.find("div.slider-inner")._outerHeight(c.height))),initValue(a)}function showRule(a){function b(a){var b=d.find("div.slider-rule"),e=d.find("div.slider-rulelabel");b.empty(),e.empty();for(var f=0;f<a.length;f++){var g=100*f/(a.length-1)+"%",h=$("<span></span>").appendTo(b);h.css("h"==c.mode?"left":"top",g),"|"!=a[f]&&(h=$("<span></span>").appendTo(e),h.html(a[f]),h.css("h"==c.mode?{left:g,marginLeft:-Math.round(h.outerWidth()/2)}:{top:g,marginTop:-Math.round(h.outerHeight()/2)}))}}var c=$.data(a,"slider").options,d=$.data(a,"slider").slider,e="h"==c.mode?c.rule:c.rule.slice(0).reverse();c.reversed&&(e=e.slice(0).reverse()),b(e)}function buildSlider(a){function b(b){var d=Math.abs(b%c.step);d<c.step/2?b-=d:b=b-d+c.step,setValue(a,b)}var c=$.data(a,"slider").options,d=$.data(a,"slider").slider;d.removeClass("slider-h slider-v slider-disabled"),d.addClass("h"==c.mode?"slider-h":"slider-v"),d.addClass(c.disabled?"slider-disabled":""),d.find("a.slider-handle").draggable({axis:c.mode,cursor:"pointer",disabled:c.disabled,onDrag:function(e){var f=e.data.left,g=d.width();if("h"!=c.mode&&(f=e.data.top,g=d.height()),0>f||f>g)return!1;var h=pos2value(a,f);return b(h),!1},onStartDrag:function(){c.onSlideStart.call(a,c.value)},onStopDrag:function(d){var e=pos2value(a,"h"==c.mode?d.data.left:d.data.top);b(e),c.onSlideEnd.call(a,c.value)}})}function setValue(a,b){var c=$.data(a,"slider").options,d=$.data(a,"slider").slider,e=c.value;b<c.min&&(b=c.min),b>c.max&&(b=c.max),c.value=b,$(a).val(b),d.find("input.slider-value").val(b);var f=value2pos(a,b),g=d.find(".slider-tip");if(c.showTip?(g.show(),g.html(c.tipFormatter.call(a,c.value))):g.hide(),"h"==c.mode){var h="left:"+f+"px;";d.find(".slider-handle").attr("style",h),g.attr("style",h+"margin-left:"+-Math.round(g.outerWidth()/2)+"px")}else{var h="top:"+f+"px;";d.find(".slider-handle").attr("style",h),g.attr("style",h+"margin-left:"+-Math.round(g.outerWidth())+"px")}e!=b&&c.onChange.call(a,b,e)}function initValue(a){var b=$.data(a,"slider").options,c=b.onChange;b.onChange=function(){},setValue(a,b.value),b.onChange=c}function value2pos(a,b){var c=$.data(a,"slider").options,d=$.data(a,"slider").slider;if("h"==c.mode){var e=(b-c.min)/(c.max-c.min)*d.width();c.reversed&&(e=d.width()-e)}else{var e=d.height()-(b-c.min)/(c.max-c.min)*d.height();c.reversed&&(e=d.height()-e)}return e.toFixed(0)}function pos2value(a,b){var c=$.data(a,"slider").options,d=$.data(a,"slider").slider;if("h"==c.mode)var e=c.min+(c.max-c.min)*(b/d.width());else var e=c.min+(c.max-c.min)*((d.height()-b)/d.height());return c.reversed?c.max-e.toFixed(0):e.toFixed(0)}$.fn.slider=function(a,b){return"string"==typeof a?$.fn.slider.methods[a](this,b):(a=a||{},this.each(function(){var b=$.data(this,"slider");b?$.extend(b.options,a):(b=$.data(this,"slider",{options:$.extend({},$.fn.slider.defaults,$.fn.slider.parseOptions(this),a),slider:init(this)}),$(this).removeAttr("disabled")),buildSlider(this),showRule(this),setSize(this)}))},$.fn.slider.methods={options:function(a){return $.data(a[0],"slider").options},destroy:function(a){return a.each(function(){$.data(this,"slider").slider.remove(),$(this).remove()})},resize:function(a,b){return a.each(function(){setSize(this,b)})},getValue:function(a){return a.slider("options").value},setValue:function(a,b){return a.each(function(){setValue(this,b)})},enable:function(a){return a.each(function(){$.data(this,"slider").options.disabled=!1,buildSlider(this)})},disable:function(a){return a.each(function(){$.data(this,"slider").options.disabled=!0,buildSlider(this)})}},$.fn.slider.parseOptions=function(target){var t=$(target);return $.extend({},$.parser.parseOptions(target,["width","height","mode",{reversed:"boolean",showTip:"boolean",min:"number",max:"number",step:"number"}]),{value:t.val()||void 0,disabled:t.attr("disabled")?!0:void 0,rule:t.attr("rule")?eval(t.attr("rule")):void 0})},$.fn.slider.defaults={width:"auto",height:"auto",mode:"h",reversed:!1,showTip:!1,disabled:!1,value:0,min:0,max:100,step:1,rule:[],tipFormatter:function(a){return a},onChange:function(){},onSlideStart:function(){},onSlideEnd:function(){}}}),define("lib/kui/tree",[],function(require,exports,module){function wrapTree(a){var b=$(a);return b.addClass("tree"),b}function getContents(a){function b(a,c){c.children("li").each(function(){var c=$(this),d=$.extend({},$.parser.parseOptions(this,["id","iconCls","state"]),{checked:c.attr("checked")?!0:void 0});d.text=c.children("span").html(),d.text||(d.text=c.html());var e=c.children("ul");e.length&&(d.children=[],b(d.children,e)),a.push(d)})}var c=[];return b(c,$(a)),c}function bindEvents(a){bindTreeEvent(a,"dblclick"),bindTreeEvent(a,"click"),bindTreeEvent(a,"mouseover"),bindTreeEvent(a,"mouseout"),bindTreeEvent(a,"contextmenu"),bindTreeEvent(a,"mousedown")}function bindTreeEvent(a,b){_addEvent(a,b,function(c){_treeEventHandler(c,b,a)})}function _addEvent(a,b,c){if(!c||!a||!b)return!1;var d=b+".trees";$(a).unbind(d).bind(d,c)}function _treeEventHandler(a,b,c){var d=$.data(c,"tree").options,e=$(a.target);switch(b){case"contextmenu":d.onContextMenu.call(c,a,getNode(c,this)),a.stopPropagation();break;case"mouseover":var f=e.closest("div.tree-node");return f.addClass("tree-node-hover"),void(e.hasClass("tree-hit")&&e.addClass(e.hasClass("tree-expanded")?"tree-expanded-hover":"tree-collapsed-hover"));case"mouseout":var f=e.closest("div.tree-node");return f.removeClass("tree-node-hover"),void(e.hasClass("tree-hit")&&e.removeClass(e.hasClass("tree-expanded")?"tree-expanded-hover":"tree-collapsed-hover"));case"mousedown":if(e.hasClass("tree-hit")||e.hasClass("tree-checkbox"))return;break;case"click":if(e.hasClass("tree-hit")){var g=e.parent();return void toggle(c,g[0])}if(e.hasClass("tree-checkbox")){var g=e.parent();return void setCheckbox1(c,g[0],!e.hasClass("tree-checkbox1"))}var g=e.closest("div.tree-node");if(onSelect(c,g[0]),e.prev().hasClass("tree-checkbox"))return void setCheckbox1(c,e.parent()[0],!e.prev().hasClass("tree-checkbox1"));d.onClick.call(c,getSelected(c)),a.stopPropagation();break;case"dblclick":var g=e.closest("div.tree-node");onSelect(c,g),d.onDblClick.call(c,getSelected(c)),a.stopPropagation()}}function draDisable(a){var b=$(a).find("div.tree-node");b.draggable("disable"),b.css("cursor","pointer")}function dragFile(target){function dragIn(a,b){function c(){var c=$(target).tree("pop",a);$(target).tree("append",{parent:b,data:[c]}),opts.onDrop.call(target,b,c,"append")}"closed"==getNode(target,b).state?expand(target,b,function(){c()}):c()}function dragOut(a,b,c){var d={};"top"==c?d.before=b:d.after=b;var e=$(target).tree("pop",a);d.data=e,$(target).tree("insert",d),opts.onDrop.call(target,b,e,c)}var opts=$.data(target,"tree").options,tree=$.data(target,"tree").tree;return opts.dragLeafOnly?void tree.find("div.tree-node").filter(function(){return 0==$(this).next("ul").length}).draggable({disabled:!1,revert:!0,cursor:opts.cursor||"pointer",proxy:opts.proxy||function(a){var b=$('<div class="tree-node-proxy tree-dnd-no"></div>').appendTo("body");return b.html($(a).find(".tree-title").html()),b.hide(),b},deltaX:15,deltaY:15,onBeforeDrag:function(a){return 1!=a.which?!1:void opts.onBeforeDrag.call(target,a)},onStartDrag:function(a){$(this).draggable("proxy").css({left:-1e4,top:-1e4}),opts.onStartDrag.call(target,a)},onDrag:function(a){var b=a.pageX,c=a.pageY,d=a.data.startX,e=a.data.startY,f=Math.sqrt((b-d)*(b-d)+(c-e)*(c-e));f>3&&$(this).draggable("proxy").show(),this.pageY=a.pageY,opts.onDrag.call(target,a)},onStopDrag:function(a){opts.onStopDrag.call(target,a)},onRevert:function(a){opts.onRevert.call(target,a)}}):void tree.find("div.tree-node").draggable({disabled:!1,revert:!0,cursor:"pointer",proxy:function(a){var b=$('<div class="tree-node-proxy tree-dnd-no"></div>').appendTo("body");return b.html($(a).find(".tree-title").html()),b.hide(),b},deltaX:15,deltaY:15,onBeforeDrag:function(a){if(1!=a.which)return!1;$(this).next("ul").find("div.tree-node").droppable({accept:"no-accept"});var b=$(this).find("span.tree-indent");b.length&&(a.data.startLeft+=b.length*b.width())},onStartDrag:function(){$(this).draggable("proxy").css({left:-1e4,top:-1e4})},onDrag:function(a){var b=a.pageX,c=a.pageY,d=a.data.startX,e=a.data.startY,f=Math.sqrt((b-d)*(b-d)+(c-e)*(c-e));f>3&&$(this).draggable("proxy").show(),this.pageY=a.pageY},onStopDrag:function(){$(this).next("ul").find("div.tree-node").droppable({accept:"div.tree-node"})}}).droppable({accept:"div.tree-node",onDragOver:function(a,b){var c=b.pageY,d=$(this).offset().top,e=d+$(this).outerHeight();$(b).draggable("proxy").removeClass("tree-dnd-no").addClass("tree-dnd-yes"),$(this).removeClass("tree-node-append tree-node-top tree-node-bottom"),$(this).addClass(c>d+(e-d)/2?5>e-c?"tree-node-bottom":"tree-node-append":5>c-d?"tree-node-top":"tree-node-append")},onDragLeave:function(a,b){$(b).draggable("proxy").removeClass("tree-dnd-yes").addClass("tree-dnd-no"),$(this).removeClass("tree-node-append tree-node-top tree-node-bottom")},onDrop:function(e,_target){var t=this,handler,position;if($(this).hasClass("tree-node-append")?(handler=dragIn,position="append"):(handler=dragOut,position=$(this).hasClass("tree-node-top")?"top":"bottom"),opts.dropMethod){var dropMethod=eval(opts.dropMethod);dropMethod.call(target,_target,t,position,function(){setTimeout(function(){handler(_target,t,position)},0)})}else setTimeout(function(){handler(_target,t,position)},0);$(this).removeClass("tree-node-append tree-node-top tree-node-bottom")}})}function setCheckbox1(a,b,c){function d(a){var b=a.next().find(".tree-checkbox");b.removeClass("tree-checkbox0 tree-checkbox1 tree-checkbox2"),b.addClass(a.find(".tree-checkbox").hasClass("tree-checkbox1")?"tree-checkbox1":"tree-checkbox0")}function e(b){function c(a){var b=a.find(".tree-checkbox");if(b.hasClass("tree-checkbox0")||b.hasClass("tree-checkbox2"))return!1;var c=!0;return a.parent().siblings().each(function(){$(this).children("div.tree-node").children(".tree-checkbox").hasClass("tree-checkbox1")||(c=!1)}),c}function d(a){var b=a.find(".tree-checkbox");if(b.hasClass("tree-checkbox1")||b.hasClass("tree-checkbox2"))return!1;var c=!0;return a.parent().siblings().each(function(){$(this).children("div.tree-node").children(".tree-checkbox").hasClass("tree-checkbox0")||(c=!1)}),c}var g=getParent(a,b[0]);if(g){var h=$(g.target).find(".tree-checkbox");h.removeClass("tree-checkbox0 tree-checkbox1 tree-checkbox2"),h.addClass(c(b)?"tree-checkbox1":d(b)?"tree-checkbox0":f.cascadeCheckValue&&f.cascadeCheck===!0?"tree-checkbox1":"tree-checkbox2"),e($(g.target))}}var f=$.data(a,"tree").options;if(f.checkbox){var g=$(b),h=g.find(".tree-checkbox");h.removeClass("tree-checkbox0 tree-checkbox1 tree-checkbox2"),h.addClass(c?"tree-checkbox1":"tree-checkbox0"),"true"==String(f.cascadeCheck)&&(e(g),d(g));var i=getNode(a,b);f.onCheck.call(a,i,c)}}function setCheckboxNoCascadeCheck(a,b,c){var d=$.data(a,"tree").options;if(d.checkbox){var e=$(b),f=e.find(".tree-checkbox");f.removeClass("tree-checkbox0 tree-checkbox1 tree-checkbox2"),f.addClass(c?"tree-checkbox1":"tree-checkbox0");var g=getNode(a,b);d.onCheck.call(a,g,c)}}function setCheckbox(a,b){var c=$.data(a,"tree").options,d=$(b);if(getHitNode(a,b)){var e=d.find(".tree-checkbox");e.length?e.hasClass("tree-checkbox1")?setCheckbox1(a,b,!0):setCheckbox1(a,b,!1):c.onlyLeafCheck&&($('<span class="tree-checkbox tree-checkbox0"></span>').insertBefore(d.find(".tree-title")),bindEvents(a))}else{var e=d.find(".tree-checkbox");if(c.onlyLeafCheck)e.remove();else if(e.hasClass("tree-checkbox1"))setCheckbox1(a,b,!0);else if(e.hasClass("tree-checkbox2")){for(var f=!0,g=!0,h=getChildren(a,b),i=0;i<h.length;i++)h[i].checked?g=!1:f=!1;f&&setCheckbox1(a,b,!0),g&&setCheckbox1(a,b,!1)}}}function deleteContent(a,b){if(!a)return b;for(var c=[],d=0;d<b.length;d++){var e=b[d],f=e.id;a!=f&&c.push(e)}return c}function childrensObject(a,b){var c={};if(!b)return c;for(var d=[],e=0;e<b.length;e++){var f=b[e],g=f.pid;a==g&&d.push(f)}return c.children=d,c}function loadData(target,ul,data,isAppend){function newRenderNodes(){function parseTreeNode(nodeIdArr,_len){for(var i=0;i<nodeIdArr.length;i++){treeHtmlArr.push("<li>");var treeNode=treeObj[nodeIdArr[i]],node=treeNode.node,children=treeNode.children||[],display="none";treeHtmlArr.push("<div class='tree-node' node-id='"+node.id+"'>");for(var j=0;_len>j;j++)treeHtmlArr.push("<span class='tree-indent'></span>");0==children.length?(treeHtmlArr.push('<span class="tree-indent"></span>'),treeHtmlArr.push('<span class="tree-icon tree-file '+(node.iconCls?node.iconCls:"")+'"></span>')):"all"==opts.treeExpand||opts.treeExpand>_len?(treeHtmlArr.push('<span class="tree-hit tree-expanded"></span>'),treeHtmlArr.push('<span class="tree-icon tree-folder tree-folder-open '+(node.iconCls?node.iconCls:"")+'"></span>'),display="block"):(treeHtmlArr.push('<span class="tree-hit tree-collapsed"></span>'),treeHtmlArr.push('<span class="tree-icon tree-folder '+(node.iconCls?node.iconCls:"")+'"></span>')),eval(opts.checkbox)&&(!opts.onlyLeafCheck||opts.onlyLeafCheck&&0==treeNode.children.length)&&(node.checked?(treeHtmlArr.push('<span class="tree-checkbox tree-checkbox1"></span>'),checkNodeIdArr.push(node.id)):treeHtmlArr.push('<span class="tree-checkbox tree-checkbox0"></span>'));var txt=node.text?node.text:$(node.target).find("span.tree-title").text();treeHtmlArr.push("<span class='tree-title' title='"+txt+"'>"+txt+"</span>"),treeHtmlArr.push("</div>"),children.length>0&&(treeHtmlArr.push("<ul style='display: "+display+"'>"),parseTreeNode(children,_len+1),treeHtmlArr.push("</ul>")),treeHtmlArr.push("</li>")}}for(var treeObj={rootNodeIdArr:[]},i=0;i<data.length;i++)treeObj[data[i].id]?(data.splice(i,1),i--):treeObj[data[i].id]={node:data[i],pNode:data[i].pid,children:[]};for(var i=0;i<data.length;i++)treeObj[data[i].pid]?treeObj[data[i].pid].children.push(data[i].id):treeObj.rootNodeIdArr.push(data[i].id);var lvlLen=$(ul).prev("div.tree-node").find("span.tree-indent, span.tree-hit").length,checkNodeIdArr=[],treeHtmlArr=[];if(0==treeObj.rootNodeIdArr.length)return console.log("tree加载失败，出现了循环节点，没有根节点出现！"),!1;parseTreeNode(treeObj.rootNodeIdArr,lvlLen),$(ul).append(treeHtmlArr.join(""));for(var i=0;i<checkNodeIdArr.length;i++){var $div=$("div.tree-node[node-id="+checkNodeIdArr[i]+"]",$(target));setCheckbox1(target,$div[0],!0)}}if(data&&0!=data.length){var opts=$.data(target,"tree").options;formatDataByConf(opts),$.isEmptyObject(opts.conf)||(data=opts.makeTreeData.call(this,opts.conf,data)),data=opts.loadFilter.call(target,data,$(ul).prev("div.tree-node")[0]),isAppend||($(ul).empty(),opts.data=data||{}),newRenderNodes(),bindEvents(target),opts.dnd&&dragFile(target),setTimeout(function(){createTreeStyle(target,target)},0);var dragNode=null;if(target!=ul){var prev=$(ul).prev();dragNode=getNode(target,prev[0])}opts.onLoadSuccess.call(target,dragNode,data)}}function createTreeStyle(a,b,c){function d(a){var b=a.find("span.tree-icon");b.prev("span.tree-indent").addClass("tree-join")}function e(a){var b=a.find("span.tree-indent, span.tree-hit").length;a.next().find("div.tree-node").each(function(){$(this).children("span:eq("+(b-1)+")").addClass("tree-line")})}var f=$.data(a,"tree").options;
if(f.lines){if(!c){c=!0,$(a).find("span.tree-indent").removeClass("tree-line tree-join tree-joinbottom"),$(a).find("div.tree-node").removeClass("tree-node-last tree-root-first tree-root-one");var g=$(a).tree("getRoots");g.length>1?$(g[0].target).addClass("tree-root-first"):0!=g.length&&$(g[0].target).addClass("tree-root-one")}$(b).children("li").each(function(){var b=$(this).children("div.tree-node"),f=b.next("ul");f.length?($(this).next().length&&e(b),createTreeStyle(a,f,c)):d(b)});var h=$(b).children("li:last").children("div.tree-node").addClass("tree-node-last");h.children("span.tree-join").removeClass("tree-join").addClass("tree-joinbottom")}}function getNodeData(a,b){if(a){var c=b.data;if(c)for(var d=c.length-1;d>=0;d--)if(a==c[d].id)return c[d]}return{}}function request(a,b,c,d){var e=$.data(a,"tree").options;if(!(e.req&&0!=e.req.length||e.url))return!1;c=c||{};var f=null;if(a!=b){var g=$(b).prev();f=getNode(a,g[0])}if(0!=e.onBeforeLoad.call(a,f,c)){var h=$("<span class='tree-folder tree-loading'></span>");$(a).append(h);var i=e.loader.call(a,c,function(c){h.remove(),c&&(e.base=e.data=c,loadData(a,b,e.data)),d&&d()},function(){h.remove(),e.onLoadError.apply(a,arguments),d&&d()});0==i&&h.remove()}}function expand(a,b,c){var d=$.data(a,"tree").options,e=$(b).children("span.tree-hit");if(0!=e.length&&!e.hasClass("tree-expanded")){var f=getNode(a,b);if(0!=d.onBeforeExpand.call(a,f)){e.removeClass("tree-collapsed tree-collapsed-hover").addClass("tree-expanded"),e.next().addClass("tree-folder-open");var g=$(b).next();if(g.length)d.animate?g.slideDown(d.animateSpeed,function(){d.onExpand.call(a,f),c&&c()}):(g.css("display","block"),d.onExpand.call(a,f),c&&c());else{var h=$('<ul style="display:none"></ul>').insertAfter(b);request(a,h[0],{id:f.id},function(){h.is(":empty")&&h.remove(),d.animate?h.slideDown(d.animateSpeed,function(){d.onExpand.call(a,f),c&&c()}):(h.css("display","block"),d.onExpand.call(a,f),c&&c())})}}}}function collapse(a,b){var c=$.data(a,"tree").options,d=$(b).children("span.tree-hit");if(0!=d.length&&!d.hasClass("tree-collapsed")){var e=getNode(a,b);if(0!=c.onBeforeCollapse.call(a,e)){d.removeClass("tree-expanded tree-expanded-hover").addClass("tree-collapsed"),d.next().removeClass("tree-folder-open");var b=$(b).next();c.animate?b.slideUp(c.animateSpeed,function(){c.onCollapse.call(a,e)}):(b.css("display","none"),c.onCollapse.call(a,e))}}}function toggle(a,b){var c=$(b).children("span.tree-hit");0!=c.length&&(c.hasClass("tree-expanded")?collapse(a,b):expand(a,b))}function expandAll(a,b){var c=getChildren(a,b);b&&c.unshift(getNode(a,b));for(var d=0;d<c.length;d++)expand(a,c[d].target)}function expandTo(a,b){if($(b).length){for(var c=[],d=getParent(a,b);d;)c.unshift(d),d=getParent(a,d.target);for(var e=0;e<c.length;e++)expand(a,c[e].target)}}function collapseAll(a,b){var c=getChildren(a,b);b&&c.unshift(getNode(a,b));for(var d=0;d<c.length;d++)collapse(a,c[d].target)}function getRoot(a){var b=getRoots(a);return b.length?b[0]:null}function getRoots(a){var b=[];return $(a).children("li").each(function(){var c=$(this).children("div.tree-node");b.push(getNode(a,c[0]))}),b}function getChildren(a,b){function c(b){b.next().find("div.tree-node").each(function(){d.push(getNode(a,this))})}var d=[];if(b)c($(b));else for(var e=getRoots(a),f=0;f<e.length;f++)d.push(e[f]),c($(e[f].target));return d}function getParent(a,b){var c=$(b).parent().parent();return c[0]==a?null:getNode(a,c.prev()[0])}function getChecked(a){var b=[];return $(a).find(".tree-checkbox1").each(function(){var c=$(this).parent();b.push(getNode(a,c[0]))}),b}function getCascadeCheckNode(a){var b=[];return $(a).find(".tree-checkbox2").each(function(){var c=$(this).parent();b.push(getNode(a,c[0]))}),$(a).find(".tree-checkbox1").each(function(){var c=$(this).parent();b.push(getNode(a,c[0]))}),b}function getSelected(a){var b=$(a).find("div.tree-node-selected");return b.length?getNode(a,b[0]):null}function getSelectedBase(a){var b=$(a).find("div.tree-node-selected"),c=$.data(a,"tree").options,d=$.extend({},c,c.conf);if(base=c.base,!b.length||!base)return null;for(var e=getNode(a,b[0]),f=d.nodeId||"id",g=0,h=base.length;h>g;g++)if(base[g][f]==e.id)return base[g]}function append(a,b){var c,d=$(b.parent);if(0==d.length?c=$(a):(c=d.next(),0==c.length&&(c=$("<ul></ul>").insertAfter(d))),b.data&&b.data.length){var e=d.find("span.tree-icon");if(e.hasClass("tree-file")){e.removeClass("tree-file").addClass("tree-folder");var f=$('<span class="tree-hit tree-expanded"></span>').insertBefore(e);f.prev().length&&f.prev().remove()}}loadData(a,c[0],b.data,!0),setCheckbox(a,c.prev())}function insert(a,b){var c,d=b.before||b.after,e=getParent(a,d);e?(append(a,{parent:e.target,data:[b.data]}),c=$(e.target).next().children("li:last")):(append(a,{parent:null,data:[b.data]}),c=$(a).children("li:last")),b.before?c.insertBefore($(d).parent()):c.insertAfter($(d).parent())}function remove(a,b){var c=getParent(a,b),d=$(b),e=d.parent(),f=e.parent();if(e.remove(),0==f.children("li").length){var d=f.prev();d.find(".tree-icon").removeClass("tree-folder").addClass("tree-file"),d.find(".tree-hit").remove(),$('<span class="tree-indent"></span>').prependTo(d),f[0]!=a&&f.remove()}c&&setCheckbox(a,c.target),createTreeStyle(a,a)}function getData(a,b){function c(b,d){d.children("li").each(function(){var d=$(this).children("div.tree-node"),e=getNode(a,d[0]),f=$(this).children("ul");f.length&&(e.children=[],c(e.children,f)),b.push(e)})}if(b){var d=getNode(a,b);return d.children=[],c(d.children,$(b).next()),d}return null}function update(a,b){var c=$(b.target),d=getNode(a,b.target);d.iconCls&&c.find(".tree-icon").removeClass(d.iconCls);var e=$.extend({},d,b);$.data(b.target,"tree-node",e),c.attr("node-id",e.id),c.find(".tree-title").html(e.text),e.iconCls&&c.find(".tree-icon").addClass(e.iconCls),d.checked!=e.checked&&setCheckbox1(a,b.target,e.checked)}function getNode(a,b){var c=$.data(a,"tree").options,d=void 0,e=void 0;b&&b.getAttribute&&(d=b.getAttribute("node-id"));var e=$.extend({},getNodeData(d,c),{target:b,checked:$(b).find(".tree-checkbox").hasClass("tree-checkbox1")});return getHitNode(a,b)||(e.state=$(b).find(".tree-hit").hasClass("tree-expanded")?"open":"closed"),e}function find(a,b){var c=$(a).find("div.tree-node[node-id='"+b+"']");return c.length?getNode(a,c[0]):null}function onSelect(a,b){var c=$.data(a,"tree").options,d=getNode(a,b);0!=c.onBeforeSelect.call(a,d)&&($("div.tree-node-selected",a).removeClass("tree-node-selected"),$(b).addClass("tree-node-selected"),c.onSelect.call(a,d))}function getHitNode(a,b){var c=$(b),d=c.children("span.tree-hit");return 0==d.length}function beginEdit(a,b){var c=$.data(a,"tree").options,d=getNode(a,b);if(0!=c.onBeforeEdit.call(a,d)){$(b).css("position","relative");var e=$(b).find(".tree-title"),f=e.outerWidth();e.empty();var g=$('<input class="tree-editor">').appendTo(e);g.val(d.text).focus(),g.width(f+20),g.height("CSS1Compat"==document.compatMode?18-(g.outerHeight()-g.height()):18),g.bind("click",function(){return!1}).bind("mousedown",function(a){a.stopPropagation()}).bind("mousemove",function(a){a.stopPropagation()}).bind("keydown",function(c){return 13==c.keyCode?(endEdit(a,b),!1):27==c.keyCode?(cancelEdit(a,b),!1):void 0}).bind("blur",function(c){c.stopPropagation(),endEdit(a,b)})}}function endEdit(a,b){var c=$.data(a,"tree").options;$(b).css("position","");var d=$(b).find("input.tree-editor"),e=d.val();d.remove();var f=getNode(a,b);f.text=e,update(a,f),c.onAfterEdit.call(a,f)}function cancelEdit(a,b){var c=$.data(a,"tree").options;$(b).css("position",""),$(b).find("input.tree-editor").remove();var d=getNode(a,b);update(a,d),c.onCancelEdit.call(a,d)}function formatDataByConf(a){var b=a.col&&a.col.editor?a.col.editor.options:null;a.data&&b&&$.each(a.data,function(a,c){var d=[];c.pid=c[b.parNode]||c.pid,c.id=c[b.nodeId]||c.id,b.nodeName&&$.each(b.nodeName.split(/,/g),function(a,b){d.push(c[b])}),c.text=d.length>0?d.join(" "):c.text})}function checkedAll(a){var b=$(a).find(".tree-checkbox");b.length>0&&b.removeClass("tree-checkbox0 tree-checkbox1 tree-checkbox2").addClass("tree-checkbox1")}function unCheckedAll(a){var b=$(a).find(".tree-checkbox");b.length>0&&b.removeClass("tree-checkbox0 tree-checkbox1 tree-checkbox2").addClass("tree-checkbox0")}function unChecked(a){for(var b=$(a).find(".tree-checkbox"),c=0;c<b.length;c++){var d=$(b[c]);d.hasClass("tree-checkbox0")?d.removeClass("tree-checkbox0").addClass("tree-checkbox1"):d.hasClass("tree-checkbox1")&&d.removeClass("tree-checkbox1").addClass("tree-checkbox0")}}$.fn.tree=function(a,b){return"string"==typeof a?$.fn.tree.methods[a](this,b):(a=a||{},this.each(function(){var b,c=$.data(this,"tree");if(c)b=$.extend(c.options,a);else{b=$.extend({},$.fn.tree.defaults,$.fn.tree.parseOptions(this),a),$.data(this,"tree",{options:b,tree:wrapTree(this)});var d=getContents(this);d.length&&!b.data&&(b.data=d)}b.data&&(b.base=b.data,loadData(this,this,b.data)),b.lines&&$(this).addClass("tree-lines"),request(this,this)}))},$.fn.tree.methods={options:function(a){return $.data(a[0],"tree").options},loadData:function(a,b){return a.each(function(){loadData(this,this,b)})},getNode:function(a,b){return getNode(a[0],b)},getData:function(a,b){return getData(a[0],b)},reload:function(a,b){return a.each(function(){if(b){var a=$(b),c=a.children("span.tree-hit");c.removeClass("tree-expanded tree-expanded-hover").addClass("tree-collapsed"),a.next().remove(),expand(this,b)}else $(this).empty(),request(this,this)})},getRoot:function(a){return getRoot(a[0])},getRoots:function(a){return getRoots(a[0])},getParent:function(a,b){return getParent(a[0],b)},getChildren:function(a,b){return getChildren(a[0],b)},getChecked:function(a){return getChecked(a[0])},getCascadeCheckNode:function(a){return getCascadeCheckNode(a[0])},getSelectedBase:function(a){return getSelectedBase(a[0])},getSelected:function(a){return getSelected(a[0])},isLeaf:function(a,b){return getHitNode(a[0],b)},find:function(a,b){return find(a[0],b)},select:function(a,b){return a.each(function(){onSelect(this,b)})},check:function(a,b){return a.each(function(){setCheckbox1(this,b,!0)})},checkNoCascade:function(a,b){return a.each(function(){setCheckboxNoCascadeCheck(this,b,!0)})},uncheck:function(a,b){return a.each(function(){setCheckbox1(this,b,!1)})},collapse:function(a,b){return a.each(function(){collapse(this,b)})},expand:function(a,b){return a.each(function(){expand(this,b)})},collapseAll:function(a,b){return a.each(function(){collapseAll(this,b)})},expandAll:function(a,b){return a.each(function(){expandAll(this,b)})},expandTo:function(a,b){return a.each(function(){expandTo(this,b)})},checkedAll:function(a){return a.each(function(){checkedAll(this)})},unChecked:function(a){return a.each(function(){unChecked(this)})},unCheckedAll:function(a){return a.each(function(){unCheckedAll(this)})},toggle:function(a,b){return a.each(function(){toggle(this,b)})},append:function(a,b){return a.each(function(){append(this,b)})},insert:function(a,b){return a.each(function(){insert(this,b)})},remove:function(a,b){return a.each(function(){remove(this,b)})},pop:function(a,b){var c=a.tree("getData",b);return a.tree("remove",b),c},update:function(a,b){return a.each(function(){update(this,b)})},enableDnd:function(a){return a.each(function(){dragFile(this)})},disableDnd:function(a){return a.each(function(){draDisable(this)})},beginEdit:function(a,b){return a.each(function(){beginEdit(this,b)})},endEdit:function(a,b){return a.each(function(){endEdit(this,b)})},cancelEdit:function(a,b){return a.each(function(){cancelEdit(this,b)})},setCascade:function(a,b){return a.each(function(){var a=$.data(this,"tree").options;a.cascadeCheck=b})}},$.fn.tree.parseOptions=function(a){$(a);return $.extend({},$.parser.parseOptions(a,["url","method",{checkbox:"boolean",cascadeCheck:"boolean",onlyLeafCheck:"boolean"},{animate:"boolean",lines:"boolean",dnd:"boolean"}]))},$.fn.tree.defaults={url:null,method:"post",animate:!1,animateSpeed:100,checkbox:!1,cascadeCheck:!0,onlyLeafCheck:!1,lines:!1,dnd:!1,dropMethod:null,data:null,required:!1,base:null,req:null,conf:{},treeExpand:0,loader:function(a,b,c){var d=this,e=$(d).tree("options");return e.req&&0!=e.req.length||e.url?void(e.url?ajax.ajax({url:e.url,type:e.method}).done(function(a){b(e.loaderSuccessFilter.call(this,a))}).fail(function(){c.apply(d,arguments)}):e.req&&e.req.length>0&&ajax.post({req:e.req}).done(function(a){b(e.loaderSuccessFilter.call(this,a))}).fail(function(){c.apply(d,arguments)})):!1},loaderSuccessFilter:function(a){return a&&a[0]||a.ANSWERS[0].ANS_COMM_DATA[0]},loadFilter:function(a){return a},onBeforeLoad:function(){},onLoadSuccess:function(){},onLoadError:function(){},onClick:function(){},onDblClick:function(){},onBeforeExpand:function(){},onExpand:function(){},onBeforeCollapse:function(){},onCollapse:function(){},onCheck:function(){},onBeforeSelect:function(){},onSelect:function(){},onContextMenu:function(){},onDrop:function(){},onBeforeEdit:function(){},onAfterEdit:function(){},onCancelEdit:function(){},onBeforeDrag:function(){},onStartDrag:function(){},onDrag:function(){},onStopDrag:function(){},onRevert:function(){},makeTreeData:function(a,b){var c,d,e,f,g=a.treeType,h=a.lvlLength;"1"==g?(c=a.nodeId,d=a.parNode,e=a.nodeName):("2"==g||"3"==g)&&(c=a.nodeId,d=a.lvlNode,e=a.nodeName),f=a.iconCls||"";var i=[];if("1"==g)for(var j=0;j<b.length;j++){var k={},l=[];b[j][c]="number"===a.nodeDataType?Number(b[j][c])+"":b[j][c],b[j][d]="number"===a.nodeDataType?Number(b[j][d])+"":b[j][d],k.id=b[j][c]||"",$.each(f.split(","),function(){l.push(b[j][this]||this)}),k.iconCls=l.join(" ");for(var m=e.split(","),n="",o=0;o<m.length;o++)n+=("undefined"==typeof b[j][m[o]]?"":b[j][m[o]])+" ";k.text=n||"",k.pid=b[j][d]||"",i.push(k)}else if("2"==g){b=kui.quickSort(b,d);for(var j=0;j<b.length;j++){var k={},l=[];k.id=b[j][c]||"",$.each(f.split(","),function(){l.push(b[j][this]||this)}),k.iconCls=l.join(" ");for(var m=e.split(","),n="",o=0;o<m.length;o++)n+=("undefined"==typeof b[j][m[o]]?"":b[j][m[o]])+" ";k.text=n||"";for(var p=b[j][d]||"",q=p.substring(0,p.length-h),o=0;o<b.length;o++){var r=b[o][c]||"",s=b[o][d]||"";if(s==q){k.pid=r;break}}k.dataSource=b[j],"number"===a.nodeDataType&&(k.id=Number(k.id),k.pid=Number(k.pid)),i.push(k)}}else if("3"==g){b=kui.quickSort(b,d);for(var j=0;j<b.length;j++){var k={};b[j][c]="number"===a.nodeDataType?Number(b[j][c])+"":b[j][c],b[j][d]="number"===a.nodeDataType?Number(b[j][d])+"":b[j][d],k.id=b[j][c]||"",k.iconCls=k.iconCls||f;for(var m=e.split(","),n="",o=0;o<m.length;o++)n+=("undefined"==typeof b[j][m[o]]?"":b[j][m[o]])+" ";k.text=n||"";for(var p=b[j][d].replace("@","")||"",t=p.substring(0,p.length-h),o=j;o>=0;o--){var r=b[o][c]||"",s=b[o][d].replace("@","")||"";if(s==t){k.pid=r;break}}if(!k.pid&&p.length>2)for(var u=p.substring(0,p.length-2),o=j;o>=0;o--){var r=b[o][c]||"",s=b[o][d].replace("@","")||"";if(s==u){k.pid=r;break}}"number"===a.nodeDataType&&(k.id=Number(k.id),k.pid=Number(k.pid)),i.push(k)}}return i}}}),define("lib/kui/panel",[],function(require,exports,module){function removeNode(a){a.each(function(){$(this).remove(),$.browser.msie&&(this.outerHTML="")})}function setSize(a,b){var c=$.data(a,"panel").options,d=$.data(a,"panel").panel,e=d.children("div.panel-header"),f=d.children("div.panel-body");if(b&&(b.width&&(c.width=b.width),b.height&&(c.height=b.height),null!=b.left&&(c.left=b.left),null!=b.top&&(c.top=b.top)),1==c.fit){var g=d.parent();g.addClass("panel-noscroll"),"BODY"==g[0].tagName&&$("html").addClass("panel-fit"),c.width=g.width(),c.height=g.height()}d.css({left:c.left,top:c.top}),c.fullScreenAble&&c.fullScreened?(e.add(f)._outerWidth($(top).width()),d._outerHeight($(top).height()),f._outerHeight(d.height()-e._outerHeight())):(isNaN(c.width)?d.width("auto"):d._outerWidth(c.width),e.add(f)._outerWidth(d.width()),isNaN(c.height)?f.height("auto"):(d._outerHeight(c.height),f._outerHeight(d.height()-e._outerHeight()))),d.css("height",""),c.onResize.apply(a,[c.width,c.height]),d.find(">div.panel-body>div").triggerHandler("_resize")}function movePanel(a,b){var c=$.data(a,"panel").options,d=$.data(a,"panel").panel;b&&(null!=b.left&&(c.left=b.left),null!=b.top&&(c.top=b.top)),d.css({left:c.left,top:c.top}),c.onMove.apply(a,[c.left,c.top])}function wrapPanel(a){$(a).addClass("panel-body");var b=$('<div class="panel"></div>').insertBefore(a);return b[0].appendChild(a),b.bind("_resize",function(){var b=$.data(a,"panel").options;return 1==b.fit&&setSize(a),!1}),b}function addHeader(target){function onToggle(a){return a.hasClass("panel-tool-expand")?expandPanel(target,!0):collapsePanel(target,!0),!1}function onMin(){return minimizePanel(target),!1}function onMax(a){return a.hasClass("panel-tool-restore")?restorePanel(target):maximizePanel(target),!1}function onClose(){return closePanel(target),!1}var opts=$.data(target,"panel").options,panel=$.data(target,"panel").panel;if(opts.tools&&"string"==typeof opts.tools&&panel.find(">div.panel-header>div.panel-tool .panel-tool-a").appendTo(opts.tools),removeNode(panel.children("div.panel-header")),opts.title&&!opts.noheader){var header=new Array,icoPanel="";header.push('<div class="panel-header"><div class="panel-title">'),opts.iconCls&&(icoPanel='<span class="ui-tool-icons '+opts.iconCls+'"></span>'),header.push(icoPanel),header.push(opts.title),header.push("</div>"),header.push('<div class="panel-tool">'),opts.collapsible&&header.push('<a class="panel-tool-collapse" href="javascript:void(0)"></a>'),opts.minimizable&&header.push('<a class="panel-tool-min" href="javascript:void(0)"></a>'),opts.maximizable&&header.push('<a class="panel-tool-max" href="javascript:void(0)"></a>'),opts.closable&&header.push('<a class="panel-tool-close" href="javascript:void(0)"></a>');var hd="";if(opts.tools)if("string"==typeof opts.tools)$(opts.tools).children().each(function(){$(this).addClass($(this).attr("iconCls")).addClass("panel-tool-a")}),header.push($(opts.tools).html()),$(opts.tools).remove();else for(var i=0;i<opts.tools.length;i++)header.push('<a href="javascript:void(0)" class="'),header.push(opts.tools[i].iconCls),header.push('"'),opts.tools[i].handle&&(opts.tools[i].handle=eval(opts.tools[i].handle),header.push(' _kuiIndex="'),header.push(i),header.push('">')),header.push("</a>");header.push("</div></div>");var jqHeader=$(header.join(""));jqHeader.prependTo(panel),jqHeader.find(".panel-tool").bind("click",function(a){var b=$(a.target);if(b.hasClass("panel-tool-collapse"))onToggle(b);else if(b.hasClass("panel-tool-min"))onMin(a);else if(b.hasClass("panel-tool-max"))onMax(b);else if(b.hasClass("panel-tool-close"))onClose(a);else if(b.attr("_kuiIndex")>-1){var c=b.attr("_kuiIndex");opts.tools[c].handle()}return!1}),panel.children("div.panel-body").removeClass("panel-body-noheader")}else panel.children("div.panel-body").addClass("panel-body-noheader")}function loadData(a){var b=$.data(a,"panel");if(b.options.href&&(!b.isLoaded||!b.options.cache)){b.isLoaded=!1,destroy(a);var c=b.panel.find(">div.panel-body");c.empty(),b.options.loadingMessage&&c.html($('<div class="panel-loading"></div>').html(b.options.loadingMessage));var d=$("<iframe frameBorder=0 width=100% height=100%></iframe>").hide().attr("src",b.options.href).appendTo(c);d.bind("load",function(){if(c.children("div.panel-loading").remove(),b.options.fullScreenAble){var e=$(d[0].contentWindow.document.body),f=$(top.document.body),g=$('<div class="maximize-box fullScreen" data-btn-trigger="fullScreen" title="全屏"></div>').prependTo(c);g.bind("click.fullScreen",function(){if($(this).hasClass("fullScreen"))g.attr("title","退出全屏"),b.options.fullScreened=!0,$(this).removeClass("fullScreen").addClass("reduceScreen").data("size",{width:b.options.width,height:b.options.height}),e.css("overflow","auto"),f.css("overflow","hidden"),c.css({position:"fixed",top:0,left:0,"z-index":99,width:$(top).width(),height:$(top).height()});else{g.attr("title","全屏"),b.options.fullScreened=!1,$(this).removeClass("reduceScreen").addClass("fullScreen"),e.css("overflow",""),f.css("overflow","");var a=$(this).data("size");c.css({position:"relative",width:a.width,height:a.height})}})}b.options.onLoad.apply(a,arguments),b.isLoaded=!0,setTimeout(function(){d.unbind()},100),d.show()})}}function getPanelContent(a){var b=$.data(a,"panel");return b.options.href?$(a).find(":first-child")[0].contentWindow:$(a).find(":first-child")}function destroy(a){var b=$("iframe",a);if(b.length>0){b[0].src="about:blank";try{b[0].contentWindow.document.write(""),b[0].contentWindow.document.clear(),b.remove()}catch(c){}}var d=$(a);d.find(".combo-f").each(function(){$(this).combo("destroy")}),d.find(".m-btn").each(function(){$(this).menubutton("destroy")}),d.find(".s-btn").each(function(){$(this).splitbutton("destroy")})}function trigger(a){$(a).find("div.panel:visible,div.accordion:visible,div.tabs-container:visible,div.layout:visible").each(function(){$(this).triggerHandler("_resize",[!0])})}function openPanel(a,b){var c=$.data(a,"panel").options,d=$.data(a,"panel").panel;(1==b||0!=c.onBeforeOpen.call(a))&&(d.show(),c.closed=!1,c.minimized=!1,c.onOpen.call(a),1==c.maximized&&(c.maximized=!1,maximizePanel(a)),1==c.collapsed&&(c.collapsed=!1,collapsePanel(a)),c.collapsed||(loadData(a),trigger(a)))}function closePanel(a,b){var c=$.data(a,"panel").options,d=$.data(a,"panel").panel;(1==b||0!=c.onBeforeClose.call(a))&&(d.hide(),c.closed=!0,c.onClose.call(a))}function destroyPanel(a,b){if($.data(a,"panel")){var c=$.data(a,"panel").options,d=$.data(a,"panel").panel;(1==b||0!=c.onBeforeDestroy.call(a))&&(destroy(a),removeNode(d),c.onDestroy.call(a))}}function collapsePanel(a,b){var c=$.data(a,"panel").options,d=$.data(a,"panel").panel,e=d.children("div.panel-body"),f=d.children("div.panel-header").find("a.panel-tool-collapse");1!=c.collapsed&&(e.stop(!0,!0),0!=c.onBeforeCollapse.call(a)&&(f.addClass("panel-tool-expand"),1==b?e.slideUp("normal",function(){c.collapsed=!0,c.onCollapse.call(a)}):(e.hide(),c.collapsed=!0,c.onCollapse.call(a))))}function expandPanel(a,b){var c=$.data(a,"panel").options,d=$.data(a,"panel").panel,e=d.children("div.panel-body"),f=d.children("div.panel-header").find("a.panel-tool-collapse");0!=c.collapsed&&(e.stop(!0,!0),0!=c.onBeforeExpand.call(a)&&(f.removeClass("panel-tool-expand"),1==b?e.slideDown("normal",function(){c.collapsed=!1,c.onExpand.call(a),loadData(a),trigger(a)}):(e.show(),c.collapsed=!1,c.onExpand.call(a),loadData(a),trigger(a))))}function maximizePanel(a){var b=$.data(a,"panel").options,c=$.data(a,"panel").panel,d=c.children("div.panel-header").find("a.panel-tool-max");1!=b.maximized&&(d.addClass("panel-tool-restore"),$.data(a,"panel").original||($.data(a,"panel").original={width:b.width,height:b.height,left:b.left,top:b.top,fit:b.fit}),b.left=0,b.top=0,b.fit=!0,setSize(a),b.minimized=!1,b.maximized=!0,b.onMaximize.call(a))}function minimizePanel(a){var b=$.data(a,"panel").options,c=$.data(a,"panel").panel;c.hide(),b.minimized=!0,b.maximized=!1,b.onMinimize.call(a)}function restorePanel(a){var b=$.data(a,"panel").options,c=$.data(a,"panel").panel,d=c.children("div.panel-header").find("a.panel-tool-max");if(0!=b.maximized){c.show(),d.removeClass("panel-tool-restore");var e=$.data(a,"panel").original;b.width=e.width,b.height=e.height,b.left=e.left,b.top=e.top,b.fit=e.fit,setSize(a),b.minimized=!1,b.maximized=!1,$.data(a,"panel").original=null,b.onRestore.call(a)}}function setBorder(a){var b=$.data(a,"panel").options,c=$.data(a,"panel").panel,d=$(a).panel("header"),e=$(a).panel("body");c.css(b.style),c.addClass(b.cls),b.border?(d.removeClass("panel-header-noborder"),e.removeClass("panel-body-noborder")):(d.addClass("panel-header-noborder"),e.addClass("panel-body-noborder")),d.addClass(b.headerCls),e.addClass(b.bodyCls),b.id?$(a).attr("id",b.id):$(a).attr("id","")}function setTitle(a,b){$.data(a,"panel").options.title=b,$(a).panel("header").find("div.panel-title").html(b)}function resizeEvent(a){var b=$.data(a,"panel");b.panel.resizable({handles:"s",disabled:0==b.options.resizable,onStartResize:function(a){b.pmask=$('<div class="panel-proxy-mask"></div>').insertAfter(b.panel),b.pmask.css({left:a.data.left,top:a.data.top,width:b.panel._outerWidth(),height:b.panel._outerHeight()}),b.proxy||(b.proxy=$('<div class="panel-proxy"></div>').insertAfter(b.panel)),b.proxy.css({left:a.data.left,top:a.data.top}),b.proxy._outerWidth(a.data.width),b.proxy._outerHeight(a.data.height)},onResize:function(a){return b.proxy.css({left:a.data.left,top:a.data.top}),b.proxy._outerWidth(a.data.width),b.proxy._outerHeight(a.data.height),!1},onStopResize:function(c){$.extend(b.options,{left:c.data.left,top:c.data.top,width:c.data.width,height:c.data.height}),setSize(a),b.pmask.remove(),b.pmask=null,b.proxy.remove(),b.proxy=null}})}$.fn.panel=function(a,b){return"string"==typeof a?$.fn.panel.methods[a](this,b):(a=a||{},this.each(function(){var b,c=$.data(this,"panel");c?b=$.extend(c.options,a):(b=$.extend({},$.fn.panel.defaults,$.fn.panel.parseOptions(this),a),$(this).attr("title",""),c=$.data(this,"panel",{options:b,panel:wrapPanel(this),isLoaded:!1})),b.content&&($(this).html(b.content),$.parser&&$.parser.parse(this)),addHeader(this),setBorder(this),1==b.doSize&&(c.panel.css("display","block"),setSize(this)),1==b.closed||1==b.minimized?c.panel.hide():openPanel(this),"true"==String(b.resizable)&&resizeEvent(this)}))},$.fn.panel.methods={options:function(a){return $.data(a[0],"panel").options},panel:function(a){return $.data(a[0],"panel").panel},header:function(a){return $.data(a[0],"panel").panel.find(">div.panel-header")},body:function(a){return $.data(a[0],"panel").panel.find(">div.panel-body")},getPanelContent:function(a){return getPanelContent(a[0])},setTitle:function(a,b){return a.each(function(){setTitle(this,b)})},open:function(a,b){return a.each(function(){openPanel(this,b)})},close:function(a,b){return a.each(function(){closePanel(this,b)})},destroy:function(a,b){return a.each(function(){destroyPanel(this,b)})},refresh:function(a,b){return a.each(function(){$.data(this,"panel").isLoaded=!1,b&&($.data(this,"panel").options.href=b),loadData(this)})},resize:function(a,b){return a.each(function(){setSize(this,b)})},move:function(a,b){return a.each(function(){movePanel(this,b)})},maximize:function(a){return a.each(function(){maximizePanel(this)})},minimize:function(a){return a.each(function(){minimizePanel(this)})},restore:function(a){return a.each(function(){restorePanel(this)})},collapse:function(a,b){return a.each(function(){collapsePanel(this,b)})},expand:function(a,b){return a.each(function(){expandPanel(this,b)})}},$.fn.panel.parseOptions=function(a){var b=$(a);return $.extend({},$.parser.parseOptions(a,["id","width","height","left","top","title","iconCls","cls","headerCls","bodyCls","tools","href","resizable",{cache:"boolean",fit:"boolean",border:"boolean",noheader:"boolean",fieldset:"boolean"},{collapsible:"boolean",minimizable:"boolean",maximizable:"boolean"},{closable:"boolean",collapsed:"boolean",minimized:"boolean",maximized:"boolean",closed:"boolean"}]),{loadingMessage:b.attr("loadingMessage")||void 0})},$.fn.panel.defaults={id:null,title:null,iconCls:null,width:"auto",height:"auto",left:null,top:null,cls:null,resizable:!1,headerCls:null,bodyCls:null,style:{},cache:!0,fit:!1,border:!1,doSize:!0,noheader:!1,content:null,fieldset:!1,collapsible:!1,minimizable:!1,maximizable:!1,closable:!1,collapsed:!1,minimized:!1,maximized:!1,closed:!1,tools:null,href:null,loadingMessage:"Loading...",fullScreenAble:!1,fullScreened:!1,extractor:function(a){var b=/&lt;body[^>]*>((.|[\n\r])*)<\/body>/im,c=b.exec(a);return c?c[1]:a},onLoad:function(){},onBeforeOpen:function(){},onOpen:function(){},onBeforeClose:function(){},onClose:function(){},onBeforeDestroy:function(){},onDestroy:function(){},onResize:function(){},onMove:function(){},onMaximize:function(){},onRestore:function(){},onMinimize:function(){},onBeforeCollapse:function(){},onBeforeExpand:function(){},onCollapse:function(){},onExpand:function(){}};var TO=!1,flag=!0;$(window).unbind(".panel").bind("resize.panel",function(){flag&&(TO!==!1&&clearTimeout(TO),TO=setTimeout(function(){flag=!1;var a=$("body.layout");a.length?a.layout("resize"):$("body").find("div.panel,div.accordion,div.tabs-container,div.layout").triggerHandler("_resize"),flag=!0,TO=!1},200))})}),define("lib/kui/pagination",[],function(require,exports,module){function buildToolbar(target){function createButton(a){var b=$('<a href="javascript:void(0)"></a>').appendTo(tr);return b.wrap("<td></td>"),b.linkbutton({iconCls:pageButtons[a].iconCls,plain:!0}).unbind(".pagination").bind("click.pagination",pageButtons[a].handler),b}var data=$.data(target,"pagination"),opts=data.options,buttons=data.buttons={},pageButtons={menu:{iconCls:"icon-grid-menu",handler:function(){if(opts.$menu){var a=$(this).offset();return void opts.$menu.menu("show",{left:a.left,top:a.top})}var b=$("<div></div>"),c=opts.gridMenu,d=(opts.importTypes,opts.exportTypes);if(c){d&&$.isArray(d)||(opts.gridMenu=c=c.replace(/(,fileExport)|(fileExport,)/,""));for(var e={fileExport:function(){for(var a=["<div kui-options=\"iconCls:'icon-export'\"><span>导出</span><div>"],c=0,e=d.length;e>c;c++)a.push("<div kui-options=\"iconCls:'icon-"+d[c]+"'\">"+d[c]+"</div>");a.push("</div></div>"),$(a.join("")).appendTo(b).find("div div").click(function(){opts.onFileExport($(this).text())})},fileImport:function(){$("<div kui-options=\"iconCls:'icon-import'\">导入</div>").appendTo(b).click(function(){opts.onFileImport($(this).text())})},freezeColumns:function(){$("<div kui-options=\"iconCls:'icon-lock'\">锁定列</div>").appendTo(b).click(function(){opts.onFreezeColumns()})},hideColumns:function(){$("<div kui-options=\"iconCls:'icon-hidecol'\">隐藏列</div>").appendTo(b).click(function(){opts.onHideColumns()})},hideCols:function(){$("<div kui-options=\"iconCls:'icon-client-detail'\">隐藏查询条件</div>").appendTo(b).click(function(){opts.onHideCols()})},restoreDefault:function(){$("<div kui-options=\"iconCls:'icon-reload'\">恢复默认</div>").appendTo(b).click(function(){opts.onRestoreDefault()})},printReport:function(){$("<div kui-options=\"iconCls:'icon-print'\">打印报表</div>").appendTo(b).click(function(){opts.onFileExport("print")})}},f=c.replace(/\'|’|‘/g,"").split(","),g=0,h=f.length;h>g;g++)e[f[g]]&&e[f[g]]();var a=$(this).offset();opts.$menu=b.menu().menu("show",{left:a.left,top:a.top})}}},first:{iconCls:"pagination-first",handler:function(){opts.pageNumber>1&&selectPage(target,1)}},prev:{iconCls:"pagination-prev",handler:function(){opts.pageNumber>1&&selectPage(target,opts.pageNumber-1)}},next:{iconCls:"pagination-next",handler:function(){var a=Math.ceil(opts.total/opts.pageSize);opts.pageNumber<a&&selectPage(target,opts.pageNumber+1)}},last:{iconCls:"pagination-last",handler:function(){var a=Math.ceil(opts.total/opts.pageSize);opts.pageNumber<a&&selectPage(target,a)}},refresh:{iconCls:"pagination-load",handler:function(){$(target).prev("div.datagrid-row-detail").hide(),0!=opts.onBeforeRefresh.call(target,opts.pageNumber,opts.pageSize)&&(selectPage(target,opts.pageNumber),opts.onRefresh.call(target,opts.pageNumber,opts.pageSize))}}},table=$(target).addClass("pagination").html('<table cellspacing="0" cellpadding="0" border="0"><tr></tr></table>'),tr=table.find("tr");if(opts.gridMenu&&createButton("menu"),opts.fallParas&&opts.fallParas[0].enable&&(opts.showPageList=!1,opts.showRefresh=!1,opts.pageNavigate=!1,opts.fallParas[0].showPageList)){var ps=$('<select class="pagination-page-list"></select>');ps.bind("change",function(){opts.fallParas[0].cntNum=this.value});for(var options=[],selectNum=opts.fallParas[0].pageList,i=0;i<selectNum.length;i++)options.push(selectNum[i]==opts.fallParas[0].cntNum?"<option selected=true>":"<option>"),options.push(selectNum[i]),options.push("</option>");$(options.join("")).appendTo(ps),$("<td></td>").append(ps).appendTo(tr)}if(opts.showPageList){var ps=$('<select class="pagination-page-list"></select>');ps.bind("change",function(){opts.pageSize=parseInt($(this).val()),opts.onChangePageSize.call(target,opts.pageSize),selectPage(target,opts.pageNumber)
});for(var options=[],i=0;i<opts.pageList.length;i++)options.push("<option>"),options.push(opts.pageList[i]),options.push("</option>");$(options.join("")).appendTo(ps),$("<td></td>").append(ps).appendTo(tr),$('<td><div class="pagination-btn-separator"></div></td>').appendTo(tr)}if(opts.pageNavigate&&(buttons.first=createButton("first"),buttons.prev=createButton("prev"),$('<td><div class="pagination-btn-separator"></div></td>').appendTo(tr),$('<span style="padding-left:6px;"></span>').html(opts.beforePageText).appendTo(tr).wrap("<td></td>"),buttons.num=$('<input class="pagination-num" type="text" value="1" size="2">').appendTo(tr).wrap("<td></td>"),buttons.num.unbind(".pagination").bind("keydown.pagination",function(a){if(13==a.keyCode){var b=parseInt($(this).val())||1;return selectPage(target,b),!1}}),buttons.after=$('<span style="padding-right:6px;"></span>').appendTo(tr).wrap("<td></td>"),$('<td><div class="pagination-btn-separator"></div></td>').appendTo(tr),buttons.next=createButton("next"),buttons.last=createButton("last")),opts.showRefresh&&($('<td><div class="pagination-btn-separator"></div></td>').appendTo(tr),buttons.refresh=createButton("refresh")),opts.buttons){var aButton=[];aButton.push('<td><div class="pagination-btn-separator"></div></td>');for(var i=0;i<opts.buttons.length;i++){var btn=opts.buttons[i];aButton.push("-"==btn?'<td><div class="pagination-btn-separator"></div></td>':'<td><a href="javascript:void(0)" _pagination_button_index_="'+i+'"></a></td>')}var $btns=$(aButton.join(""));$btns.appendTo(tr),$("a",$btns).each(function(){var index=$(this).attr("_pagination_button_index_"),btn=opts.buttons[index];$(this).linkbutton($.extend(btn,{plain:!0})).bind("click",eval(btn.handler||function(){}))});var detailButton=$btns.find("input[name=datagrid_detail_button]")[0];detailButton&&(detailButton.checked=opts.isShowDetail)}$('<div class="pagination-info"></div>').appendTo(table),$('<div style="clear:both;"></div>').appendTo(table)}function selectPage(a,b){var c=$.data(a,"pagination").options;showInfo(a,{pageNumber:b}),c.onSelectPage.call(a,c.pageNumber,c.pageSize)}function showInfo(a,b){var c=$.data(a,"pagination").options,d=c.timeMsg;if($.extend(c,b||{}),c.fallParas&&c.fallParas[0].enable){var e=c.fallParas[0].last?c.fallPageInfoFinish:0==c.total?c.fallPageInfoLoading:c.fallPageInfoStart;return e=e.replace(/{total}/,c.total),c.showTime&&(d=d.replace(/{time}/,c.time||0),e=d+" "+e),$(a).find("span:contains('下一页')").css("display",c.fallParas[0].last?"none":"inline-block"),void $(a).find("div.pagination-info").html(e)}var f=$.data(a,"pagination").buttons,g=$(a).find("select.pagination-page-list");g.length&&(g.val(c.pageSize+""),c.pageSize=parseInt(g.val()));var h=Math.ceil(c.total/c.pageSize)||1;c.pageNumber<1&&(c.pageNumber=1),c.pageNumber>h&&(c.pageNumber=h),f.num&&f.num.val(c.pageNumber),f.after&&f.after.html(c.afterPageText.replace(/{pages}/,h));var i=c.displayMsg;i=i.replace(/{from}/,0==c.total?0:c.pageSize*(c.pageNumber-1)+1),i=i.replace(/{to}/,Math.min(c.pageSize*c.pageNumber,c.total)),i=i.replace(/{total}/,c.total),c.showTime&&(d=d.replace(/{time}/,c.time||0),i=d+" "+i),$(a).find("div.pagination-info").html(i),f.first&&f.first.add(f.prev).linkbutton({disabled:1==c.pageNumber}),f.next&&f.next.add(f.last).linkbutton({disabled:c.pageNumber==h}),setLoadStatus(a,c.loading)}function setLoadStatus(a,b){var c=$.data(a,"pagination").options,d=$.data(a,"pagination").buttons;c.loading=b,c.showRefresh&&d.refresh.linkbutton(c.loading?{iconCls:"pagination-loading"}:{iconCls:"pagination-load"})}$.fn.pagination=function(options,context){return"string"==typeof options?$.fn.pagination.methods[options](this,context):(options=options||{},this.each(function(){var opts,state=$.data(this,"pagination");state?opts=$.extend(state.options,options):(opts=$.extend({},$.fn.pagination.defaults,$.fn.pagination.parseOptions(this),options),opts.pageSize>10&&(pageSize=Number(opts.pageSize),opts.pageList=opts.pageList?eval(opts.pageList):[pageSize,pageSize+10,pageSize+20,pageSize+30]),$.data(this,"pagination",{options:opts})),buildToolbar(this),showInfo(this)}))},$.fn.pagination.methods={options:function(a){return $.data(a[0],"pagination").options},loading:function(a){return a.each(function(){setLoadStatus(this,!0)})},loaded:function(a){return a.each(function(){setLoadStatus(this,!1)})},refresh:function(a,b){return a.each(function(){showInfo(this,b)})},select:function(a,b){return a.each(function(){selectPage(this,b)})}},$.fn.pagination.parseOptions=function(target){var jq=$(target);return $.extend({},$.parser.parseOptions(target,[{total:"number",pageSize:"number",pageNumber:"number"},{loading:"boolean",showPageList:"boolean",showRefresh:"boolean"}]),{pageList:jq.attr("pageList")?eval(jq.attr("pageList")):void 0})},$.fn.pagination.defaults={total:0,pageSize:10,pageNumber:1,pageList:[20,50,100,200,500,1e3],loading:!1,buttons:null,showPageList:!0,showRefresh:!0,pageNavigate:!0,onSelectPage:function(){},onBeforeRefresh:function(){},onRefresh:function(){},onChangePageSize:function(){},beforePageText:"Page",afterPageText:"/ {pages}",displayMsg:"Displaying {from} to {to} of {total} items",showTime:!0,timeMsg:"Time {time}ms",fallPageInfoFinish:"Load completed, A total of {total} records",fallPageInfoLoading:"Currently loaded 0 records",fallPageInfoStart:"Currently loaded {total} records, And data is not loaded"}}),define("lib/kui/window",[],function(){function a(a,c){var d=$.data(a,"window").options;c&&(c.width&&(d.width=c.width),c.height&&(d.height=c.height),null!=c.left&&(d.left=c.left),null!=c.top&&(d.top=c.top)),$(a).panel("resize",d),b(a)}function b(a){var b=$.data(a,"panel").panel,c=$.data(a,"window").options.outWin,d=b.height()+c===!1?0:9,e=b.width()+c===!1?0:10,f=$("<iframe class='panel-iframe-layer' src='about:blank' frameborder='0' marginHeight='0' marginWidth='0'></iframe>"),g=b.find(".panel-iframe-layer");g.length||(g=f,b.append(g)),g.width(e).height(d)}function c(a,b){var c=$.data(a,"window");b&&(null!=b.left&&(c.options.left=b.left),null!=b.top&&(c.options.top=b.top)),$(a).panel("move",c.options),c.shadow&&c.shadow.css({left:c.options.left,top:c.options.top})}function d(a,b){var d=$.data(a,"window"),e=d.options,f=e.width;if(isNaN(f)&&(f=d.window._outerWidth()),e.inline){var g=d.window.parent();e.left=(g.width()-f)/2+g.scrollLeft()}else e.left=($(window)._outerWidth()-f)/2+$(document).scrollLeft();b&&c(a)}function e(a,b){var d=$.data(a,"window"),e=d.options,f=e.height;if(isNaN(f)&&(f=d.window._outerHeight()),e.inline){var g=d.window.parent();e.top=(g.height()-f)/2+g.scrollTop()}else e.top=($(window)._outerHeight()-f)/2+$(document).scrollTop();b&&c(a)}function f(a){var f=$.data(a,"window"),g=(f?f.options.zIndex:$.fn.window.defaults.zIndex,$(a).panel($.extend({},f.options,{border:!1,doSize:!0,closed:!0,cls:"window",headerCls:"window-header",bodyCls:"window-body "+(f.options.noheader?"window-body-noheader":""),onBeforeDestroy:function(){return 0==f.options.onBeforeDestroy.call(a)?!1:(f.shadow&&f.shadow.remove(),void(f.mask&&f.mask.remove()))},onClose:function(){f.shadow&&f.shadow.hide(),f.mask&&f.mask.hide(),$("body").find(".validatebox-tip").css("display","none"),f.options.onClose.call(a)},onOpen:function(){f.mask&&f.mask.css({display:"block",zIndex:$.fn.window.defaults.zIndex++}),f.shadow&&f.shadow.css({display:"block",zIndex:$.fn.window.defaults.zIndex++,left:f.options.left,top:f.options.top,width:f.window._outerWidth(),height:f.window._outerHeight()}),f.window.css("z-index",$.fn.window.defaults.zIndex++),f.options.onOpen.call(a)},onResize:function(b,c){var d=$(this).panel("options");$.extend(f.options,{width:d.width,height:d.height,left:d.left,top:d.top}),f.shadow&&f.shadow.css({left:f.options.left,top:f.options.top,width:f.window._outerWidth(),height:f.window._outerHeight()}),f.options.onResize.call(a,b,c)},onMinimize:function(){f.shadow&&f.shadow.hide(),f.mask&&f.mask.hide(),f.options.onMinimize.call(a)},onBeforeCollapse:function(){return 0==f.options.onBeforeCollapse.call(a)?!1:void(f.shadow&&f.shadow.hide())},onExpand:function(){f.shadow&&f.shadow.show(),f.options.onExpand.call(a)}})));f.window=g.panel("panel"),f.mask&&f.mask.remove(),1==f.options.modal&&(f.mask=$('<div class="window-mask"></div>').insertAfter(f.window),f.mask.css({width:f.options.inline?f.mask.parent().width():h().width,height:f.options.inline?f.mask.parent().height():h().height-1,display:"none"})),f.shadow&&f.shadow.remove(),1==f.options.shadow&&(f.shadow=$('<div class="window-shadow"></div>').insertAfter(f.window),f.shadow.css({display:"none"})),null==f.options.left&&d(a),null==f.options.top&&e(a),c(a),0==f.options.closed&&g.window("open"),b(a)}function g(b){{var c,d=$.data(b,"window");d?d.options.zIndex:$.fn.window.defaults.zIndex}d.window.draggable({handle:">div.panel-header>div.panel-title",disabled:0==d.options.draggable,onStartDrag:function(a){return d.options&&"function"==typeof d.options.onStartDrag&&!1===d.options.onStartDrag.call($(d.window).find(".panel-body")[0],a)?!1:(d.proxy||(d.proxy=$('<div class="window-proxy" style="cursor:move;"></div>').insertAfter(d.window)),d.options.modal||(c=$('<div class="window-mask transparent"></div>'),c.insertAfter(d.window)),d.proxy.css({display:"none",zIndex:$.fn.window.defaults.zIndex++,left:a.data.left,top:a.data.top}),d.proxy._outerWidth(d.window._outerWidth()),d.proxy._outerHeight(d.window._outerHeight()),void setTimeout(function(){d.proxy&&d.proxy.show()},500))},onDrag:function(a){if(d.options.outWin===!1){var b=a.data,c=$(b.target),e=$(window),f=c.outerWidth(),g=c.outerHeight(),h=e.width(),i=e.height();b.left<0&&(b.left=0),b.top<0&&(b.top=0),b.left+f>h&&(b.left=h-f),b.top+g>i&&(b.top=i-g)}return d.proxy.css({display:"block",left:a.data.left,top:a.data.top}),!1},onStopDrag:function(a){if(d.options.dragout)d.options.left=a.data.left,d.options.top=a.data.top;else{var e=120-d.options.width,f=$(window).width()-120,g=$(window).height()-30;d.options.left=a.data.left<e?e:a.data.left>f?f:a.data.left,d.options.top=a.data.top<0?0:a.data.top>g?g:a.data.top}$(b).window("move"),d.proxy.remove(),c&&c.remove(),d.proxy=null}}),d.window.resizable({disabled:0==d.options.resizable,onStartResize:function(a){d.pmask=$('<div class="window-proxy-mask"></div>').insertAfter(d.window),d.pmask.css({zIndex:$.fn.window.defaults.zIndex++,left:a.data.left,top:a.data.top,width:d.window._outerWidth(),height:d.window._outerHeight()}),d.proxy||(d.proxy=$('<div class="window-proxy"></div>').insertAfter(d.window)),d.proxy.css({zIndex:$.fn.window.defaults.zIndex++,left:a.data.left,top:a.data.top}),d.proxy._outerWidth(a.data.width),d.proxy._outerHeight(a.data.height)},onResize:function(a){return d.proxy.css({left:a.data.left,top:a.data.top}),d.proxy._outerWidth(a.data.width),d.proxy._outerHeight(a.data.height),!1},onStopResize:function(c){$.extend(d.options,{left:c.data.left,top:c.data.top,width:c.data.width,height:c.data.height}),a(b),d.pmask.remove(),d.pmask=null,d.proxy.remove(),d.proxy=null}})}function h(){return"BackCompat"==document.compatMode?{width:Math.max(document.body.scrollWidth,document.body.clientWidth),height:Math.max(document.body.scrollHeight,document.body.clientHeight)}:{width:Math.max(document.documentElement.scrollWidth,document.documentElement.clientWidth),height:Math.max(document.documentElement.scrollHeight,document.documentElement.clientHeight)}}$.fn.window=function(a,b){if("string"==typeof a){var c=$.fn.window.methods[a];return c?c(this,b):this.panel(a,b)}return a=a||{},a.outWin===!1&&$.extend(a,{offsetParent:!1}),this.each(function(){var b=$.data(this,"window");b?$.extend(b.options,a):(b=$.data(this,"window",{options:$.extend({},$.fn.window.defaults,$.fn.window.parseOptions(this),a)}),b.options.inline||document.body.appendChild(this)),f(this),g(this)})},$.fn.window.methods={options:function(a){var b=a.panel("options"),c=$.data(a[0],"window").options;return $.extend(c,{closed:b.closed,collapsed:b.collapsed,minimized:b.minimized,maximized:b.maximized})},window:function(a){return $.data(a[0],"window")?$.data(a[0],"window").window:null},resize:function(b,c){return b.each(function(){a(this,c)})},move:function(a,b){return a.each(function(){c(this,b)})},hcenter:function(a){return a.each(function(){d(this,!0)})},vcenter:function(a){return a.each(function(){e(this,!0)})},center:function(a){return a.each(function(){d(this),e(this),c(this)})}},$.fn.window.parseOptions=function(a){return $.extend({},$.fn.panel.parseOptions(a),$.parser.parseOptions(a,[{draggable:"boolean",resizable:"boolean",shadow:"boolean",modal:"boolean",inline:"boolean"}]))},$.fn.window.defaults=$.extend({},$.fn.panel.defaults,{zIndex:9e3,draggable:!0,resizable:!0,shadow:!0,modal:!1,inline:!1,outWin:!0,dragout:!1,title:"New Window",collapsible:!0,minimizable:!0,maximizable:!0,closable:!0,closed:!1}),$(window).resize(function(){setTimeout(function(){$("body>div.window-mask").css({width:h().width,height:h().height-1})},50)})}),define("lib/kui/dialog",[],function(){function a(a){var b=$(a);b.wrapInner('<div class="dialog-content"></div>');var c=b.children("div.dialog-content");return c.attr("style",b.attr("style")),b.removeAttr("style").css("overflow","hidden"),c.panel({border:!1,doSize:!1}),c}function b(a){var b=$.data(a,"dialog").options,c=$.data(a,"dialog").contentPanel;if(b.toolbar&&b.toolbar.length)if("string"==typeof b.toolbar)$(b.toolbar).addClass("dialog-toolbar").prependTo(a),$(b.toolbar).show();else{$(a).find("div.dialog-toolbar").remove();var d=new Array;d.push('<div class="dialog-toolbar">');for(var e=0;e<b.toolbar.length;e++){var f=b.toolbar[e];d.push("-"==f?'<div class="dialog-tool-separator"></div>':'<a href="javascript:void(0)" _kuiIndex="'+e+'" ></a>')}d.push('<div style="clear:both"></div></div>');var g=$(d.join("")).prependTo(a);g.find(">a").css("float","left").each(function(){var a=$(this).attr("_kuiIndex");this.onclick=b.toolbar[a].handler||function(){},$(this).linkbutton($.extend({},b.toolbar[a],{plain:!0}))})}else $(a).find("div.dialog-toolbar").remove();if(b.buttons&&b.buttons.length)if("string"==typeof b.buttons)$(b.buttons).addClass("dialog-button").appendTo(a),$(b.buttons).show();else{$(a).find("div.dialog-button").remove();for(var h=$('<div class="dialog-button"></div>').appendTo(a),e=0;e<b.buttons.length;e++)!function(b){var c=$('<a href="javascript:void(0)"></a>').appendTo(h);c[0].onclick=function(c){b&&$.isFunction(b.handler)&&b.handler.call(this,c,$(a))},c.linkbutton(b)}(b.buttons[e])}else $(a).find("div.dialog-button").remove();var i=b.href,j=b.content;b.href=null,b.content=null,$(a).window($.extend({},b,{onOpen:function(){c.panel("open"),b.onOpen&&b.onOpen.call(a)},onResize:function(d,e){var f=$(a).panel("panel").find(">div.panel-body");c.panel("panel").show(),c.panel("resize",{width:f.width(),height:"auto"==e?"auto":f.height()-f.find(">div.dialog-toolbar")._outerHeight()-f.find(">div.dialog-button")._outerHeight()}),b.onResize&&b.onResize.call(a,d,e)}})),c.panel({closed:b.closed,cache:b.cache,href:i,content:j,onLoad:function(){"auto"==b.height&&$(a).window("resize"),b.onLoad.apply(a,arguments)}}),b.href=i,b.content=j,c.show()}function c(a){var b=$.data(a,"dialog").contentPanel;b.panel("refresh")}function d(a){var b=$.data(a,"dialog").contentPanel;return b.panel("getPanelContent")}$.fn.dialog=function(c,d){if("string"==typeof c){var e=$.fn.dialog.methods[c];return e?e(this,d):this.window(c,d)}return c=c||{},this.each(function(){var d=$.data(this,"dialog");d?$.extend(d.options,c):$.data(this,"dialog",{options:$.extend({},$.fn.dialog.defaults,$.fn.dialog.parseOptions(this),c),contentPanel:a(this)}),b(this),$(this).dialog("resize")})},$.fn.dialog.methods={options:function(a){var b=$.data(a[0],"dialog").options,c=a.panel("options");$.extend(b,{closed:c.closed,collapsed:c.collapsed,minimized:c.minimized,maximized:c.maximized});$.data(a[0],"dialog").contentPanel;return b},dialog:function(a){return a.window("window")},refresh:function(a,b){return a.each(function(){c(this,b)})},getContent:function(a){return d(a[0])}},$.fn.dialog.parseOptions=function(a){return $.extend({},$.fn.window.parseOptions(a),$.parser.parseOptions(a,["toolbar","buttons"]))},$.fn.dialog.defaults=$.extend({},$.fn.window.defaults,{title:" ",collapsible:!1,minimizable:!1,maximizable:!1,resizable:!1,toolbar:null,buttons:null})}),define("lib/kui/message",[],function(){function a(a,c,e,f,g){var h,i;return c=c||"",e=e||{},g=g||{},i=$(g.parent&&$(g.parent).length?g.parent:"body"),h=$(b({content:c,buttons:e})).appendTo(i),$.each(e,function(a){h.find(".win-btn-"+a).linkbutton({onClick:function(){e[a]()}})}),h.window({title:a,noheader:a?!1:!0,width:g.width||400,height:"auto",modal:!0,collapsible:!1,minimizable:!1,maximizable:!1,resizable:!1,outWin:!1,onBeforeDestroy:function(){if(g.showOne){var a=!1;d=$.grep(d,function(b){return h===b.win?!1:(!a&&b.parent.is(i)&&h.is(":visible")&&(b.win.show(),a=!0),!0)})}},onBeforeClose:function(){setTimeout(function(){return"function"==typeof f?(f(),!1):void h.window("destroy")},100)}}),h.window("window").addClass("messager-window"),g.showOne&&($.each(d,function(){this.parent.is(i)&&this.win.hide()}),d.unshift({parent:i,win:h})),setTimeout(function(){h.children("div.messager-button").find("a.l-btn:first").focus()}),h}var b=artTemplate.compile('<div class="messager-body">{{#content}}<div class="messager-button">{{each buttons as button key}}<a class="win-btn-{{key}}">{{key}}</a>{{/each}}</div></div>'),c=artTemplate.compile("<div class='messager-icon messager-{{type}}'></div><div class='messager-text' title='{{msg}}'>{{msg}}</div><br/><div style='clear:both;'/>"+'{{if showInput}}<div><input class="messager-input" type="text"/></div>{{/if}}');$.message={defaultOkText:"确定",defaultCancelText:"取消",alert:$.extend(function(b,d){var e,f,g,h,i;"string"==$.type(d)?f=d:"object"==$.type(d)?(f=d.type,e=d.title,g=d.onClose):"function"==$.type(d)&&(g=d),f=f||$.message.alert.INFO,e=e||f==$.message.alert.INFO?"提示":f==$.message.alert.WARN?"警告":f==$.message.alert.ERROR?"错误":"",h=c({type:f,msg:b});var j={};j[d&&d.okBtnTxt||$.message.defaultOkText]=function(){g&&g(),k.window("destroy")},i=function(){"function"==$.type(g)&&g()};var k=a(e,h,j,i,$.extend({},"object"==$.type(d)&&d||{},{showOne:!0}))},{INFO:"info",WARN:"warning",ERROR:"error"}),confirm:function(b,d,e){var f,g,h={},i=c({type:"question",msg:b});e=e||{},h[e.okBtnText||$.message.defaultOkText]=function(){d&&d(!0),j.window("destroy")},h[e.cancelBtnText||$.message.defaultCancelText]=function(){d&&d(!1),j.window("destroy")},f=e.onClose||function(){d&&d(!1)},g=e.title||"确认";var j=a(g,i,h,f,e)},prompt:function(b,d){var e,f,g,h,i,j={};d=d||{},e="undefined"==$.type(d.msg)?"请输入":d.msg,f=c({type:"info",showInput:!0,msg:e}),j[d&&d.okBtnTxt||$.message.defaultOkText]=function(){var a,c=k.find("input.messager-input");if(d.validType){if(!c.validatebox("isValid"))return!1;a=c.validatebox("getValue")}else a=$.trim(c.val());a&&!1!==b(a)&&k.window("destroy")},j[$.message.defaultCancelText]=function(){b&&b(null),k.window("destroy")},h=function(){"function"==$.type(d.onClose)&&d.onClose(null)},i=d.title||"确认";var k=a(i,f,j,h);return g=k.find("input.messager-input"),d.validType&&g.validatebox({validType:d.validType}),g.focus(),k},loading:function(b,c){var d,e;return b=b||"操作中,请稍候...",e='<div class="progress-mask-msg">'+b+"</div>",d=a(!1,e,null,null,$.extend({},c,{showOne:!0})),d.addClass("messager-loading-body").closest("div.messager-window").addClass("message-loading").next("div.window-shadow").remove(),{destroy:function(){d&&d.window("destroy")},setText:function(a){d&&d.find(".messager-text,.progress-mask-msg").text(a)}}}};var d=[];return{alert:$.message.alert,confirm:$.message.confirm,prompt:$.message.prompt,loading:$.message.loading}}),define("lib/kui/layout",[],function(){function a(a){function b(a){0!=a.length&&(a.panel("resize",{width:i.width(),height:a.panel("options").height,left:0,top:0}),j.top+=a.panel("options").height,j.height-=a.panel("options").height)}function c(a){0!=a.length&&(a.panel("resize",{width:i.width(),height:a.panel("options").height,left:0,top:i.height()-a.panel("options").height}),j.height-=a.panel("options").height)}function d(a){0!=a.length&&(a.panel("resize",{width:a.panel("options").width,height:j.height,left:i.width()-a.panel("options").width,top:j.top}),j.width-=a.panel("options").width)}function e(a){0!=a.length&&(a.panel("resize",{width:a.panel("options").width,height:j.height,left:0,top:j.top}),j.left+=a.panel("options").width,j.width-=a.panel("options").width)}var f=$.data(a,"layout").options,g=$.data(a,"layout").panels,i=$(a);f.fit?i.css(i._fit()):i._fit(!1);var j={top:0,left:0,width:i.width(),height:i.height()};b(h(g.expandNorth)?g.expandNorth:g.north),c(h(g.expandSouth)?g.expandSouth:g.south),d(h(g.expandEast)?g.expandEast:g.east),e(h(g.expandWest)?g.expandWest:g.west),g.center.panel("resize",j)}function b(b){function d(a){a.children("div").each(function(){var a=$.parser.parseOptions(this,["region"]),d=a.region;("north"==d||"south"==d||"east"==d||"west"==d||"center"==d)&&c(b,a,this)})}var e=$(b);"BODY"==e[0].tagName&&$("html").addClass("panel-fit"),e.addClass("layout"),d(e.children("form").length?e.children("form"):e),$('<div class="layout-split-proxy-h"></div>').appendTo(e),$('<div class="layout-split-proxy-v"></div>').appendTo(e),e.bind("_resize",function(c,d){var e=$.data(b,"layout").options;return $.isFunction(e.onBeforeResize)&&e.onBeforeResize.call(b),(1==e.fit||d)&&a(b),!1})}function c(b,c,d){c.region=c.region||"center";var f=$.data(b,"layout").panels,g=$(b),h=c.region;if(!f[h].length){var i=$(d);if(i.length||(i=$("<div></div>").appendTo(g)),i.panel($.extend({},{width:i.length?parseInt(i[0].style.width)||i.outerWidth():"auto",height:i.length?parseInt(i[0].style.height)||i.outerHeight():"auto",split:i.attr("split")?"true"==i.attr("split"):void 0,doSize:!1,cls:"layout-panel layout-panel-"+h,bodyCls:"layout-body",onOpen:function(){if(c.collapsable!==!1){var a={north:"up",south:"down",east:"right",west:"left"};if(a[h]){var d="layout-button-"+a[h],f=$(this).panel("header").children("div.panel-tool");if(!f.children("a."+d).length){var g=$('<a href="javascript:void(0)"></a>').addClass(d).appendTo(f);g.bind("click",{dir:h},function(a){return e(b,a.data.dir),!1})}}}}},c)),f[h]=i,i.panel("options").split){var k=i.panel("panel");k.addClass("layout-split-"+h);var l="";"north"==h&&(l="s"),"south"==h&&(l="n"),"east"==h&&(l="w"),"west"==h&&(l="e"),k.resizable({handles:l,onStartResize:function(){j=!0;var a="";if("north"==h||"south"==h)var a=$(">div.layout-split-proxy-v",b);else var a=$(">div.layout-split-proxy-h",b);var c={display:"block"};"north"==h?(c.top=parseInt(k.css("top"))+k.outerHeight()-a.height(),c.left=parseInt(k.css("left")),c.width=k.outerWidth(),c.height=a.height()):"south"==h?(c.top=parseInt(k.css("top")),c.left=parseInt(k.css("left")),c.width=k.outerWidth(),c.height=a.height()):"east"==h?(c.top=parseInt(k.css("top"))||0,c.left=parseInt(k.css("left"))||0,c.width=a.width(),c.height=k.outerHeight()):"west"==h&&(c.top=parseInt(k.css("top"))||0,c.left=k.outerWidth()-a.width(),c.width=a.width(),c.height=k.outerHeight()),a.css(c),$('<div class="layout-mask"></div>').css({left:0,top:0,width:g.width(),height:g.height()}).appendTo(g)},onResize:function(a){if("north"==h||"south"==h){var c=$(">div.layout-split-proxy-v",b);c.css("top",a.pageY-$(b).offset().top-c.height()/2)}else{var c=$(">div.layout-split-proxy-h",b);c.css("left",a.pageX-$(b).offset().left-c.width()/2)}return!1},onStopResize:function(){$(">div.layout-split-proxy-v",b).css("display","none"),$(">div.layout-split-proxy-h",b).css("display","none");var c=i.panel("options");c.width=k.outerWidth(),c.height=k.outerHeight(),c.left=k.css("left"),c.top=k.css("top"),i.panel("resize"),a(b),j=!1,g.find(">div.layout-mask").remove()}})}}}function d(a,b){var c=$.data(a,"layout").panels;if(c[b].length){c[b].panel("destroy"),c[b]=$();var d="expand"+b.substring(0,1).toUpperCase()+b.substring(1);c[d]&&(c[d].panel("destroy"),c[d]=void 0)}}function e(a,b){function c(c){var d;"east"==c?d="layout-button-left":"west"==c?d="layout-button-right":"north"==c?d="layout-button-down":"south"==c&&(d="layout-button-up");var e=$("<div></div>").appendTo(a).panel({cls:"layout-expand",title:"&nbsp;",closed:!0,doSize:!1,tools:[{iconCls:d,handle:function(){return f(a,b),!1}}]});return e.panel("panel").hover(function(){$(this).addClass("layout-expand-over")},function(){$(this).removeClass("layout-expand-over")}),e}function d(){var c=$(a);if("east"==b)return{center:{width:g.center.panel("options").width+g.east.panel("options").width-28},expand:{left:c.width()-g.east.panel("options").width},pos:{top:g.east.panel("options").top,left:c.width()-28,width:28,height:g.center.panel("options").height},collapse:{left:c.width()}};if("west"==b)return{center:{width:g.center.panel("options").width+g.west.panel("options").width-28,left:28},expand:{left:0},pos:{left:0,top:g.west.panel("options").top,width:28,height:g.center.panel("options").height},collapse:{left:-g.west.panel("options").width}};if("north"==b){var d=c.height()-28;return h(g.expandSouth)?d-=g.expandSouth.panel("options").height:h(g.south)&&(d-=g.south.panel("options").height),g.east.panel("resize",{top:28,height:d}),g.west.panel("resize",{top:28,height:d}),h(g.expandEast)&&g.expandEast.panel("resize",{top:28,height:d}),h(g.expandWest)&&g.expandWest.panel("resize",{top:28,height:d}),{center:{top:28,height:d},expand:{top:0},pos:{top:0,left:0,width:c.width(),height:28},collapse:{top:-g.north.panel("options").height}}}if("south"==b){var d=c.height()-28;return h(g.expandNorth)?d-=g.expandNorth.panel("options").height:h(g.north)&&(d-=g.north.panel("options").height),g.east.panel("resize",{height:d}),g.west.panel("resize",{height:d}),h(g.expandEast)&&g.expandEast.panel("resize",{height:d}),h(g.expandWest)&&g.expandWest.panel("resize",{height:d}),{center:{height:d},expand:{top:c.height()-g.south.panel("options").height},pos:{top:c.height()-28,left:0,width:c.width(),height:28},collapse:{top:c.height()}}}}var e=$.data(a,"layout").options,g=$.data(a,"layout").panels,i=g[b];if(0!=i.panel("options").onBeforeCollapse.call(i)){var j="expand"+b.substring(0,1).toUpperCase()+b.substring(1);g[j]||(g[j]=c(b),g[j].panel("panel").click(function(){f(a,b)}));var k=d();h(g[j])||g.center.panel("resize",k.center),i.panel("panel").animate(k.collapse,e.animateSpeed,function(){i.panel("collapse",!1).panel("close"),g[j].panel("open").panel("resize",k.pos)});var g=$.data(a,"layout").panels,l=i.parents("div.layout"),m=i.panel("options"),n="expand"+m.region.substring(0,1).toUpperCase()+m.region.substring(1),o=l.data("layout").panels[n];if("west"==m.region||"east"==m.region){for(var p=[],q=0;q<m.title.length;q++)p.push(m.title.substring(q,q+1));o.panel("body").addClass("panel-title").css({"font-size":"12px","text-align":"center"}).html(p.join("<br/>"))}else o.panel("setTitle",m.title)}}function f(b,c){function d(){var a=$(b);return"east"==c&&f.expandEast?{collapse:{left:a.width()},expand:{left:a.width()-f.east.panel("options").width}}:"west"==c&&f.expandWest?{collapse:{left:-f.west.panel("options").width},expand:{left:0}}:"north"==c&&f.expandNorth?{collapse:{top:-f.north.panel("options").height},expand:{top:0}}:"south"==c&&f.expandSouth?{collapse:{top:a.height()},expand:{top:a.height()-f.south.panel("options").height}}:void 0}var e=$.data(b,"layout").options,f=$.data(b,"layout").panels,g=d();if(g){var h=f[c];if(!h.is(":visible")&&0!=h.panel("options").onBeforeExpand.call(h)){var i="expand"+c.substring(0,1).toUpperCase()+c.substring(1);f[i].panel("close"),h.panel("panel").stop(!0,!0),h.panel("expand",!1).panel("open").panel("resize",g.collapse),h.panel("panel").animate(g.expand,e.animateSpeed,function(){a(b)})}}}function g(a){function b(b){return 1!=j?("east"!=b.data&&h(c.east)&&h(c.expandEast)&&e(a,"east"),"west"!=b.data&&h(c.west)&&h(c.expandWest)&&e(a,"west"),"north"!=b.data&&h(c.north)&&h(c.expandNorth)&&e(a,"north"),"south"!=b.data&&h(c.south)&&h(c.expandSouth)&&e(a,"south"),!1):void 0}{var c=$.data(a,"layout").panels;$(a)}c.east.length&&c.east.panel("panel").bind("mouseover","east",b),c.west.length&&c.west.panel("panel").bind("mouseover","west",b),c.north.length&&c.north.panel("panel").bind("mouseover","north",b),c.south.length&&c.south.panel("panel").bind("mouseover","south",b),c.center.panel("panel").bind("mouseover","center",b)}function h(a){return a&&a.length?a.panel("panel").is(":visible"):!1}function i(a){var b=$.data(a,"layout").panels;b.east.length&&b.east.panel("options").collapsed&&e(a,"east"),b.west.length&&b.west.panel("options").collapsed&&e(a,"west"),b.north.length&&b.north.panel("options").collapsed&&e(a,"north"),b.south.length&&b.south.panel("options").collapsed&&e(a,"south")}$.fn.layout=function(c,d){return"string"==typeof c?$.fn.layout.methods[c](this,d):(c=c||{},this.each(function(){var d=$.data(this,"layout"),e=$.extend({},$.fn.layout.defaults,$.fn.layout.parseOptions(this),c);d?$.extend(d.options,c):($.data(this,"layout",{options:e,panels:{center:$(),north:$(),south:$(),east:$(),west:$()}}),b(this),g(this)),e.animateSpeed=e.animate?e.animateSpeed:0,a(this),i(this),e.onInitSuccess.call(this,this)}))},$.fn.layout.methods={resize:function(b){return b.each(function(){a(this)})},panel:function(a,b){return $.data(a[0],"layout").panels[b]},collapse:function(a,b){return a.each(function(){e(this,b)})},expand:function(a,b){return a.each(function(){f(this,b)})},add:function(b,d){return b.each(function(){c(this,d),a(this),$(this).layout("panel",d.region).panel("options").collapsed&&e(this,d.region)})},remove:function(b,c){return b.each(function(){d(this,c),a(this)})}},$.fn.layout.parseOptions=function(a){return $.extend({},$.parser.parseOptions(a,[{fit:"boolean"}]))},$.fn.layout.defaults={fit:!1,animate:!0,animateSpeed:100,onInitSuccess:function(){}};var j=!1}),define("lib/kui/tabs",[],function(require,exports,module){function setScrollers(a){var b=$.data(a,"tabs").options;if("left"!=b.tabPosition&&"right"!=b.tabPosition){var c=$(a).children("div.tabs-header"),d=c.children("div.tabs-tool"),e=c.children("div.tabs-scroller-left"),f=c.children("div.tabs-scroller-right"),g=c.children("div.tabs-wrap");d._outerHeight(c.outerHeight()-(b.plain?2:0));var h=0;$("ul.tabs li",c).each(function(){h+=$(this).outerWidth(!0)});var i=c.width()-d._outerWidth();h>i?(e.show(),f.show(),"left"==b.toolPosition?(d.css({left:e.outerWidth(),right:""}),g.css({marginLeft:e.outerWidth()+d._outerWidth(),marginRight:f._outerWidth(),width:i-e.outerWidth()-f.outerWidth()-25})):(d.css({left:"",right:f.outerWidth()}),g.css({marginLeft:e.outerWidth(),marginRight:f.outerWidth()+d._outerWidth(),width:i-e.outerWidth()-f.outerWidth()}))):(e.hide(),f.hide(),"left"==b.toolPosition?(d.css({left:0,right:""}),g.css({marginLeft:d._outerWidth(),marginRight:0,width:i})):(d.css({left:"",right:0}),g.css({marginLeft:0,marginRight:d._outerWidth(),width:i})))}}function addTools(container){var opts=$.data(container,"tabs").options,header=$(container).children("div.tabs-header");if(opts.tools)if("string"==typeof opts.tools)$(opts.tools).addClass("tabs-tool").appendTo(header),$(opts.tools).show();else{header.children("div.tabs-tool").remove();for(var tools=$('<div class="tabs-tool"></div>').appendTo(header),i=0;i<opts.tools.length;i++){var tool=$('<a href="javascript:void(0);"></a>').appendTo(tools);tool[0].onclick=eval(opts.tools[i].handler||function(){}),tool.linkbutton($.extend({},opts.tools[i],{plain:!0}))}}else header.children("div.tabs-tool").remove()}function setSize(a,b){var c=$.data(a,"tabs").options,d=$(a);b&&(b.width&&(c.width=b.width),b.height&&(c.height=b.height)),c.fit?$.extend(c,d._fit()):d._fit(!1),d.width(c.width).height(c.height);var e=$(a).children("div.tabs-header"),f=$(a).children("div.tabs-panels");if("left"==c.tabPosition||"right"==c.tabPosition){e._outerWidth(c.headerWidth),f._outerWidth(d.width()-c.headerWidth),e.add(f)._outerHeight(c.height);var g=e.find("div.tabs-wrap");g._outerWidth(e.width()),e.find(".tabs")._outerWidth(g.width())
}else{e.css("height",""),e.find("div.tabs-wrap").css("width",""),e.find(".tabs").css("width",""),e._outerWidth(c.width),setScrollers(a);var h=c.height;isNaN(h)?f.height("auto"):f._outerHeight(h-e.outerHeight());var i=c.width;isNaN(i)?f.width("auto"):f._outerWidth(i)}}function setSelectedSize(a){var b=$.data(a,"tabs").options,c=getSelectedTab(a);if(c){var d=$(a).children("div.tabs-panels"),e="auto"==b.width?"auto":d.width(),f="auto"==b.height?"auto":d.height();c.panel("resize",{width:e,height:f})}}function wrapTabs(a){var b=$.data(a,"tabs").tabs,c=$.data(a,"tabs").options,d=$(a);d.addClass("tabs-container"),d.wrapInner('<div class="tabs-panels"/>'),$('<div class="tabs-header"><div class="tabs-scroller-left"></div><div class="tabs-scroller-right"></div><div class="tabs-wrap"><ul class="tabs clearfix"></ul></div></div>').prependTo(a),d.children("div.tabs-panels").children("div").each(function(){var d=$.extend({},$.parser.parseOptions(this),{selected:$(this).attr("selected")?!0:void 0,fullScreenAble:c.fullScreenAble||!1}),e=$(this);b.push(e),createTab(a,e,d)}),d.children("div.tabs-header").find(".tabs-scroller-left, .tabs-scroller-right").hover(function(){$(this).addClass("tabs-scroller-over")},function(){$(this).removeClass("tabs-scroller-over")}),d.bind("_resize",function(b,c){var d=$.data(a,"tabs").options;return(1==d.fit||c)&&(setSize(a),setSelectedSize(a)),!1}),$.data(a,"tabs").options.onInitSuccess.call(this)}function setProperties(a){var b=$.data(a,"tabs").options,c=$(a).children("div.tabs-header"),d=$(a).children("div.tabs-panels");c.removeClass("tabs-header-top tabs-header-bottom tabs-header-left tabs-header-right"),d.removeClass("tabs-panels-top tabs-panels-bottom tabs-panels-left tabs-panels-right"),"top"==b.tabPosition?c.insertBefore(d):"bottom"==b.tabPosition?(c.insertAfter(d),c.addClass("tabs-header-bottom"),d.addClass("tabs-panels-top")):"left"==b.tabPosition?(c.addClass("tabs-header-left"),d.addClass("tabs-panels-right")):"right"==b.tabPosition&&(c.addClass("tabs-header-right"),d.addClass("tabs-panels-left")),1==b.plain?c.addClass("tabs-header-plain"):c.removeClass("tabs-header-plain"),1==b.border?(c.removeClass("tabs-header-noborder"),d.removeClass("tabs-panels-noborder")):(c.addClass("tabs-header-noborder"),d.addClass("tabs-panels-noborder")),$(".tabs-scroller-left",c).unbind(".tabs").bind("click.tabs",function(){$(a).tabs("scrollBy",-b.scrollIncrement)}),$(".tabs-scroller-right",c).unbind(".tabs").bind("click.tabs",function(){$(a).tabs("scrollBy",b.scrollIncrement)})}function createTab(a,b,c){var d=$.data(a,"tabs");c=c||{},b.panel($.extend({},c,{border:!1,noheader:!0,closed:!0,doSize:!1,iconCls:c.icon?c.icon:void 0,onLoad:function(){c.onLoad&&c.onLoad.call(this,arguments),d.options.onLoad.call(a,$(this))}}));var e=b.panel("options"),f=$(a).children("div.tabs-header").find("ul.tabs"),g=c.id&&""!=c.id?" id='"+c.id+"' ":"";e.tab=$("<li "+g+"></li>").appendTo(f),e.tab.append('<a href="javascript:void(0)" class="tabs-inner"><span class="tabs-title"></span>'+(e.iconCls?'<span class="tabs-icon"></span>':"")+"</a>"),e.tab.unbind(".tabs").bind("click.tabs",{p:b},function(b){$(this).hasClass("tabs-disabled")||selectTab(a,getTabIndex(a,b.data.p))}).bind("contextmenu.tabs",{p:b},function(b){$(this).hasClass("tabs-disabled")||d.options.onContextMenu.call(a,b,$(this).find("span.tabs-title").html(),getTabIndex(a,b.data.p))}),$(a).tabs("update",{tab:b,options:e})}function addTab(a,b){var c=$.data(a,"tabs").options,d=$.data(a,"tabs").tabs;void 0==b.selected&&(b.selected=!0);var e=$("<div></div>").appendTo($(a).children("div.tabs-panels"));d.push(e),createTab(a,e,b),c.onAdd.call(a,b.title,d.length-1),setScrollers(a),b.selected&&selectTab(a,d.length-1)}function addPageTab(a,b){tabIdExists(a,b.id)?selectTab(a,b.id,!0):(addTab(a,{id:b.id,title:b.title,content:'<iframe id="'+b.id+'" nodeid="'+b.id+'" scrolling="auto" frameborder="0" allowtransparency="true"  style="width:100%;height:100%;overflow:auto;"></iframe>',closable:"undefined"!=String(b.closable)?b.closable:!0}),$("iframe#"+b.id,a).attr("src",b.url))}function tabIdExists(a,b){return null!=getTabById(a,b)}function getTabById(a,b){for(var c=$.data(a,"tabs").tabs,d=0;d<c.length;d++){var e=c[d];if(e.attr("id")==b)return e}return null}function updateTab(a,b){var c=$.data(a,"tabs").options,d=$.data(a,"tabs").selectHis,e=b.tab,f=e.panel("options").title;e.panel($.extend({},b.options,{iconCls:b.options.icon?b.options.icon:void 0}));var g=e.panel("options"),h=g.tab,i=h.find("span.tabs-title"),j=h.find("span.tabs-icon");if(i.html(g.title),j.attr("class","tabs-icon"),h.find("a.tabs-close").remove(),g.closable){i.addClass("tabs-closable");var k=$('<a href="javascript:void(0)" class="tabs-close" title="关闭"></a>').appendTo(h);k.bind("click.tabs",{p:e},function(b){return $(this).parent().hasClass("tabs-disabled")?void 0:(closeTab(a,getTabIndex(a,b.data.p)),!1)})}else i.removeClass("tabs-closable");if(g.iconCls?(i.addClass("tabs-with-icon"),j.addClass(g.iconCls)):i.removeClass("tabs-with-icon"),f!=g.title)for(var l=0;l<d.length;l++)d[l]==f&&(d[l]=g.title);if(h.find("span.tabs-p-tool").remove(),g.tools){var m=$('<span class="tabs-p-tool"></span>').insertAfter(h.find("a.tabs-inner"));if("string"==typeof g.tools)$(g.tools).children().appendTo(m);else for(var l=0;l<g.tools.length;l++){var n=$('<a href="javascript:void(0)"></a>').appendTo(m);n.addClass(g.tools[l].iconCls),g.tools[l].handler&&n.bind("click",{handler:g.tools[l].handler},function(a){$(this).parents("li").hasClass("tabs-disabled")||a.data.handler.call(this)})}var o=12*m.children().length;g.closable?o+=8:(o-=3,m.css("right","5px")),i.css("padding-right",o+"px")}i.width()>=c.maxTitleWidth&&(i.css({display:"block",width:c.maxTitleWidth-20+"px","text-overflow":"ellipsis","white-space":"nowrap","word-wrap":"normal",overflow:"hidden"}),i.attr("title",i.html())),setScrollers(a),$.data(a,"tabs").options.onUpdate.call(a,g.title,getTabIndex(a,e))}function closeTab(a,b){var c=$.data(a,"tabs").options,d=$.data(a,"tabs").tabs,e=$.data(a,"tabs").selectHis;if(exists(a,b)){var f=getTab(a,b),g=f.panel("options").title,h=getTabIndex(a,f);if(0!=c.onBeforeClose.call(a,g,h)){var f=getTab(a,b,!0);f.panel("options").tab.remove(),f.panel("destroy"),c.onClose.call(a,g,h),setScrollers(a);for(var i=0;i<e.length;i++)e[i]==g&&(e.splice(i,1),i--);var j=e.pop();j?selectTab(a,j):d.length&&selectTab(a,0)}}}function getTab(a,b,c){var d=$.data(a,"tabs").tabs;if("number"==typeof b){if(0>b||b>=d.length)return null;var e=d[b];return c&&d.splice(b,1),e}for(var f=0;f<d.length;f++){var e=d[f];if(e.panel("options").title==b)return c&&d.splice(f,1),e}return null}function getTabIndex(a,b){for(var c=$.data(a,"tabs").tabs,d=0;d<c.length;d++)if(c[d][0]==$(b)[0])return d;return-1}function getSelectedTab(a){for(var b=$.data(a,"tabs").tabs,c=0;c<b.length;c++){var d=b[c];if(0==d.panel("options").closed)return d}return null}function doFirstSelect(a){for(var b=$.data(a,"tabs").tabs,c=0;c<b.length;c++)if(b[c].panel("options").selected)return void selectTab(a,c);b.length&&selectTab(a,0)}function selectTab(a,b,c){var d=$.data(a,"tabs").options,e=$.data(a,"tabs").tabs,f=$.data(a,"tabs").selectHis;if(0!=e.length){var g;if(g=c?getTabById(a,b):getTab(a,b)){if(g.panel("options").tab.hasClass("tabs-selected"))return d.onSelect.call(a,g.panel("options").title||"",getTabIndex(a,g)),!1;var h=getSelectedTab(a);h&&(h.panel("close"),h.panel("options").tab.removeClass("tabs-selected")),g.panel("open");var i=g.panel("options").title;f.push(i);var j=g.panel("options").tab;j.addClass("tabs-selected");var k=$(a).find(">div.tabs-header>div.tabs-wrap"),l=j.position().left,m=l+j.outerWidth();if(0>l||m>k.width()){var n=l-(k.width()-j.width())/2;$(a).tabs("scrollBy",n)}else $(a).tabs("scrollBy",0);setSelectedSize(a),d.onSelect.call(a,i,getTabIndex(a,g))}}}function exists(a,b){return null!=getTab(a,b)}function destroy(a){for(var b,c=0;(b=getTab(a,c++))&&b.length;)b.panel("destroy");$(a).remove()}$.fn.tabs=function(a){return"string"==typeof a?$.fn.tabs.methods[a].apply(this,[this].concat(Array.prototype.slice.call(arguments,1))):(a=a||{},this.each(function(){var b,c=$.data(this,"tabs");c?(b=$.extend(c.options,a),c.options=b):($.data(this,"tabs",{options:$.extend({},$.fn.tabs.defaults,$.fn.tabs.parseOptions(this),a),tabs:[],selectHis:[]}),wrapTabs(this)),addTools(this),setProperties(this),setSize(this),doFirstSelect(this)}))},$.fn.tabs.methods={options:function(a){return $.data(a[0],"tabs").options},tabs:function(a){return $.data(a[0],"tabs").tabs},resize:function(a,b){return a.each(function(){$.data(this,"tabs")&&(setSize(this,b),setSelectedSize(this))})},add:function(a,b){return a.each(function(){addTab(this,b)})},close:function(a,b){return a.each(function(){closeTab(this,b)})},getTab:function(a,b){return getTab(a[0],b)},getTabIndex:function(a,b){return getTabIndex(a[0],b)},getSelected:function(a){return getSelectedTab(a[0])},select:function(a,b,c){return a.each(function(){selectTab(this,b,c)})},exists:function(a,b){return exists(a[0],b)},update:function(a,b){return a.each(function(){updateTab(this,b)})},enableTab:function(a,b){return a.each(function(){$(this).tabs("getTab",b).panel("options").tab.removeClass("tabs-disabled")})},disableTab:function(a,b){return a.each(function(){$(this).tabs("getTab",b).panel("options").tab.addClass("tabs-disabled")})},scrollBy:function(a,b){return a.each(function(){function a(){var a=0,b=d.children("ul");return b.children("li").each(function(){a+=$(this).outerWidth(!0)}),a-d.width()+(b.outerWidth()-b.width())}var c=$(this).tabs("options"),d=$(this).find(">div.tabs-header>div.tabs-wrap"),e=Math.min(d._scrollLeft()+b,a());d.animate({scrollLeft:e},c.scrollDuration)})},addPageTab:function(a,b){return a.each(function(){addPageTab(this,b)})},getTabById:function(a,b){return getTabById(a[0],b)},destroy:function(a){return a.each(function(){destroy(this)})}},$.fn.tabs.parseOptions=function(a){return $.extend({},$.parser.parseOptions(a,["width","height","tools","toolPosition","tabPosition",{fit:"boolean",border:"boolean",plain:"boolean",headerWidth:"number"}]))},$.fn.tabs.defaults={width:"auto",height:"auto",maxTitleWidth:230,headerWidth:150,plain:!1,fit:!1,border:!0,tools:null,toolPosition:"right",tabPosition:"top",scrollIncrement:100,scrollDuration:1,onLoad:function(){},onSelect:function(){},onBeforeClose:function(){},onClose:function(){},onAdd:function(){},onUpdate:function(){},onContextMenu:function(){},onInitSuccess:function(){}}}),define("lib/kui/accordion",[],function(){function a(a){var b=$.data(a,"accordion").options,c=$.data(a,"accordion").panels,d=$(a);b.fit?$.extend(b,d._fit()):d._fit(!1),b.width>0&&d._outerWidth(b.width);var e="auto";if(b.height>0){d._outerHeight(b.height);var f=c.length?c[0].panel("header").css("height","")._outerHeight():"auto",e=d.height()-(c.length-1)*f}for(var g=0;g<c.length;g++){var h=c[g],i=h.panel("header");i._outerHeight(f),h.panel("resize",{width:d.width(),height:e})}}function b(a){for(var b=$.data(a,"accordion").panels,c=0;c<b.length;c++){var d=b[c];if(0==d.panel("options").collapsed)return d}return null}function c(a,b){for(var c=$.data(a,"accordion").panels,d=0;d<c.length;d++)if(c[d][0]==$(b)[0])return d;return-1}function d(a,b,c){var d=$.data(a,"accordion").panels;if("number"==typeof b){if(0>b||b>=d.length)return null;var e=d[b];return c&&d.splice(b,1),e}for(var f=0;f<d.length;f++){var e=d[f];if(e.panel("options").title==b)return c&&d.splice(f,1),e}return null}function e(a){var b=$.data(a,"accordion").options,c=$(a);b.border?c.removeClass("accordion-noborder"):c.addClass("accordion-noborder")}function f(b){var c=$(b);c.addClass("accordion");var d=[];return c.children("div").each(function(){var a=$.extend({},$.parser.parseOptions(this),{selected:$(this).attr("selected")?!0:void 0}),c=$(this);d.push(c),g(b,c,a)}),c.bind("_resize",function(c,d){var e=$.data(b,"accordion").options;return(1==e.fit||d)&&a(b),!1}),{accordion:c,panels:d}}function g(a,d,e){d.panel($.extend({},e,{collapsible:!1,minimizable:!1,maximizable:!1,closable:!1,doSize:!1,collapsed:!0,headerCls:"accordion-header",bodyCls:"accordion-body",onBeforeExpand:function(){var c=b(a);if(c){var e=$(c).panel("header");e.removeClass("accordion-header-selected"),e.find(".accordion-collapse").triggerHandler("click")}var e=d.panel("header");e.addClass("accordion-header-selected"),e.find(".accordion-collapse").removeClass("accordion-expand")},onExpand:function(){var b=$.data(a,"accordion").options;b.onSelect.call(a,d.panel("options").title,c(a,this))},onBeforeCollapse:function(){var a=d.panel("header");a.removeClass("accordion-header-selected"),a.find(".accordion-collapse").addClass("accordion-expand")}}));var f=d.panel("header"),g=$('<a class="accordion-collapse accordion-expand" href="javascript:void(0)"></a>').appendTo(f.children("div.panel-tool"));g.bind("click",function(){var b=$.data(a,"accordion").options.animate;return j(a),d.panel("options").collapsed?d.panel("expand",b):d.panel("collapse",b),!1}),f.click(function(){return $(this).find(".accordion-collapse").triggerHandler("click"),!1})}function h(a,c){var e=d(a,c);if(e){var f=b(a);f&&f[0]==e[0]||e.panel("header").triggerHandler("click")}}function i(a){function b(b){var c=$.data(a,"accordion").options,d=c.animate;c.animate=!1,h(a,b),c.animate=d}for(var c=$.data(a,"accordion").panels,d=0;d<c.length;d++)if(c[d].panel("options").selected)return void b(d);c.length&&b(0)}function j(a){for(var b=$.data(a,"accordion").panels,c=0;c<b.length;c++)b[c].stop(!0,!0)}function k(b,c){var d=$.data(b,"accordion").options,e=$.data(b,"accordion").panels;void 0==c.selected&&(c.selected=!0),j(b);var f=$("<div></div>").appendTo(b);e.push(f),g(b,f,c),a(b),d.onAdd.call(b,c.title,e.length-1),c.selected&&h(b,e.length-1)}function l(e,f){var g=$.data(e,"accordion").options,i=$.data(e,"accordion").panels;j(e);var k=d(e,f),l=k.panel("options").title,m=c(e,k);if(0!=g.onBeforeRemove.call(e,l,m)){var k=d(e,f,!0);if(k&&(k.panel("destroy"),i.length)){a(e);var n=b(e);n||h(e,0)}g.onRemove.call(e,l,m)}}$.fn.accordion=function(b,c){return"string"==typeof b?$.fn.accordion.methods[b](this,c):(b=b||{},this.each(function(){var c,d=$.data(this,"accordion");if(d)c=$.extend(d.options,b),d.opts=c;else{c=$.extend({},$.fn.accordion.defaults,$.fn.accordion.parseOptions(this),b);var g=f(this);$.data(this,"accordion",{options:c,accordion:g.accordion,panels:g.panels})}e(this),a(this),i(this)}))},$.fn.accordion.methods={options:function(a){return $.data(a[0],"accordion").options},panels:function(a){return $.data(a[0],"accordion").panels},resize:function(b){return b.each(function(){a(this)})},getSelected:function(a){return b(a[0])},getPanel:function(a,b){return d(a[0],b)},getPanelIndex:function(a,b){return c(a[0],b)},select:function(a,b){return a.each(function(){h(this,b)})},add:function(a,b){return a.each(function(){k(this,b)})},remove:function(a,b){return a.each(function(){l(this,b)})}},$.fn.accordion.parseOptions=function(a){$(a);return $.extend({},$.parser.parseOptions(a,["width","height",{fit:"boolean",border:"boolean",animate:"boolean"}]))},$.fn.accordion.defaults={width:"auto",height:"auto",fit:!1,border:!0,animate:!0,onSelect:function(){},onAdd:function(){},onBeforeRemove:function(){},onRemove:function(){}}}),define("lib/kui/combo",[],function(){function a(a,b){var c,d=$.data(a,"combo").options,e=$.data(a,"combo").combo,f=$.data(a,"combo").panel;b&&(d.width=b),e.appendTo("body"),isNaN(d.width)&&(d.width=e.find("input.combo-text").outerWidth());var g=0;d.hasDownArrow&&(g=e.find(".combo-arrow").outerWidth()),e.outerWidth(d.width),e.find("input.combo-text").width(d.hasDownArrow?e.width()-g:e.width()-g),c=d.multiple&&e.outerWidth()<140?e.outerWidth()+20:e.outerWidth(),f.panel("resize",{width:d.panelWidth?d.panelWidth:c,height:d.panelHeight}),e.insertAfter(a)}function b(a,b){var a=$(a).addClass("combo-f").removeAttr("disabled").hide(),c=$("<span class='combo'></span>").insertAfter(a),d=$("<span class='combo-arrow'></span>").appendTo(c)[b.hasDownArrow?"show":"hide"](),e=$("<input class='combo-text' autocomplete='off' type='"+(a.inputType||"text")+"'/>").appendTo(c),f=(b.isClear?$("<span class='clear' title='清空'></span>"):$()).appendTo(c),g=$('<div class="combo-panel combo-none-panel"></div>').attr("panel-name",a.attr("name")||a.attr("id")).appendTo("body").panel({doSize:!1,closed:!0,cls:"combo-panel",style:{position:"absolute",zIndex:10},onOpen:function(){$(this).panel("resize")}});b.hasDownArrow||f.css("right","0px"),e.attr("readonly",!b.editable).validatebox(b),c.append("<input type='hidden' class='combo-value'>"),g.before($('<div class="combo-selectAll"><span class="select-bg" >全选(F2)</span><span class="select-bg">反选(F3)</span></div>'));var h=a.attr("name")||a.attr("id");return h&&(c.find("input.combo-value").attr("name",h),a.removeAttr("name").attr("comboname",h)),{combo:c,panel:g,comboArrow:d,comboText:e,comboClear:f}}function c(a){var b=$.data(a,"combo").combo.find("input.combo-text");b.validatebox("destroy"),$.data(a,"combo").panel.panel("destroy"),$.data(a,"combo").combo.remove(),$(a).remove()}function d(a){var b=$.data(a,"combo"),c=$.data(a,"combo").options,d=$.data(a,"combo").combo,i=$.data(a,"combo").panel,k=$.data(a,"combo").comboText,l=$.data(a,"combo").comboArrow,m=$.data(a,"combo").comboClear;$.each([d,i,k,l,m],function(){this.unbind(".combo")}),c.disabled||(k.bind("mousedown.combo",function(a){a.stopPropagation()}).bind("click.combo",function(){i.is(":visible")&&!c.justFocused?g(a):(c.closePanel&&$("body>div.panel>div.combo-panel").panel("close"),i.find("div").length>0&&(i.show(),e(a))),c.justFocused=!1}).bind("keyup.combo",function(a){switch(a.keyCode){case 8:if(!c.editable)return!1}}).bind("keydown.combo",function(d){switch(d.keyCode){case 37:i.is(":visible")||(i.show(),e(a)),!c.multiple&&c.keyHandler.left&&c.keyHandler.left.call(a);break;case 38:i.is(":visible")||(i.show(),e(a)),c.multiple||c.keyHandler.up.call(a);break;case 39:i.is(":visible")||(i.show(),e(a)),!c.multiple&&c.keyHandler.left&&c.keyHandler.right.call(a);break;case 40:i.is(":visible")||(i.show(),e(a)),c.multiple||c.keyHandler.down.call(a);break;case 13:c.keyHandler.enter.call(a),g(a),d.preventDefault();break;case 9:g(a);break;case 27:g(a);break;case 113:d.stopPropagation(),d.preventDefault(),$(a).data("combobox")&&$(a).combobox("selectAll"),$(a).data("combotree")&&$(a).combotree("selectAll"),$(a).data("combogrid")&&$(a).combogrid("selectAll");break;case 114:d.stopPropagation(),d.preventDefault(),$(a).data("combobox")&&$(a).combobox("unSelectAll"),$(a).data("combotree")&&$(a).combotree("unSelectAll"),$(a).data("combogrid")&&$(a).combogrid("unSelectAll");break;case 115:d.stopPropagation(),d.preventDefault(),$(a).data("combobox")&&$(a).combobox("clear"),$(a).data("combotree")&&$(a).combotree("clear"),$(a).data("combogrid")&&$(a).combogrid("clear");break;default:c.editable&&(b.timer&&clearTimeout(b.timer),b.timer=setTimeout(function(){var d=k.val();b.previousValue!=d&&(b.previousValue=d,e(a),c.keyHandler.query.call(a,k.val()),h(a,!0))},c.delay))}}).bind("focus.combo",function(){i.is(":visible")||e(a),c.justFocused=!0}).bind("blur.combo",function(b){d.removeClass("combo-focus"),c.editable&&c.acceptInput&&o(a,[k.val()]),c.onBlur.call(a,b)}),d.bind("mouseenter.combo",function(){($(a).combo("getValues").length||k.val())&&m.show()}).bind("mouseleave.combo",function(){m.hide()}),m.bind("mousedown.combo",function(){j(a),m.hide(),c.onClear.call(a)}),l.bind("click.combo",function(){i.is(":visible")?g(a):(c.closePanel&&$("body>div.panel>div.combo-panel").panel("close"),f(),i.find("div").length>0&&(i.show(),e(a),k.focus())),c.justFocused=!1}).bind("mouseenter.combo",function(){$(this).addClass("combo-arrow-hover")}).bind("mouseleave.combo",function(){$(this).removeClass("combo-arrow-hover")}).bind("mousedown.combo",function(){return!1}),i.bind("mousedown.combo",function(){var a=k.data("validatebox").options;i.is(":visible")&&(k.data("validOnBlur",a.validOnBlur),a.validOnBlur=!1)}).bind("mouseup.combo",function(){k.data("validatebox").options.validOnBlur=k.data("validOnBlur")}))}function e(a){var b=$.data(a,"combo").options,c=$.data(a,"combo").combo,d=$.data(a,"combo").panel;0!==d.find("div").length&&($.fn.window&&d.panel("panel").css("z-index",$.fn.window.defaults.zIndex++),b.multiple&&b.isShowSelectPanel?$(".combo-selectAll").show():$(".combo-selectAll").hide(),c.addClass("combo-focus"),d.panel("open"),b.onShowPanel.call(a),function(){if(d.is(":visible")){var a=c.offset().top+c.outerHeight(),b=c.offset().left;a+d.parent().outerHeight()>$(window).height()+$(document).scrollTop()&&(a=c.offset().top-d.parent().outerHeight()),a<$(document).scrollTop()&&(a=c.offset().top+c.outerHeight()),b+d.outerWidth()>$(window).outerWidth()&&(b=$(window).outerWidth()-d.parent().outerWidth()),d.panel("move",{left:b,top:a}),setTimeout(arguments.callee,200)}}(),$(document).unbind(".combo").bind("mousedown.combo",function(c){var d=$("body>div.combo-p>div.mulbottomtoolbar"),e=$("body>div.panel>div.combo-panel"),g=$(c.target).closest("div.combo-panel",e),h=$(c.target).closest("div.mulbottomtoolbar",d);g.length||h.length||(f(),e.panel("close"),b.onHidePanel.call(a),$(document).unbind(".combo"))}))}function f(){var a=$("body .combo");a.hasClass("combo-focus")&&a.removeClass("combo-focus")}function g(a){var b=$.data(a,"combo").options,c=$.data(a,"combo").panel,d=$.data(a,"combo").combo;d.removeClass("combo-focus"),c.panel("close"),b.onHidePanel.call(a)}function h(a,b){if(_.isEmpty($.data(a,"combo")))return!1;var c=$.data(a,"combo").options,d=$.data(a,"combo").combo.find("input.combo-text"),e=$(a);c.required&&e.parent().prev().children().length<1&&e.parent().prev().text()&&e.parent().prev().html('<label class="required-star"> <span>'+e.parent().prev().text()+"</span> </label>"),d.validatebox(c),b&&(d.validatebox("validate"),d.trigger("mouseleave"))}function i(a,b){b=String(b);var c=$.data(a,"combo").options,d=$.data(a,"combo").combo,e=$.data(a,"combo").comboText,f=$.data(a,"combo").comboArrow,g=d.find(".combo-value");"true"==b||"disabled"==b?(c.disabled=!0,$(a).attr("disabled",!0),g.attr("disabled",!0),d.addClass("combo-disabled"),f.addClass("combo-arrow-disabled"),e.addClass("form-input-disabled").attr("disabled",!0).removeClass("validatebox-invalid").removeClass("varlidataTextarea-invalid").validatebox("hideTip")):(c.disabled=!1,$(a).removeAttr("disabled"),g.removeAttr("disabled"),d.removeClass("combo-disabled"),f.removeClass("combo-arrow-disabled"),e.removeClass("form-input-disabled").removeAttr("disabled"))}function j(a){var b=$.data(a,"combo").options,c=$.data(a,"combo").combo;b.multiple?(c.find("input.combo-value").length?c.find("input.combo-value:eq(0)").val("").siblings("input.combo-value").remove():$('<input type="hidden" class="combo-value" name="'+$(a).attr("comboname")+'" value="">').appendTo(c),$.data(a,"combo").panel.find(".combobox-item-selected").removeClass("combobox-item-selected").find("input:first").each(function(){$(this).attr("checked",!1)})):c.find("input.combo-value").val(""),c.find("input.combo-text").val("").removeAttr("title")}function k(a){var b=$.data(a,"combo").combo;return b.find("input.combo-text").val()}function l(a,b){b&&(b=$("<a>"+b+"</a>").text());var c=$.data(a,"combo").combo;c.find("input.combo-text").val(b),b&&h(a,!0),$.data(a,"combo").previousValue=b,c.find("input.combo-text").attr("title",b)}function m(){}function n(a){var b=[],c=$.data(a,"combo").combo;return c.find("input.combo-value").each(function(){$(this).val()&&b.push($(this).val())}),b}function o(a,b,c){var d=$.data(a,"combo").options,e=n(a),f=$.data(a,"combo").combo;f.find("input.combo-value").remove();var g=$(a).attr("comboName"),h=b[b.length-1],i=0;if("combobox"==h){var j=b[b.length-2];i=b.length-2}else i=b.length;if(0==i){var k=$('<input type="hidden" class="combo-value">').appendTo(f);g&&k.attr("name",g),k.val("")}else for(var l=0;i>l;l++){b[l]=jQuery.trim(b[l]);var k=$('<input type="hidden" class="combo-value">').appendTo(f);"combobox"==h&&k.attr("text",j[l]),g&&k.attr("name",g),k.val(b[l])}for(var m=[],l=0;l<e.length;l++)m[l]=jQuery.trim(e[l]);for(var o=[],l=0;l<b.length;l++)for(var p=0;p<m.length;p++)if(b[l]==m[p]){o.push(b[l]),m.splice(p,1);break}(o.length!=b.length||b.length!=e.length)&&(d.multiple?d.onChange.call(a,b,e):d.onChange.call(a,b[0],e[0])),c||$(a).combo("setText",b[0])}function p(a){var b=n(a);return 0==b.length?"":b[0]}function q(a){var b=r(a);return b[0]}function r(a){var b=[],c=$.data(a,"combo").combo;return c.find("input.combo-value").each(function(){b.push($(this).attr("text"))}),b}function s(a,b){o(a,[b])}function t(a){var b=$.data(a,"combo").options;s(a,b.defaultValue||b.value),l(a,b.text)}function u(a){var b=$.data(a,"combo").options,c=b.value||b.defaultValue||"";b.multiple?o(a,$.isArray(c)?c:c.split(-1===c.indexOf(",")&&b.singleByte?"":b.separator)):s(a,c)}function v(a,b,c){$.data(a,"combo").combo.find("input.combo-text").validatebox("showTip",b,c)}$.fn.combo=function(c){if("string"==typeof c){var e=[this];return $.fn.combo.methods[c].apply(this,e.concat(Array.prototype.slice.call(arguments,1)))}return c=c||{},this.each(function(){c=c||{};var e=$.data(this,"combo");e?$.extend(e.options,c):(e=$.extend({},$.fn.combo.defaults,$.fn.combo.parseOptions(this),c),e=$.data(this,"combo",$.extend({options:e,previousValue:null},b(this,e)))),i(this,e.options.disabled),a(this,"auto"!=e.options.width?e.options.width:$.browser.chrome?120:122),d(this),n(this).length||u(this)})},$.fn.combo.methods={options:function(a){return $.data(a[0],"combo").options},panel:function(a){return $.data(a[0],"combo").panel},textbox:function(a){return $.data(a[0],"combo").combo.find("input.combo-text")},destroy:function(a){return a.each(function(){c(this)})},resize:function(b,c){return b.each(function(){a(this,c)})},showPanel:function(a){return a.each(function(){e(this)})},hidePanel:function(a){return a.each(function(){g(this)})},disable:function(a){return a.each(function(){i(this,!0),d(this)})},enable:function(a){return a.each(function(){i(this,!1),d(this)})},changeRequired:function(a,b){return a.each(function(){var a=$(this).data("combo").options,c=$(this).data("combo").comboText;a.required=!!b,c.validatebox("changeRequired",b)})},validate:function(a){return a.each(function(){h(this,!0)})},isValid:function(a){var b=$.data(a[0],"combo").combo.find("input.combo-text");return b.validatebox("isValid")},clear:function(a){return a.each(function(){j(this)})},reset:function(a){return a.each(function(){t(this)})},getText:function(a){return k(a[0])},setText:function(a,b){return a.each(function(){l(this,b)})},setTexts:function(a,b){return a.each(function(){m(this,b)})},getValues:function(a){return n(a[0])},setValues:function(a,b,c){return a.each(function(){o(this,b,c)})},getValue:function(a){return p(a[0])},setValue:function(a,b){return a.each(function(){s(this,b)})},getName:function(a){return q(a[0])},getNames:function(a){return r(a[0])},showTip:function(a,b,c){return a.each(function(){v(this,b,c)})}},$.fn.combo.parseOptions=function(a){var b=$(a);return $.extend({},$.fn.validatebox.parseOptions(a),$.parser.parseOptions(a,["width","separator",{panelWidth:"number",editable:"boolean",hasDownArrow:"boolean",isClear:"boolean",delay:"number"}]),{panelHeight:"auto"==b.attr("panelHeight")?"auto":parseInt(b.attr("panelHeight"))||void 0,multiple:"true"===String(b.attr("multiple"))?!0:void 0,disabled:b.attr("disabled")?!0:void 0,isClear:b.attr("true")?!0:void 0,value:b.val()||void 0})},$.fn.combo.defaults=$.extend({},$.fn.validatebox.defaults,{width:"auto",panelWidth:null,panelHeight:"auto",multiple:!1,separator:",",editable:!1,acceptInput:!1,disabled:!1,isClear:!0,isShowSelectPanel:!0,hasDownArrow:!0,value:"",defaultValue:"",closePanel:!0,delay:200,keyHandler:{up:function(){},down:function(){},enter:function(){},query:function(){}},onShowPanel:function(){},onHidePanel:function(){},onChange:function(){},onClear:function(){},onBlur:$.noop})}),define("lib/kui/combobox",[],function(require,exports,module){function selectAll(a){var b=$.data(a,"combobox").options;if(b.multiple!==!1&&(setValues(a,$.map(b.data,function(a){return a[b.valueField]})),b.onSelect))for(var c=0;c<b.data.length;c++)b.onSelect.call(a,b.data[c])}function unSelectAll(a){var b=$.data(a,"combobox").options,c=$(a),d=c.combo("getValues");if(!d.length)return void selectAll(a);var e=[];$.each(b.data,function(a,c){-1===$.inArray(c[b.valueField]+"",d)&&e.push(c[b.valueField])}),c.combo("clear"),setValues(a,e)}function scrollTo(a,b){var c=$(a).combo("panel"),d=c.find('div.combobox-item[value="'+b+'"]');if(d.length)if(d.position().top<=0){var e=c.scrollTop()+d.position().top;c.scrollTop(e)}else if(d.position().top+d.outerHeight()>c.height()){var e=c.scrollTop()+d.position().top+d.outerHeight()-c.height();c.scrollTop(e)}}function setSize(a,b){$(a).combo("resize",b)}function selectPrev(a){var b,c=$(a).combo("panel"),d=$(a).combo("getValues"),e=c.find('div.combobox-item[value="'+d.pop()+'"]').prevAll(":visible:first");e.length||(e=c.find("div.combobox-item:visible:last")),b=e.attr("value"),select(a,b),scrollTo(a,b)}function selectNext(a){var b,c,d=$(a).combo("panel"),e=$(a).combo("getValues");isComboboxEmpty(a)?(b=getEmptyItem(a),b=b.length&&isItemSelected(b)?b.next(":visible"):d.find("div.combobox-item:visible:first")):b=d.find('div.combobox-item[value="'+e.pop()+'"]').nextAll(":visible:first"),b.length||(b=d.find("div.combobox-item:visible:first")),c=b.attr("value"),select(a,c),scrollTo(a,c)}function isComboboxEmpty(a){var b=$(a).combo("getValues");return!b.length||1===b.length&&""===b[0]}function getEmptyItem(a){return $(a).combo("panel").find("div.combobox-item[value='']")}function isItemSelected(a){return a.hasClass("combobox-item-selected")}function select(a,b){var c=$.data(a,"combobox").options,d=$.data(a,"combobox").data||[];if(c.multiple){for(var e=$(a).combo("getValues"),f=0;f<e.length;f++)if(e[f]==b)return;e.push(b),setValues(a,e)}else setValues(a,[b]);for(var f=0;f<d.length;f++)if(d[f][c.valueField]==b){c.onSelect.call(a,d[f]);break}}function unselect(a,b){for(var c=$.data(a,"combobox").options,d=$.data(a,"combobox").data,e=$(a).combo("getValues"),f=0;f<e.length;f++)if(e[f]==b){e.splice(f,1),setValues(a,e);break}for(var f=0;f<d.length;f++)if(d[f][c.valueField]==b)return void c.onUnselect.call(a,d[f])}function isSingleByte(a){var b=$.data(a,"combobox").options,c=$.data(a,"combobox").data||[],d=!0;return $.each(c,function(a,c){return c[b.valueField].length>1?d=!1:void 0}),d}function setValues(a,b,c){function d(a){for(var b,c=0;c<f.length;c++)if(f[c]&&f[c][e.valueField]==a){if(e.textField.indexOf(",")>-1){var d=e.textField.split(",");b=f[c][d[0]]+(f[c][d[0]].toString()?"-":"")+f[c][d[1]]}else b=f[c][e.textField];break}return b}var e=$.data(a,"combobox").options,f=e.data||[],g=$(a).combo("panel");if(!(e.acceptInput||f&&f.length))return void $(a).combo("setText","");var h=$.isArray(b)?b:e.multiple?b.split(-1===b.indexOf(",")&&isSingleByte(a)?"":","):[b],i=[],j=[];g.find(".combobox-item").each(function(){var a=$(this);a.removeClass("combobox-item-selected"),e.multiple&&a.find("input").prop("checked",!1)});for(var k=0;k<h.length;k++){var l,m=h[k];"\\"===m&&(m="\\\\"),l=g.find('.combobox-item[value="'+m+'"]'),l.length&&(j.push(d(m)||m),i.push(m),l.addClass("combobox-item-selected"),e.multiple&&l.find("input").prop("checked",!0))}i.length?($(a).combo("setValues",i,c),c||$(a).combo("setText",j.join(e.separator))):e.acceptInput?$(a).combo("setValues",b):($(a).combo("setValues",[]),$(a).combo("setText",""))}function transformData(a){var b=$.data(a,"combobox").options,c=[];return $(">option",a).each(function(){var a={};a[b.valueField]=void 0!=$(this).attr("value")?$(this).attr("value"):$(this).html(),a[b.textField]=$(this).html(),a.selected=$(this).attr("selected"),c.push(a)}),c}function setDict(a,b){var c=$.data(a,"combobox").options,d=dict.getDictData(b),e=d||[],f=[],f=f.concat(e);if(c&&c["default"]){var g=c["default"].split(":");f.unshift({dict_val:g[0],dict_des:g[1]})}c.valueField="dict_val",c.textField="dict_des",loadData(a,f)
}function setCache(a,b){var c=$.data(a,"combobox").options,d=cache.getData(b),e=[];if(e=e.concat(d),c&&c["default"]){var f=c["default"].split(":"),g={};g[c.valueField]=f[0],c.textField.indexOf(",")>-1?g[c.textField.split(",")[1]]=f[1]:g[c.textField]=f[1],e.unshift(g)}loadData(a,e)}function loadData(target,data,remainText){var opts=$.data(target,"combobox").options,panel=$(target).combo("panel");$.data(target,"combobox").data=$.extend([],data);var selected=$(target).combobox("getValues");if(panel.empty(),"undefined"!=typeof data&&0!=data.length){var cData=$.extend([],data);opts.sort&&(cData=opts.sort.call(target,cData));var retData=[];if("string"===$.type(opts.loadFilter)){var inverse="!"===opts.loadFilter.charAt("0"),filterArr=opts.loadFilter.replace("!","").split(/[,\|]/),condition="-1 "+(inverse?"===":"!==")+" $.inArray(this[opts.valueField], filterArr)";$.each(cData,function(){eval(condition)&&retData.push(this)}),cData=retData}else $.isFunction(opts.loadFilter)&&(cData=opts.loadFilter.call(target,cData));if(opts.extItems){opts.extItems=$.isArray(opts.extItems)?opts.extItems:eval("("+opts.extItems+")"),opts.extItems.sort(function(a,b){return""===b[opts.valueField]?1:0});var extItems=[];$.each(opts.extItems,function(a,b){extItems.push(b)}),$.data(target,"combobox").data=$.extend([],cData=extItems.concat(cData))}if(opts.dict&&opts.showDictValue&&(opts.valueField="dict_val",opts.textField="dict_val,dict_des"),opts.col||opts.dataColor){var objCol=opts.col?opts.col.dataColor:opts.dataColor,_color=[];if(objCol)for(var key in objCol){var arr=objCol[key].split("|");if(arr.length>1)for(var a=0;a<arr.length;a++)_color.push({item:arr[a],color:key});else _color.push({item:arr[0],color:key})}}for(var i=0;i<cData.length;i++){if("undefined"==typeof cData[i])return;var v=$.trim(cData[i][opts.valueField]);if("number"===opts.valDataType){var sArr=opts.textField.split(",");cData[i][sArr[0]]=Number(cData[i][sArr[0]]),cData[i][opts.valueField]=v=Number(v)}var s;if(opts.textField.indexOf(",")>-1){var sArr=opts.textField.split(",");s=cData[i][sArr[0]]+(cData[i][sArr[0]].toString()?"-":"")+cData[i][sArr[1]]}else s=cData[i][opts.textField];var color="";_color&&_color.length>0&&$.each(_color,function(a,b){return b.item==cData[i].dict_val?void(color=b.color):void 0});var item=$('<div class="combobox-item" style="color:'+color+'"></div>').appendTo(panel);item.attr("value",v),item.html(opts.formatter?opts.multiple?'<input type="checkbox" value="'+v+'"><span>'+opts.formatter.call(target,cData[i])+"</span>":opts.formatter.call(target,cData[i]):opts.multiple?'<input type="checkbox" value="'+v+'"><span>'+s+"</span>":s),cData[i].selected&&!function(){for(var a=0;a<selected.length;a++)if(v==selected[a])return;selected.push(v)}()}if(opts.data=cData,(0==selected.length||""==selected[0])&&(cData.length>0&&opts.autoFill&&(selected.push(cData[0][opts.valueField]),setTimeout(function(){opts.onSelect.call(target,cData[0])},100)),cData.length>0&&""!==opts.defaultValue&&(selected.push(opts.defaultValue),setValues(target,selected,remainText))),selected.length>0&&1!=selected.length||""!=selected[0]){var oldValues=$(target).combobox("getValue");if(opts.multiple)if("@"==selected[0]&&opts.autoSelectAll){var panel=$.data(target,"combo").panel,$select=panel.parent().find(".combo-selectAll");$select.find("span:eq(0)").trigger("click")}else setValues(target,selected,remainText);else selected.length?setValues(target,[selected[selected.length-1]],remainText):cData.length&&opts.autoFill?setValues(target,[cData[0][opts.valueField]],remainText):setValues(target,[],remainText)}opts.onLoadSuccess.call(target,cData),$(".combobox-item",panel).hover(function(){$(this).addClass("combobox-item-hover")},function(){$(this).removeClass("combobox-item-hover")}).click(function(a){var b=$(this);opts.multiple?(b.hasClass("combobox-item-selected")?(b.find(":checkbox").attr("checked",!1),b.removeClass("combobox-item-selected"),unselect(target,b.attr("value"))):(b.find(":checkbox").attr("checked",!0),b.addClass("combobox-item-selected"),select(target,b.attr("value"))),$(target).parent().find("input.combo-text").focus()):(select(target,b.attr("value")),$(target).combo("hidePanel")),a.stopPropagation()})}}function changeFilter(a,b){var c=$.data(a,"combobox");c.options.loadFilter=b,loadData(a,c.data)}function bindEvents(a){var b=$.data(a,"combo").panel,c=b.parent().find(".combo-selectAll");c.find("span:eq(0)").unbind("click").bind("click",function(){selectAll(a)}),c.find("span:eq(1)").unbind("click").bind("click",function(){unSelectAll(a)})}function request(a,b,c,d){var e=$.data(a,"combobox").options;b&&(e.url=b),c=c||{},0!=e.onBeforeLoad.call(a,c)&&e.loader.call(a,c,function(b){loadData(a,b,d)},function(){e.onLoadError.apply(this,arguments)})}function doQuery(a,b){var c=$.data(a,"combobox").options,d=$(a).combo("panel"),e=$.data(a,"combobox").data||[],f=[];return clearValue(a),resetPanel(a),b?(b=c.multiple?b.split(/[\,\，]/):[b],d.find("div.combobox-item").hide(),$.each(e,function(e,g){$.each(b,function(b,e){e&&c.filter.call(a,e,g)&&(d.find('div.combobox-item[value="'+g[c.valueField]+'"]').show(),-1===$.inArray(g[c.valueField],f)&&f.push(g[c.valueField]||""))})}),!d.find("div.combobox-item:visible").length,void(f.length&&!c.multiple&&setValues(a,c.multiple?f:[f[0]],!0))):void d.find("div.combobox-item").show()}function clearValue(a){var b=$.data(a,"combo").combo;b.find("input.combo-value").remove(),$('<input type="hidden" class="combo-value" name="'+$(a).attr("comboname")+'">').appendTo(b)}function resetPanel(a){$(a).combo("panel").find("div.combobox-item-selected").removeClass("combobox-item-selected").find(":checkbox").attr("checked",!1)}function create(a){var b=$.data(a,"combobox"),c=b.options;$(a).addClass("combobox-f"),$(a).combo($.extend({},c,{onShowPanel:function(){var b="auto",d=$.data(a,"combobox").data;$(a).combo("panel").find("div.combobox-item").show(),scrollTo(a,$(a).combobox("getValue")),c.onShowPanel.call(a),b=d&&d.length>10?c.panelHeight===b?260:c.panelHeight:c.panelHeight===b?b:c.panelHeight,$(a).combo("panel").css({height:b})},onClear:function(){resetPanel(this),c.onClear.call(a)},onBlur:function(b){var d=$.data(a,"combo").combo.find("input.combo-text"),e=$(a).combo("getValues");d.val()&&(isComboboxEmpty(a)?setValues(a,getEmptyItem(a).length?[""]:[]):setValues(a,e)),_.isFunction(c.onBlur)&&c.onBlur.call(a,b)}}))}$.fn.combobox=function(a,b){if("string"==typeof a){var c=$.fn.combobox.methods[a];return c?c(this,b):this.combo(a,b)}return a=a||{},this.each(function(){var b=$.data(this,"combobox");b?($.extend(b.options,a),(b.options.dict||b.options.cache||b.options.req&&b.options.req.length)&&b.options.data.length&&(b.options.data=[]),create(this)):(b=$.data(this,"combobox",{options:$.extend({},$.fn.combobox.defaults,$.fn.combobox.parseOptions(this),a)}),create(this),bindEvents(this));var c=transformData(this);c.length?loadData(this,c):b.options.data.length?loadData(this,b.options.data):b.options.dict?setDict(this,b.options.dict):b.options.cache?setCache(this,b.options.cache):request(this),b.options.text=$.data(this,"combo").options.text=$(this).combo("getText")})},$.fn.combobox.methods={options:function(a){var b=$.data(a[0],"combobox").options;return b.originalValue=a.combo("options").originalValue,b},getData:function(a){return $.data(a[0],"combobox").data},setValues:function(a,b){return a.each(function(){setValues(this,b)})},setValue:function(a,b){return a.each(function(){setValues(this,[b])})},reset:function(a){return a.each(function(){var a=$(this).combobox("options");a.multiple?$(this).combobox("setValues",a.originalValue):$(this).combobox("setValue",a.originalValue)})},loadData:function(a,b){return a.each(function(){loadData(this,b)})},changeFilter:function(a,b){return a.each(function(){changeFilter(this,b)})},reload:function(a,b,c){return a.each(function(){request(this,b,c)})},select:function(a,b){return a.each(function(){select(this,b)})},unselect:function(a,b){return a.each(function(){unselect(this,b)})},setDict:function(a,b){return a.each(function(){setDict(this,b)})},setCache:function(a,b){return a.each(function(){setCache(this,b)})},selectAll:function(a){return a.each(function(){selectAll(this)})},unSelectAll:function(a){return a.each(function(){unSelectAll(this)})}},$.fn.combobox.parseOptions=function(a){$(a);return $.extend({},$.fn.combo.parseOptions(a),$.parser.parseOptions(a,["valueField","textField","mode","method","url"]))},$.fn.combobox.defaults=$.extend({},$.fn.combo.defaults,{atIsAll:!1,autoSelectAll:!0,showDictValue:!0,width:"auto",panelWidth:null,panelHeight:"auto",valueField:"value",textField:"text",mode:"local",method:"post",editable:!0,enableQuery:!0,matchCase:!0,autoFill:!1,sort:null,url:null,data:[],req:[],keyHandler:{up:function(){selectPrev(this)},down:function(){selectNext(this)},enter:function(){var a=$(this).data("combo").panel,b=$(this).combobox("getValues"),c=a.find("div.combobox-item:visible:first");b=b.length?b:c.length?[c.attr("value")]:[],b.length&&select(this,b[0]),$(this).combobox("hidePanel")},query:function(a){var b=$(this).combobox("options");b.enableQuery&&doQuery(this,a)}},filter:function(a,b){function c(a,b){return d.matchCase?-1!==a.indexOf(b):-1!==a.toLowerCase().indexOf(b.toLowerCase())}var d=$(this).combobox("options"),e=d.textField.split(",");return 1===e.length?c(b[d.textField],a)||c(b[d.valueField],a):c(b[e[0]],a)||c(b[e[1]],a)||c(b[d.valueField],a)},formatter:function(a){var b=$(this).combobox("options");if(b.textField.indexOf(",")>-1){var c=b.textField.split(",");return a[c[0]]+(a[c[0]].toString()?"-":"")+a[c[1]]}return a[b.textField]},loader:function(a,b,c){var d=$(this).combobox("options");if(!(d.url||d.req&&0!=d.req.length))return!1;d.req&&d.req.length>0&&(d.req[0].service||(d.req[0].service="P9999999"));var e=function(a){a&&a[0]&&$.isFunction(b)&&b(a[0])},f={url:d.url,type:d.method,dataType:"xml",async:!0,responseType:"xml",func:e,error:function(){c.apply(this,arguments)},req:d.req||[]};ajaxRequest(f)},onBeforeLoad:function(){},onLoadSuccess:function(){},onLoadError:function(){},onSelect:function(){},onUnselect:function(){},onSelectAll:function(){},onUnselectAll:function(){},onClear:$.noop})}),define("lib/kui/autocomplete",[],function(require,exports,module){function init(target){function hideSearchOptions(){state.searchTypeDom&&state.searchOptions&&($(".auto-search-type",state.searchTypeDom).removeClass().addClass("auto-search-type"),state.searchTypeDom.find("b").css("backgroundPosition","-15px center"),state.searchOptions.hide())}function selectCurrent(){var a=select.selected();if(!a)return!1;var b=a.searchTypeResult||a.result;if(previousValue=b,options.multiple){var c=trimWords(jQuerytarget.val());c.length>1&&(b=c.slice(0,c.length-1).join(options.multipleSeparator)+options.multipleSeparator+b),b+=options.multipleSeparator}return jQuerytarget.val(b).attr("prevSelected",b),options.$hiddenField&&options.$hiddenField.length&&options.$hiddenField.val(a.original[options.hiddenField]||""),hideResultsNow(),jQuerytarget.trigger("result",[a.data,a.value]),!0}function onChange(a,b){if(lastKeyPressCode==KEY.DEL)return void select.hide();var c=jQuerytarget.val().replace(/\'*/g,"");if(b||c!=previousValue){previousValue=c,c=lastWord(c),checkResultValidate(target,!0);var d=c.replace(/[^\x00-\xff]/g,"**");validate(jQuerytarget[0])&&d.length>=options.minLength?(jQuerytarget.addClass(options.loadingClass),options.matchCase||(c=c.toLowerCase()),request(c,receiveData,hideResultsNow)):(stopLoading(),select.hide())}}function trimWords(a){if(!a)return[""];var b=a.split(options.multipleSeparator),c=[];return jQuery.each(b,function(a,b){jQuery.trim(b)&&(c[a]=jQuery.trim(b))}),c}function lastWord(a){if(!options.multiple)return a;var b=trimWords(a);return b[b.length-1]}function autoFill(a,b){options.autoFill&&lastWord(jQuerytarget.val()).toLowerCase()==a.toLowerCase()&&lastKeyPressCode!=KEY.BACKSPACE&&(jQuerytarget.val(jQuerytarget.val()+b.substring(lastWord(previousValue).length)),selection(target,previousValue.length,previousValue.length+b.length))}function hideResults(){clearTimeout(timeout),timeout=setTimeout(hideResultsNow,200)}function hideResultsNow(){var a=select.visible();select.hide(),clearTimeout(timeout),stopLoading(),a&&(options.focusAfterSelect&&selection(target,target.value.length,target.value.length),options.onClose.call(this,target))}function receiveData(a,b){var c=$(this).autocomplete("options");if(b&&b.length&&hasFocus){if(stopLoading(),select.display(b,a),autoFill(a,b[0].value),select.show(),c.blurSearch&&($(this).val(""),1===b.length)){var d=select.selected();if(!d)return!1;var e=d.searchTypeResult||d.result;c.previousValue=e,$(this).val(e).attr("prevSelected",e),hideResultsNow()}}else c.translate=!1,hideResultsNow()}function request(a,b,c){options.matchCase||(a=a.toLowerCase());var d=cache.load(a);if(options.useCache&&d&&d.length)b.call(target,a,d);else if("string"==typeof options.url&&options.url.length>0){var e={timestamp:+new Date};jQuery.each(options.extraParams,function(a,b){e[a]="function"==typeof b?b():b});var f=options.req;$.extend(f[0],options.extraParams),f[0].pagecount=options.max,f[0].sourceField=options.sourceField,void 0!=field&&void 0==f[0][field]&&(f[0][field]=options.searchType.data[0].value);var g=options.params;g&&(f[0][g]=a),f=_.isArray(f)?f:[f],f=_.chain(f).each(function(a){delete a._server_id}).value(),ajax.post({noProcess:options.blurSearch?!0:!1,req:f}).done(function(c){if(a==jQuerytarget.val()){opts.tampData=c.length>0?c[0]:[];var d=options.parse&&options.parse(c)||parse(c);if(cache.add(a,d),b.call(target,a,d),options.onResponse.call(target,c),!opts.tampData.length||0===opts.tampData.length){var e="无检索记录,请输入正确的检索值！";$(target).validatebox("showTip",e),setTimeout(function(){$(target).validatebox("hideTip")},5e3),checkResultValidate(target,!1,e),opts.blurSearch||options.onNoRecords.call(this),opts.blurSearch&&(options.typeChange=!0,options.translate=!1)}}})}else select.emptyList(),c(a)}function checkResultValidate(a,b,c){if(options.isResultValid){var d="noAccord",e=$.data(a,"validatebox").options.validType||"";b?(e=e.replace(/(;?)noAccord/g,""),$(a).validatebox({validType:e})):($.fn.validatebox.defaults.rules[d]={validator:function(){return!1},message:c},$(a).validatebox({validType:e?e+";"+d:d}))}}function parse(a){for(var b=[],c=a[0],d=options.sourceField,e=options.keyField,f=0;f<c.length;f++){var g="";valueFileds=d.split(",");for(var h=0;h<valueFileds.length;h++)g+=("undefined"==typeof c[f][valueFileds[h]]?"":c[f][valueFileds[h]])+"   ";b[b.length]={data:g,key:c[f][e],value:c[f][e],result:c[f][e],original:c[f]}}return b}function stopLoading(){jQuerytarget.removeClass(options.loadingClass)}var state=$.data(target,"autocomplete"),opts=state.options,isUrl="string"==typeof opts.source;opts.width>0&&$(target).css("width",opts.width);var options=$.extend({},opts,{url:isUrl?opts.source:null,data:isUrl?null:opts.source,max:opts&&opts.maxItem?opts.maxItem:10});if(isUrl&&(options.formatItem=function(a){return a}),options.searchType){var types=options.searchType;"string"==typeof types&&(types=eval("("+options.searchType+")"));var searchOptions=[],box=[];if(types.data&&types.data.length>1){for(var field=types.field,i=0;i<types.data.length;i++){var typeValue=types.data[i].value,typeText=types.data[i].text,typeField=types.data[i].field;0==i&&(box.push("<div class='auto-search-box'>"),box.push("<a class='auto-search-type' name='"+field+"' fvalue='"+typeValue+"' href='#'><b></b>"+typeText+"</a>"),box.push("</div>"),searchOptions.push("<div class='auto-search-options' style='display:none;'>"),searchOptions.push("<ul>")),searchOptions.push("<li class='auto-search-item' name='"+field+"' field='"+typeField+"' fvalue='"+typeValue+"'>"+typeText+"</li>")}searchOptions.push("</ul></div>")}else if(types.data&&1==types.data.length){var field=types.field,typeValue=types.data[0].value,typeText=types.data[0].text;box.push("<span class='auto-search-type' style='padding: 3px 0px 3px 2px;' name='"+field+"' fvalue='"+typeValue+"' href='#'>"+typeText+"：</span>")}var $dom=$(box.join("")),$col=$(target).closest("div");$col.length>0&&$col.find("span.form-label").length>0?$dom.appendTo($col.find("span.form-label").empty()):$(target).before($dom);var $searchOptions=$(searchOptions.join("")).appendTo($("body"));state.searchTypeDom=$dom,state.searchOptions=$searchOptions}options.highlight=options.highlight||function(a){return a},options.formatMatch=options.formatMatch||options.formatItem;var KEY={UP:38,DOWN:40,DEL:46,TAB:9,RETURN:13,ESC:27,COMMA:188,PAGEUP:33,PAGEDOWN:34,BACKSPACE:8,F4:115},jQuerytarget=$(target).attr("autocomplete","off").addClass("ac_input");options.readonly&&jQuerytarget.attr("readonly",!0),options.disabled||jQuerytarget.attr("disabled",!0);var timeout,previousValue="",cache=autoCache(options),hasFocus=0,lastKeyPressCode,config={mouseDownOnSelect:!1},select=creatSelect(options,target,selectCurrent,config),blockSubmit;if(jQuery.browser.opera&&jQuery(target.form).bind("submit.autocomplete",function(){return blockSubmit?(blockSubmit=!1,!1):void 0}),options.searchType){var $searchTypeDom=state.searchTypeDom,$searchOptions=state.searchOptions;$searchTypeDom.unbind("click").bind("click",function(a){a.stopPropagation(),a.preventDefault();var b=$(this).find(".auto-search-type");if(0!=b.length){var c=b.find("b")[0].style.backgroundPosition;if(""==c||-1!=c.indexOf("-15px")){var d=b.offset(),e=$searchTypeDom.closest("td").length>0?d.top+b.outerHeight():b.outerHeight()+d.top,f=$searchTypeDom.closest("td").length>0?d.left:d.left;b.addClass("auto-search-type-hover"),b.find("b").css("backgroundPosition","1px center"),$searchOptions.css({position:"absolute","z-index":"1000",top:e-3+"px",left:f+"px"}),$searchOptions.show()}else hideSearchOptions()}}),$searchOptions.find("li").click(function(){var a=$(this).attr("fvalue"),b=$(this).html(),c=$(this).attr("name");options.typeChange=options.req[0][c]+""!=a+"",options.translate=!1,options.req[0][c]=a+"",$(".auto-search-type",$searchTypeDom).attr("fvalue",a).removeClass().addClass("auto-search-type"),$(".auto-search-type",$searchTypeDom).html("<b></b>"+b),$(target).autocomplete("clear"),$searchOptions.hide(),stopLoading(),options.onSearchTypeChange.call(this,options,target)})}jQuerytarget.bind((jQuery.browser.opera?"keypress":"keydown")+".autocomplete",function(a){function b(a,b){var c,d=b.searchOptions?b.searchOptions.find("li"):[],e=b.options;d&&d.length>0&&(e.f4Index=e.f4Index?e.f4Index:0,c=e.f4Index>d.length-1?e.f4Index%d.length:e.f4Index,e.f4Index=c+1,$(d[c]).click())}switch(lastKeyPressCode=a.keyCode,a.keyCode){case KEY.UP:a.preventDefault(),select.visible()?select.prev():onChange(0,!0);break;case KEY.DOWN:a.preventDefault(),select.visible()?select.next():onChange(0,!0);break;case KEY.PAGEUP:a.preventDefault(),select.visible()?select.pageUp():onChange(0,!0);break;case KEY.PAGEDOWN:a.preventDefault(),select.visible()?select.pageDown():onChange(0,!0);break;case options.multiple&&","==jQuery.trim(options.multipleSeparator):case KEY.RETURN:if(a.preventDefault(),jQuerytarget.removeAttr("dontFocus2Next"),!jQuerytarget.val())return;if(jQuerytarget.attr("prevSelected")===jQuerytarget.val())return;if(selectCurrent())return blockSubmit=!0,jQuerytarget.attr("dontFocus2Next",!0),!1;if(opts.enterSearch){if(_.isFunction(opts.onBeforeSearch)&&!1===opts.onBeforeSearch.call(jQuerytarget))return!1;jQuerytarget.attr("dontFocus2Next",!0),opts.blurSearch?jQuerytarget.blur():onChange(0,!0)}break;case KEY.ESC:select.hide();break;case KEY.F4:b(a,state);break;default:if(a.ctrlKey&&17==a.keyCode)return;if(jQuerytarget.removeAttr("prevSelected"),clearTimeout(timeout),!options.autoSearch)return void select.hide();timeout=setTimeout(function(){onChange(0,!0)},options.delay)}}).focus(function(){hasFocus++,"function"==typeof hideSearchOptions&&hideSearchOptions()}).blur(function(){if(hasFocus=0,config.mouseDownOnSelect||(options.blurSearch&&""!==$(this).val()&&(options.typeChange||$(this).val()!==options.value)?(hasFocus++,onChange(0,!0)):(hideResults(),$(this).val()!==options.value&&options.onChange.call(this,$(this).val(),options.value)),options.value=$(this).val()),options.mustMatch){var a=!1,b=jQuerytarget.val();$.each(cache.data,function(c,d){return $.each(d,function(c,d){return d.key===b?(a=!0,!1):void 0}),a?!1:void 0}),a||(jQuerytarget.val(""),options.$hiddenField&&options.$hiddenField.val(""))}state.options.onBlur.call(this,$(this).val())}).click(function(){if(hasFocus++>1&&!select.visible()){if(jQuerytarget.val()&&_.isFunction(opts.onBeforeSearch)&&!1===opts.onBeforeSearch.call(jQuerytarget))return!1;opts.blurSearch?stopLoading():onChange(0,!0)}}).bind("search",function(){function a(a,c){var d;if(c&&c.length)for(var e=0;e<c.length;e++)if(c[e].result.toLowerCase()==a.toLowerCase()){d=c[e];break}"function"==typeof b?b(d):jQuerytarget.trigger("result",d&&[d.data,d.value])}var b=arguments.length>1?arguments[1]:null;jQuery.each(trimWords(jQuerytarget.val()),function(b,c){request(c,a,a)})}).bind("flushCache",function(){cache.flush()}).bind("setOptions",function(){jQuery.extend(options,arguments[1]),"data"in arguments[1]&&cache.populate()}).bind("unautocomplete",function(){select.unbind(),jQuerytarget.unbind(),jQuery(target.form).unbind(".autocomplete")}),$(document).bind("mousedown.autocomplete",function(a){$(a.target).closest("div.ac_results").length||select.hide();var b=state.searchOptions;if(b&&!b.is(":hidden")){var c=$("body>div.panel>div.auto-search-options"),d=$(a.target).closest("div.auto-search-options",c);if(d.length)return;hideSearchOptions()}}),$(target).validatebox(options),options.hiddenField&&(options.$hiddenField=$("<input type='hidden' name='"+options.hiddenField+"' />").insertAfter(target)),options.onInitSuccess.call(null,options,target)}function autoCache(a){function b(b,c,d){var e,f;return a.matchCase||(b=b.toLowerCase()),a.strRegex&&d!==!1?(f=new RegExp(a.strRegex.replace("$regex",c)),b.match(f)):(e=b.indexOf(c),-1==e?!1:0==e||a.matchContains)}function c(b,c){g>a.cacheLength&&e(),f[b]||g++,f[b]=c}function d(){if(!a.data)return!1;var b={},d=0;a.url||(a.cacheLength=1),b[""]=[];for(var e=0,f=a.data.length;f>e;e++){var g=a.data[e];g="string"==typeof g?[g]:g;var h=a.formatMatch(g,e+1,a.data.length);if(h!==!1){var i=h.substr(0,a.minLength).toLowerCase();b[i]||(b[i]=[]);var j={value:h,data:g,key:g[a.keyField],sourceValue:a.formatSourceMatch&&a.formatSourceMatch(g)||h,result:a.formatResult&&a.formatResult(g)||h};b[i].push(j),d++<a.max&&b[""].push(j)}}jQuery.each(b,function(b,d){a.cacheLength++,c(b,d)})}function e(){f={},g=0}var f={},g=0;return setTimeout(d,25),{data:f,flush:e,add:c,populate:d,load:function(c){if(!a.cacheLength||!g)return null;if(!a.url&&a.matchContains){var d=[];for(var e in f)if(e.length>0){var h=f[e];jQuery.each(h,function(e,f){return a.max<d.length?!1:void(isNaN(c)?b(f.sourceValue,c,!1)&&d.push(f):b(f.value,c)&&d.push(f))})}return _.chain(d).sortBy(function(a){return a.key.match(/^[0-9]\d*$/g)?Number(a.key):a.key}).value()}if(f[c])return f[c];if(a.matchSubset)for(var i=c.length-1;i>=a.minLength;i--){var h=f[c.substr(0,i)];if(h){var d=[];return jQuery.each(h,function(a,e){b(e.value||e.data,c)&&(d[d.length]=e)}),d}}return null}}}function creatSelect(a,b,c,d){function e(){r&&(m=jQuery("<div/>").hide().addClass(a.resultsClass).css("position","absolute").appendTo(document.body),n=jQuery("<ul/>").appendTo(m).mouseover(function(a){f(a).nodeName&&"LI"==f(a).nodeName.toUpperCase()&&(p=jQuery("li",n).removeClass(o.ACTIVE).index(f(a)),jQuery(f(a)).addClass(o.ACTIVE))}).click(function(d){return jQuery(f(d)).addClass(o.ACTIVE),c(),a.focusAfterSelect&&b.focus(),!1}).mousedown(function(){d.mouseDownOnSelect=!0}).mouseup(function(){d.mouseDownOnSelect=!1}),a.panelWidth>0&&m.css("width",a.panelWidth),a.panelHeight&&m.find("ul").css("height",a.panelHeight),r=!1)}function f(a){for(var b=a.target;b&&"LI"!=b.tagName;)b=b.parentNode;return b?b:[]}function g(b){k.slice(p,p+1).removeClass(o.ACTIVE),h(b);var c=k.slice(p,p+1).addClass(o.ACTIVE);if(a.scroll){var d=0;k.slice(0,p).each(function(){d+=this.offsetHeight}),d+c[0].offsetHeight-n.scrollTop()>n[0].clientHeight?n.scrollTop(d+c[0].offsetHeight-n.innerHeight()):d<n.scrollTop()&&n.scrollTop(d)}}function h(a){p+=a,0>p?p=k.size()-1:p>=k.size()&&(p=0)}function i(b){return a.max&&a.max<b?a.max:b}function j(){n.empty();var b,c,d=i(l.length),e=a.searchType?a.searchType.field:a.keyField;if(void 0!=s){b=a.req[0][e];for(var f=0;f<s.data.length;f++)s.data[f].value==b&&(c=s.data[f].field)}for(var g=0;d>g;g++)if(l[g]){var h,j=a.formatItem(l[g].data,g+1,d,l[g].value,q);if(h=c?l[g].original[c]:l[g].key,j!==!1){var m=jQuery("<li/>").html(h?a.highlight(j,q,h):j).addClass(g%2==0?"ac_even":"ac_odd").appendTo(n)[0];jQuery.data(m,"ac_data",l[g])}}k=n.find("li"),a.selectFirst&&(k.slice(0,1).addClass(o.ACTIVE),p=0),jQuery.fn.bgiframe&&n.bgiframe()}var k,l,m,n,o={ACTIVE:"ac_over"},p=-1,q="",r=!0,s=a.searchType;return{display:function(a,b){e(),l=a,q=b,j()},next:function(){g(1)},prev:function(){g(-1)},pageUp:function(){g(0!=p&&0>p-8?-p:-8)},pageDown:function(){g(p!=k.size()-1&&p+8>k.size()?k.size()-1-p:8)},hide:function(){m&&m.hide(),k&&k.removeClass(o.ACTIVE),p=-1},visible:function(){return m&&m.is(":visible")},current:function(){return this.visible()&&(k.filter("."+o.ACTIVE)[0]||a.selectFirst&&k[0])},show:function(){var c=jQuery(b).offset(),d=parseInt(a.panelWidth);d=d>jQuery(b).width()?d:jQuery(b).width()+4;var e=d+c.left>$(window).width()+$(document).scrollLeft()?c.left+jQuery(b).width()-d:c.left;if(m.css({width:d,top:c.top+b.offsetHeight,left:e}).show(),a.scroll&&(n.scrollTop(0),n.css({maxHeight:a.scrollHeight,overflow:"auto"}),jQuery.browser.msie&&"undefined"==typeof document.body.style.maxHeight)){var f=0;k.each(function(){f+=this.offsetHeight});var g=f>a.scrollHeight;n.css("height",g?a.scrollHeight:f),g||k.width(n.width()-parseInt(k.css("padding-left"))-parseInt(k.css("padding-right")))}a.onCreate.call(this,m)},selected:function(){var c,d=k&&k.filter("."+o.ACTIVE).removeClass(o.ACTIVE);if(d&&d[0]){var e=$.data(d[0],"ac_data");a.searchType&&(a.resetSearchType?(c=e.original[a.searchTypeKeyField],$.data(b,"autocomplete").searchOptions.find("li[field='"+a.searchTypeKeyField+"']").click(),a.typeChange=a.req[0].USER_ID_TYPE+""!=e.original.OBJ_USER_ID_TYPE+"",$(b).autocomplete("options").translate=!0):c=function(){var c=$(b).parent().find("div.auto-search-box").find("a:first").attr("value"),d=$.grep(a.searchType.data||[],function(a){return c==a.value})[0];return d?e.original[d.field]:e.key}(),a.blurSearch&&(a.value=c)),$(b).autocomplete("options").onSelect.call(this,e.key,e&&e.original?e.original:e)}return e&&!e.original&&(e.original=e.data),e?$.extend({},e,{searchTypeResult:c}):null},emptyList:function(){n&&n.empty()},unbind:function(){m&&m.remove()}}}function selection(a,b,c){if(a.createTextRange){var d=a.createTextRange();d.collapse(!0),d.moveStart("character",b),d.moveEnd("character",c),d.select()}else a.setSelectionRange?a.setSelectionRange(b,c):a.selectionStart&&(a.selectionStart=b,a.selectionEnd=c);a.focus()}function destroyBox(a){var b=$.data(a,"autocomplete"),c=b.select;c&&c.remove(),$(a).unbind(),$(a).remove()}function close(a){var b=$.data(a,"autocomplete"),c=b.select;c&&c.remove(),$(a).unbind()}function setDisabled(a,b){var c=$.data(a,"autocomplete").options,b=String(b);"true"==b?(c.disabled=!0,$(a).attr("disabled",!0).addClass("form-input-disabled").removeClass("validatebox-invalid").removeClass("varlidataTextarea-invalid").validatebox("hideTip"),$(a).parent().find(".auto-search-type b").hide()):(c.disabled=!1,$(a).removeAttr("disabled").removeClass("form-input-disabled"))}function validate(a){var b=($.data(a,"autocomplete").options,$(a)),c=b.validatebox("isValid");return c}function showTip(a,b){var c=$(a),d=c.offset();$("body").find(".validatebox-tip").css("display","none");var e=$.data(a,"autocomplete").tip;e||(e=$('<div class="validatebox-tip"><div class="validatebox-tip-content"></div><div class="validatebox-tip-pointer"></div></div>').appendTo("body"),$.data(a,"autocomplete").tip=e),e.find(".validatebox-tip-content").html(b),e.css({left:d.left+20,top:d.top-e.outerHeight()+7}).show()}function hideTip(a){var b=$.data(a,"autocomplete");if(b){var c=b.tip;c&&(c.remove(),b.tip=null)}}function setValue(a,b){$(a).val(b)}function clear(a){$(a).val("")}$.fn.autocomplete=function(a,b){if("string"==typeof a){var c=$.fn.autocomplete.methods[a];if(c)return c(this,b)}return a=a||{},this.each(function(){var b=$.data(this,"autocomplete");b?$.extend(b.options,a):(b=$.data(this,"autocomplete",{options:$.extend({},$.fn.autocomplete.defaults,$.fn.autocomplete.parseOptions(this),a)}),b.options.searchType&&b.options.resetSearchType&&(b.options.searchTypeKeyField=b.options.searchTypeKeyField||b.options.keyField),init(this),setValue(this,b.options.value),setDisabled(this,b.options.disabled))})},$.fn.autocomplete.methods={options:function(a){return $.data(a[0],"autocomplete").options},destroy:function(a){return a.each(function(){destroyBox(this)})},disable:function(a){return a.each(function(){setDisabled(a[0],!0)})},enable:function(a){return a.each(function(){setDisabled(a[0],!1)})},validate:function(a){return a.each(function(){validate(this)})},setValue:function(a,b){return a.each(function(){setValue(this,b)})},getValue:function(a){return a.val()},clear:function(a){return a.each(function(){clear(this)})}},$.fn.autocomplete.parseOptions=function(a){return $.extend({},$.parser.parseOptions(a,["autoFocus","delay","minLength","position","params","source","readonly","disabled","req","sourceField","dataType"]))},$.fn.autocomplete.defaults=$.extend({},$.fn.validatebox.defaults,{hiddenField:"",resetSearchType:!0,searchTypeKeyField:"",resultsClass:"ac_results",loadingClass:"ac_loading",previousValue:"",hasFocus:0,autoSearch:!0,enterSearch:!0,blurSearch:!1,typeChange:!0,translate:!1,focusAfterSelect:!0,minLength:1,req:[],dataType:"json",delay:100,disabled:!1,readonly:!1,matchCase:!1,matchSubset:!0,matchContains:!1,useCache:!1,cacheLength:10,params:"",tampData:[],max:100,value:"",sourceField:"",mustMatch:!1,extraParams:{},selectFirst:!0,formatItem:function(a){return a[0]},formatMatch:null,autoFill:!1,width:0,panelWidth:0,source:"../../kjdp_ajax?returnType=json",multiple:!1,multipleSeparator:", ",highlight:function(a,b,c){var d=c,e=a.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+d+")(?![^<>]*>)(?![^&;]+;)","i"),c.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+b.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi,"\\$1")+")(?![^<>]*>)(?![^&;]+;)","gi"),"<strong>$1</strong>"));return e},scroll:!0,scrollHeight:100,isResultValid:!1,onChange:function(){},onBlur:function(){},onClose:function(){},onCreate:function(){},onResponse:function(){},onNoRecords:function(){},onSelect:function(){},onInitSuccess:function(){},onSearchTypeChange:function(){},onBeforeSearch:function(){}})}),define("lib/kui/combotree",[],function(){function a(a){var b=$.data(a,"combotree").options,c=$.data(a,"combotree").tree;$(a).addClass("combotree-f"),$(a).combo($.extend({},b,{onClear:function(){$(a).combotree("clear"),b.onClear.call(a)},onShowPanel:function(){if(!b.multiple){var d=$(a).combotree("getValue"),e=$(a).data("combo").panel,f=c.find("div.tree-node[node-id='"+d+"']");f.length&&(c.css("position","relative").tree("expandTo",f),e.scrollTop(f.position().top))}}}));var e=$(a).combo("panel");c||(c=$("<ul></ul>").appendTo(e),$.data(a,"combotree").tree=c),c.tree($.extend({},b,{checkbox:b.multiple,onLoadSuccess:function(d,e){var f=$(a).combotree("getValues");if(b.multiple)for(var g=c.tree("getChecked"),h=0;h<g.length;h++){var i=g[h].id;!function(){for(var a=0;a<f.length;a++)if(i==f[a])return;f.push(i)}()}$(a).combotree("setValues",f),b.onLoadSuccess.call(this,d,e),comboOptions=$.data(a,"combo").options,comboOptions.text=$(a).combo("getText"),b.text=$(a).combo("getText")},onClick:function(c){d(a),$(a).combo("hidePanel"),b.onClick.call(this,c)},onCheck:function(c,e){d(a),b.onCheck.call(this,c,e)}}))}function b(a){for(var b=$.data(a,"combotree").options,c=$.data(a,"combotree").tree,d=$(a).combo("getText"),e=$(a).combo("panel"),f=c.tree("getChecked"),g=0;g<f.length;g++)c.tree("uncheck",f[g].target);
if(b.editable){if(d){var h=[];b.multiple?h=d.split(","):(d.indexOf(",")>0&&(d=d.substring(0,d.indexOf(","))),h[0]=d);for(var i,g=0;g<h.length;g++){var j=c.tree("find",h[g]);if(j&&!j.checked){c.tree("check",j.target),c.tree("select",j.target);var k=e.find('div.tree-node[node-id="'+h[g]+'"]');k.length&&(i=e.scrollTop()+k.position().top+k.outerHeight()-e.height()/2,e.scrollTop(i))}}}else $(a).combotree("clear");$(a).combo("setText",d)}}function c(a){var b=$.data(a,"combotree").options,c=$(a).next().children("input");b.disabled||c.bind("blur.combo",function(){d(a)});var e=$.data(a,"combo").panel,f=e.parent().find(".combo-selectAll");f.find("span:eq(0)").unbind("click").bind("click",function(){$(a).combotree("selectAll")}),f.find("span:eq(1)").unbind("click").bind("click",function(){$(a).combotree("unSelectAll")})}function d(a){var b=$.data(a,"combotree").options,c=$.data(a,"combotree").tree;if("@"!=b.value){var d=[],e=[];if("true"==String(b.multiple))for(var f=c.tree("getChecked"),g=0;g<f.length;g++)d.push(f[g].id),e.push(f[g].text);else{var h=c.tree("getSelected");h&&(d.push(h.id),e.push(h.text))}var i=e.join(b.separator);b.keyDisplay&&(i=d.join(b.separator)),$(a).combo("setValues",d).combo("setText",i)}}function e(a,b){var c=$.data(a,"combotree").options,d=$.data(a,"combotree").tree;d.find("span.tree-checkbox").addClass("tree-checkbox0").removeClass("tree-checkbox1 tree-checkbox2");var e=[],f=[];if(1==b.length&&"@"==b[0])f.push(b[0]);else for(var g=0;g<b.length;g++){var h=b[g],i=h,j=d.tree("find",h);j&&(i=j.text,d.tree("check",j.target),d.tree("select",j.target)),e.push(h),f.push(i)}$(a).combo("setValues",e),(f.length>1||f[0])&&$(a).combo("setText",f.join(c.separator))}$.fn.combotree=function(b,d){if("string"==typeof b){var e=$.fn.combotree.methods[b];return e?e(this,d):this.combo(b,d)}return b=b||{},this.each(function(){var d=$.data(this,"combotree");d=d?$.extend(d.options,b):$.data(this,"combotree",{options:$.extend({},$.fn.combotree.defaults,$.fn.combotree.parseOptions(this),b)}),a(this),c(this)})},$.fn.combotree.methods={options:function(a){return $.data(a[0],"combotree").options},tree:function(a){return $.data(a[0],"combotree").tree},loadData:function(a,b){return a.each(function(){var a=$.data(this,"combotree").options;a.data=b;var c=$.data(this,"combotree").tree;c.tree("loadData",b)})},reload:function(a,b){return a.each(function(){var a=$.data(this,"combotree").options,c=$.data(this,"combotree").tree;b&&(a.url=b),c.tree({url:a.url})})},setValues:function(a,b){return a.each(function(){e(this,b)})},setValue:function(a,b){return a.each(function(){e(this,[b])})},clear:function(a){return a.each(function(){var a=$.data(this,"combotree").tree;a.find("div.tree-node-selected").removeClass("tree-node-selected"),a.tree("uncheck",a.find("div.tree-node")),d(this)})},selectAll:function(a){var b=a[0],c=$(b).combotree("tree");c.tree("check",c.find("div.tree-node")),d(b)},unSelectAll:function(a){var b=a[0],c=$(b).combotree("tree"),e=c.find("div.tree-node").find(".tree-checkbox");e.each(function(){$(this).hasClass("tree-checkbox0")?$(this).removeClass("tree-checkbox0 tree-checkbox1 tree-checkbox2").addClass("tree-checkbox1"):$(this).hasClass("tree-checkbox1")&&$(this).removeClass("tree-checkbox0 tree-checkbox1 tree-checkbox2").addClass("tree-checkbox0")}),d(b)}},$.fn.combotree.parseOptions=function(a){return $.extend({},$.fn.combo.parseOptions(a),$.fn.tree.parseOptions(a))},$.fn.combotree.defaults=$.extend({},$.fn.combo.defaults,$.fn.tree.defaults,{editable:!0,keyDisplay:!1,keyHandler:{up:function(){},down:function(){},enter:function(){},query:function(a){b(this,a)}},onHidePanel:function(){$.data(this,"combotree").options;d(this)}})}),define("lib/kui/textinput",[],function(){function a(a){if($.fn.validatebox){var b=$.data(a,"textinput").options;$(a).validatebox(b)}}function b(a){var b=$.data(a,"textinput").options;$(a).unbind(".textinput").bind("blur.textinput focus.textinput change.textinput error.textinput keyup.textinput",function(c){var d={blur:"onBlur",focus:"onFocus",change:"onChange",error:"onError",keyup:"onKeyup"};b[d[c.type]]&&b[d[c.type]].call(a,c),"keyup"==c.type&&13==c.keyCode&&b.onChange.call(a,c),"password"!==$(a).attr("type")&&$(a).attr("title",$(a).val())})}function c(a,b){var c=$.data(a,"textinput").options;"true"==String(b)||"disabled"==b?(c.disabled=!0,$(a).attr("disabled",!0).addClass("form-input-disabled").removeClass("validatebox-invalid").removeClass("varlidataTextarea-invalid").validatebox("hideTip")):(c.disabled=!1,$(a).removeAttr("disabled").removeClass("form-input-disabled"))}function d(a,b){var c=$.data(a,"textinput").options;b?(c.hidden=!0,$(a).hide()):(c.hidden=!1,$(a).show())}function e(a,b){var c=$.data(a,"textinput").options;b?(c.readonly=!0,$(a).attr("readonly","readonly")):(c.readonly=!1,$(a).removeAttr("readonly"))}function f(a,b){$.data(a,"textinput").options;$(a).attr("maxlength",b)}function g(a,b){var c=$(a);return""===b||void 0==b?void c.val("").removeAttr("title"):(b+="",c.val(b),void("password"!==c.attr("type")&&c.attr("title",b)))}function h(a,b){var c=$(a);b&&(b=isNaN(b)?b:b+"px",c.innerWidth(b))}$.fn.textinput=function(i,j){if("string"==typeof i){var k=$.fn.textinput.methods[i];return k?k(this,j):this.validatebox(i,j)}return i=i||{},this.each(function(){var j=$.data(this,"textinput");if(j)$.extend(j.options,i);else{var k=$(this);j=$.data(this,"textinput",{options:$.extend({},$.fn.textinput.defaults,$.fn.textinput.parseOptions(this),i)}),k.removeAttr("disabled")}g(this,j.options.value||j.options.defaultValue),c(this,j.options.disabled),e(this,j.options.readonly),f(this,j.options.maxLength),d(this,j.options.hidden),h(this,j.options.width),a(this),b(this)})},$.fn.textinput.methods={options:function(a){return $.data(a[0],"textinput").options},destroy:function(a){return a.each(function(){$(this).validatebox("destroy"),$(this).remove()})},disable:function(a){return a.each(function(){c(this,!0)})},enable:function(a){return a.each(function(){c(this,!1)})},changeWidth:function(a,b){return a.each(function(){h(this,b)})},setValue:function(a,b){return a.each(function(){g(this,b)})},clear:function(a){return a.each(function(){$.data(this,"textinput");$(this).val("")})},reset:function(a){return a.each(function(){var a=$.data(this,"textinput").options.defaultValue;$(this).val(a)})},hide:function(a){return a.each(function(){d(this,!0)})},show:function(a){return a.each(function(){d(this,!1)})},validate:function(b){return b.each(function(){a(this)})},addError:function(a,b){return a.each(function(){$.data(this,"validatebox").options.invalidMessage=b})},removeError:function(a){return a.each(function(){$.data(this,"validatebox").options.invalidMessage=null})}},$.fn.textinput.parseOptions=function(a){var b=$(a);return $.extend({},$.fn.validatebox.parseOptions(a),$.parser.parseOptions(a,["maxLength"]),{disabled:b.attr("disabled")?!0:void 0,value:b.attr("value")?b.attr("value"):void 0})},$.fn.textinput.defaults=$.extend({},$.fn.validatebox.defaults,{value:null,defaultValue:null,name:null,hidden:!1,readonly:!1,disabled:!1,maxLength:null,validate:{},onChange:function(){}})}),define("lib/kui/password",[],function(){function a(a){var c,a=$(a),d=a.data("password").options,e=1===Number(d.isValid)||"true"===String(d.isValid);d.isValid=e,e&&(d.validType?(c=d.validType.split(";"),c.push(d.eqRule),d.validType=c.join(";")):d.validType=d.eqRule),a.css("width",d.width).validatebox($.extend({},d,{focus2Next:e?!1:d.focus2Next,validOnBlur:e?!1:!0})).addClass("password-f"),a.val()&&$(a).data(d.eqKey,$.trim(a.val())),e&&b(a)}function b(a){var b=this,a=$(a),c=a.attr("type")||"text",d="password"===c,e=a.data("validatebox").options;b.syncFlag=0,a.unbind(".password").bind("blur.password",function(){var f=$.trim(a.validatebox("getValue")),g=$.trim(a.data(e.eqKey)),h=a.data("password").options,i=e.validType.split(";"),j=$.inArray(e.eqRule,i);0==b.syncFlag&&(b.syncFlag=1,-1!=j&&i.splice(j,1),a.validatebox("changeValid",i.join(";")),a.validatebox("isValid")&&(!f||g&&g===f||(a.data(e.eqKey,""),$.when($.isFunction(h.afterValid)&&h.afterValid.call(a,f)).then(function(i){if(!i)return i;b.msgBody&&b.msgBody.window("destroy");var j=b.msgBody=prompt(function(b){return b!==f?(setTimeout(function(){n.focus(),n.validatebox("showTip","两次输入不一致，请重新输入！")},0),setTimeout(function(){n.validatebox("hideTip")},3e3),!1):void(b?(a.data(h.eqKey,b),h.focus2Next?a.validatebox("moveNext"):a.focus(),$.isFunction(h.onConfirm)&&h.onConfirm.call(a,b)):(h.focusOnCancel&&a.focus(),h.clearOnCancel&&a.password("clear")))},{title:d?"确认密码":"确认输入",msg:"请重新输入"}),k=j.data("window").window,l=j.data("window").mask,m=j.find(".messager-input").hide(),n=$("<input class='messager-input' type='"+c+"'/>").insertAfter(m),o=j.find(".messager-button a:first");l.addClass("password-window-mask"),k.addClass("password-window"),j.window("resize",{width:270}),k.css({left:a.offset().left,top:a.outerHeight(!0)+a.offset().top+3}),m.remove(),e.isManualConfirm&&n.attr({oncontextmenu:"return false",oncopy:"return false",oncut:"return false",onpaste:"return false"}),a.attr("maxlength")&&n.attr("maxlength",a.attr("maxlength")),n.keydown(function(b){13===b.keyCode?o.click():27===b.keyCode&&(j.window("destroy"),a.focus())}).validatebox({required:!0,isFocusRemoveTip:!1}),o.click(function(){n.val()||n.focus()}),setTimeout(function(){n.focus()},50),$.isFunction(h.onChange)&&h.onChange.call(this,f,g)}),i.push(e.eqRule),a.validatebox("changeValid",i.join(";"))),!f&&$.isFunction(h.onChange)&&h.onChange.call(this,f,g)),b.syncFlag=0)})}function c(a,b){var a=$(a),c=a.data("password").options;a.val(b),c.isValid&&a.data(c.eqKey,b);var d=a.attr("type")||"text",e="password"===d;e||a.attr("title",b)}function d(a){var b=$(a).data("password").options;$(a).val("").removeAttr("title"),$(a).data(b.eqKey,"")}$.fn.password=function(b,c){if("string"==typeof b){var d=$.fn.password.methods[b];return d?d(this,c):this.validatebox(b,c)}return b=b||{},this.each(function(){var c=$.data(this,"password");c?$.extend(c.options,b):(c=$.data(this,"password",{options:$.extend({},$.fn.password.defaults,$.fn.password.parseOptions(this),b)}),a(this))})},$.fn.password.methods={options:function(a){return $.data(a[0],"password").options},clear:function(a){return a.each(function(){d(this)})},setValue:function(a,b){return a.each(function(){c(this,$.trim(b))})}},$.fn.password.parseOptions=function(a){return $.extend({},$.fn.validatebox.parseOptions(a),$.parser.parseOptions(a,["maxLength"]),{})},$.fn.password.defaults=$.extend({eqRule:"eqValue",eqKey:"kui-eqValue",isValid:1,width:120,focus2Next:!0,onChange:function(){},isManualConfirm:!1},$.fn.validatebox.defaults,{value:null,name:null,hidden:!1,readonly:!1,disabled:!1,maxLength:null,focusOnCancel:!1,clearOnCancel:!1,onConfirm:$.noop,afterValid:function(){return!0}})}),define("lib/kui/textarea",[],function(){function a(a){if($.fn.validatebox){{var b=$.data(a,"textarea").options;$(a)}$(a).validatebox(b)}}function b(a){var b=$(a);b.unbind("keydown"),b.bind("blur focus change error",function(b){var c={blur:"onBlur",focus:"onFocus",change:"onChange",error:"onError"},d=$.data(a,"textarea").options;d[c[b.type]]&&d[c[b.type]]()}),$(a).bind("keyup",function(){var b=$.data(a,"textarea").options,c=b.maxLength;c&&(this.value=this.value.slice(0,c))})}function c(a,b){var c=$.data(a,"textarea").options;b?(c.disabled=!0,$(a).attr("disabled",!0)):(c.disabled=!1,$(a).removeAttr("disabled"))}function d(a,b){var c=$.data(a,"textarea").options;b?(c.readonly=!0,$(a).attr("readonly","readonly")):(c.readonly=!1,$(a).removeAttr("readonly"))}function e(a,b){b&&$(a).attr("maxlength",b)}function f(a,b){$.data(a,"textarea").options;null!=b&&$(a).val(b)}$.fn.textarea=function(g,h){if("string"==typeof g){var i=$.fn.textarea.methods[g];return i?i(this,h):this.validatebox(g,h)}return g=g||{},this.each(function(){var h=$.data(this,"textarea");if(h)$.extend(h.options,g);else{var i=$(this);h=$.data(this,"textarea",{options:$.extend({},$.fn.textarea.defaults,$.fn.textarea.parseOptions(this),g)}),i.removeAttr("disabled")}h.options.cols&&$(this).attr("cols",h.options.cols),h.options.rows&&$(this).attr("rows",h.options.rows),f(this,h.options.value),c(this,h.options.disabled),d(this,h.options.readonly),e(this,h.options.maxLength),a(this),b(this)})},$.fn.textarea.methods={options:function(a){return $.data(a[0],"textarea").options},destroy:function(a){return a.each(function(){$(this).validatebox("destroy"),$(this).remove()})},disable:function(a){return a.each(function(){c(this,!0)})},enable:function(a){return a.each(function(){c(this,!1)})},setValue:function(a,b){return a.each(function(){f(this,b)})},clear:function(a){return a.each(function(){$.data(this,"textarea");$(this).val("")})},reset:function(a){return a.each(function(){var a=$.data(this,"textarea").defaultValue;$(this).val(a)})},validate:function(b){return b.each(function(){a(this)})},addError:function(a,b){return a.each(function(){$.data(this,"validatebox").options.invalidMessage=b})},removeError:function(a){return a.each(function(){$.data(this,"validatebox").options.invalidMessage=null})}},$.fn.textarea.parseOptions=function(a){var b=$(a);return $.extend({},$.fn.validatebox.parseOptions(a),$.parser.parseOptions(a,["maxLength"]),{disabled:b.attr("disabled")?!0:void 0})},$.fn.textarea.defaults=$.extend({},$.fn.validatebox.defaults,{disabled:!1,maxLength:null,onChange:function(){}})}),define("lib/kui/numberbox",[],function(){function a(a,b){var e=$.data(a,"numberbox").options;"1"===e.moneyUnits&&(b=Number(b)/1e4),$(a).val(b),c(a),d(a)}function b(a,b){return a&&b?Number(a).toFixed(b):a}function c(a){var c=$.data(a,"numberbox").options,d=$(a).val();d.indexOf(",")>0&&(d=d.replace(/,/g,""));var e=d;return isNaN(e)?($(a).val(""),void $(a).nextAll("input.numberbox-value").val("")):(c.min=1*c.min,$(a).val(null!=c.min&&void 0!=c.min&&e<c.min?c.min.toFixed(c.precision):null!=c.max&&void 0!=c.max&&e>c.max?b(d,c.precision):c.precision?b(d,c.precision):"true"==String(c.setThousandChar)?f(d):d),$(a).val()&&$(a).nextAll("input.numberbox-value").val($(a).val().replace(/,/g,"")),void c.onChange.call(a,e))}function d(a){var b=$.data(a,"numberbox").options,c=$(a).val();return c.indexOf(",")>0&&(c=c.replace(/,/g,"")),!$.isNumeric(c)||/(^\s+)|(\s+$)/g.test(c)?($(a).val(""),void $(a).nextAll("input.numberbox-value").val("")):($(a).val(null!=b.min&&void 0!=b.min&&Number(c)<b.min?parseFloat(b.min).toFixed(b.precision):null!=b.max&&void 0!=b.max&&Number(c)>b.max?parseFloat(b.max).toFixed(b.precision):"true"==String(b.setThousandChar)?f(c):c),$(a).val()&&$(a).nextAll("input.numberbox-value").val($(a).val().replace(/,/g,"")),"number"==b.toChinese?l(a,k(parseFloat(c))):"money"==b.toChinese&&("1"===b.moneyUnits&&(c=1e4*parseFloat(c)),l(a,j(parseFloat(c)))),void b.onChange.call(a,c))}function e(a){var b=$.data(a,"numberbox").options;$(a).unbind(".numberbox"),$(a).bind("keypress.numberbox",function(a){return 45==a.which?!0:46==a.which?!0:a.which>=48&&a.which<=57&&0==a.ctrlKey&&0==a.shiftKey||0==a.which||8==a.which?!0:1!=a.ctrlKey||99!=a.which&&118!=a.which?37==a.which||39==a.which?!0:!1:!0}).bind("paste.numberbox",function(){if(window.clipboardData){var b=clipboardData.getData("text");return/\D/.test(b)?!1:!0}setTimeout(function(){c(a)},100)}).bind("dragenter.numberbox",function(){return!1}).bind("blur.numberbox",function(){c(a),"password"!==$(a).attr("type")&&$(a).attr("title",$(a).val()),d(a),b.onBlur.call(a)}).bind("keyup.numberbox",function(c){return c.which>=48&&c.which<=57||37==c.which||39==c.which||189==c.which||46==c.which||(0!=c.ctrlKey||0!=c.shiftKey)&&0!=c.which||8==c.which?!1:(d(a),void b.onKeyup.call(a))})}function f(a){if(!/^(\+|-)?(\d+)(,\d{3})*(\.|\.\d+)?$/.test(a))return a;for(var b=RegExp.$1,c=RegExp.$2,d=RegExp.$4,e=/(\d)(\d{3})(,|$)/;e.test(c);)c=c.replace(e,"$1,$2$3");return b+""+c+d}function g(a){var a=$(a).addClass("numberbox-text"),b=a.attr("name");b&&(a.after("<input type='hidden' class='numberbox-value' name='"+b+"'>"),a.removeAttr("name").attr("numberboxName",b))}function h(a){var b=$.data(a,"numberbox").options;$(a).validatebox(b)}function i(a,b){var c=$.data(a,"numberbox").options;b?(c.disabled=!0,$(a).attr("disabled",!0),$(a).addClass("form-input-disabled")):(c.disabled=!1,$(a).removeAttr("disabled"),$(a).removeClass("form-input-disabled"))}function j(a){var b="负",c=0,d=9999999999999.99,e=-9999999999999.99;if(a>d)j="数据过大！";else if(e>a)j="数据过小！";else{Number(a)<0&&(c=a,a=String(a).substring(1,String(a).length));var f="万仟佰拾亿仟佰拾万仟佰拾元角分",g="";a+="00";var h=a.indexOf(".");h>=0&&(a=a.substring(0,h)+a.substr(h+1,2)),f=f.substr(f.length-a.length);for(var i=0;i<a.length;i++)g+="零壹贰叁肆伍陆柒捌玖".charAt(a.charAt(i))+f.charAt(i);if("零元零角零分"==g)j="零元";else var j=g.replace(/零(仟|佰|拾|角)/g,"零").replace(/(零)+/g,"零").replace(/零(万|亿|元)/g,"$1").replace(/(亿)万/g,"$1").replace(/^元零?|零分/g,"").replace(/元$/g,"元")}return j&&Number(c)<0?b+j:j}function k(a){var b="负",c=0,d=9999999999999.99,e=-9999999999999.99;if(a>d)j="数据过大！";else if(e>a)j="数据过小！";else{Number(a)<0&&(c=a,a=String(a).substring(1,String(a).length));var f="万仟佰拾亿仟佰拾万仟佰拾点",g="";a+="00";var h=a.indexOf(".");h>=0&&(a=a.substring(0,h)+a.substr(h+1,2)),f=f.substr(f.length-a.length+2);for(var i=0;i<a.length;i++)g+="零壹贰叁肆伍陆柒捌玖".charAt(a.charAt(i))+f.charAt(i);if("零点零零"==g)j="零";else var j=g.replace(/点零零/g,"").replace(/零(仟|佰|拾)/g,"零").replace(/(零)+/g,"零").replace(/零(万|亿)/g,"$1").replace(/(亿)万/g,"$1").replace(/零$/g,"")}return j&&Number(c)<0?b+j:j}function l(a,b){var c=$(a),d=$.data(a,"numberbox").options,e=c.next("span"),f=$("<span class='to-chinese'>");c.closest("td").width("auto"),e.hasClass("validatebox-must")?e.next("span").remove():e.remove(),"bottom"===d.textPosition?f.css("margin-left",c.prev().width()+10||0):"right"===d.textPosition&&f.addClass("inline"),c.parent().find("span.to-chinese").remove(),c.after(f.text(b))}$.fn.numberbox=function(b,c){if("string"==typeof b){var d=$.fn.numberbox.methods[b];return d?d(this,c):this.validatebox(b,c)}return b=b||{},this.each(function(){var c=$.data(this,"numberbox");if(c)$.extend(c.options,b);else{var d=$(this);g(this),c=$.data(this,"numberbox",{options:$.extend({},$.fn.numberbox.defaults,$.fn.numberbox.parseOptions(this),b)}),d.removeAttr("disabled"),$(this).css({imeMode:"disabled"})}a(this,c.options.value),i(this,c.options.disabled),e(this),h(this)})},$.fn.numberbox.methods={options:function(a){var b=$.data(a[0],"numberbox").options;return $.extend(b,{value:a.val()})},setValue:function(b,c){return b.each(function(){a(this,c)})},getValue:function(a){var b=$.data(a[0],"numberbox").options;return"1"===b.moneyUnits?1e4*$.trim(a.val().replace(/,/g,"")):$.trim(a.val().replace(/,/g,""))},reset:function(a){return a.each(function(){if($.data(a[0],"numberbox")){var b=$.data(a[0],"numberbox").options;$(this).val(b.value||"").numberbox("fix");var c=$(this).next("span.to-chinese");c&&c.remove(),$(this).removeClass("validatebox-invalid")}})},fix:function(a){return a.each(function(){c(this)})},disable:function(a){return a.each(function(){i(this,!0)})},enable:function(a){return a.each(function(){i(this,!1)})}},$.fn.numberbox.parseOptions=function(a){var b=$(a);return $.extend({},$.fn.validatebox.parseOptions(a),{disabled:b.attr("disabled")?!0:void 0,min:"0"==b.attr("min")?0:parseFloat(b.attr("min"))||void 0,max:"0"==b.attr("max")?0:parseFloat(b.attr("max"))||void 0,precision:parseInt(b.attr("precision"))||void 0})},$.fn.numberbox.defaults={disabled:!1,toChinese:null,min:void 0,max:void 0,precision:0,setThousandChar:!0,textPosition:"bottom",moneyUnits:"0",onChange:function(){},onKeyup:function(){},onBlur:function(){}}}),define("lib/kui/spinner",[],function(){function a(a){var e=$.data(a,"spinner"),f=e.options,g=$('<span class="spinner"></span>'),h=$("<input class='spinner-text' autocomplete='off' type='text'/>").appendTo(g),i=$('<span class="spinner-arrow"><span class="spinner-arrow-up"></span><span class="spinner-arrow-down"></span></span>').appendTo(g);g.insertAfter($(a)),$(a).attr("spinnername",f.spinnername).hide(),$.extend(e,{spinner:g,spinnerText:h,spinnerArrow:i}),h.validatebox(f).val(f.defaultValue||f.value).attr("readonly",!f.editable),b(a),c(a,e.options.disabled),d(a)}function b(a,b){var c=$.data(a,"spinner"),d=c.options,e=(c.spinner,c.spinnerArrow),f=c.spinnerText;b&&(d.width=b),isNaN(d.width)&&(d.width=$(a).outerWidth()-8);var g=e.outerWidth()||18;b=d.width-g,f.width(b)}function c(a,b){var c=$.data(a,"spinner"),d=c.options,e=c.spinnerText;b?(d.disabled=!0,e.validatebox("disabled")):(d.disabled=!1,e.validatebox("enabled"))}function d(a){var b=$.data(a,"spinner"),c=b.options,d=(b.spinner,b.spinnerArrow);d.find(".spinner-arrow-up,.spinner-arrow-down").unbind(".spinner"),c.disabled||(d.find(".spinner-arrow-up,.spinner-arrow-down").bind("mouseenter.spinner",function(){$(this).addClass("spinner-arrow-hover")}).bind("mouseleave.spinner",function(){$(this).removeClass("spinner-arrow-hover")}),d.find(".spinner-arrow-up").bind("click.spinner",function(){c.spin.call(a,!1),c.onSpinUp.call(a)}),d.find(".spinner-arrow-down").bind("click.spinner",function(){c.spin.call(a,!0),c.onSpinDown.call(a)}))}function e(a){return $.data(a,"spinner").spinnerText.val()}function f(a,b){$.data(a,"spinner").spinnerText.val(b)}function g(a){$.data(a,"spinner").spinnerText.val("")}function h(a){var b=$.data(a,"spinner"),c=b.options;b.spinnerText.val(c.defaultValue)}$.fn.spinner=function(b,c){if("string"==typeof b){var d=$.fn.spinner.methods[b],e=[this];return d?d.apply(this,e.concat(Array.prototype.slice.call(arguments,1))):this.validatebox(b,c)}return this.each(function(){b=b||{};var c=$.data(this,"spinner");c?$.extend(c.options,b):($.data(this,"spinner",{options:$.extend({},$.fn.spinner.defaults,$.fn.spinner.parseOptions(this),b)}),a(this))})},$.fn.spinner.defaults=$.extend({},$.fn.validatebox.defaults,{width:"auto",spinnername:"",value:"",defaultValue:"",editable:!0,disabled:!1,spin:$.noop,onSpinUp:$.noop,onSpinDown:$.noop}),$.fn.spinner.parseOptions=function(a){return $.extend({},$.parser.parseOptions(a))},$.fn.spinner.methods={options:function(a){return $.data(a[0],"spinner").options},destroy:function(a){return a.each(function(){var a=$.data(this,"spinner").spinner;a.remove(),$(this).remove()})},resize:function(a,c){return a.each(function(){b(this,c)})},enable:function(a){return a.each(function(){c(this,!1),d(this)})},disable:function(a){return a.each(function(){c(this,!0),d(this)})},getValue:function(a){return e(a[0])},setValue:function(a,b){return a.each(function(){f(this,b)})},clear:function(a){return a.each(function(){g(this)})},reset:function(a){return a.each(function(){h(this)})}}}),define("lib/kui/numberspinner",[],function(){function a(a){var b=$.data(a,"numberspinner"),c=b.options;$(a).spinner($.extend({},c,{spinnername:a.id||a.name||""})),$.extend(b,{spinnerText:$.data(a,"spinner").spinnerText}),b.spinnerText.numberbox(c)}function b(a,b){var c=$.data(a,"numberspinner"),d=c.options,e=c.spinnerText,f=$(a).spinner("getValue"),g=f.indexOf(".")<0?0:f.length-1-f.indexOf(".");f=f.replace(/,/g,""),f=parseFloat(f)||0,0==b?f+=Number(d.increment):f-=Number(d.increment),f=parseFloat(f).toFixed(g),$(a).val(f),e.val(f).numberbox("fix")}function c(a,b){var c=$.data(a,"numberspinner"),d=(c.options,c.spinnerText);$(a).val(b),d.val(b).numberbox("fix")}function d(a){return $(a).spinner("getValue")}$.fn.numberspinner=function(b,c){if("string"==typeof b){var d=$.fn.numberspinner.methods[b];return d?d(this,c):this.spinner(b,c)}return this.each(function(){b=b||{};var c=$.data(this,"numberspinner");c?$.extend(c.options,b):$.data(this,"numberspinner",{options:$.extend({},$.fn.numberspinner.defaults,$.fn.numberspinner.parseOptions(this),b)}),a(this)})},$.fn.numberspinner.methods={options:function(a){return $.data(a[0],"numberspinner").options},setValue:function(a,b){return a.each(function(){c(this,b)})},getValue:function(a){return d(a[0])}},$.fn.numberspinner.parseOptions=function(a){return $.extend({},$.parser.parseOptions(a))},$.fn.numberspinner.defaults=$.extend({},$.fn.spinner.defaults,$.fn.numberbox.defaults,{spin:function(a){b(this,a)},increment:1})}),define("lib/kui/timespinner",[],function(){function a(a){var c=$.data(a,"timespinner"),d=c.options;d.showMinute&&(2==d.defaultValue.length&&(d.defaultValue+=d.separator+"00"),d.highlight=1,d.formatLength=4,d.maxLength=5,d.showSeconds&&(5==d.defaultValue.length&&(d.defaultValue+=d.separator+"00"),d.highlight=2,d.formatLength=6,d.maxLength=8,d.millisecond&&(8==d.defaultValue.length&&(d.defaultValue+=d.separator+"000"),d.highlight=3,d.formatLength=9,d.maxLength=12))),$(a).spinner($.extend({},d,{spinnername:a.id||a.name||""})),$.extend(c,{spinnerText:$.data(a,"spinner").spinnerText}),$(a).val($(a).timespinner("getValue")),b(a)}function b(a){var b=$.data(a,"timespinner"),e=b.options,g=b.spinnerText,h=g[0];$(h).unbind(".timespinner"),e.disabled||$(h).bind("click.timespinner",function(){var b=0;if(null!=this.selectionStart)b=this.selectionStart;else if(this.createTextRange){var c=a.createTextRange(),f=document.selection.createRange();f.setEndPoint("StartToStart",c),b=f.text.length}b>=0&&2>=b?e.highlight=0:b>=3&&5>=b?e.highlight=1:b>=6&&8>=b&&(e.highlight=2),d(a)}).bind("blur.timespinner",function(){f(a),$(a).val($(a).timespinner("getValue"))}).bind("keyup.timespinner",function(b){38==b.keyCode&&c(a,!1),40==b.keyCode&&c(a,!0)})}function c(a,b){for(var c=$.data(a,"timespinner"),f=c.options,g=$(a).spinner("getValue"),h=g.split(f.separator),i=0;i<h.length;i++)h[i]=parseInt(h[i],10)||0;0==b?h[f.highlight]+=Number(f.increment):h[f.highlight]-=Number(f.increment),$(a).spinner("setValue",e(h,f.hourMax).join(f.separator)),d(a)}function d(a){var b=$.data(a,"timespinner"),c=b.options,d=b.spinnerText,e=d[0],f=0,g=0;if(0==c.highlight?(f=0,g=2):1==c.highlight?(f=3,g=5):2==c.highlight?(f=6,g=8):3==c.highlight&&(f=9,g=12),null!=e.selectionStart)e.setSelectionRange(f,g);else if(e.createTextRange){var h=e.createTextRange();h.collapse(),h.moveEnd("character",g),h.moveStart("character",f),h.select()}$(e).focus()}function e(a,b){for(var c=a.length-1;c>=0;c--)3==c&&(a[c]>999&&(a[c]-=1e3,a[c-1]++),a[c]<0&&(a[c]+=1e3,a[c-1]--)),(2==c||1==c)&&(a[c]>59&&(a[c]-=60,a[c-1]++),a[c]<0&&(a[c]+=60,a[c-1]--)),0==c&&(a[c]>b&&(a[c]-=b),a[c]<0&&(a[c]+=b));for(var c=0;c<a.length;c++)a[c]=3==c?g(a[c],3):g(a[c],2);return a}function f(a){for(var b=$.data(a,"timespinner"),c=b.options,d=b.spinnerText,e=d.val(),f=[];e.length<c.maxLength;){-1==e.indexOf(c.separator)?(f[0]=e.substr(0,2),c.showMinute&&(f[1]=e.substr(2,2),c.showSeconds&&(f[2]=e.substr(4,2),c.millisecond&&(f[3]=e.substr(6,3))))):f=e.split(c.separator);for(var h=0;h<f.length;h++)f[h]=3==h?g(f[h],3):g(f[h],2);e=f.join(c.separator),e.length<c.maxLength&&(e+=c.separator)}d.val(e)}function g(a,b){for(b=b||2,a+="";a.length<b;)a="0"+a;return a}function h(a,b){var c=$.data(a,"timespinner"),d=c.options;b?(d.disabled=!0,$(a).spinner("disable")):(d.disabled=!1,$(a).spinner("enable"))}function i(a,b){var c=$.data(a,"timespinner"),d=c.options,e=c.spinnerText;$(a).val(b),d.valueHasSeparator&&(b=b.split(d.separator).join("")),d.suffixStr&&(b=b.substr(0,b.length-d.suffixStr.length)),e.val(d.setFormat.call(a,a,b))}function j(a,b){var c=$.data(a,"timespinner"),d=c.spinnerText,e=c.options,f=d.val(),g=f.split(e.separator);return isNaN(b)?e.valueHasSeparator?f+e.suffixStr:g.join("")+e.suffixStr:g[b]||""}function k(a,b){var c=$.data(a,"timespinner"),d=c.options,e=[],f=d.formatLength;return b=g(b,f),e[0]=b.substr(0,2),d.showMinute&&(e[1]=b.substr(2,2),d.showSeconds&&(e[2]=b.substr(4,2),d.millisecond&&(e[3]=b.substr(6,3)))),e.join(d.separator)}$.fn.timespinner=function(b,c){if("string"==typeof b){var d=$.fn.timespinner.methods[b],e=[this];return d?d.apply(this,e.concat(Array.prototype.slice.call(arguments,1))):this.spinner(b,c)}return this.each(function(){b=b||{};var c=$.data(this,"timespinner");c?$.extend(c.options,b):($.data(this,"timespinner",{options:$.extend({},$.fn.timespinner.defaults,$.fn.timespinner.parseOptions(this),b)}),a(this))})},$.fn.timespinner.parseOptions=function(a){return $.extend({},$.parser.parseOptions(a))},$.fn.timespinner.defaults=$.extend({},$.fn.spinner.defaults,{separator:":",showMinute:!0,showSeconds:!0,showMillisecond:!1,hourMax:24,increment:1,suffixStr:"",valueHasSeparator:!0,setFormat:k,spin:function(a){c(this,a)},maxLength:"2",defaultValue:"00",highlight:0,formatLength:2}),$.fn.timespinner.methods={options:function(a){return $.data(a[0],"timespinner").options},setValue:function(a,b){return a.each(function(){i(this,b)})},getValue:function(a){return j(a[0])},enable:function(a){return a.each(function(){h(this,!1),b(this)})},disable:function(a){return a.each(function(){h(this,!0),b(this)})},getHours:function(a){return j(a[0],0)},getMinutes:function(a){return j(a[0],1)},getSeconds:function(a){return j(a[0],2)},getMillisecond:function(a){return j(a[0],3)}}}),define("lib/kui/datebox",[],function(){function a(a){var b=$.data(a,"datebox"),c=b.options,d=$.data(a,"combo").combo,e=$.data(a,"combo").panel,g=d.find(".combo-text");if(b.options.editable){var h=function(b,c){if(b.max&&c>b.max){f(a,b.max);var d=$("table",e).find(".calendar-no-max");$("table",e).find(".calendar-day").removeClass("calendar-selected"),d.first().prev().addClass("calendar-selected")}else if(b.min&&c<b.min){f(a,b.min);var d=$("table",e).find(".calendar-no-min");$("table",e).find(".calendar-day").removeClass("calendar-selected"),d.last().next().addClass("calendar-selected")}else c&&b.separator&&8===c.length&&(c=utils.formatDate(c,"yyyy"+b.separator+"MM"+b.separator+"dd")),f(a,c);$(a).combo("hidePanel")};g.unbind("keydown").bind("keydown",function(b){if(!c.editable||37!==b.keyCode&&38!==b.keyCode&&39!==b.keyCode&&40!==b.keyCode){var d=g.val();d&&$(a).combo("isValid")?h(c,d):""===d&&13===b.keyCode&&(f(a,c.max),$(this).validatebox("moveNext"),$(a).combo("hidePanel"))}})}}function b(a){function b(){var b=$(a).combo("panel");c.calendar=$("<div></div>").appendTo(b).wrap('<div class="datebox-calendar-inner"></div>'),c.calendar.calendar({fit:!0,border:!1,min:e.min,max:e.max,selectDay:e.selectDay,onSelect:function(b){var c="undefiend"!=typeof e.separator?e.separator:"",d=e.formatter(b,c);f(a,d),$(a).combo("hidePanel"),e.onSelect.call(a,b,d)},onClick:function(){$.data(a,"combo").comboText.focus()}});var g=$('<div class="datebox-button"></div>').appendTo(b);$('<a href="javascript:void(0)" class="datebox-close"></a>').html(e.closeText).appendTo(g),$('<a href="javascript:void(0)" class="datebox-current"></a>').html(e.currentText).appendTo(g),$('<a href="javascript:void(0)" class="datebox-ok"></a>').html(e.okText).appendTo(g),g.find(".datebox-current,.datebox-close,.datebox-ok").hover(function(){$(this).addClass("datebox-button-hover")},function(){$(this).removeClass("datebox-button-hover")}),g.find(".datebox-current").click(function(){c.calendar.calendar({year:(new Date).getFullYear(),month:(new Date).getMonth()+1,current:new Date}),d(a)}),g.find(".datebox-close").click(function(){f(a,""),$(a).combo("validate"),$(a).combo("hidePanel")}),g.find(".datebox-ok").click(function(){d(a)}).hide()}var c=$.data(a,"datebox"),e=c.options,g=e.value||e.defaultValue;g&&":"==String(g).charAt(0)&&(g=e.defaultValue=e.value=kui.getCurrDate(g,e.separator)),$(a).addClass("datebox-f"),$(a).combo($.extend({},e,{onShowPanel:function(){c.calendar.calendar("resize"),e.onShowPanel.call(a)},keyHandler:e.editable?$.fn.combo.defaults.keyHandler:e.keyHandler})),$(a).combo("textbox").parent().addClass("datebox"),c.calendar||b(),f(a,g)}function c(a,b){var c=b||"",d=c;if(!(""!=c&&c.length<4)){var e=$.data(a,"datebox"),f=e.options;if(""==c){var g=e.calendar.calendar("options").current.getDate();e.calendar.calendar("moveTo",f.parser(g))}else/\d{4}\W?/.test(c)?(d+=f.separator+"01"+f.separator+"01",e.calendar.calendar("moveTo",f.parser(d))):/\d{4}\W?\d{2}/.test(c)&&(d+=f.separator+"01",e.calendar.calendar("moveTo",f.parser(d)))}}function d(a){var b=$.data(a,"datebox").options,c=$.data(a,"datebox").calendar,d="undefiend"!=typeof b.separator?b.separator:"",e=c.calendar("options").current,g=b.formatter(e,d);
f(a,g),$(a).combo("hidePanel"),b.onSelect.call(a,e,g)}function e(a,b){var c=$.data(a,"datebox").options,d=$.data(a,"datebox").calendar,e="undefiend"!=typeof c.separator?c.separator:"",g=d.calendar("options").current.getTime(),h=new Date(g+24*(b?b:0)*60*60*1e3),i=c.formatter(h,e);return c.min&&i<c.min?!1:c.max&&i>c.max?!1:void f(a,i)}function f(a,b){var c=$.data(a,"datebox"),d=c.options,e="";if(b&&""!=b)e=b;else if(""!=b){var f=/(\d{4})\W?(\d{2})\W?(\d{2})/,g=f.exec(b);null!=g&&(e=g[1]+d.separator+g[2]+d.separator+g[3],b=g[1]+d.saveformat+g[2]+d.saveformat+g[3])}"undefined"!=typeof b&&$(a).combo("setValue",b).combo("setText",e),c.calendar.calendar("moveTo",d.parser(b))}function g(a,b){var c=$.data(a,"datebox").options;b?(c.editable=!0,$(a).parent().find(".combo-text").removeAttr("readonly")):(c.editable=!1,$(a).parent().find(".combo-text").attr("readonly","readonly"))}$.fn.datebox=function(c,d){if("string"==typeof c){var e=$.fn.datebox.methods[c];return e?e(this,d):this.combo(c,d)}return c=c||{},this.each(function(){var d=$.data(this,"datebox");if(d?$.extend(d.options,c):d=$.data(this,"datebox",{options:$.extend(!0,{},$.fn.datebox.defaults,$.fn.datebox.parseOptions(this),c)}),d.options.isCurrentDateMin&&(d.options.min=utils.formatDate(new Date,"yyyyMMdd")),d.options.isCurrentDateMax&&(d.options.max=utils.formatDate(new Date,"yyyyMMdd")),d.options.selectDay||(d.options.addDefaultRule=!1,d.options.editable=!1),d.options.validType=d.options.validType||"",d.options.addDefaultRule){var e=d.options.validType.split(";");-1===$.inArray("date",e)&&(e.unshift("date"),d.options.validType=e.join(";"))}d.options.editable&&(d.options.acceptInput=!0),b(this),g(this,d.options.editable),comboOptions=$.data(this,"combo").options,comboOptions.text=$(this).combo("getText"),d.options.text=$(this).combo("getText"),a(this)})},$.fn.datebox.methods={options:function(a){var b=$.data(a[0],"datebox").options;return b.originalValue=a.combo("options").originalValue,b},calendar:function(a){return $.data(a[0],"datebox").calendar},setValue:function(a,b){return a.each(function(){f(this,b)})},reset:function(a){return a.each(function(){var a=$(this).datebox("options");$(this).datebox("setValue",a.originalValue)})}},$.fn.datebox.parseOptions=function(a){$(a);return $.extend({},$.fn.combo.parseOptions(a),{})},$.fn.datebox.defaults=$.extend({},$.fn.combo.defaults,{isCurrentDateMin:!1,isCurrentDateMax:!1,selectDay:!0,addDefaultRule:!0,panelWidth:180,panelHeight:"auto",value:"",keyHandler:{up:function(){e(this,-7)},down:function(){e(this,7)},left:function(){e(this,-1)},right:function(){e(this,1)},enter:function(){d(this)},query:function(a){c(this,a)}},editable:!0,currentText:"Today",closeText:"Close",okText:"Ok",min:"19000101",max:"30001231",separator:"",saveformat:"",formatter:function(a,b){var c=[],d=a.getFullYear(),e=a.getMonth()+1,f=a.getDate();return c.push(d+""),c.push(10>e?"0"+e:e),this.selectDay&&c.push(10>f?"0"+f:f),c.join(b)},parser:function(a){var b=/(\d{4})\W?(\d{2})\W?(\d{2})/;a=String(a);var c=a&&a.replace(b,"$1/$2/$3"),d=Date.parse(c);return isNaN(d)?new Date:new Date(d)},onSelect:function(){}})}),define("lib/kui/datetimebox",[],function(){function a(a){var b=$.data(a,"datetimebox"),c=b.options;$(a).datebox($.extend({},c,{onShowPanel:function(){var b=$(a).datetimebox("getValue");e(a,b,!0),c.onShowPanel.call(a)},addDefaultRule:!1})),$(a).datebox("calendar").calendar({onSelect:function(b){var d=$(a).datetimebox("calendar");d.calendar("options").current=b,c.onSelect.call(a,b),$.data(a,"combo").comboText.focus()}});var f=$(a).datebox("panel");if(!b.spinner){var g=$('<div style="padding:2px"><input style="width:80px"></div>').insertAfter(f.children("div.datebox-calendar-inner"));b.spinner=g.children("input"),b.spinner.timespinner({showSeconds:!0}).bind("mousedown",function(a){a.stopPropagation()}),e(a,c.value);var h=f.children("div.datebox-button"),i=$('<a href="javascript:void(0)" class="datebox-ok"></a>').html(c.okText).appendTo(h);i.hover(function(){$(this).addClass("datebox-button-hover")},function(){$(this).removeClass("datebox-button-hover")}).click(function(){d(a)})}}function b(a){var b=$(a).datetimebox("calendar"),c=$(a).datetimebox("spinner"),d=b.calendar("options").current;return new Date(d.getFullYear(),d.getMonth(),d.getDate(),c.timespinner("getHours"),c.timespinner("getMinutes"),c.timespinner("getSeconds"))}function c(a,b){e(a,b,!0)}function d(a){var c=$.data(a,"datetimebox").options,d=b(a);e(a,c.formatter(d,c.separator)),$(a).combo("hidePanel")}function e(a,b,c){function d(b){function c(a){return(10>a?"0":"")+a}var d=[c(b.getHours()),c(b.getMinutes())];return e.showSeconds&&d.push(c(b.getSeconds())),d.join($(a).datetimebox("spinner").timespinner("options").separator)}var e=$.data(a,"datetimebox").options;if($(a).combo("setValue",b),!c&&b){var f=e.parser(b);$(a).combo("setValue",e.formatter(f,e.separator)),$(a).combo("setText",e.formatter(f,e.separator)),$(a).combo("validate")}var f=e.parser(b);$(a).datetimebox("calendar").calendar("moveTo",e.parser(b)),$(a).datetimebox("spinner").timespinner("setValue",d(f))}function f(a,b){var c=$.data(a,"datetimebox").options,d=$.data(a,"datebox").calendar,f="undefiend"!=typeof c.separator?c.separator:"",g=d.calendar("options").current.getTime(),h=new Date(g+24*(b?b:0)*60*60*1e3),i=c.formatter(h,f);return c.min&&i<c.min?!1:c.max&&i>c.max?!1:void e(a,i)}$.fn.datetimebox=function(b,c){if("string"==typeof b){var d=$.fn.datetimebox.methods[b];return d?d(this,c):this.datebox(b,c)}return b=b||{},this.each(function(){var c=$.data(this,"datetimebox");c?$.extend(c.options,b):$.data(this,"datetimebox",{options:$.extend({},$.fn.datetimebox.defaults,$.fn.datetimebox.parseOptions(this),b)}),a(this)})},$.fn.datetimebox.methods={options:function(a){return $.data(a[0],"datetimebox").options},spinner:function(a){return $.data(a[0],"datetimebox").spinner},setValue:function(a,b){return a.each(function(){e(this,b)})}},$.fn.datetimebox.parseOptions=function(a){$(a);return $.extend({},$.fn.datebox.parseOptions(a),{})},$.fn.datetimebox.defaults=$.extend({},$.fn.datebox.defaults,{showSeconds:!0,keyHandler:{up:function(){f(this,-7)},down:function(){f(this,7)},left:function(){f(this,-1)},right:function(){f(this,1)},enter:function(){d(this)},query:function(a){c(this,a)}},formatter:function(a,b){function c(a){return(10>a?"0":"")+a}var d=a.getHours(),e=a.getMinutes(),f=a.getSeconds();return $.fn.datebox.defaults.formatter(a,b||"")+" "+c(d)+":"+c(e)+":"+c(f)},parser:function(a){if(""==$.trim(a))return new Date;var b=a.split(" "),c=$.fn.datebox.defaults.parser(b[0]),d=b[1].split(":"),e=parseInt(d[0],10),f=parseInt(d[1],10),g=parseInt(d[2],10);return new Date(c.getFullYear(),c.getMonth(),c.getDate(),e,f,g)}})}),define("lib/kui/report",["lib/kui/tpls/report-import-tpl"],function(a){function b(a){d(a)}function c(a){var b=$.data(a,"report").options,c=[],d=["max","min","avg","sum"],e=[];$.each(b.gridColumns,function(a,f){if($.inArray(b.columns,f.field)){for(var g,h={},i=0,j=d.length;j>i;i++){var k=f[d[i]];k&&(g=!0,h[d[i]]=!0)}if(g&&(h.name=f.field,c.push(h)),f.remoteFormat){var l={};l[f.field]=f.remoteFormat,e.push(l)}}}),b.stsColumns=c;var f={tableView:b.tableView,reqStr:b.reqStr,columns:b.columns,configInfo:{pageInfo:b.pageInfo,reportConfig:{range:b.range,page:b.page,fonts:b.fonts},searchParam:b.searchParam,userName:b.userName,orgName:b.orgName},Datas:b.Datas,exportType:b.exportType,isPrint:b.isPrint,implType:b.implType,title:b.title,fileName:b.fileName,langCode:b.langCode,formatCol:e};b.isExportSts&&(f.stsColumns=b.stsColumns),b.isPrint&&(f.footerInfo=b.footerInfo,f.companyName=b.companyName,f.confirmInfo=b.confirmInfo);var g,h="<?xml version='1.0' encoding='UTF-8'?><requests>"+JSON.stringify(f)+"</requests>",i=utils.fsEncrypt(h);window&&window.g_user&&window.g_user.JSESSIONID&&(g=window.g_user.JSESSIONID),g||b.isPrint?$.when($.isFunction(b.onBeforePrint)?b.onBeforePrint():void 0).then(function(a){if(!1!==a)var c,d,e="",f=window.open("/apps/frame/pages/Print.html"+e,"打印"),h=40,j=setInterval(function(){if(f&&f.document&&!f.closed&&(c=f.document.getElementById("export"))&&(d=f.document.getElementById("printForm"))){if(clearInterval(j),g){var a=f.location.pathname.replace(/\/frame.*$/,"");f.document.cookie="JSESSIONID="+g+"; path="+a+";"}c.innerHTML=i,d.action=b.action,d.submit()}else--h<0&&clearInterval(j)},200)}):$.when($.isFunction(b.onBeforeExport)?b.onBeforeExport(f):void 0).then(function(a){if(!1!==a){var c=$('<iframe id="hideExportFrame" name="hideExportFrame" src="" style="display: none;" ></iframe>'),d=$("<form>");d.attr("style","display:none"),d.attr("method","POST"),d.attr("target","hideExportFrame"),d.attr("action",b.action),d.append('<input name="export" value="'+i+'">'),c.appendTo("body"),d.appendTo("body").submit()}})}function d(a){function b(){var a=!0;return v.each(function(){return $(this).prop("checked")?void 0:a=!1}),a}var d=$.data(a,"report").options,i=d.exportType,j=d.isPrint,k=d.title,l=j?"打印列":"导出列",m="pdf"==i,n=d.gridColumns,o=[];("dbf"===i||"csv"===i)&&(d.showStatistics=!1),o.push('<div class="export-div-reportDialog"><div style="width:'),o.push(g()?"550px":"570px"),o.push(';float:left"><div class="export-div-print-columns"><fieldset style="padding:0;width:270px;height:'),o.push(d.showStatistics?g()?h()?"212px":"213px":"238px":g()?h()?"199px":"200px":"225px"),o.push('"><legend>'),o.push(l),o.push('</legend><div class="export-div-print-columns-div"><input id="export_checkAll" type="checkbox" name="checkAll"><label for="export_checkAll">选中全部</label></div><div class="export_columns" style=\'border:1px solid gray;width:260px;height:'),o.push(g()?"140px":"165px"),o.push(";overflow:auto;margin:5px'>");for(var p=$.ls(d.lsKey+"-report")||[],q=0;q<n.length;q++)"chk"==n[q].field||""==n[q].field||n[q].hidden||"notice"==n[q].type||(o.push('<div class="export-div-chk"><li class="export-div-chk-li"><span class="export-div-chk-li-span1"><input type="checkbox" id="export_'),o.push(n[q].field),o.push('_chk" value="'),o.push(n[q].field),o.push('"'),/ hide/.test(n[q].cellClass)||(p.length?-1===$.inArray(n[q].field,p)&&o.push('checked="checked"'):d.exportCheckAll?o.push('checked="checked"'):n[q].exportCheck&&o.push('checked="checked"')),o.push('><label for="export_'),o.push(n[q].field),o.push('_chk">'),o.push(n[q].title),o.push('</label></span><span class="export-div-chk-li-span2">宽(毫米):<input type="text" disabled="disabled" size="2" '),o.push('onkeyup="value=value.replace(/[^\\d+(\\.\\d+)?$]/g,\'\')" value="'),o.push(n[q].width),o.push('"/></span></li></div>'));if(o.push('</div></fieldset></div><div class="export-div-float-left"><fieldset style="width:251px;margin-bottom:5px;height:'),o.push(g()?h()?"43px":"40px":"43px"),o.push('"><legend>基本</legend><div class="export-div-title-range">标题:&nbsp;&nbsp;<input type="text" id="export_title" value="'),o.push(k),o.push('"/></div></fieldset><fieldset class="export_direction" style="width:251;margin-bottom:5px;height:'),o.push(g()?h()?"39px":"33px":"35px"),o.push('"><legend>方向</legend><div><input type="radio" name="printDirection" value="horizontal"'),o.push("horizontal"===d.page.direction?'checked="checked"':""),o.push('/>横向&nbsp;&nbsp;<input type="radio" name="printDirection" value="vertical"'),o.push("vertical"===d.page.direction?'checked="checked"':""),o.push('/>纵向</div></fieldset><fieldset class="export_range" style="width:253px;height:'),o.push(d.showStatistics?g()?h()?"109px":"112px":"107px":g()?h()?"90px":"93px":"88px"),o.push('"><legend>范围</legend><div class="export-div-title-range"><input id="allPage" type="radio" '),o.push("all"===d.general.range?'checked="checked"':""),o.push(' value="all" name="range">全部</div><div class="export-div-title-range"><input id="currentPage" type="radio" value="current" '),o.push("current"===d.general.range?'checked="checked"':""),o.push(' name="range">当前页</div><div><input id="defineRange" type="radio" value="define" '),o.push("define"===d.general.range?'checked="checked"':""),o.push(' name="range">起始页:&nbsp;&nbsp;<input name="start" value="1" type="text" size="2" onkeyup="value=value.replace(/[^\\d]/g,\'\')" onkeydown="$(this).parent().find(\'input[name=range]\')[0].checked=true">&nbsp;&nbsp;结束页:&nbsp;&nbsp;<input name="end" value="1" type="text" size="2" onkeyup="value=value.replace(/[^\\d]/g,\'\')" onkeydown="$(this).parent().find(\'input[name=range]\')[0].checked=true"></div>'),d.showStatistics&&o.push('<div style="padding:3px 0 0 2px"><input id="exportSts" type="checkbox" checked>统计区域</div>'),o.push("</fieldset></div></div>"),m){o.push('<fieldset class="export_spacing" style="width:534px;float:left;margin-bottom:5px;margin-top:5px"><legend>间距(厘米)</legend><div>上:&nbsp;&nbsp;<input name="topMargin" type="text" size="3" onkeyup="value=value.replace(/[^\\d+(\\.\\d+)?$]/g,\'\')" value="'),o.push(d.page.topMargin),o.push('"/>&nbsp&nbsp下:&nbsp;&nbsp;<input name="bottomMargin" type="text" size="3" onkeyup="value=value.replace(/[^\\d+(\\.\\d+)?$]/g,\'\')" value="'),o.push(d.page.bottomMargin),o.push('"/>&nbsp;&nbsp;左:&nbsp;&nbsp;<input name="leftMargin" type="text" size="3" onkeyup="value=value.replace(/[^\\d+(\\.\\d+)?$]/g,\'\')" value="'),o.push(d.page.leftMargin),o.push('"/>&nbsp;&nbsp;右:&nbsp;&nbsp;<input name="rightMargin" type="text" size="3" onkeyup="value=value.replace(/[^\\d+(\\.\\d+)?$]/g,\'\')" value="'),o.push(d.page.rightMargin),o.push('"/></div></fieldset><fieldset class="export_paper" style="width:534px;float:left;margin-bottom:5px;"><legend>纸张</legend><div><input id="export_standardsize" type="radio" name="pageSize" value="standard" '),o.push("define"==d.page.PageSize?"":'checked="checked"'),o.push('/>标准&nbsp;&nbsp;<select id="sizeSelect" onchange="$(this).prev()[0].checked=true">');for(var q=0,r=d.stardardPapers.length;r>q;q++)o.push(d.page.PageSize==d.stardardPapers[q]?'<option value="'+d.stardardPapers[q]+'" selected="selected">'+d.stardardPapers[q]+"</option>":'<option value="'+d.stardardPapers[q]+'">'+d.stardardPapers[q]+"</option>");o.push('</select>&nbsp;&nbsp;<input id="export_definesize" type="radio" name="pageSize" value="define"'),o.push("define"==d.page.PageSize?'checked="checked"':""),o.push("/><label>自定义&nbsp;&nbsp;</label>宽(厘米):&nbsp;&nbsp;<input"),o.push(' value = "'+String(d.page.width).replace(/[^\d.]/g,"")+'"'),o.push(' type="text" id="pageWidth" size="5" onkeydown="$(this).parent().find(\'#export_definesize\')[0].checked=true" onkeyup="value=value.replace(/[^\\d+(\\.\\d+)?$]/g,\'\')"/>&nbsp;&nbsp;高(厘米):&nbsp;&nbsp;<input'),o.push(' value = "'+String(d.page.height).replace(/[^\d.]/g,"")+'"'),o.push(' type="text" id="pageHeight" size="5" onkeydown="$(this).parent().find(\'#export_definesize\')[0].check 	ed=true" onkeyup="value=value.replace(/[^\\d+(\\.\\d+)?$]/g,\'\')"/></div><div></div></fieldset>'),j&&(d.companyName||d.companyName||d.footerInfo)&&(o.push('<fieldset class="export_paper" style="width:534px;float:left;margin-bottom:5px;">'),o.push("<legend>表尾区域</legend><div>"),o.push("<div>"),o.push('<span style="line-height: 20px;">确认信息：</span><input name="confirmInfo" style="width: 150px" value="'+(d.confirmInfo||"")+'"/>'),o.push('<span style="line-height: 20px;margin-left: 93px;">公司名称：</span><input name="companyName" style="width: 150px" value="'+(d.companyName||"")+'"/>'),o.push("</div>"),o.push('<div><span style="float: left;line-height: 40px;">表尾描述：</span><textarea name="footerInfo" style="width: 455px;resize: none;">'+(d.footerInfo||"")+"</textarea></div>"),o.push("</div></fieldset>"))}if(o.push("</div>"),d.notShowDialog){var d=$.data(a,"report").options,s=[];$.each(n,function(a,b){s.push(b.field)}),d.columns=s;var t="all";return d.pageInfo.startRowNum=0==d.pageInfo.startRowNum?0:1,d.pageInfo.endRowNum=-1,d.pageInfo.noPagination&&(d.pageInfo.pageSize=-1,delete d.pageInfo.noPagination),d.fallParas.enable&&d.reqStr.req[0]&&(d.reqStr.req[0][d.fallParas.recName]=d.pageInfo.startRowNum,d.reqStr.req[0][d.fallParas.cntName]=d.pageInfo.endRowNum,"all"==t&&(d.reqStr.req[0][d.fallParas.cntName]=99999999)),d.pageInfo.remotePagination&&"all"==t&&d.pageInfo.pageParamete&&(d.reqStr.req[0][d.pageInfo.pageParamete.recName]=99999999,d.reqStr.req[0][d.pageInfo.pageParamete.cntName]=0),void c(a)}if($.data(a,"window")){var u=m?g()?378:440:g()?280:320;u=d.showStatistics?u+19:u,j&&(d.companyName||d.companyName||d.footerInfo)&&(u=d.footerInfo?u+80:u),$(a).find("div.dialog-content").html(o.join("")).end().window("open").window("resize",{height:u}).window("center").window("setTitle",d.titles[j?"print":i])}else{var u=m?g()?378:440:g()?282:320;u=d.showStatistics?u+19:u,j&&(d.companyName||d.companyName||d.footerInfo)&&(u=d.footerInfo?u+80:u),$(a).html(o.join("")).dialog({width:590,height:u,modal:!0,title:d.titles[j?"print":i],iconCls:"icon-save",shadow:!1,collapsible:!1,buttons:[{text:"确定",iconCls:"icon-save",handler:function(){return e(a)?void(f(a)&&(c(a),$(a).dialog("close"))):void alert("请勾选需要导出的列！")}},{text:"关闭",iconCls:"icon-cancel",handler:function(){$(a).dialog("close")}}]})}var v=$(a).find(".export_columns").find("input[type='checkbox']"),w=$(a).find("#export_checkAll");v.click(function(){w.prop("checked",b())}),w.prop("checked",b()).click(function(){v.prop("checked",$(this).prop("checked"))})}function e(a){return $(a).find(".export_columns").find("input[type='checkbox']").filter(function(){return $(this).prop("checked")}).length}function f(a){var b=$.data(a,"report").options,c=[],d=[],e=[];$(a).find('div.export_columns:first input[type="checkbox"]').each(function(){this.checked?(c.push($(this).val()),d.push($(this).parent().next().find("input").val())):e.push($(this).val())}),b.columns=c,b.isExportSts=$(a).find("#exportSts").attr("checked"),b.title=$(a).find("#export_title").val(),b.fileName=b.title,$.ls(b.lsKey+"-report",e),b.page.direction=$(a).find("fieldset.export_direction:first").find("input:checked").val();var f=$(a).find("fieldset.export_range:first"),g=f.find("input[type=radio]:checked").val(),h=parseInt(f.find("input[name=start]").val())||1,i=parseInt(f.find("input[name=end]").val())||1;if(h>i)return alert("结束页应该大于等于起始页。"),!1;if("all"==g?(b.pageInfo.startRowNum=0==b.pageInfo.startRowNum?0:1,b.pageInfo.endRowNum=-1):"define"==g&&(b.fallParas.enable&&b.reqStr.req[0]?b.reqStr.req[0][b.fallParas.recName]=0==b.pageInfo.startRowNum?b.pageInfo.pageSize*(h-1):b.pageInfo.pageSize*(h-1)+1:b.pageInfo.startRowNum=b.pageInfo.pageSize*(h-1)+1,b.pageInfo.endRowNum=b.pageInfo.pageSize*i),b.pageInfo.noPagination&&(b.pageInfo.pageSize=-1,delete b.pageInfo.noPagination),b.fallParas.enable&&b.reqStr.req[0]&&(b.reqStr.req[0][b.fallParas.recName]=b.pageInfo.startRowNum,b.reqStr.req[0][b.fallParas.cntName]=b.pageInfo.endRowNum,"all"==g&&(b.reqStr.req[0][b.fallParas.cntName]=99999999)),b.pageInfo.remotePagination&&"all"==g&&b.pageInfo.pageParamete&&(b.reqStr.req[0][b.pageInfo.pageParamete.recName]=99999999,b.reqStr.req[0][b.pageInfo.pageParamete.cntName]=0),"pdf"==b.exportType){for(var j=$(a).find("fieldset.export_spacing:first"),k=["leftMargin","rightMargin","topMargin","bottomMargin"],l=0;l<k.length;l++){var m=parseFloat(j.find("input[name="+k[l]+"]").val());b.page[k[l]]="number"==typeof m?m:$.fn.report.defaults.page[k[l]]}var n=$(a).find("fieldset.export_paper:first"),o=n.find('input[name="pageSize"]:checked').val();"standard"==o?(b.page.PageSize=n.find("#sizeSelect").val(),b.page.width=0,b.page.height=0):(b.page.PageSize="define",b.page.width=parseInt(n.find("#pageWidth").val())||0,b.page.height=parseInt(n.find("#pageHeight").val())||0)}if(b.isPrint){var p=$(a).find(":input");b.footerInfo=p.filter("[name='footerInfo']").val(),b.companyName=p.filter("[name='companyName']").val(),b.confirmInfo=p.filter("[name='confirmInfo']").val()}return b.Datas&&(b.Datas=""),!0}function g(){var a=!1;return $.browser.msie&&(a=!0),a}function h(){var a=!1;return $.browser.msie&&"8.0"==$.browser.version&&(a=!0),a}$.fn.report=function(a,d){return"string"==typeof a?$.fn.report.methods[a](this,d):(a=a||{},this.each(function(){$.data(this,"report")||$.data(this,"report",{options:$.extend({},$.fn.report.defaults)});var d=$.data(this,"report").options;$.extend(d,a),d.noSet?c(this):b(this)}))},$.fn.report.parseOptions=function(a){return $.extend({},$.parser.parseOptions(a,[{colNumbers:"number"}]))},$.fn.report.methods={options:function(a){return $.data(a[0],"report").options},submit:function(a){c(a[0])}},$.fn.report.defaults={action:"../../../kjdp_export",tableView:{otctsTrade_ListIntentInfo:"col"},reqStr:{req:[{service:"exportTest",F_FUNCTION:"0"}]},gridColumns:[],columns:[],pageInfo:{pageSize:20,pageNum:1,totalRowNum:791,totalPageNum:40,startRowNum:1,endRowNum:20},general:{range:"current"},page:{PageSize:"A4",direction:"vertical",width:0,height:0,align:"left",leftMargin:1.27,rightMargin:1.27,topMargin:.5,bottomMargin:1.27},fonts:{header:{printable:!0,font:"宋体",size:8,bold:!0,italic:!1},footer:{printable:!0,font:"宋体 ",size:8,bold:!0,italic:!1},title:{printable:!0,font:"宋体",size:12,bold:!0,italic:!1},subtitle:{printable:!0,font:"宋体",size:8,bold:!1,italic:!1},datatitle:{printable:!0,font:"宋体",size:8,bold:!1,italic:!1},data:{printable:!0,font:"宋体",size:8,bold:!1,italic:!1}},searchParam:{"交易市场":"OTC"},userName:"",orgName:"",Datas:"",exportType:"pdf",isPrint:!1,implType:"",title:"导出",fileName:"导出",langCode:"zh_CN",titles:{xls:"Excel导出配置",pdf:"PDF导出配置",dbf:"DBF导出配置",csv:"CSV导出配置",txt:"TXT导出配置",xml:"XML导出配置",flg:"FLG导出配置",print:"打印设置"},stardardPapers:["A1","A2","A3","A4","A5"]},$.fn.imports=function(a,b,c){return"string"==typeof b?$.fn.imports.methods[b](this,c):(b=b||{},this.each(function(){var b=$.data(this,"import")?$.data(this,"import"):new j($(this),$(a));$.data(this,"import",b),b.openDialog()}))};var i=a("lib/kui/tpls/report-import-tpl"),j=function(a,b){this.$el=a,this.$tpl=$(i()),this.$dialog=null,this.$grid=b};j.prototype={initDg:function(a){if(!(null==a||a.length<1)){var b=this,c=b.$tpl.find("#import_file");b.$impGrid=c.datagrid({rowEdit:!1,singleSelect:!0,columns:[a]}),b.$dialog.find(".kui-uploadify").uploadify({uploadUrl:"../../../kjdp_upload?DIR=import",fileTypeDesc:"请选择dbf,xls文件",fileTypeExts:"*.dbf;*.xls",fileNumLimit:"1",onUploadSuccess:function(a){b.uploadSuccess(a)},onDeleteSuccess:function(){b.$impGrid.datagrid("loadData",{DATA:[[]],HEAD:{DATA_ROWS:0},rows:[],total:0}),b.$dialog.find("#sno").text(""),b.$dialog.find("#name").text(""),b.$dialog.find("#type").text("")}})}},openDialog:function(){var a=this;a.$dialog||(a.$dialog=a.$tpl.dialog({width:.8*document.body.clientWidth,height:document.body.clientHeight-40,modal:!0,title:"导入报表",iconCls:"icon-save",shadow:!1,collapsible:!1,buttons:[{text:"导入",iconCls:"icon-save",handler:function(){a.submitImport().done(function(){a.$dialog.dialog("close"),a.$grid.datagrid("reload")}).fail(function(a){alert(a.join(","))})}},{text:"关闭",iconCls:"icon-cancel",handler:function(){a.$dialog.dialog("close")}}]}),a.initDg(a.$grid.datagrid("getOriginalColumns"))),a.$dialog.dialog("open")},submitImport:function(){var a,b=this,c=$.Deferred(),d=!1,e=b.$impGrid.datagrid("getOriginalRowsData"),f=b.$grid.data("datagrid"),g=f.options.toolbar,h={},i=[],j=[];if(g&&g.length){for(var k=0;k<g.length;k++)if("icon-add"==g[k].iconCls){a=g[k].req;break}if(a){for(var l=0;l<e.length;l++)i[l]=$.extend({},a[0],e[l]);i.length<1?(alert("导入数据为空！"),j.push("导入数据为空！")):(d=!0,h.req=i,ajax.post(h).done(function(a,b,d){$.each(d,function(a,b){"0"!==b.head.MSG_CODE&&j.push(b.head.MSG_TEXT)}),j.length>0?c.reject(j):c.resolve()}))}else j.push("该表格没有批量导入功能！")}return d||setTimeout(function(){c.reject(j)},100),c.promise()},uploadSuccess:function(a){var b=this,c=b.$dialog,d=a.FILECON,e=d.substring(d.lastIndexOf(".")+1,d.length).toUpperCase();c.find("#sno").text("1"),c.find("#name").text(d),c.find("#type").text(e),b.$impGrid.datagrid("loading"),ajax.get({url:"../../../kjdp_import?&FILENAME="+d+"&IMPORTTYPE="+e+"&ISCOMMIT=0"}).done(function(a){var c=$.data(b.$impGrid[0],"datagrid").options.originalRowsData||[],d=c.concat(a.ANSWERS[0].ANS_COMM_DATA[0]);b.$impGrid.datagrid("loaded"),b.$impGrid.datagrid("loadData",{DATA:[d],HEAD:{DATA_ROWS:d.length},rows:d,total:d.length})})}}}),define("lib/kui/tpls/report-import-tpl",[],function(){return template.runtime('<div class="report-import clearfix"> <table class="vertical-flow-box" cellspacing="0" cellpadding="0"> <tbody> <tr class="inst-info"> <td> <div id="inst_info_tab1" class="datagrid-htable"> <form id="UploadForm" enctype="multipart/form-data" method="post" > <table class="vertical-flow-box" cellspacing="0" cellpadding="0" style="border: 1px solid #99CCFF;"> <tr> <td class="step-label">序号</td> <td class="step-label">文件名称</td> <td class="step-label">类型</td> </tr> <tr> <td class="step-content"><div id="sno"></div></td> <td class="step-content"><div id="name"></div></td> <td class="step-content"><div id="type"></div></td> </tr> <tr> <td class="step-content" colspan="3" style="text-align: right;"> <input id="upload_img" name="upload_img" type="file" class="kui-uploadify"/> </td> </tr> </table> </form> </div> </td> </tr> <tr> <td class="step-content"> <div id="inst_info_tab"> <table id="import_file" class="kui-datagrid"></table> </div> </td> </tr> </tbody> </table> </div>')}),define("lib/kui/form",[],function(require,exports,module){function getData(a,b){var c=kui.serialize2Json($(a).serialize().replace(/\+/g," "),null,function(c,d){return d.indexOf(",")&&$(".kui-numberbox[name="+c+"]",a).length>0&&(d=d.replace(/,/g,"")),b&&(d=kui.valueReplace(d)),$.trim(d)},a);return $.isPlainObject(c)&&delete c["checkbox"+$.expando],c}function ajaxSubmit(a,b){b=b||{};var c={},d=$(a),e=$.data(a,"form").options;b.req&&b.req.length>0&&b.req[0].service&&(e=$.extend(e,b));for(var f=$(d[0]).serializeArray(),g=e.req&&e.req.length>0?e.req:b.req,h=[],i=0;i<g.length;i++){c={};for(var j=0;j<f.length;j++){var k=f[j].name,l=kui.valueReplace(f[j].value),m=d.find("input[name='"+k+"']")[0];"undefined"!=typeof m&&m.className.indexOf("numberbox")>0&&(l=l.replace(/[,]/g,"")),c[k]=c[k]?c[k]+","+l:l}h[i]=$.extend({},g[i],c)}if(!b.onSubmit||0!=b.onSubmit.call(a,h)){var n={url:e.url?e.url:d.attr("action"),type:e.method?e.method:d.attr("type"),dataType:"xml",async:!1,needToCheck:b.needToCheck||!1,responseType:"xml",func:function(a){try{var c=a[0];b.success?b.success(c):e.success&&e.success(a)}catch(d){alert(d)}},error:function(a){b.fail?b.fail(a[0].ANS_MSG_HDR.MSG_TEXT):e.fail&&e.fail(a[0].ANS_MSG_HDR.MSG_TEXT)},req:h};(g&&g.length>0||e.url)&&ajaxRequest(n)}}function setDisplay(a,b,c){var d=$.isArray(b)?!1:!0,e=$(a);e.find("input,textarea,.form-notice").each(function(){var a=$(this),e=a.closest(".form-group-inline");(d||nameInArray(a.attr("name"),b))&&(c?e.show():e.hide())})}function load(a,b){function c(b){if(b&&!$.isEmptyObject(b)){h.originalData=b;var c=$(a),g=c.data("uioptions");if(g&&!$.isEmptyObject(g))$.each(g,function(a,g){var h,i=g.col,j=i.editor.type,k=g.field,l=b[k],m=["combobox","combotree","selecttree","combogrid","datetimebox","datebox","combo"];null!=l&&("password"===j&&(h=c.find(".kui-password[name='"+k+"']")).length?h.password("setValue",l):"timespinner"==j?f(k,l):"numberbox"==j?c.find("input[numberboxname='"+k+"']").numberbox("setValue",l):-1!=_.indexOf(m,j)?e(k,l):"radio"==j||"checkbox"==j?d(k,l):"textarea"==j?c.find("textarea[name='"+k+"']").val(l):c.find("input[name='"+k+"']").val(l))});else{var i,j,k,l;c.find("input,textarea,select").each(function(){if(l=$(this),i=l.attr("type"),j=l.attr("name"),k=b[j],j&&"undefined"!=String(k)&&"null"!=String(k))if("radio"==i||"checkbox"==i)d(j,k);else if(l.hasClass("combo-value"))e(j,k);else if(l.hasClass("numberbox-text"))l.numberbox("setValue",k);else if(l.hasClass("validatebox-text")){if(l.data("password"))return l.password("setValue",k),!0;l.val(k),l.attr("title",k),$(this).data("numberbox")&&l.triggerHandler("keyup")}else{if(l.hasClass("time-value"))return f(j,k),!0;"hidden"==l[0].type&&(l.val(k),l.attr("title",k))}})}h.validateOnLoad&&validate(a),h.onLoadSuccess.call(a,b)}}function d(b,c){var d=$(a),e=$('input[name="'+b+'"][type=radio], input[name="'+b+'"][type=checkbox]',d);return $.fn.prop?e.prop("checked",!1):e.attr("checked",!1),e.each(function(){var a=$(this);a.val()==String(c)&&($.fn.prop?a.prop("checked",!0):a.attr("checked",!0))}),e}function e(b,c){var d=$(a),e=["combobox","combotree","selecttree","combogrid","datetimebox","datebox","combo"],f=d.find('[comboName="'+b+'"]');if(f.length)for(var g=0;g<e.length;g++){var h=e[g];if(f.hasClass(h+"-f")){var i=f[h]("options");if(i.multiple)if("string"==typeof c&&(c=-1!=c.indexOf(",")?c.split(","):1==i.singleByte?c.split(""):[c]),"@"!=c&&"@"!=c[0]||"combobox"!=h||1!=i.atIsAll)f[h]("setValues",c);else{var j=$.data(f[0],"combo").panel,k=[];j.find(".combobox-item").each(function(){var a=$(this).attr("value");k.push(a)}),f[h]("setValues",k)}else f[h]("setValue",c);return}}}function f(b,c){var d=$(a),e=d.find("[spinnername="+b+"]");$(e).timespinner("setValue",c)}if(b){if(!$.data(a,"form")){for(var g in b)b[g]=jQuery.trim(b[g]);$.data(a,"form",{options:$.extend({},$.fn.form.defaults)})}var h=$.data(a,"form").options;if("string"==typeof b||b.req){var i={};if(!b.req[0].service&&b.req[0].bex_codes&&(b.req[0].service="P9999999"),0==h.onBeforeLoad.call(a,i))return;var j=function(a){try{var b=a[0][0];b&&c(b)}catch(d){alert(d)}},k={url:"string"==typeof b?b:h.url,dataType:"xml",async:!0,responseType:"xml",func:j,error:function(){h.onLoadError.apply(a,arguments)},req:b.req||[]};(h.req&&h.req.length>0||h.url||"string"==typeof b)&&ajaxRequest(k)}else c(b)}}function nameInArray(a,b){if(!a)return!1;for(var c=0,d=b.length;d>c;c++)if(b[c]==a)return!0;return!1}function clear(a){if($("input,select,textarea",a).each(function(){var a=this.type,b=this.tagName.toLowerCase();if("text"==a||"hidden"==a||"password"==a||"textarea"==b)this.value="";else if("file"==a){var c=$(this);c.after(c.clone().val("")),c.remove()}else"checkbox"==a||"radio"==a?this.checked=!1:"select"==b&&(this.selectedIndex=-1)}),$("input,textarea",a).each(function(){$(this).removeAttr("title")}),$.fn.uploadify){$(".uploadify-queue",a).html("");var b=$("div.uploadify",a);$(a).find("input[name="+b.attr("name")+"]").val("")}if($.fn.password){var c=$("div.hideInput",a);c.removeAttr("kui-options"),c.hide()}$.fn.combo&&$(".combo-f",a).combo("clear"),$.fn.combobox&&$(".combobox-f",a).combobox("clear"),$.fn.combotree&&$(".combotree-f",a).combotree("clear"),$.fn.selecttree&&$(".selecttree-f",a).selecttree("clear"),$.fn.combogrid&&$(".combogrid-f",a).combogrid("clear"),$.fn.obviousbox&&$(".obviousbox-f",a).obviousbox("reset"),$.fn.numberbox&&$(".kui-numberbox",a).numberbox("reset"),$.fn.password&&$(".password-f",a).password("clear"),$(a).find(".validatebox-invalid").each(function(){$(this).removeClass("validatebox-invalid")})}function setDisabled(a,b,c,d,e){function f(a,b){if(!a)return!1;for(var c=0,d=b.length;d>c;c++)if(b[c]==a)return!0;return!1}var g=$.isArray(b)?!1:!0,h=$(a);h.find("input,textarea").each(function(){var a=$(this);(g||f(a.attr("name"),b))&&(a.hasClass("combo-value")&&d?a.parent().prev().combo(d,e):a.hasClass("validatebox-text")&&a.validatebox(c,e))})}function reset(a){a.reset();var b=$(a);if($("input,textarea",a).each(function(){$(this).removeAttr("title")}),$.fn.combo&&b.find(".combo-f").each(function(){$(this).combo("reset")}),$.fn.combotree&&b.find(".combotree-f").combotree("reset"),$.fn.selecttree&&b.find(".selecttree-f").selecttree("reset"),$.fn.combogrid&&b.find(".combogrid-f").combogrid("reset"),$.fn.spinner&&b.find(".spinner-f").spinner("reset"),$.fn.timespinner&&b.find(".timespinner-f").timespinner("reset"),$.fn.numberbox&&b.find(".kui-numberbox").numberbox("reset"),$.fn.numberspinner&&b.find(".numberspinner-f").numberspinner("reset"),$.fn.obviousbox&&b.find(".obviousbox-f").obviousbox("reset"),$.fn.password){var c=$("div.hideInput",a);c.removeAttr("kui-options"),c.hide()}$(a).find(".validatebox-invalid").each(function(){$(this).removeClass("validatebox-invalid")})}function setForm(a){var b=$.data(a,"form").options,c=$(a);c.unbind(".form").bind("submit.form",function(){return setTimeout(function(){ajaxSubmit(a,b)
},0),!1})}function validate(a){var b=$(a),c=!0;return b.find(".validatebox-text:not(:disabled)").each(function(){return c=$(this).validatebox("isValid")}),c}function addMask(a){var b=$.data(a,"form").options;if(b.loadingMask){$div=$(a).closest("div.panel"),$(a).hide();var c=$('<div class="datagrid-mask"></div>');c.css({display:"block",opacity:"1",background:"#fff",height:$div.height(),width:$div.width(),top:30}),c.appendTo($div);var d=$('<div class="datagrid-mask-msg" style="display:block"></div>').html("正在处理,请稍候...").appendTo($div);d.css("left",($div.width()-d.outerWidth())/2)}}function removeMask(a){var b=$.data(a,"form").options;b.loadingMask&&($(a).show(),$div=$(a).closest("div.panel"),$div.children("div.datagrid-mask-msg").remove(),$div.children("div.datagrid-mask").remove())}function createForm(target){function createCols(a){for(var b=[],c=[],d=['<style type="text/css" rel="stylesheet">'],e=["<div class='form-box form-"+formId+"'>"],f=[],g=0;g<a.length;g++){var h=a[g];h.hidden||"3"==h.edit_flag?b.push(h):c.push(h)}for(var i=0;i<b.length;i++){var j=b[i],k={field:j.field,value:j.dft_val,hidden:!0,record:record,col:j};k.value=record&&record[j.field]?$.trim(record[j.field]):j.defaultValue||j.dft_val,j.editor.options&&(k=$.extend({},k,j.editor.options)),uioptions[k.field]=k,f.push('<input type="hidden" name="'+k.field+'" class="kui-textinput"/>')}for(var l={},m={},n={},o=[],p=opts.colNumbers?Number(opts.colNumbers):2,q=1,r=0,s=c.length;s>r;r++){var t=c[r],u={field:t.field,col:t},v="form-group-inline",w="",x="",y="textinput",z="",A=0;if(inputStyle="style='#width##height#'",t.editor&&t.editor.options&&(u=$.extend(u,t.editor.options)),t.editor&&t.editor.type&&(y="text"===t.editor.type?"textinput":t.editor.type),opts.lsKey&&(y.indexOf("combo")>-1||y.indexOf("datebox")>-1)&&(u.width=u.width||"102"),inputStyle=u.width&&"autocomplete"!=y?inputStyle.replace(/#width#/g,"width:"+u.width+"px;"):inputStyle.replace(/#width#/g,""),inputStyle=u.height&&"autocomplete"!=y?inputStyle.replace(/#height#/g,"height:"+u.height+"px;"):inputStyle.replace(/#height#/g,""),u.data&&u.data.length>0&&(u.valueField=u.valueField||"dict_val",u.textField=u.textField||"dict_des"),t.edit_flag&&("2"==t.edit_flag||"1"==t.edit_flag&&opts.modify||"4"==t.edit_flag&&!opts.modify)&&(u.disabled=!0),u.record=record,u.value=record&&record[u.field]?$.trim(record[u.field]).replace(/&quot;/g,'"')||u.defaultValue:u.defaultValue,opts.autoColNumber){var B=getCharLength(t.title);x="form-auto-label-"+formId,l[x]?l[x].push(B):l[x]=[B]}else{var C=q%p;C=0==C?p:C;var D=1;t.colspan?(A=Math.floor(Number(t.colspan)/2),D=A>p?p:A,q+=D,C+D-1>p&&(C=1)):q++,w="group-"+formId+"-"+C+"-"+D,o.push(w),x="form-fixed-label-"+formId+"-"+C;var E=(t.labelWidth?Number(t.labelWidth):getCharLength(t.title))+20;E=76>E?76:E,n[x]?n[x].push(E):n[x]=[E];var F=u.width&&1==D?Number(u.width):134;m[C]?m[C].push(E+F):m[C]=[E+F]}if(uioptions[t.field]=u,"textarea"===y)z="<textarea name='"+t.field+"' class='kui-"+y+" form-input' "+inputStyle+"></textarea>";else if("notice"===y)z="<span name='"+t.field+"' class='form-notice' style='color:red;'>"+u.value+"</span>";else if("password"===y)z="<input name='"+t.field+"' type='"+(t.inputType||t.editor.options.inputType||"password")+"' class='kui-"+y+" form-input' "+inputStyle+"></input>";else if("twriceText"===y)z="<input name='"+t.field+"' type='text' class='kui-password form-input' "+inputStyle+"></input>";else{if("obviousbox"===y){z="<input name='"+t.field+"' type='"+(t.inputType||"input")+"' class='kui-"+y+" form-input' "+inputStyle+"></input>",e.push("<div >"+z+"</div>");continue}z="<input name='"+t.field+"' type='"+(t.inputType||"input")+"' class='kui-"+y+" form-input' "+inputStyle+"></input>"}e.push("<div class='"+v+" "+w+"'>"),e.push("<span class='form-label "+x+"'>"+t.title+"：</span>"),e.push(z),e.push("</div>")}if(e.push("</div>"),0==c.length&&(e=[]),!$.isEmptyObject(l))for(var G in l)l[G].sort(function(a,b){return b>a?1:-1}),d.push("."+G+"{width:"+(l[G][0]+22)+"px;}");if(!$.isEmptyObject(n)){for(var G in n){var H=n[G]||[];H.sort(function(a,b){return b>a?1:-1}),d.push("."+G+"{width:"+H[0]+"px;}")}var I=12,J=0,K={};for(var G in m){var L=m[G]||[];L.sort(function(a,b){return b>a?1:-1}),K[G]=L[0]+I,J+=L[0]+I}if(d.push(".form-"+formId+"{width:"+J+"px;}"),o.length>0){var M="";o=o.sort();for(var i=0;i<o.length;i++)if(M!=o[i]){M=o[i];for(var N=o[i].split("-"),O=Number(N[2]),P=Number(N[3]),Q=0,R=O;P+O>R;R++)Q+=K[R]||0;d.push("."+o[i]+"{width:"+Q+"px;}")}}}return d.push("</style>"),d.concat(e).concat(f)}function getCharLength(a){var b=0;if(!a||""==a)return b;for(i=0;i<a.length;i++)b+=a.charCodeAt(i)>256?14:a.charCodeAt(i)<65?7:9;return b}function mathRandom(a){for(var b="",c=0;a>c;c++)b+=Math.floor(10*Math.random());return b}var opts=$.data(target,"form").options,isFormVisible;if(opts.queryCols){opts.queryCols=eval(opts.queryCols),opts.col=eval(opts.col),opts.toolbar=eval(opts.toolbar);var formWidth=$(target).width()||$(target).parent().width()||$(target).parents(".datagrid:first").width(),record=opts.record;opts.originalData=record;var requiredGrp=opts.requiredGrp||"",targetDiv=target,uioptions={},formId=mathRandom(5),formDom=[];opts.col&&opts.col.length>0&&(formDom=createCols(opts.col,target));for(var k=0;k<opts.queryCols.length;k++){var queryCols=opts.queryCols[k];formDom=createCols(queryCols.cols,$(target))}if(requiredGrp)for(var i=0;i<requiredGrp.length;i++)for(var grpNames=requiredGrp[i],arr=grpNames.split(","),j=0;j<arr.length;j++){var editor=$(target).find(":input[name='"+arr[j]+"']");editor.addClass("validatebox-grp-"+i),0==editor.next("span[class='validatebox-must']").length&&editor.after("<span class='validatebox-grp-must'>*</span>")}isFormVisible="none"!=$(target).css("display")||"hidden"!=$(target).css("visibility"),isFormVisible&&$(target).hide(),$(target).append(formDom.join(""));for(var $buttons,i=0;i<opts.toolbar.length;i++){var btn=opts.toolbar[i];0===i&&($buttons=$("<div class='form-buttons'></div>").appendTo($(target)));var btn=opts.toolbar[i],btnOpts=$.extend({},btn,{plain:!0}),$button=$("<a href='javascript:void(0)' class='kui-linkbutton' kui-options='"+JSON.stringify(btnOpts)+"'>"+btn.text+"</a>");$button=$button.appendTo($buttons);try{eval(btn.handler)}catch(e){return alert("请定义"+btn.handler+"函数"),!1}$button.bind("click",{target:$(target),handler:eval(btn.handler),req:[opts.service]},function(a){return $(a.target).closest("a.l-btn").hasClass("l-btn-disabled")?!1:void a.data.handler(a)})}addMask(target),$.data(target,"uioptions",uioptions),setTimeout(function(){$.parser.director($(target)).done(function(){$.isFunction(opts.onInitSuccess)&&(isFormVisible&&$(target).show(),opts.onInitSuccess.call(target)),removeMask(target)})}),record&&opts.onLoadSuccess.call(target,record)}}function hideColsWindow(a,b){var c=$(a),d=$.data(a,"form").options;if(d&&d.isHideCols&&d.queryCols&&d.queryCols[0]&&(d.allColsHide||!d.allColsHide&&!c.is(":hidden"))){var e=d.queryCols[0].cols,f=[];f.push('<div class="hide_columns"><div style="line-height:20px;height:20px;"><a name="selectAll" style="margin:0 5px;" href="javascript:void(0)">全选</a><a href="javascript:void(0)" style="margin:0 5px;">全不选</a><a href="javascript:void(0)" style="margin:0 5px;">反选</a></div><div style="height:160px;overflow:auto;margin-bottom:10px;"><ul style="list-style:none;margin:0;padding:0;">');for(var g=0,h=e.length;h>g;g++)"true"!=String(e[g].hidden)&&(f.push('<li><input type="checkbox"'),e[g].hidden&&f.push(' checked="checked"'),e[g].editor.options.required&&f.push(' disabled="disabled"'),f.push("><span>"+e[g].title+"</span></li>"));f.push('</ul></div><a name="confirm" class="kui-linkbutton" style="margin:0 10px 0 10px;">确定</a>'),f.push('<a name="cancel" class="kui-linkbutton">取消</a>'),f.push("</div>");var i=$(f.join("")).window({title:"请选择要隐藏的查询条件",width:200,height:250,modal:!0,minimizable:!1,maximizable:!1,collapsible:!1});i.find("a[name=selectAll]").click(function(){i.find("ul input").each(function(){this.checked=!this.disabled})}).next().click(function(){i.find("ul input").each(function(){this.checked=!1})}).next().click(function(){i.find("ul input").each(function(){this.checked=!this.disabled&&!this.checked})}),i.find("a[name=confirm]").linkbutton({}).click(function(){var c=[];i.find("input:checked").each(function(a,b){c.push($(b).parent().index())}),hideCols(a,c),i.window("close"),b&&b()}),i.find("a[name=cancel]").linkbutton({}).linkbutton({}).click(function(){i.window("close")}),i.window("open")}else alert("没有可供隐藏的搜索条件！")}function hideCols(a,b){if(a&&$.isArray(b)){$(a).show();var c=$.data(a,"form").options;if(c&&c.queryCols&&c.queryCols[0]){for(var d=c.queryCols[0].cols,e=[],f=[],g=0,h=d.length;h>g;g++)"true"!=String(d[g].hidden)?(d[g].hidden=0,f.push(d[g])):e.push(d[g]);for(var g=0,h=b.length;h>g;g++){var i=b[g];"true"!=String(f[i].hidden)&&(f[i].hidden=1)}for(var j=0;j<e.length;j++)f.push(e[j]);var k=$(a),l=k.find("div.form-group-inline:has(a.l-btn):contains(查询)");l[0]&&($queryBtn=l.clone(!0)),k.empty(),createForm(a),k.find("div.form-group-inline:last").after($queryBtn),$.ls(c.lsKey,b)}}}function restoreDefault(a){var b=$.data(a,"form").options;$.ls(b.lsKey,null)}$.fn.form=function(a,b){return"string"==typeof a?$.fn.form.methods[a](this,b):(a=a||{},this.each(function(){a=a||{};var b=$.data(this,"form");b?$.extend(b.options,a):b=$.data(this,"form",{options:$.extend({},$.extend({},$.fn.form.defaults),$.fn.form.parseOptions(this),a)});var c=b.options;if(c&&c.isHideCols&&c.queryCols&&c.queryCols[0]){for(var d=c.queryCols[0].cols,e=0,f=0,g=d.length;g>f;f++)"true"!=String(d[f].hidden)&&e++;var h=$.ls(c.lsKey);if(h&&h.length==e)return hideCols(this,h),$.ls(c.lsKey,h),$(this).hide(),void(c.allColsHide=!0);createForm(this)}else createForm(this);setForm(this),a.req&&a.request&&"true"==String(a.request)&&load(this,a)}))},$.fn.form.parseOptions=function(target){var jq=$(target);return $.extend({},$.parser.parseOptions(target,[{colNumbers:"number"}],{queryCols:jq.attr("queryCols")?eval(jq.attr("queryCols")):void 0,toolbar:jq.attr("toolbar")?eval(jq.attr("toolbar")):void 0,req:jq.attr("req")?eval(jq.attr("req")):void 0}))},$.fn.form.methods={submit:function(a,b){return a.each(function(){ajaxSubmit(this,$.extend({},$.fn.form.defaults,b||{}))})},submitBex:function(a,b){return a.each(function(){ajaxSubmit(this,$.extend({},$.fn.form.defaults,b||{}))})},load:function(a,b){return a.each(function(){load(this,b)})},clear:function(a){return a.each(function(){clear(this)})},reset:function(a){return a.each(function(){reset(this)})},validate:function(a){return validate(a[0])},getData:function(a,b){return getData(a[0],b)},hideColsWindow:function(a,b){hideColsWindow(a[0],b)},restoreDefault:function(a){restoreDefault(a[0])},disable:function(a,b){return a.each(function(){setDisabled(this,b,"disabled","disable")})},enable:function(a,b){return a.each(function(){setDisabled(this,b,"enabled","enable")})},clearFields:function(a,b){return a.each(function(){setDisabled(this,b,"clear","clear")})},addRequired:function(a,b){return a.each(function(){setDisabled(this,b,"changeRequired","changeRequired",!0)})},delRequired:function(a,b){return a.each(function(){setDisabled(this,b,"changeRequired","changeRequired",!1)})},hideFields:function(a,b){return a.each(function(){setDisplay(this,b,!1)})},showFields:function(a,b){return a.each(function(){setDisplay(this,b,!0)})}},$.fn.form.defaults={url:null,req:[],queryCols:[],toolbar:[],colNumbers:3,originalData:void 0,onSubmit:function(){return $(this).form("validate")},requiredGrp:[],tipMessage:["输入条件不能同时为空"],isHideCols:!1,autoColNumber:!1,validateOnLoad:!1,loadingMask:!1,success:function(){},onInitSuccess:$.noop,onBeforeLoad:function(){},onLoadSuccess:function(){},onLoadError:function(){}};var $queryBtn=null}),define("lib/kui/sform",[],function(require,exports,module){function create(a){$(a).addClass("kui-sform");var b=$.data(a,"sform").options,c=b.queryCols;if(c&&0!=c.length){{$(a).width()||$(a).parent().width()}b.$ul=$("<ul></ul>").appendTo(a),b.fontSize=parseInt(b.$ul.css("font-size"))||12,cols=c[0].cols;for(var d,e=[],f=b.maxLabel,g=0,h=0,i=cols.length;i>h;h++)d=cols[h],g=_getStrWidth(d.title+"：",b),g>f&&(f=g),e.push('<li name="'+(d.field||"")+'"><span>'+(d.title||"")+"：</span><b></b></li>");e.push('<div style="clear:both;"></div>'),b.maxLabel=f,b.$ul.html(e),b.required?reload(a):b.data?load(a,b.data):setSize(a),b.onInitSuccess.call(a)}}function _getStrWidth(a,b){var c=a.match(/[\x00-\xFF]/g);return a.length*(b.fontSize+1)-(c?c.length*(b.fontSize/2+1):0)}function setSize(a,b){var c=$.data(a,"sform").options;$.extend(c,b);var d=c.$ul;d.find("li").width(c.cellWidth).find("span").width(c.maxLabel);var e,f=c.cellWidth,g=c.maxLabel,h=f-g;d.find("li b").each(function(){e=_getStrWidth($(this).text(),c),e>h&&$(this).parent().width(parseInt((e+g+f)/f)*f)})}function reload(a){var b=$.data(a,"sform").options,c=b.req;$.isArray(c)&&c.length&&b.onBeforeRequest.call(a,c)!==!1?ajaxRequest({type:b.method,url:b.url,dataType:b.dataType,req:c,func:function(b){b[0].data[0].length&&load(a,b[0].data[0][0])},error:function(){setSize(a),b.onRequestError.call(a)}}):b.data&&b.onBeforeLoadData.call(a,b.data)!==!1?load(a,data):setSize(a)}function load(target,data){if(data){var opts=$.data(target,"sform").options;opts.data=$.extend(opts.data,data);var cols=opts.queryCols[0].cols,col,name,value,type,dicts;opts.$ul.find("li").each(function(i){name=$(this).attr("name"),value=data[name],void 0!=value&&(col=cols[i],type=col.type,col.formatter&&("string"==typeof col.formatter&&(col.formatter=eval("("+col.formatter+")")),$.isFunction(col.formatter)&&(value=col.formatter.call(this,value,null,name,col))),_views[type]&&(value=_views[type](col.editor,value)),$(this).find("b").html(value))}),setSize(target),opts.onLoadSuccess.call(target,data)}}function getData(a){var b=$.data(a,"sform").options;return b.data}function clear(a){var b=$.data(a,"sform").options;b.$ul.find("li b").text("")}function toForm(a){var b=$.data(a,"sform").options;$(a).empty().form(b)}$.fn.sform=function(a,b){return"string"==typeof a?$.fn.sform.methods[a](this,b):(a=a||{},this.each(function(){$.data(this,"sform")||(a=$.data(this,"sform",{options:$.extend({},$.extend({},$.fn.sform.defaults),$.fn.sform.parseOptions(this),a)})),create(this)}))},$.fn.sform.parseOptions=function(target){var jq=$(target);return $.extend({},$.parser.parseOptions(target,[{colNumbers:"number"}],{queryCols:jq.attr("queryCols")?eval(jq.attr("queryCols")):void 0,toolbar:jq.attr("toolbar")?eval(jq.attr("toolbar")):void 0,req:jq.attr("req")?eval(jq.attr("req")):void 0}))},$.fn.sform.methods={load:function(a,b){return a.each(function(){load(this,b)})},getData:function(a){return getData(a[0])},clear:function(a){return a.each(function(){clear(this)})},reload:function(a){return a.each(function(){reload(this)})},toForm:function(a){return a.each(function(){toForm(this)})}},$.fn.sform.defaults={url:void 0,method:void 0,dataType:void 0,req:[],queryCols:[],colNumbers:3,required:!1,maxLabel:0,cellWidth:248,onInitSuccess:function(){},onLoadSuccess:function(){},onBeforeRequest:function(){},onBeforeLoadData:function(){},onRequestError:function(){}};var _views={combobox:function(a,b){var c=a.options.valueField||"dict_val",d=a.options.textField||"dict_des";if(a&&a.options&&a.options.data){var e=a.options.data;if(a.options.multiple){var f;f=b.split(-1!=b.indexOf(",")?",":"");for(var g=[],h=0,i=f.length;i>h;h++)for(var j=0,k=e.length;k>j;j++)if(f[h]==e[j][c]){var l=e[j][d]||"";g.push(l.trim());break}if(g.length>0)return g.join(",")}else for(var h=0,i=e.length;i>h;h++)if(e[h][c]==b){var l=(2===d.split(/,/g).length?e[h][d.split(/,/g)[0]]+"-"+e[h][d.split(/,/g)[1]]:e[h][d])||"";return l.trim()}}return b},timespinner:function(a,b){for(var c=[];b=b.replace(/(.{2}$)|(^.$)/,function(a){return c.unshift(a),""}););return c.join(":")}}}),define("lib/kui/datagrid",[],function(require,exports,module){function contain(a,b){for(var c=0,d=a.length;d>c;c++)if("[object Object]"===Object.prototype.toString.call(a[c])){var e=!0;for(var f in b){var g=b[f]+"",h=a[c][f]+"";if(g=g&&g.match(/^(-?\d+)(\.\d+)?$/)?Number(g):g,h=h&&h.match(/^(-?\d+)(\.\d+)?$/)?Number(h):h,g&&g!=h){e=!1;break}}if(e)return c}else if(a[c]==b)return c;return-1}function remove(a,b,c){if("string"==typeof b){for(var d=0,e=a.length;e>d;d++)if(a[d]&&a[d][b]==c)return void a.splice(d,1)}else{var f=contain(a,b);-1!=f&&a.splice(f,1)}}function setSize(a,b){var c=$.data(a,"datagrid"),d=c.dc,e=$.data(a,"datagrid").options,f=$.data(a,"datagrid").panel;if(b&&(b.width&&(e.width=b.width),b.height&&(e.height=b.height)),1==e.fit){var g=f.panel("panel").parent();e.width=g.width(),e.height=g.height()}f.panel("resize",{width:e.width,height:e.height}),d.body2.triggerHandler("scroll")}function resize(a){var b=$.data(a,"datagrid").options,c=$.data(a,"datagrid").dc,d=$.data(a,"datagrid").panel,e=d.width(),f=d.outerHeight(),g=c.view,h=c.view1,i=c.view2,j=h.children("div.datagrid-header"),k=i.children("div.datagrid-header"),l=j.find("table"),m=k.find("table");g.width(e-2);var n=j.children("div.datagrid-header-inner").show();h.width(n.find("table").width()),b.showHeader||n.hide(),i.width(e-h.outerWidth()),h.children("div.datagrid-header,div.datagrid-body,div.datagrid-footer,div.datagrid-toolbar").width(h.width()),i.children("div.datagrid-header,div.datagrid-body,div.datagrid-footer,div.datagrid-toolbar").width(i.width()),j.css("height",""),k.css("height",""),l.css("height",""),m.css("height","");var o=Math.max(l.height(),m.height());l.height(o),m.height(o),j.add(k)._outerHeight(o);var p=h.children("div.datagrid-toolbar"),q=i.children("div.datagrid-toolbar");q.children().length>0&&p.add(q)._outerHeight(o);var r=i.children("div.datagrid-footer"),s=r.find("div.datagrid-footer-inner").children();if(r.height(0==s.length?0:s.height()),"auto"!=b.height){var t=f,u=i.children("div.datagrid-header").outerHeight(!0),v=i.children("div.datagrid-footer").outerHeight(!0),w=d.children("div.datagrid-row-detail:visible").outerHeight(!0),x=d.find(">div.datagrid-queryForm").outerHeight(!0),y=d.children("div.datagrid-toolbar");toolbarHeight=y.outerHeight(!0),$.isNumeric(u)&&(t-=u),$.isNumeric(v)&&(t-=v),$.isNumeric(toolbarHeight)&&y.children().length>0&&(t-=toolbarHeight),$.isNumeric(x)&&(t-=x),$.isNumeric(w)&&(t-=w),d.children("div.datagrid-pager").each(function(){$.isNumeric($(this).outerHeight(!0))&&(t-=$(this).outerHeight(!0))}),h.children("div.datagrid-body").height(t),i.children("div.datagrid-body").height(t)}g.height(i.height()-1),i.css("left",h.outerWidth());var z=i.children("div.datagrid-header").find(".datagrid-htable").width(),A=c.body1.find(">table>tbody>tr:visible"),B=i.children("div.datagrid-body");A.length||B.find(".fullWidth").length||B.append("<div class='fullWidth' style='width:"+z+"px;height:22px'></div>"),A.length&&B.find(".fullWidth").remove()}function fixRowHeight(a,b,c){function d(a,b){for(var c=0;c<b.length;c++){var d=$(a[c]),e=$(b[c]);d.css("height",""),e.css("height","");var f=Math.max(d.height(),e.height());d.css("height",f),e.css("height",f)}}var e=($.data(a,"datagrid").data.rows,$.data(a,"datagrid").options),f=$.data(a,"datagrid").dc;if(!f.body1.is(":empty")&&(!e.nowrap||e.autoRowHeight||c))if(void 0!=b){var g=e.finder.getTr(a,b,"body",1),h=e.finder.getTr(a,b,"body",2);d(g,h)}else{var g=e.finder.getTr(a,0,"allbody",1),h=e.finder.getTr(a,0,"allbody",2);d(g,h)}if(resize(a),"auto"==e.height){var i=f.body1.parent(),j=f.body2,k=0,l=0;j.children().each(function(){var a=$(this);a.is(":visible")&&(k+=a.outerHeight(),l<a.outerWidth()&&(l=a.outerWidth()))}),l>j.width()&&(k+=18),i.height(k),j.height(k),f.view.height(f.view2.height())}f.body2.triggerHandler("scroll")}function autoSizeColumn(a,b){function c(b){function c(c){var e=0;return d.finder.getTr(a,0,c).find('td[field="'+b+'"] div.datagrid-cell').each(function(){var a=$(this).outerWidth();a>e&&(e=a)}),e}var f=e.view.find('div.datagrid-header td[field="'+b+'"] div.datagrid-cell');f.css("width","");var g=$(a).datagrid("getColumnOption",b);g.width=void 0,g.boxWidth=void 0,g.auto=!0,$(a).datagrid("fixColumnSize",b);var h=Math.max(f.outerWidth(),c("allbody"),c("allfooter"));f._outerWidth(h+1),g.width=h,g.boxWidth=parseInt(f[0].style.width),$(a).datagrid("fixColumnSize",b),d.onResizeColumn.call(a,b,g.width)}var d=$.data(a,"datagrid").options,e=$.data(a,"datagrid").dc;if(b)c(b),d.fitColumns&&(resize(a),fitColumns(a));else{for(var f=!1,g=getColumnFields(a,!0).concat(getColumnFields(a,!1)),h=0;h<g.length;h++){var b=g[h],i=getColumnOption(a,b);i&&i.auto&&!i.listHidden&&(c(b),f=!0)}f&&d.fitColumns&&(resize(a),fitColumns(a))}}function fixColumnSize(a,b){function c(b){var c=getColumnOption(a,b);if(c&&!c.checkbox)for(var e=d.view.children("style")[0],f=e.styleSheet?e.styleSheet:e.sheet||document.styleSheets[document.styleSheets.length-1],g=f.cssRules||f.rules,h=0,i=g.length;i>h;h++){var j=g[h];if(c.cellSelector&&j.selectorText&&j.selectorText.toLowerCase()==c.cellSelector.toLowerCase()){j.style.width=c.boxWidth?c.boxWidth+"px":"auto";break}}}var d=($.data(a,"datagrid").options,$.data(a,"datagrid").dc),e=d.view.find("table.datagrid-btable,table.datagrid-ftable");if(e.css("table-layout","fixed"),b)c(b);else for(var f=getColumnFields(a,!0).concat(getColumnFields(a,!1)),g=0;g<f.length;g++)c(f[g]);e.css("table-layout","auto"),merge(a),setTimeout(function(){fixRowHeight(a),resizeEditor(a)},0)}function merge(a){var b=$.data(a,"datagrid").dc;b.body1.add(b.body2).find("td.datagrid-td-merged").each(function(){for(var b=$(this),c=b.attr("colspan")||1,d=getColumnOption(a,b.attr("field")).width,e=1;c>e;e++)b=b.next(),d+=getColumnOption(a,b.attr("field")).width+1;$(this).children("div.datagrid-cell")._outerWidth(d)})}function fitColumns(a){function b(a,b){a.width+=b,a.boxWidth+=b,g.find('td[field="'+a.field+'"] div.datagrid-cell').width(a.boxWidth)}function c(a){return a.hidden||a.checkbox||a.auto?void 0:!0}var d=$.data(a,"datagrid").options,e=$.data(a,"datagrid").dc;if(d.fitColumns){for(var f,g=e.view2.children("div.datagrid-header"),h=0,i=getColumnFields(a,!1),j=0;j<i.length;j++){var k=getColumnOption(a,i[j]);c(k)&&(h+=k.width,f=k)}var l=g.children("div.datagrid-header-inner").show(),m=g.width()-g.find("table").width()-d.scrollbarSize,n=m/h;d.showHeader||l.hide();for(var j=0;j<i.length;j++){var k=getColumnOption(a,i[j]);if(c(k)){var o=Math.floor(k.width*n);b(k,o),m-=o}}m&&f&&b(f,m),fixColumnSize(a)}}function clean(a){$(a).datagrid("loadData",{});var b=$.data(a,"datagrid");b.options.editing=void 0,b.updatedRows=[],b.insertedRows=[],b.deletedRows=[]}function wrapGrid(target,rownumbers){function getColumnOptions(){var frozenColumns=[],columns=[];return $(target).children("thead").each(function(){var opt=$.parser.parseOptions(this,[{frozen:"boolean"}]);$(this).find("tr").each(function(){var cols=[];$(this).find("th").each(function(){var th=$(this),col=$.extend({},$.parser.parseOptions(this,["field","align",{sortable:"boolean",checkbox:"boolean",resizable:"boolean"},{rowspan:"number",colspan:"number",width:"number"}]),{title:th.html()||th.attr("title")||void 0,hidden:th.attr("hidden")?!0:void 0,formatter:th.attr("formatter")?eval(th.attr("formatter")):void 0,styler:th.attr("styler")?eval(th.attr("styler")):void 0});if(col.align||(col.align="left"),th.attr("editor")){var editor=$.trim(th.attr("editor"));col.editor="{"==editor.substr(0,1)?eval("("+editor+")"):editor}cols.push(col)}),opt.frozen?frozenColumns.push(cols):columns.push(cols)})}),[frozenColumns,columns]}var container=['<div class="datagrid-wrap">','<div class="datagrid-queryForm"></div>','<div class="datagrid-view">','<div class="datagrid-view1">','<div class="datagrid-header">','<div class="datagrid-header-inner"></div>',"</div>",'<div class="datagrid-body">','<div class="datagrid-body-inner"></div>',"</div>",'<div class="datagrid-footer">','<div class="datagrid-footer-inner"></div>',"</div>","</div>",'<div class="datagrid-view2">','<div class="datagrid-header">','<div class="datagrid-header-inner"></div>',"</div>",'<div class="datagrid-body"></div>','<div class="datagrid-footer">','<div class="datagrid-footer-inner"></div>',"</div>","</div>","</div>","</div>"],grid=$(container.join("")).insertAfter(target);grid.panel({doSize:!1}),grid.panel("panel").addClass("datagrid").bind("_resize",function(a,b){var c=$.data(target,"datagrid").options;return(1==c.fit||b)&&(setSize(target),setTimeout(function(){$.data(target,"datagrid")&&fixColumnSize(target)},0)),!1}),$(target).hide().appendTo(grid.children("div.datagrid-view"));var columns=getColumnOptions(),view=grid.children("div.datagrid-view"),queryForm=grid.children("div.datagrid-queryForm"),view1=view.children("div.datagrid-view1"),view2=view.children("div.datagrid-view2");return{panel:grid,frozenColumns:columns[0],columns:columns[1],dc:{view:view,view1:view1,view2:view2,queryForm:queryForm,header1:view1.children("div.datagrid-header").children("div.datagrid-header-inner"),header2:view2.children("div.datagrid-header").children("div.datagrid-header-inner"),body1:view1.children("div.datagrid-body").children("div.datagrid-body-inner"),body2:view2.children("div.datagrid-body"),footer1:view1.children("div.datagrid-footer").children("div.datagrid-footer-inner"),footer2:view2.children("div.datagrid-footer").children("div.datagrid-footer-inner")}}}function resizeEditor(a){{var b=$.data(a,"datagrid").dc;$.data(a,"datagrid").options}b.view.find("div.datagrid-editable").each(function(){var b=$(this),c=b.parent().attr("field"),d=$(a).datagrid("getColumnOption",c);b._outerWidth(d.boxWidth+8);var e=$.data(this,"datagrid.editor");e.actions?e.actions.resize&&e.actions.resize(e.target,b.width()):e.type&&e.filter&&$(e.filter,e.target)[e.type]("resize",b.width())})}function getColumnOption(a,b){function c(a){if(a)for(var c=0;c<a.length;c++)for(var d=a[c],e=0;e<d.length;e++){var f=d[e];if(f.field==b)return f}return null}var d=$.data(a,"datagrid").options,e=c(d.columns);return e||(e=c(d.frozenColumns)),e}function getData(a,b,c){var d={total:0,rows:[]},e=getColumnFields(a,!0).concat(getColumnFields(a,!1));if(b){var f=$(a).find("tbody tr:eq("+b+")");if(c)$("td:eq("+c+")",f).html();else{d=[];for(var g={},h=0;h<e.length;h++)g[e[h]]=$("td:eq("+h+")",f).html();d.push(g)}}else $(a).find("tbody tr").each(function(){d.total++;for(var a={},b=0;b<e.length;b++)a[e[b]]=$("td:eq("+b+")",this).html();d.rows.push(a)});return d}function create(target){function createColumnHeader(a,b,c){var d="undifend";if(d=c?b.frozenColumns:b.columns){$(a).show(),$(a).empty();var e=new Array;e.push('<table class="datagrid-htable" border="0" cellspacing="0" cellpadding="0">'),e.push("<tbody>");for(var f=0;f<d.length;f++){e.push('<tr class="datagrid-header-row">');for(var g=d[f],h=0;h<g.length;h++){var i=g[h];g&&"notice"!==i.type&&(null==i.grid_header_filter&&(i.grid_header_filter=!1),e.push("<td"),i.rowspan&&e.push(' rowspan="'+i.rowspan+'"'),i.colspan&&e.push(' colspan="'+i.colspan+'"'),(i.hidden||i.listHidden)&&e.push(' style="display:none"'),i.checkbox?(i.field=i.field||"checkbox"+$.expando,e.push(' field="'+i.field+'">'),e.push('<div class="datagrid-header-check"><input type="checkbox"/'+(b.enableCheckAll?"":"disabled='true'")+' class="header-check-input"></div>')):i.field?(i.width=Math.max(parseInt(i.width),titleLen(i.title)),e.push(' field="'+i.field+'">'),e.push('<div class="datagrid-cell" style="float:left;text-align:'+(i.align||"left")+";"+(i.width?"width:"+i.width+"px;":"")+'"'),e.push(0==i.resizable?' resizable="false">':">"),i.width?i.boxWidth=i.width:i.auto=!0,i.cellClass="datagrid-cell-c"+datagridId+"-"+i.field.replace(".","-"),i.cellSelector="div."+i.cellClass,e.push('<div class="datagrid-title">'+(i.title?i.title:"")+"</div>"),b.rowEdit&&(e.push('<div class="edit-nullalbe-div">'),e.push(i.edt_required?'<div class="nullable-div">*</div>':'<div class="nullable-div"></div>'),""!=i.edit_flag&&"undefined"!=typeof i.edit_flag&&"0"==i.edit_flag&&e.push('<div class="edit-div edit-icon"></div>'),e.push("</div>")),i.sortable&&"true"==i.sortable.toString()&&e.push('<span class="datagrid-sort-icon"></span>'),("combobox"==i.type||"combotree"==i.type)&&i.editor&&i.editor.options.data&&0!=i.grid_header_filter?e.push('<span class="datagrid-match-icon" title="选择"></span>'):0!=i.grid_header_filter&&e.push('<span class="datagrid-filter-icon" title="筛选"></span>'),e.push("</div>")):(e.push(">"),e.push('<div class="datagrid-cell-group">'+i.title+"</div>")),e.push("</td>"))}e.push("</tr>"),e.push("</tbody></table>")}var j=$(e.join(""));if(a.append(j),c&&(b.rownumbers||b.subrow)){var k=$(b.rownumbers?'<td rowspan="'+b.frozenColumns.length+'"><div class="datagrid-header-rownumber"></div></td>':'<td rowspan="1"><div class="datagrid-header-subrow"></div></td>');0==$("tr",j).length?k.wrap('<tr class="datagrid-header-row"></tr>').parent().appendTo($("tbody",j)):k.prependTo($("tr:first",j))}}}function titleLen(a){a=a||"";var b=a.match(/[\x00-\xFF]/g);return 13*a.length-(b?7*b.length:0)}function CreateCellClass(){dc.view.children("style").remove();for(var a=['<style type="text/css" rel="stylesheet">'],b=getColumnFields(target,!0).concat(getColumnFields(target)),c=0;c<b.length;c++){var d=getColumnOption(target,b[c]);d&&!d.checkbox&&(d.boxWidth=$("td[field='"+d.field+"']",dc.header2).children().outerWidth()-8,d.boxWidth<0&&(d.boxWidth=$("td[field='"+d.field+"']",dc.header1).children().outerWidth()-8),a.push(d.cellSelector+"{ width:"+d.boxWidth+"px;}"))}a.push("</style>"),$(a.join("\n")).prependTo(dc.view)}var state=$.data(target,"datagrid"),opts=state.options,dc=state.dc,panel=state.panel;if(panel.panel($.extend({},opts,{id:null,doSize:!0,onResize:function(a,b){setTimeout(function(){$.data(target,"datagrid")&&(resize(target),opts.fitColumns&&fitColumns(target),opts.onResize.call(panel,a,b))},0)},onExpand:function(){fixRowHeight(target),opts.onExpand.call(panel)}})),1==opts.allowMove&&panel.panel("panel").draggable({handle:".panel-header"}),state.rowIdPrefix="datagrid-row-r"+ ++datagridId,createColumnHeader(dc.header1,opts,!0),createColumnHeader(dc.header2,opts,!1),CreateCellClass(),dc.header1.add(dc.header2).css("display",opts.showHeader?"block":"none"),opts.toolbar)if("string"==typeof opts.toolbar)$(opts.toolbar).addClass("datagrid-toolbar").insertAfter("bottom"===opts.toolbarAlign?dc.view:dc.queryForm),$(opts.toolbar).show();else{$("div.datagrid-toolbar",panel).remove();for(var tb=$('<div class="datagrid-toolbar"></div>').insertAfter("bottom"===opts.toolbarAlign?dc.view:dc.queryForm),i=0;i<opts.toolbar.length;i++){var btn=opts.toolbar[i];if("true"!=String(btn.hidden))if("-"==btn)$('<div class="datagrid-btn-separator"></div>').appendTo(tb);else{var a=$("<a></a>"),b=a.appendTo(tb).linkbutton($.extend({plain:!0},btn)),iconCls=btn.iconCls,cls=void 0,event=void 0,handler=void 0;iconCls&&(cls=opts.toolbarHandler[iconCls.split("-").length>1?iconCls.split("-")[1]:"dft"]),opts.rowEdit&&!btn.handler?event=cls?cls.editHandler:opts.toolbarHandler.dft.editHandler:(handler=eval(btn.handler),event=cls?cls.clbHandler:opts.toolbarHandler.dft.clbHandler);var hideDetail=function(){var a=dc.view.next(".datagrid-row-detail");dc.view.height(dc.view[0].clientHeight+(a.length?a[0].scrollHeight:0)),a.hide(),resize(target)};btn.float1&&a.css("float",btn.float1),b.bind("click",{target:$(target),req:btn.req,title:btn.title,handler:handler,w:btn.width,h:btn.height,view:btn.view,options:btn,callback:function(a){return $(a.target).closest("a.l-btn").hasClass("l-btn-disabled")?!1:void a.data.handler(a)}},event)}}}if(opts.queryCols&&opts.queryCols.length>0){if(dc.queryForm.find("form").length>=1)return!1;var form=$("<form/>");panel.panel("panel").children().eq(0).before(form),dc.queryForm.append(form);var colNumbers=2;opts.colNumbers&&(colNumbers=opts.colNumbers),form.form({onInitSuccess:function(){opts.colNumbers=opts.autoColNumber&&dc.queryForm.is(":visible")?parseInt(dc.queryForm.width()/dc.queryForm.find(".form-group-inline:first").width()):opts.colNumbers,createQueryMoreBtn(target),opts.isFormCollapsable&&createFormCollapseBtn(target),$.extend(opts.queryParams,form.form("getData")),$.isFunction(opts.onQueryFormInitSuccess)&&opts.onQueryFormInitSuccess.call(this),opts.required||request(target),setSize(target)
},queryCols:opts.queryCols,colNumbers:colNumbers,autoColNumber:opts.autoColNumber,isHideCols:opts.isHideCols,lsKey:opts.lsKey+"form"});var $form=form.find("div.form-box"),$formGrp=$("<div class='form-group-inline'></div>").appendTo($form);$formGrp.append($("<span></span>").attr("class",$formGrp.prev().find(".form-label").attr("class")));var $button=$("<a></a>").appendTo($formGrp.find(".form-label"));$button.linkbutton($.extend({},{plain:!0,iconCls:opts.queryBtnIco,text:opts.queryBtnTxt})),$button.click(function(a){if($button.hasClass("l-btn-disabled")||!form.form("validate"))return!1;opts.pageNumber=1;var b=form.form("getData",!0);opts.onClickQueryButtonBefore&&$.extend(b,opts.onClickQueryButtonBefore.call(target,b,form)),opts.onQueryButtonClick?($.extend(opts.queryParams,b),opts.onQueryButtonClick.call(target,b,form)):($(target).datagrid("reload",b),opts.clearOnQuery&&$(target).datagrid("clearSelections"),opts.isTreeGrid&&$(target).treegrid("reload",0,b)),a.preventDefault()})}else dc.queryForm.hide(),dc.queryForm.height(0);if($("div.datagrid-pager",panel).remove(),opts.pagination){var pager=$('<div class="datagrid-pager"></div>');if("bottom"==opts.pagePosition)pager.appendTo(panel);else if("top"==opts.pagePosition)pager.addClass("datagrid-pager-top").prependTo(panel);else{var ptop=$('<div class="datagrid-pager datagrid-pager-top"></div>').prependTo(panel);pager.appendTo(panel),pager=pager.add(ptop)}var dButtons=[];if(opts.showRowDetail&&(dButtons=[{text:'<input id="'+opts.id+'_show_detail" name="datagrid_detail_button" type="checkbox" '+(opts.isShowDetail?'checked="true"':"")+' style="vertical-align:middle;cursor:pointer;"/><label for="'+opts.id+'_show_detail" style="vertical-align:middle;cursor:pointer;padding: 1px 0 1px 1px;">显示详细</label>',handler:function(a){var b=$(this).find("input").attr("checked"),c=dc.view.nextAll(".datagrid-row-detail");b?(opts.isShowDetail=!0,showDblClickRowDetail(target,dc.view2.find("tr.datagrid-row-selected"))):c.length>0&&(dc.view.height(dc.view[0].clientHeight+c[0].scrollHeight),c.hide(),resize(target),opts.isShowDetail=!1),a.stopPropagation()}}]),opts.fallParas[0].dbPagination){var prevButton={text:'<span id="dbpPrevBtn" style="cursor:pointer;display: none;">上一页</span>',handler:function(){var a=$(this);$(this).find("span.l-btn-left").is(":hidden")||($(this).hide(),dbpRequire(target,a))}},nextButton={text:'<span id="dbpNextBtn" style="cursor:pointer;display: inline-block;">下一页</span>',handler:function(){var a=$(this);$(this).find("span.l-btn-left").is(":hidden")||($(this).hide(),dbpRequire(target,a))}};dButtons.push(prevButton),dButtons.push(nextButton)}if(opts.fallParas[0].enable&&opts.fallParas[0].backAllBtn){var backAllButton={text:'<span style="cursor:pointer;margin: 2px 0 0 0;display: inline-block;">查看全部</span>',handler:function(){onFileExport(target,"print",void 0,"txt",!0)}};dButtons.push(backAllButton)}if(opts.fallParas[0].enable&&opts.fallParas[0].nextPageBtn){var nextButton={text:'<span style="cursor:pointer;display: inline-block;">下一页</span>',handler:function(){var a=$(this);$(this).find("span.l-btn-left").is(":hidden")||($(this).hide(),request(target,null,!0,function(){a.show()}))}};dButtons.push(nextButton)}if(opts.showStatistics){var btnStatistics={text:'<input id="'+opts.id+'_show_statistics" name="datagrid_statistics_button" type="checkbox" '+(opts.isShowStatistics?'checked="true"':"")+' style="vertical-align:middle;cursor:pointer;" /><label for="'+opts.id+'_show_statistics" style="vertical-align:middle;cursor:pointer;padding: 1px 0 1px 1px;">显示统计</label>',handler:function(a){var b=$(this).find("input").attr("checked");"INPUT"==a.target.tagName&&(b?(opts.isShowStatistics=!0,$(target).statistics("showPanel")):($(target).statistics("hidePanel"),opts.isShowStatistics=!1)),a.stopPropagation()}};dButtons.push(btnStatistics)}pager.pagination({pageNumber:opts.pageNumber,pageSize:opts.pageSize,pageList:opts.pageList,showTime:opts.showTime,buttons:dButtons.length>0?dButtons:void 0,onSelectPage:function(a,b){opts.pageNumber=a,opts.pageSize=b,pager.pagination("refresh",{pageNumber:a,pageSize:b}),request(target)},gridMenu:opts.gridMenu,exportTypes:opts.exportTypes,importTypes:opts.importTypes,onHideColumns:function(){onHideColumns(target)},onHideCols:function(){onHideCols(target)},onFreezeColumns:function(){onFreezeColumns(target)},onRestoreDefault:function(){onRestoreDefault(target)},onFileExport:function(a){onFileExport(target,a)},onFileImport:function(){onFileImport(target)},fallParas:opts.fallParas,showPageList:opts.pagerShowPageList,showRefresh:opts.pagerShowRefresh,pageNavigate:opts.pagerPageNavigate,isShowDetail:opts.isShowDetail})}}function createQueryMoreBtn(a){var b=$(a),c=b.data("datagrid"),d=c.options,e=c.dc,f=$("<div class='datagrid-query'><div title='更多查询条件' class='datagrid-queryMoreBtn datagrid-queryOpenBtn'></div></div>"),g=f.find(".datagrid-queryMoreBtn"),h=0;if($.each(d.queryCols[0].cols,function(a,b){!b.hidden&&h++}),!(Math.ceil(h/d.colNumbers)<=d.limitQueryLine)){f.appendTo(e.queryForm.find("div.form-box .form-group-inline:last .form-label").addClass("showMoreQueryButton"));var i=d.limitQueryLine*d.colNumbers-2;e.queryForm.find(".form-group-inline:gt("+i+")").filter(function(){return!$(this).find("a.l-btn").length}).hide(),g.click(function(){if(g.hasClass("datagrid-queryHideBtn")){g.attr("title","更多查询条件").removeClass("datagrid-queryHideBtn").addClass("datagrid-queryOpenBtn");var b=d.limitQueryLine*d.colNumbers-2;e.queryForm.find(".form-group-inline:gt("+b+")").filter(function(){return!$(this).find("a.l-btn").length}).hide()}else e.queryForm.find(".form-group-inline").show(),g.attr("title","收起查询条件").removeClass("datagrid-queryOpenBtn").addClass("datagrid-queryHideBtn");resize(a)})}}function createFormCollapseBtn(a){var b=$(a),c=b.data("datagrid"),d=c.options,e=c.dc,f=e.queryForm.find("form"),g=$("<div class='form-collapse-wrap'><div class='collapse-btn close' title='隐藏查询条件'></div></div>").appendTo(e.queryForm),h=g.find(".collapse-btn");h.click(function(){var b=h.hasClass("close");b&&f.data("height",f.outerHeight(!0)),f.animate({height:b?0:f.data("height")},50,function(){b?h.removeClass("close").addClass("open").attr("title","显示查询条件"):h.removeClass("open").addClass("close").attr("title","隐藏查询条件"),!b&&f.css("height",""),resize(a)})}),setTimeout(function(){d.isFormCollapsed&&h.click()}),resize(a)}function paginatonBtn(a,b){var c=$(a).datagrid("getPager"),d=b.HEAD.MSG_TEXT.split(",");c.pagination("options").dbpNum=parseInt(d[1]),$("#dbpPrevBtn").parent().parent().parent().css({display:"inline-block"}),$("#dbpPrevBtn").css({display:"inline-block"}),$("#dbpNextBtn").parent().parent().parent().css({display:"inline-block"}),"1"==c.pagination("options").dbpNum&&$("#dbpPrevBtn").parent().parent().parent().css({display:"none"}),"1"==d[0]&&$("#dbpNextBtn").parent().parent().parent().css({display:"none"})}function getColumnFields(a,b){function c(a){for(var b=[],c=0,d=0;d<e[a].length;d++){var g=e[a][d];g.field&&b.push([c,g.field]),c+=parseInt(g.colspan||"1")}for(var d=0;d<b.length;d++){var h=b[d];f[h[0]]=h[1]}}var d=$.data(a,"datagrid").options,e=1==b?d.frozenColumns||[[]]:d.columns;if(0==e.length)return[];for(var f=[],g=0;g<e.length;g++)c(g);return f}function saveOriginalRows(a){for(var b=$.data(a,"datagrid").data,c=b.rows,d=[],e=0;e<c.length;e++)d.push($.extend({},c[e]));$.data(a,"datagrid").originalRows=d,$.data(a,"datagrid").updatedRows=[],$.data(a,"datagrid").insertedRows=[],$.data(a,"datagrid").deletedRows=[]}function addEvent(a,b,c){if(!c||!a||!b)return!1;var d=b+".datagrid";return a.unbind(d).bind(d,c),a}function getEventTargets(a,b){var c,d=$.data(a,"datagrid"),e=d.options,f=$(b.target),g=f.closest("tr.datagrid-row"),h=f.text();c=g.attr("datagrid-row-index")?parseInt(g.attr("datagrid-row-index")):g.attr("node-id");var i=e.finder.getRow(a,c),j=f.closest("td[field]",g),k=j.attr("field");return{cell:f,tr:g,row:$.extend({},i),index:c,field:k,value:h}}function _bodyEventHandler(a,b,c){var d=$.data(c,"datagrid"),e=d.options,f=d.dc,g=getEventTargets(c,a);switch(b){case"contextmenu":e.onRowContextMenu.call(c,a,g.index,g.row),a.stopPropagation();break;case"click":if(!g.index&&0!=g.index)return;if(e.showRowDetail){var h=d.panel,i=$("input[name='datagrid_detail_button']",h).attr("checked");e.isShowDetail&&i&&showDblClickRowDetail(c,g.tr)}if(g.cell.parent().hasClass("datagrid-cell-check"))e.singleSelect&&e.selectOnCheck?(e.checkOnSelect||uncheckAll(c,!0),checkRow(c,g.index)):g.cell.is(":checked")?checkRow(c,g.index):uncheckRow(c,g.index);else if(g.cell.parent().hasClass("datagrid-cell-subrow")){if(g.cell.hasClass("datagrid-row-expand")){g.cell.removeClass("datagrid-row-expand").addClass("datagrid-row-collapse");var j=getSubRow(c,g.index,1),k=getSubRow(c,g.index,2);if(k&&k.length>0)j.add(k).show();else{var l=$.data(c,"datagrid").options.view;l.insertSubRow.call(l,c,g.index,g.row),e.onExpandRow.call(c,g.index,g.row)}}else{g.cell.removeClass("datagrid-row-collapse").addClass("datagrid-row-expand");var j=getSubRow(c,g.index,1),k=getSubRow(c,g.index,2);k&&k.length>0&&j.add(k).hide(),e.onCollapseRow.call(c,g.index,g.row)}selectRow(c,g.index)}else g.field&&e.onClickCell.call(c,g.index,g.field,g.row[g.field]),1==e.singleSelect?selectRow(c,g.index):g.tr.hasClass("datagrid-row-selected")?unselectRow(c,g.index):selectRow(c,g.index),e.rowEdit&&("undefined"==typeof e.editing?(beginEdit(c,g.index),e.editing=g.index):e.editing!=g.index&&validateRow(c,e.editing)&&(endEdit(c,e.editing),beginEdit(c,g.index),e.editing=g.index)),e.onClickRow.call(c,g.index,g.row,a);a.stopPropagation();break;case"dblclick":g.field&&e.onDblClickCell.call(c,g.index,g.field,g.row[g.field]),e.onDblClickRow.call(c,g.index,g.row,a),a.stopPropagation();break;case"scroll":if(f.view1.children("div.datagrid-body").scrollTop(f.body2.scrollTop()),f.view2.children("div.datagrid-header,div.datagrid-footer").scrollLeft($(f.body2).scrollLeft()),!e.requesting&&e.fallParas[0].enable&&!e.fallParas[0].last&&e.reportParams){e.trHeight||(e.trHeight=f.body2.find("tr:first").height());var m=0,n=f.body2.scrollTop();if(d.data.total>e.maxRows&&(m=d.data.total-e.maxRows),(d.data.total-m)*e.trHeight<=f.body2.height()+n+10){if(e.fallParas&&e.fallParas[0]&&e.fallParas[0].nextPageBtn)return;if(e.fallParas[0].dbPagination)return;request(c,null,!0)}}break;case"mouseover":if(!g.tr)return;g.tr.addClass("datagrid-row-over"),a.stopPropagation();break;case"mouseout":if(!g.tr)return;g.tr.removeClass("datagrid-row-over"),a.stopPropagation()}}function _checkAllSelect(a,b){var c=a.view1.find("[type=checkbox]"),d=0;if(c.length||(c=a.view2.find("[type=checkbox]")),b>=0&&$(c[0]).hasClass("header-check-input")){for(var e=1,f=c.length;f>e;e++)$(c[e]).prop("checked")&&d++;$(c[0]).prop("checked",d===c.length-1)}}function _bindBodyEvent(a,b,c){addEvent(b,c,function(b){_bodyEventHandler(b,c,a)})}function bindEvents(target){var state=$.data(target,"datagrid"),panel=state.panel,opts=state.options,dc=state.dc,header=dc.header1.add(dc.header2),$headCell=$("td:has(div.datagrid-cell)",header);addEvent($headCell,"mouseenter",function(){state.resizing||$(this).addClass("datagrid-header-over")}),addEvent($headCell,"mouseleave",function(){$(this).removeClass("datagrid-header-over")}),addEvent($headCell,"contextmenu",function(a){var b=$(this).attr("field");opts.onHeaderContextMenu.call(target,a,b)});var $headCheckbox=$("input[type=checkbox]",header);addEvent($headCheckbox,"click",function(a){return opts.singleSelect&&opts.selectOnCheck?!1:($(this).is(":checked")?checkAll(target):uncheckAll(target),void a.stopPropagation())});var $headerCell=$("div.datagrid-cell",header);addEvent($headerCell,"click",function(e){if($(e.target).hasClass("datagrid-match-icon")){var field=$(this).parent().attr("field"),col=getColumnOption(target,field);if("combotree"==col.type)var nodeNameArray=col.nodeName?col.nodeName.split(","):col.editor.options.nodeName.split(","),nodeName=1===nodeNameArray.length?nodeNameArray[0]:nodeNameArray[1];else if(col.editor.options.req)var textNameArray=col.editor.options.textField.split(","),textName=1===textNameArray.length?textNameArray[0]:textNameArray[1];var selectItem="combotree"==col.type?{textField:col.nodeName||col.editor.options.nodeName,valueField:col.nodeId||col.editor.options.nodeId}:col.editor.options.req?{textField:col.editor.options.textField,valueField:col.editor.options.valueField}:{textField:"dict_val,dict_des",valueField:"dict_val"},showField="combotree"==col.type?{textField:nodeName,valueField:col.nodeId||col.editor.options.nodeId}:col.editor.options.req?{textField:textName,valueField:col.editor.options.valueField}:{textField:"dict_des",valueField:"dict_val"},tempData=[];if(col.editor.options.orgFilter&&"string"==typeof col.editor.options.orgFilter){var f=eval(col.editor.options.orgFilter);col.editor.options.data=f(col.editor.options.data)}else col.editor.options.data=$.grep(col.editor.options.data,function(a,b){for(var c={textField:a[showField.valueField]+"-"+a[showField.textField],valueField:a[showField.valueField],dict_org:a.dict_org},d=tempData.length,b=0;d>b&&(c.textField!=tempData[b].textField||c.valueField!=tempData[b].valueField||a.dict_org!=tempData[b].dict_org);b++);return b==d?(tempData.push(c),!0):void 0});var selectedText=$(this).closest("td").attr("filter"),selectedValue=$.grep(col.editor.options.data,function(a){return a[showField.valueField]+"-"+a[showField.textField]==selectedText});selectedValue=selectedValue.length>0?selectedValue[0][showField.valueField]:"";var options=$.extend({},col.editor.options,{editable:col.filterable?col.filterable:!1,required:!1,multiple:!1,isClear:!1,showDictValue:!1,width:col.width,panelHeight:col.editor.options.data.length>9?220:void 0,value:selectedValue,onSelect:function(){var a=$(this).next().find(">input:first").val(),b=a.indexOf("-")+1,c=a.substr(b);$(this).next().find(">input:first").val(c),c&&"请选择"!=c?$(this).closest("td").addClass("filtered").attr("filter",c):$(this).closest("td").removeClass("filtered").attr("filter",""),headFilter(target)}},selectItem,{extItems:""}),needExtItem=!0;if(needExtItem){var oItem={};oItem[showField.valueField]="",oItem[showField.textField]="请选择",options.data.unshift(oItem)}$("<div><input></div>").prependTo(this).click(function(){return!1}).find("input").combobox($.extend({},options,{onHidePanel:function(){var a=$(this).next().find(">input:first").val();a&&"请选择"!=a?$(this).closest("td").addClass("filtered").attr("filter",a):$(this).closest("td").removeClass("filtered"),$(this).parent().remove()}})).next().children("input").focus(),needExtItem&&options.data.splice(0,1)}else if($(e.target).hasClass("datagrid-filter-icon")){var field=$(this).parent().attr("field"),col=getColumnOption(target,field),options={onBlur:function(){var a=$(this),b=$.trim(a.val());""!=b?$(this).closest("td").addClass("filtered").attr("filter",b):$(this).closest("td").removeClass("filtered").attr("filter",""),a.parent().remove(),headFilter(target)}};$('<div><input style="width:'+col.width+'px;"></div>').prependTo(this).click(function(){return!1}).find("input").focus().textinput(options).val($(e.target).closest("td").attr("filter")).keydown(function(a){return a.stopPropagation(),13==a.which?!1:void 0})}else if(e.pageX<$(this).offset().left+$(this).outerWidth()-5){var field=$(this).parent().attr("field"),col=getColumnOption(target,field);if(!col.sortable||"false"==col.sortable.toString()||state.resizing)return;opts.sortName=field,opts.sortOrder="asc";var className="datagrid-sort-asc";if($(this).hasClass(className)&&(className="datagrid-sort-desc",opts.sortOrder="desc"),$headerCell.removeClass("datagrid-sort-asc datagrid-sort-desc"),$(this).addClass(className),opts.remoteSort)request(target);else{var data=$.data(target,"datagrid").data;loadData(target,data,0)}opts.onSortColumn.call(target,opts.sortName,opts.sortOrder)}}),addEvent($headerCell,"dblclick",function(a){if(a.pageX>$(this).offset().left+$(this).outerWidth()-5){var b=$(this).parent().attr("field"),c=getColumnOption(target,b);if(0==c.resizable)return;$(target).datagrid("autoSizeColumn",b),c.auto=!1}}),$headerCell.each(function(){$(this).resizable({handles:"e",disabled:$(this).attr("resizable")?"false"==$(this).attr("resizable"):!1,minWidth:25,onStartResize:function(a){state.resizing=!0,header.css("cursor","e-resize"),state.proxy||(state.proxy=$('<div class="datagrid-resize-proxy"></div>').appendTo(dc.view)),state.proxy.css({left:a.pageX-$(panel).offset().left-1,display:"none"}),setTimeout(function(){state.proxy&&state.proxy.show()},500)},onResize:function(a){return state.proxy.css({left:a.pageX-$(panel).offset().left-1,display:"block"}),!1},onStopResize:function(){header.css("cursor","");var a=$(this).parent().attr("field"),b=getColumnOption(target,a);b.width=$(this).outerWidth(),b.boxWidth=parseInt(this.style.width),b.auto=void 0,fixColumnSize(target,a),dc.view2.children("div.datagrid-header").scrollLeft(dc.body2.scrollLeft()),state.proxy.remove(),state.proxy=null,$(this).parents("div:first.datagrid-header").parent().hasClass("datagrid-view1")&&resize(target),fitColumns(target);for(var c=[],d=getOriginalColumns(target),e=0,f=d.length;f>e;e++)c.push(parseInt(d[e].boxWidth));$.ls(opts.lsKey+"_width",c),opts.onResizeColumn.call(target,a,b.width),setTimeout(function(){state.resizing=!1},0)}})});var bodys=dc.body1.add(dc.body2);_bindBodyEvent(target,bodys,"mouseover"),_bindBodyEvent(target,bodys,"mouseout"),_bindBodyEvent(target,bodys,"click"),_bindBodyEvent(target,bodys,"dblclick"),_bindBodyEvent(target,bodys,"contextmenu"),_bindBodyEvent(target,bodys,"scroll")}function showDblClickRowDetail(a,b){var c=$.data(a,"datagrid"),d=c.options,e=c.dc;if(d.isShowDetail){if(b[0]){var f=b[0].id;f=f.replace(/\d-\d*$/,function(a){return a.replace(/^\d/,function(a){return"1"==a?"2":"1"})});var g=b.add("#"+f);b=g}var h=e.view.nextAll(".datagrid-row-detail");h.length>0?(h.is(":hidden")&&(d.detailTrsLen=0),h.remove()):d.detailTrsLen=0;for(var i=$.extend([],$(a).datagrid("getOriginalColumns",!1)),j=0,k=i.length;k>j;j++)(/ hide/.test(i[j].cellClass)||i[j].hidden||i[j].listHidden)&&(i.splice(j,1),j--,k--);if(d.showDetailCols&&d.showDetailCols.length>0)for(var j=0;j<i.length;j++)-1==d.showDetailCols.indexOf(i[j].field)&&(i.splice(j,1),j--);for(var l=120,m=i.length,n=0,o=parseInt(e.view[0].style.width)-16,p=['<div class="datagrid-row-detail"><table width="95%"><tbody>'],q=0,j=0;m>j;j++)if("true"!=String(i[j].hidden)&&"操作"!=String(i[j].title)&&"notice"!=i[j].type){0==n&&(p.push("<tr>"),q++);var r=b&&b.length>0?b.find("td[field="+i[j].field+"]").children().text():"";r=r.replace(/(^\s*)|(\s*$)/g,"");var s=caculateCharLength(r);s=120,r=r.replace(/\"/g,"&quot"),r=r.replace(/</g,"&lt"),r=r.replace(/>/g,"&gt");var t=1;if(s>120){var u=Math.round(s/120);t=u>1&&u%2==0?u-1:u}else s=Math.max(120,s),t=1;var v=l+120*t+5;v>o-n?(p.push("</tr>"),p.push("<tr>"),q++,n=v):n+=v;var w=i[j].title;_.isUndefined(w)||(w=w.length>8?w.substring(0,8)+"...":i[j].title,p.push("<td class='datagrid-detail-label'><div style=\"width:"+l+'px;overflow:hidden;white-space:nowrap;word-wrap:normal;" title="'+i[j].title+'">'+w+"</div></td>"),p.push('<td nowrap colspan="'+t+'"><div id="detail_'+i[j].field+'" class=\'datagrid-detail-value\' style="width:120px;overflow:hidden;white-space:nowrap;text-overflow: ellipsis;word-wrap:normal;" title="'+r+'">'+r+"</div></td>"))}p.push("</tbody></table></div>");var x="auto"==d.rowDetailHeight?26*q+2:d.rowDetailHeight;h=$(p.join("")).height(x),h=$(p.join("")).height(d.rowDetailHeight);var y=e.view.nextAll(".datagrid-row-statistics");h.insertAfter(y.length>0?y:e.view),q!=d.detailTrsLen&&(d.detailTrsLen=q,resize(a))}}function showStatisticsRow(a){var b=$.data(a,"datagrid"),c=b.data.rows,d=b.options;if(!d.showStatistics)return!1;var e=d.columns[0],f=d.frozenColumns[0],g=e.concat(f);$(a).statistics({columns:g,rows:c,dc:b.dc,stsDescFieldIndex:d.stsDescFieldIndex,view:d.view,statisticsTexts:d.statisticsTexts,fields:$(a).datagrid("getColumnFields",!1),onLoaded:function(){resize(a)}}),d.isShowStatistics||$(a).statistics("hidePanel")}function caculateCharLength(a){a+="";var b=0;if(!a||""==a)return b;for(i=0;i<a.length;i++)b+=a.charCodeAt(i)>256?14:a.charCodeAt(i)<65?8:9;return b}function selectRow(target,index,check,boolTrigger){var state=$.data(target,"datagrid"),dc=state.dc,opts=state.options,data=state.data,grid=$.data(target,"datagrid"),selectedRows=grid.selectedRows;if(opts.singleSelect&&(opts.selectOnCheck&&uncheckRow(target,grid.singleSelectIndex,!1),selectedRows.splice(0,selectedRows.length)),!check&&opts.checkOnSelect&&checkRow(target,index,!0,boolTrigger),grid.singleSelectIndex=index,opts.idField){var row=opts.finder.getRow(target,index);!function(){for(var a=0;a<selectedRows.length;a++)if(row&&selectedRows[a]&&selectedRows[a][opts.idField]==row[opts.idField])return;selectedRows.push(row)}()}var tr=opts.finder.getTr(target,index).addClass("datagrid-row-selected");if(tr.length){var height=0,tr_top=0,body2=dc.body2;$.data(target,"datagrid-header-outerHeight")||$.data(target,"datagrid-header-outerHeight",dc.view2.children("div.datagrid-header").outerHeight()),$.data(target,"row-selected_top")||$.data(target,"row-selected_top",tr.position().top),height=$.data(target,"datagrid-header-outerHeight"),tr_top=$.data(target,"row-selected_top")}!opts.singleSelect&&!opts.checkOnSelect&&_checkAllSelect(dc,index),"string"==typeof opts.onSelect&&(opts.onSelect=eval(opts.onSelect)),!1!==boolTrigger&&opts.onSelect.call(target,index,data.rows[index])}function unselectRow(a,b,c){var d=$.data(a,"datagrid"),e=d.dc,f=d.options,g=(d.data,$.data(a,"datagrid").selectedRows);!c&&f.checkOnSelect&&uncheckRow(a,b,!0),f.finder.getTr(a,b).removeClass("datagrid-row-selected");var h=f.finder.getRow(a,b);f.idField&&h&&remove(g,f.idField,h[f.idField]),!f.singleSelect&&!f.checkOnSelect&&_checkAllSelect(e,b),f.onUnselect.call(a,b,h)}function selectAll(a,b){var c=$.data(a,"datagrid"),d=c.options,e=c.data.rows,f=$.data(a,"datagrid").selectedRows;if(!b&&d.checkOnSelect&&checkAll(a,!0),d.finder.getTr(a,"","allbody").addClass("datagrid-row-selected"),d.idField)for(var g=0;g<e.length;g++)!function(){for(var a=e[g],b=0;b<f.length;b++)if(f[b][d.idField]==a[d.idField])return;f.push(a)}();d.onSelectAll.call(a,e)}function unselectAll(a,b){var c=$.data(a,"datagrid"),d=c.options,e=c.data.rows,f=$.data(a,"datagrid").selectedRows;if(!b&&d.checkOnSelect&&uncheckAll(a,!0),d.finder.getTr(a,"","selected").removeClass("datagrid-row-selected"),d.idField)for(var g=0;g<e.length;g++)remove(f,d.idField,e[g][d.idField]);d.onUnselectAll.call(a,f)}function checkRow(a,b,c,d){var e=$.data(a,"datagrid"),f=e.dc,g=e.options,h=e.data,i=h.rows[b]?h.rows[b]:h.rows[b-(g.pageNumber-1)*g.pageSize];!c&&g.selectOnCheck&&selectRow(a,b,!0);var j=g.finder.getTr(a,b).find("div.datagrid-cell-check input[type=checkbox]");$.fn.prop?j.prop("checked",!0):j.attr("checked",!0),!g.singleSelect&&_checkAllSelect(f,b),!1!==d&&g.onCheck.call(a,b,i,c)}function uncheckRow(a,b,c,d){var e=$.data(a,"datagrid"),f=e.dc,g=e.options,h=e.data,i=h.rows[b]?h.rows[b]:h.rows[b-(g.pageNumber-1)*g.pageSize];!c&&g.selectOnCheck&&unselectRow(a,b,!0);var j=g.finder.getTr(a,b).find("div.datagrid-cell-check input[type=checkbox]");$.fn.prop?j.prop("checked",!1):j.attr("checked",!1),!g.singleSelect&&_checkAllSelect(f,b),!1!==d&&g.onUncheck.call(a,b,i,c)}function checkAll(a,b){var c=$.data(a,"datagrid"),d=c.dc,e=c.options,f=c.data;!b&&e.selectOnCheck&&selectAll(a,!0);var g=e.finder.getTr(a,"","allbody").find("div.datagrid-cell-check input[type=checkbox]");$.fn.prop?g.prop("checked",!0):g.attr("checked",!0),!e.singleSelect&&_checkAllSelect(d,0),e.onCheckAll.call(a,f.rows,b)}function uncheckAll(a,b){var c=$.data(a,"datagrid"),d=c.dc,e=c.options,f=c.data;!b&&e.selectOnCheck&&unselectAll(a,!0);var g=e.finder.getTr(a,"","allbody").find("div.datagrid-cell-check input[type=checkbox]");$.fn.prop?g.prop("checked",!1):g.attr("checked",!1),!e.singleSelect&&_checkAllSelect(d,0),e.onUncheckAll.call(a,f.rows,b)}function beginEdit(a,b){var c=$.data(a,"datagrid").options,d=c.finder.getTr(a,b),e=c.finder.getRow(a,b);d.hasClass("datagrid-row-editing")||0!=c.onBeforeEdit.call(a,b,e)&&(d.addClass("datagrid-row-editing"),createEditor(a,b))}function endEdit(a,b,c){var d=$.data(a,"datagrid").options,e=$.data(a,"datagrid").updatedRows,f=$.data(a,"datagrid").insertedRows,g=d.finder.getTr(a,b),h=d.finder.getRow(a,b);if(g.hasClass("datagrid-row-editing")){if(!c){if(!canEdit(a,b))return;var i=!1,j={};g.find("div.datagrid-editable").each(function(){var b,c=$(this).parent().attr("field"),d=(getColumnOption(a,c),$.data(this,"datagrid.editor"));b=d.actions?d.actions.getValue?d.actions.getValue(d.target):"":$(d.filter,$(this)).data("combo")?$(d.filter,$(this))[d.type]("getValues").join(","):$(d.filter,$(this))[d.type]("getValue"),h[c]!=b&&void 0!=b&&(h[c]=b,i=!0,j[c]=b)}),i&&-1==contain(f,h)&&-1==contain(e,h)&&e.push(h)}g.removeClass("datagrid-row-editing"),destroyEditor(a,b),$(a).datagrid("refreshRow",b),c?d.onCancelEdit.call(a,b,h):d.onAfterEdit.call(a,b,h,j)}}function canEdit(a,b){var c=$.data(a,"datagrid").options.finder.getTr(a,b);if(!c.hasClass("datagrid-row-editing"))return!0;var d=c.find(".validatebox-text");d.validatebox("validate"),d.trigger("mouseleave");var e=c.find(".validatebox-invalid");return 0==e.length}function getEditor(a,b){var c=null,d=$.data(a,"datagrid").options,e=d.finder.getTr(a,b.index);return e.find("div.datagrid-editable").each(function(){var a=$(this).parent().attr("field");a==b.field&&(c=$.data(this,"datagrid.editor"))}),c}function destroyEditor(a,b){var c=$.data(a,"datagrid").options,d=c.finder.getTr(a,b);d.children("td").each(function(){var a=$(this).find("div.datagrid-editable");if(a.length){var b=$.data(a[0],"datagrid.editor");b.actions?b.actions.destroy&&b.actions.destroy(b.target):$(b.filter,a)[b.type]&&$(b.filter,a)[b.type]("destroy"),a.html(b.oldHtml),$.removeData(a[0],"datagrid.editor"),a.removeClass("datagrid-editable"),a.css("width","")}})}function destroyEditorCell(a){if(a.length){var b=$.data(a[0],"datagrid.editor");b.actions.destroy&&b.actions.destroy(b.target),a.html(b.oldHtml),$.removeData(a[0],"datagrid.editor"),a.removeClass("datagrid-editable"),a.css("width","")}}function deleteAllSelections(a,b){var c=[],d=$.data(a,"datagrid").options;d.finder.getTr(a,"","selected",2).each(function(){var a=parseInt($(this).attr("datagrid-row-index"));c.push(a)}),c.sort(function(a,b){return b>a?1:-1}),$.each(c,function(b,c){deleteRow(a,c)}),b!==!1&&loadData(a,$.data(a,"datagrid").data)}function deleteRow(a,b,c){var d=$.data(a,"datagrid").options,e=$.data(a,"datagrid").updatedRows,f=$.data(a,"datagrid").insertedRows,g=d.finder.getTr(a,b);g.remove();var h=d.finder.getRow(a,b);if(!g.hasClass("datagrid-row-editing")){var i=$.data(a,"datagrid").data;return i.rows.splice(b,1),i.total-=1,void d.originalRowsData.splice(b,1)}if(!c){if(!validateRow(a,b))return;var j=!1,k={};g.find("div.datagrid-editable").each(function(){var a=$(this).parent().attr("field"),b=$.data(this,"datagrid.editor"),c=b.actions.getValue(b.target);h[a]!=c&&(h[a]=c,j=!0,k[a]=c)}),j&&-1==contain(f,h)&&-1==contain(e,h)&&e.push(h)}g.removeClass("datagrid-row-editing"),destroyEditor(a,b),$(a).datagrid("refreshRow",b),c?d.onDeleteRow.call(a,b,h):d.onAfterEdit.call(a,b,h,k);for(var i=$.data(a,"datagrid").data,l=$.data(a,"datagrid"),m=b+1;m<i.rows.length;m++){d.finder.getTr(a,m,"body",2).attr("datagrid-row-index",m-1).attr("id",l.rowIdPrefix+"-2-"+(m-1));var n=d.finder.getTr(a,m,"body",1).attr("datagrid-row-index",m-1).attr("id",l.rowIdPrefix+"-1-"+(m-1));d.rownumbers&&n.find("div.datagrid-cell-rownumber").html(m)}i.rows.splice(b,1),i.total-=1}function loadData(a,b,c){var d=$.data(a,"datagrid"),e=d.options,f=d.options.sortOrder,g=d.dc,h=d.selectedRows,i=b.HEAD;return $.data(a,"datagrid").options.fallParas[0].dbPagination&&b.HEAD&&paginatonBtn(a,b),$.when($.isFunction(e.beforeFilter)&&e.beforeFilter.call(a,b)).then(function(b){function j(){function c(a){for(var b=0;b<h.length;b++)if(h[b][e.idField]==a[e.idField])return h[b]=a,!0;return!1}if(e.idField)for(var d=0;d<b.rows.length;d++){var f=b.rows[d];c(f)&&selectRecord(a,f[e.idField])}}b=e.loadFilter.call(a,b,e.pageNumber);var k;if(c===!0)if(k=b.rows,k&&k.length){d.data.total=parseInt(d.data.total)+parseInt(b.total);var l=d.data.rows.length+k.length-e.maxRows;if(d.appendRows=$.extend([],k),l>0)if("desc"!==f)d.data.rows=d.data.rows.concat(k),d.data.rows=d.data.rows.slice(e.maxRows),g.body2.find("tr:lt("+l+")").remove();else{var m=e.maxRows-k.length;d.data.rows=d.data.rows.slice(0,m),g.body2.find("tr:gt("+m+")").remove(),d.data.rows=d.data.rows.concat(k)}else d.data.rows=d.data.rows.concat(k);k.length&&k.length!=e.fallParas[0].cntNum&&(e.fallParas[0].last=!0)}else e.fallParas[0].last=!0;else c===!1||void 0===c?(d.appendRows=$.extend([],b.rows),d.data=b,e.fallParas[0].last=!1,b.rows||(b.rows=[],b.total=0),e.fallParas[0].enable&&b.total!=e.fallParas[0].cntNum&&(e.fallParas[0].last=!0)):0===c&&(d.data=b,k=[],b.rows||(b.rows=[],b.total=0));if(!e.remoteSort){var n=getColumnOption(a,e.sortName);if(n){var o=n.sorter;n.sortType="numberbox"===n.type?"number":n.sortType,n.sortType="datebox"===n.type?"date":n.sortType,o||(o="number"==n.sortType||"date"==n.sortType?function(a,b){var c=a.replace(/-/g,""),d=b.replace(/-/g,"");return c&&d?parseFloat(c)>parseFloat(d)?1:-1:c?1:-1}:function(a,b){return a>b?1:-1}),b.rows&&b.rows.sort(function(a,b){return o(a[e.sortName],b[e.sortName])*("asc"==e.sortOrder?1:-1)})}}var p=g.view2.find("div.datagrid-header-check input[type=checkbox]");if(p&&$.fn.prop?p.prop("checked",!1):p.attr("checked",!1),e.view.onBeforeRender&&e.view.onBeforeRender.call(e.view,a,b.rows),e.view.render.call(e.view,a,g.body1,!0,k),e.view.render.call(e.view,a,g.body2,!1,k),e.view.onAfterRender&&e.view.onAfterRender.call(e.view,a),k&&0!==c)return $.extend(d.data.HEAD,i),loadData(a,d.data,0);clearHeadFilter(a),e.onLoadSuccess.call(a,b);var q=$(a).datagrid("getPager");return q.length&&(q.pagination("refresh",{time:i&&i.RUN_TIMES?i.RUN_TIMES:0,total:d.data.total,pageNumber:e.pageNumber}),q.prev("div.datagrid-row-detail").hide()),fixRowHeight(a),g.body2.triggerHandler("scroll"),j(),$(a).datagrid("autoSizeColumn"),showStatisticsRow(a),b})}function getRowIndex(a,b){var c=$.data(a,"datagrid").options,d=$.data(a,"datagrid").data.rows;if("object"==typeof b)return contain(d,b);for(var e=0;e<d.length;e++)if(d[e][c.idField]==b)return e;return-1}function gridDataValueReplace(a){return"string"!=typeof a?a:(a=a.replace(/</g,"&lt;"),a=a.replace(/>/g,"&gt;"))}function gridDataValueReplaceReverse(a){return"string"!=typeof a?a:(a=a.replace(/&lt;/g,"<"),a=a.replace(/&gt;/g,">"))}function getSelections(a){var b=$.data(a,"datagrid").options,c=$.data(a,"datagrid").data;if(b.idField)return $.data(a,"datagrid").selectedRows;var d=[];return b.finder.getTr(a,"","selected",2).each(function(){var a=parseInt($(this).attr("datagrid-row-index")),b=c.rows[a];for(var e in b)b[e]=gridDataValueReplaceReverse(b[e]);d.push(b)}),d}function getSelectRows(a){var b=$.data(a,"datagrid").options,c=$.data(a,"datagrid").data,d=[];return b.finder.getTr(a,"","selected",2).each(function(){var a=parseInt($(this).attr("datagrid-row-index")),b=c.rows[a];for(var e in b)b[e]=gridDataValueReplaceReverse(b[e]);d.push(b)}),d}function getCheckedRows(a){var b=$.data(a,"datagrid"),c=b.data,d=b.dc,e=[];return d.body2.find("input:checked").each(function(){var a=$(this).closest("tr"),b=parseInt(a.attr("datagrid-row-index")),d=c.rows[b];for(var f in d)d[f]=gridDataValueReplaceReverse(d[f]);e.push(d)}),e}function getUnCheckedRows(a){var b=$.data(a,"datagrid"),c=b.data,d=b.dc,e=[];return d.body2.find("input").not("input:checked").each(function(){var a=$(this).closest("tr"),b=parseInt(a.attr("datagrid-row-index")),d=c.rows[b];for(var f in d)d[f]=gridDataValueReplaceReverse(d[f]);e.push(d)}),e}function selectRecord(a,b){var c=$.data(a,"datagrid").options;if(c.idField){var d=getRowIndex(a,b);d>=0&&selectRow(a,d)}}function getEdtDictText(col,fieldValue,row){if(fieldValue&&("@"==fieldValue||"@"==fieldValue[0])&&1==col.editor.options.atIsAll)return"全部";
var orgCode=col.editor.options.dictOrg?row[col.editor.options.dictOrg]:"",dictData=col.editor.options.data;if(col.editor.options.extItems){var extItems=$.isArray(col.editor.options.extItems)?col.editor.options.extItems:eval("("+col.editor.options.extItems+")");dictData=extItems.concat(dictData)}if(fieldValue=$.trim(fieldValue),fieldValue=gridDataValueReplaceReverse(fieldValue),!dictData)return fieldValue;var dictValue=[],valueField="combotree"==col.editor.type?col.editor.options.nodeId:col.editor.options.valueField,textField="combotree"==col.editor.type?col.editor.options.nodeName:col.editor.options.textField;if(null!=fieldValue&&void 0!=fieldValue&&""!=fieldValue){var sep=",";(col.singleByte||col.editor&&col.editor.options.singleByte)&&(sep="");var dictText=fieldValue.split(sep);dictText=$.grep(dictText,function(a){return" "!=a?!0:void 0});for(var m=0;m<dictText.length;m++){var index=-1;if($.each(dictData,function(a,b){return col.editor&&col.editor.options&&col.editor.options.conf&&"number"===col.editor.options.conf.nodeDataType&&(b[valueField]=Number(b[valueField]).toString()),$.trim(b[valueField])!=dictText[m]||orgCode&&orgCode!=b.dict_org?void 0:void(index=a)}),-1==index)dictValue.push(dictText[m]);else{var text="";if(-1!=textField.indexOf(",")){var textSplit=textField.split(",");text=dictData[index][textSplit[0]]+"-"+dictData[index][textSplit[1]]}else text=dictData[index][textField];dictValue.push(text)}}}return 1==dictValue.length?dictValue[0]:dictValue}function getEdtCacheText(a,b){var c=cache.getData(a.editor.options.cache);if(b=$.trim(b),b=gridDataValueReplaceReverse(b),!c)return b;var d=[],e="combotree"==a.editor.type?a.editor.options.nodeId:a.editor.options.valueField,f="combotree"==a.editor.type?a.editor.options.nodeName:a.editor.options.textField;if(null!=b&&void 0!=b&&""!=b){var g=",";(a.singleByte||a.editor&&a.editor.options.singleByte)&&(g="");var h=b.split(g);h=$.grep(h,function(a){return" "!=a?!0:void 0});for(var i=0;i<h.length;i++){var j=-1;if($.each(c,function(b,c){return a.editor&&a.editor.options&&a.editor.options.conf&&"number"===a.editor.options.conf.nodeDataType&&(c[e]=Number(c[e]).toString()),c[e]==h[i]?void(j=b):void 0}),-1==j)d.push(h[i]);else{var k="";if(-1!=f.indexOf(",")){var l=f.split(",");k=c[j][l[0]]+"-"+c[j][l[1]]}else k=c[j][f];d.push(k)}}}return 1==d.length?d[0]:d}function validateDictText(a,b){var c=a.editor.options.data,d=!1;if(!c)return d;for(var e=0;e<c.length;e++)for(var f=0;f<b.length;f++)c[e][a.editor.options.valueField]==b[f]&&(d=!0);return d}function getEdtDictValue(a,b){for(var c=a.editor.options.data,d=[],e=b.split(","),f=0;f<c.length;f++)for(var g=0;g<e.length;g++)c[f][a.editor.options.textField]==e[g]&&d.push(c[f][a.editor.options.valueField]);return 1==d.length?d[0]:d}function createEditor(target,index){for(var opts=$.data(target,"datagrid").options,tr=opts.finder.getTr(target,index),selectRow=opts.finder.getRow(target,index),insertFlag=!1,insertedRows=$.data(target,"datagrid").insertedRows,i=0;i<insertedRows.length;i++)insertedRows[i]==selectRow&&(insertFlag=!0);var uioptions={};tr.children("td").each(function(){var cell=$(this).find("div.datagrid-cell"),field=$(this).attr("field");if(field){var col=getColumnOption(target,field),editFlag=col.edit_flag;if(insertFlag){if("2"==editFlag)return}else if("1"==editFlag||"2"==editFlag)return;if(col&&col.editor&&opts.onBeforeEditCell.call(target,index,field,selectRow,col)){var type,options={field:field};"string"==typeof col.editor?type=col.editor:(col.editor&&col.editor.options&&(options=$.extend(options,col.editor.options),options.req&&(options.req=eval(options.req))),col.editor&&col.editor.type&&(type="text"===col.editor.type?"textinput":col.editor.type)),options.value=selectRow&&selectRow[field]?$.trim(selectRow[field])||options.defaultValue:options.defaultValue;var editor=opts.editors[type];if("checkbox"!=type){var oldHtml=cell.html();col.edt_dict&&(oldHtml=getEdtDictValue(col,oldHtml));var input="";editor||(uioptions[field]=options,"textarea"==type?input="<textarea name='"+field+"' class='kui-"+type+" form-input'></textarea>":(input="<input type="+("password"===type?type:"text")+" name='"+field+"' class='kui-"+type+"'></input>",type="text"===type?"textinput":type));var width=cell.outerWidth();cell.addClass("datagrid-editable"),cell._outerWidth(width),cell.html('<table border="0" cellspacing="0" cellpadding="1"><tr><td>'+input+"</td></tr></table>"),cell.children("table").attr("align",col.align),cell.children("table").bind("click dblclick contextmenu",function(a){a.stopPropagation()}),cell.find("input").width(width).val(oldHtml);var editOptions={field:field,type:type,oldHtml:oldHtml,filter:"combobox"===type||"combogrid"===type||"combotree"===type||"datebox"===type||"datetimebox"===type?"input[comboname='"+field+"']":"input[name='"+field+"']"};editor?(editOptions.actions=editor,editOptions.target=editor.init(cell.find("td"),options)):editOptions.target=cell.find("td"),$.data(cell[0],"datagrid.editor",editOptions)}}}}),$.data(tr[0],"uioptions",uioptions),$.parser.director(tr).done(function(){fixRowHeight(target,index,!0),resizeEditor(target)})}function validateRow(a,b){var c=$.data(a,"datagrid").options.finder.getTr(a,b);if(!c.hasClass("datagrid-row-editing"))return!0;var d=c.find(".validatebox-text"),e=c.find(".easyui-moneybox");e&&e.val(e.next().val()),d.validatebox("validate"),d.trigger("mouseleave");var f=c.find(".validatebox-invalid");return 0==f.length}function getChanges(a,b){var c=$.data(a,"datagrid").insertedRows,d=$.data(a,"datagrid").deletedRows,e=$.data(a,"datagrid").updatedRows;if(!b){var f=[];return f=f.concat(c),f=f.concat(d),f=f.concat(e)}return"inserted"==b?c:"deleted"==b?d:"updated"==b?e:[]}function insertRow(a,b){var c=b.index,d=b.row,e=$.data(a,"datagrid").options.view,f=$.data(a,"datagrid").insertedRows;e.insertRow.call(e,a,c,d),f.push(d)}function appendRow(a,b){var c=$.data(a,"datagrid").options.view,d=$.data(a,"datagrid").insertedRows,e=$.data(a,"datagrid").options,f={};if(e.columns.length>0)for(var g=e.columns[0].length,h=0;g>h;h++){var i=e.columns[0][h];"undefined"!=typeof i.dft_value?(-1!=i.dft_value.indexOf(",")&&(i.dft_value=i.dft_value.split(",")),f[i.field]=i.dft_value):f[i.field]=""}if(!$.isEmptyObject(b))for(var j in b)for(var k in f)j==k&&(f[k]=b[j]);b=$.extend({},f),c.insertRow.call(c,a,null,b),d.push(b)}function acceptChanges(a){for(var b=$.data(a,"datagrid").data,c=!0,d=0,e=b.rows.length;e>d;d++)validateRow(a,d)||(c=!1);c&&saveOriginalRows(a)}function rejectChanges(a){for(var b=$.data(a,"datagrid").options,c=$.data(a,"datagrid").originalRows,d=$.data(a,"datagrid").insertedRows,e=$.data(a,"datagrid").deletedRows,f=$.data(a,"datagrid").selectedRows,g=$.data(a,"datagrid").data,h=0;h<g.rows.length;h++)deleteRow(a,h,!0);for(var i=[],h=0;h<f.length;h++)i.push(f[h][b.idField]);f.splice(0,f.length),g.total=Number(g.total)+e.length-d.length,g.rows=c,loadData(a,g);for(var h=0;h<i.length;h++)selectRecord(a,i[h]);saveOriginalRows(a)}function request(target,queryParams,addition,reloadCallback){function load(){$(target).datagrid("loading");var a=!1;(opts.req.length>0||opts.url)&&(a=opts.loader.call(target,params,function(a){opts.reportParams=params,opts.searchParam=getSearchParam(target),setTimeout(function(){$(target).datagrid("loaded")},0),loadData(target,a,addition).then(function(a){return 0==a.rows.length&&opts.pageNumber>1?(opts.pageNumber--,opts.requesting=!1,$(target).datagrid("reload"),!1):(setTimeout(function(){saveOriginalRows(target),opts.requesting=!1},0),opts.backAllMode&&!fallParas.last?(opts.requesting=!1,request(target,null,!0),setTimeout(function(){$(target).datagrid("loaded")},0)):opts.backAllMode=!1,void($.isFunction(reloadCallback)&&reloadCallback()))})},function(){setTimeout(function(){$(target).datagrid("loaded")},0),opts.onLoadError.apply(target,arguments),opts.requesting=!1,opts.backAllMode=!1})),0==a&&$(target).datagrid("loaded")}var grid=$.data(target,"datagrid"),opts=grid.options,pager=$(target).datagrid("getPager");if(pager.length){var pagerOptions=pager.pagination("options");pagerOptions.pageNumber=1}if(!opts.fallParas[0].enable||!opts.requesting){opts.requesting=!0;var dc=$.data(target,"datagrid").dc;queryParams&&(opts.queryParams=$.extend(opts.queryParams,queryParams));var params=$.extend({},opts.queryParams);opts.pagination&&$.extend(params,{PAGE_NUM:opts.pageNumber,PAGE_SIZE:opts.pageSize}),opts.sortName&&$.extend(params,{sort:opts.sortName,order:opts.sortOrder});var form=dc.queryForm.find("form");if(!form.form("validate"))return opts.requesting=!1,$.isFunction(reloadCallback)&&reloadCallback(),!1;var p=form.form("getData");params=$.extend({},params,p),$.when($.isFunction(opts.onBeforeLoad)?opts.onBeforeLoad.call(target,params):!0).always(function(){opts.requesting=!1}).then(function(flag){if(flag!==!1){if(opts.req){var req;req="string"==typeof opts.req?eval("("+opts.req+")"):opts.req||{};for(var i=0;i<req.length;i++){var servicesObj=req[i];!req[i].service&&req[i].bex_codes&&(servicesObj.service="P9999999"),params=$.extend(params,servicesObj)}}var data=grid.data;addition&&0===data.rows.length&&(addition=!1);var fallParas=opts.fallParas[0];if(fallParas.enable&&(params[fallParas.recName]=fallParas.recNum+(addition?1*data.total:0),params[fallParas.cntName]=1*fallParas.cntNum,addition&&fallParas.keyField)){var keyArr=fallParas.keyField.split(","),valueArr=[];if(fallParas.valueField)valueArr=fallParas.valueField.split(",");else for(var i=0;i<keyArr.length;i++)valueArr.push("K_"+keyArr[i]);if(keyArr.length!=valueArr.length)return void alert("分页参数配置错误，请检查view配置！");var lastRow=grid.originalRows[grid.originalRows.length-1];if(lastRow)for(var i=0;i<valueArr.length;i++)params[valueArr[i]]=lastRow[keyArr[i]]}opts.pageParamete&&(params[opts.pageParamete.recName]=params.PAGE_SIZE,params[opts.pageParamete.cntName]=params.PAGE_NUM),load()}})}}function mergeCells(a,b){var c=$.data(a,"datagrid").options,d=$.data(a,"datagrid").data.rows;if(b.rowspan=b.rowspan||1,b.colspan=b.colspan||1,!(b.index<0||b.index>=d.length||1==b.rowspan&&1==b.colspan)){var e=d[b.index][b.field],f=c.finder.getTr(a,b.index),g=f.find('td[field="'+b.field+'"]');g.attr("rowspan",b.rowspan).attr("colspan",b.colspan),g.addClass("datagrid-td-merged");for(var h=1;h<b.colspan;h++)g=g.next(),g.hide(),d[b.index][g.attr("field")]=e;for(var h=1;h<b.rowspan;h++){f=f.next();var g=f.find('td[field="'+b.field+'"]').hide();d[b.index+h][g.attr("field")]=e;for(var i=1;i<b.colspan;i++)g=g.next(),g.hide(),d[b.index+h][g.attr("field")]=e}merge(a)}}function parseColumns(a){var b=$.data(a,"datagrid").options;if(b.fallParas&&b.fallParas[0].enable&&(b.fallParas[0]=$.extend({},$.fn.datagrid.defaults.fallParas[0],b.fallParas[0])),b.gridMenu){strs=["fileExport","freezeColumns","hideColumns","hideCols"];for(var c=0,d=strs.length;d>c;c++){var e=new RegExp(strs[c]);e.test(b.gridMenu)&&(b["is"+strs[c].replace(/^[a-z]/,function(a){return a.toUpperCase()})]=!0)}}b.frozenColumns=b.frozenColumns||[[]],b.frozenColumns[0]=b.frozenColumns[0]||[],b.lsKey=getReportTitle(a)+(datagridId+1);var f=b.columns[0];if(!f)return[];var g=$.ls(b.lsKey+"_width");if(g)if($.isArray(g)&&g.length==f.length)for(var c=0,d=g.length;d>c;c++)f[c].width=g[c];else $.ls(b.lsKey,null);for(var c=0,d=f.length;d>c;c++)f[c].sortable="undefined"==typeof f[c].sortable?!0:f[c].sortable;var h=$.ls(b.lsKey),i=new Array;if((b.isMoveColumns||b.isHideColumns||b.isFreezeColumns)&&b.columns&&b.columns[0]){var f=b.columns[0];if(h&&h.length==f.length){for(var j=new Array,k=new Array,c=0,d=h.length;d>c;c++)h[c]<0?(j.push(f[h[c]+d]),i.push(c)):h[c]>=d?k.push(f[h[c]-d]):j.push(f[h[c]]);b.columns[0]=j,b.frozenColumns[0]=k}else $.ls(b.lsKey,null)}if(!h&&b.columns&&b.columns[0]){h=[];for(var f=b.columns[0],k=new Array,l=0,d=f.length,c=d-1;c>=0;c--)f[c]&&f[c].frozen&&f[c].frozen+""!="false"?(k.unshift(f.splice(c,1)[0]),h.splice(h.length-l++,0,c+d)):h.unshift(c);b.frozenColumns[0]=k}return i}function addMoveColumn(a){function b(){return!1}if(a){var c=$.data(a,"datagrid").dc,d=c.header1.find("tr"),e=c.header2.find("tr"),f=c.body2,g=$("body"),h=g[0].onselectstart,i=null,j=!1,k=0,l=0,m=0,n=[];g.mousemove(function(a){if(j){e.find(".floatTd").css("left",m+(a.pageX-l)+"px");for(var b=Math.max(a.pageX,n[0]),c=1,d=n.length;d>c;c++)if(b<n[c]){var f;f=b>=n[c]-(n[c]-n[c-1])/2?e.find("td:eq("+(c-1)+") div.datagrid-cell").removeClass("leftInsert").addClass("rightInsert"):e.find("td:eq("+(c-1)+") div.datagrid-cell").removeClass("rightInsert").addClass("leftInsert"),f[0]!=i[0]&&(i.removeClass("leftInsert").removeClass("rightInsert"),i=f);break}}}).bind("mouseup mouseleave",function(b){if(j){j=!1,g[0].onselectstart=h,g.removeClass("noneSelect"),e.find(".floatTd").remove(),i.removeClass("leftInsert").removeClass("rightInsert");for(var c=Math.max(b.pageX,n[0]),d=1,f=n.length;f>d;d++)if(c<n[d])return void(c>=n[d]-(n[d]-n[d-1])/2?moveColumn(a,k,d):moveColumn(a,k,d-1));moveColumn(a,k,f-1)}}),d.find("td").add(e.find("td")).mousedown(function(a){if($(this).parents("div.datagrid-view2:first").length<1)return!0;if("e-resize"!=$(this).find(".datagrid-cell:first").css("cursor")&&a.ctrlKey){j=!0,k=$(this).index(),g[0].onselectstart=b,g.addClass("noneSelect"),l=a.pageX,m=$(this).offset().left;var c=e.parent().offset().left,d=f.scrollLeft();m=m-c-d,n=[],$(this).parent().find("td").each(function(){n.push($(this).offset().left)}).filter(":last").each(function(){n.push($(this).offset().left+$(this).width())}),i=$(this).parent().append($(this).clone().attr("class","floatTd").css("left",m+"px")).find("div.datagrid-cell")}})}}function moveColumn(a,b,c){if(a){var d=$.data(a,"datagrid").dc,e=d.view2,f=e.find("tr:first td").length;if(!(0>b||b>f-1||0>c||c>f||b==c||b==c-1)){var g,h=e.find("tr"),i=c;c==f?(g="insertAfter",i=f-1):g="insertBefore",h.each(function(){var a=$(this).find("td:eq("+b+")"),c=$(this).find("td:eq("+i+")");a[g](c)});var j=$.data(a,"datagrid").options,k=j.columns[0],l=j.frozenColumns[0];k.splice(c,0,k[b]),k.splice(b>c?b+1:b,1);var m=$.ls(j.lsKey);if(!m||!$.isArray(m)||m.length!=k.length+l.length){m=[];for(var n=0,f=k.length+l.length;f>n;n++)m[n]=n}m.splice(c,0,m[b]),m.splice(b>c?b+1:b,1),$.ls(j.lsKey,m)}}}function addHideColumns(a){if(a&&$.data(a,"datagrid")){var b=$.data(a,"datagrid").options.columns[0],c=[];c.push('<div class="hide_columns"><div style="line-height:20px;height:20px;"><a name="selectAll" style="margin:0 5px;" href="javascript:void(0)">全选</a><a href="javascript:void(0)" style="margin:0 5px;">全不选</a><a href="javascript:void(0)" style="margin:0 5px;">反选</a></div><div style="height:160px;overflow:auto;margin-bottom:10px;"><ul style="list-style:none;margin:0;padding:0;">');for(var d=0,e=b.length;e>d;d++)c.push("<li "),("true"==b[d].hidden||"true"==b[d].listHidden)&&c.push(' style="display:none"'),c.push('><input type="checkbox"'),/ hide/.test(b[d].cellClass)&&c.push(' checked="checked"'),c.push("><span>"+b[d].title+"</span></li>");c.push('</ul></div><a name="confirm" style="margin:0 10px 0 10px;" href="javascript:void(0)">确定</a>'),c.push('<a name="cancel" class="kui-linkbutton">取消</a>'),c.push("</div>");var f=$(c.join("")).window({title:"请选择要隐藏的列",width:200,height:250,modal:!0,minimizable:!1,maximizable:!1,collapsible:!1});f.find("a[name=selectAll]").click(function(){f.find("ul input").each(function(){this.checked=!0})}).next().click(function(){f.find("ul input").each(function(){this.checked=!1})}).next().click(function(){f.find("ul input").each(function(){this.checked=!this.checked})}),f.find("a[name=confirm]").linkbutton({}).click(function(){var b=[];f.find("input:checked").each(function(a,c){b.push($(c).parent().index())}),hideColumns(a,b),f.window("close")}),f.find("a[name=cancel]").linkbutton({}).click(function(){f.window("close")}),f.window("open")}}function hideColumns(a,b){if(a&&$.isArray(b)){var c=$.data(a,"datagrid").dc,d=c.header2,e=c.body2,f=d.find("tr"),g=e.find("tr"),h=$.data(a,"datagrid").options,i=h.columns[0],j=h.frozenColumns[0];f.find("td>div").show(),g.find("td>div[class*=hide]").removeClass("hide");for(var k=0,l=i.length;l>k;k++)i[k].checkbox||(i[k].cellClass=i[k].cellClass.replace(/ hide/g,""));for(var k=0,l=b.length;l>k;k++){var m=b[k];i[m].cellClass+=" hide",f.find("td:eq("+m+")>div").hide(),g.find("td:eq("+m+")>div").addClass("hide")}var n=$.ls(h.lsKey);if(!n||!$.isArray(n)||n.length!=i.length+j.length){n=[];for(var k=0,l=i.length+j.length;l>k;k++)n[k]=k}for(var o=n.length,k=0,l=n.length;l>k;k++)n[k]<0&&(n[k]+=o);for(var k=0,l=b.length;l>k;k++)n[b[k]]>=0&&(n[b[k]]-=o);$.ls(h.lsKey,n)}}function freezeColumnsWindow(a){if(a&&$.data(a,"datagrid")){var b=$.data(a,"datagrid").options,c=b.columns[0],d=b.frozenColumns[0],e=[];e.push('<div class="hide_columns"><div style="line-height:20px;height:20px;"><a name="selectAll" style="margin:0 5px;" href="javascript:void(0)">全选</a><a href="javascript:void(0)" style="margin:0 5px;">全不选</a><a href="javascript:void(0)" style="margin:0 5px;">反选</a></div><div style="height:160px;overflow:auto;margin-bottom:10px;"><ul style="list-style:none;margin:0;padding:0;">');for(var f=0,g=d.length;g>f;f++)e.push("<li"),d[f].hidden&&e.push(' style="display:none"'),e.push('><input type="checkbox" field="'+d[f].field+'"'),e.push(' checked="checked"'),e.push("><span>"+d[f].title+"</span></li>");for(var f=0,g=c.length;g>f;f++)/ hide/.test(c[f].cellClass)||(e.push("<li"),("true"==c[f].hidden||"true"==c[f].listHidden)&&e.push(' style="display:none"'),e.push('><input type="checkbox" field="'+c[f].field+'"'),e.push("><span>"+c[f].title+"</span></li>"));e.push('</ul></div><a name="confirm" style="margin:0 10px 0 10px;" href="javascript:void(0)">确定</a>'),e.push('<a name="cancel" class="kui-linkbutton">取消</a>'),e.push("</div>");var h=$(e.join("")).window({title:"请选择要锁定的列",width:200,height:250,modal:!0,minimizable:!1,maximizable:!1,collapsible:!1});h.find("a[name=selectAll]").click(function(){h.find("ul input").each(function(){this.checked=!0})}).next().click(function(){h.find("ul input").each(function(){this.checked=!1})}).next().click(function(){h.find("ul input").each(function(){this.checked=!this.checked})}),h.find("a[name=confirm]").linkbutton({}).click(function(){var b=[];h.find("input:checked").each(function(a,c){b.push($(c).attr("field"))}),freezeColumns(a,b)&&h.window("close")}),h.find("a[name=cancel]").linkbutton({}).click(function(){h.window("close")}),h.window("open")}}function freezeColumns(a,b){function c(a,b){for(var c=0,d=b.length;d>c;c++)if(a==b[c])return!1;return!0}function d(a,b){for(var c=0,d=b.length;d>c;c++)if(a==b[c].field)return!1;return!0}if(a&&$.isArray(b)){var e=($(a).datagrid("getPager"),$.data(a,"datagrid")),f=e.dc,g=e.options,h=e.originalRows,i=f.header1,j=f.header2,k=g.columns[0],l=g.frozenColumns[0],m=k.length+l.length,n=$.ls(g.lsKey);if(!n||!$.isArray(n)||n.length!=m){n=[];for(var o=0,p=k.length;p>o;o++)n[o]=o;for(var q=0,p=l.length;p>q;q++)n[o+q]=o+q+m}for(var r=.6*f.view.width(),s=l.concat(k),t=0,o=0,p=b.length;p>o;o++)for(var q=0,u=s.length;u>q;q++)b[o]==s[q].field&&(t+=parseInt(s[q].width));if(t>r)return alert("所有固定列宽度之和不能超过表格宽度的60%。"),!1;for(var p=l.length,o=p-1,v=0;o>=0;o--){var w=l[o].field;c(w,b)&&(k.unshift(l.splice(o,1)[0]),n.unshift(n.splice(m-(p-o-v++),1)[0]-m),i.find("tr td[field="+w+"]").prependTo(j.find("tr")))}for(var o=0,p=b.length;p>o;o++)if(d(b[o],l))for(var q=0,u=k.length;u>q;q++)if(k[q].field==b[o]){l.push(k.splice(q,1)[0]);var x=n.splice(q,1)[0];0>x?x+=2*m:m>x&&(x+=m),n.push(x),j.find("tr td[field="+b[o]+"]").appendTo(i.find("tr"));break}return $.ls(g.lsKey,n),h&&h.length>0&&$(a).datagrid("loadData",e.data),resize(a),!0}}function getOriginalColumns(a,b){var c,d=$.data(a,"datagrid").options,e=$.ls(d.lsKey),f=d.columns[0],g=d.frozenColumns[0]||[];if(e&&$.isArray(e)&&f&&g&&e.length==f.length+g.length){c=[];for(var h=e.length,i=f.length,j=0;h>j;j++)e[j]<0&&(e[j]+=h);for(var j=0;h>j;j++)for(var k=0;h>k;k++){if(j==e[k]){c.push(f[k]);break}if(j==e[k]-h){c.push(g[k-i]);break}}}else c=f.concat(g);if(b)for(var j=0,l=c.length;l>j;j++)(/ hide/.test(c[j].cellClass)||c[j].hidden||c[j].listHidden)&&(c.splice(j,1),j--,l--);return c}function onHideColumns(a){addHideColumns(a)}function onHideCols(a){var b=$.data(a,"datagrid").dc,c=b.queryForm.find("form");c.form("hideColsWindow",function(){resize(a)})}function onFreezeColumns(a){freezeColumnsWindow(a)}function onRestoreDefault(a){var b=$.data(a,"datagrid");$.ls(b.options.lsKey,null),$.ls(b.options.lsKey+"_width",null);var c=b.dc.queryForm,d=c&&/form/i.test(c[0].tagName)?c:c.find("form"),e=d.data();e&&e.form&&d.form("restoreDefault"),window.location.reload(!1)}function getSearchParam(a){var b=$.data(a,"datagrid"),c=b.dc.queryForm||$(),d={};return c.find("input:visible").each(function(){var a,b=$(this),c=$.trim(b.val());c&&"-请选择-"!=c&&$.data(this,"validatebox")&&$.data(this,"validatebox").options.showWhenExport&&(a=b.closest("div").children(":first").text(),a&&(a=a.replace(/[:：]$/,""),d[a]=c))}),d}function submitReport(a,b){var c=$.data(a,"datagrid");c.dc.reportDialog?c.dc.reportDialog.report(b):c.dc.reportDialog=$("<div></div>").report(b)}function getReportTitle(a){var b=$.data(a,"datagrid"),c=b.options,d=c.reportTitle||c.name||c.title,e=b.dc.view.parents("div.kui-tabs:first");return e.length>0&&(d=e.data("tabs")?d||e.tabs("getSelected").panel("options").title:d||b.dc.view.parents("div.panel:first").parent().attr("title")),d}function onFileExport(a,b,c,d,e){var f="print"==b,g=$.data(a,"datagrid"),h=g.options,i=h.reportParams;if(c&&c.Datas&&(i={}),!i)return void alert("必须先进行一次查询！");if(!g.data.rows)return void alert("没有数据不必要进行该操作！");var j,k=h.searchParam,l=getReportTitle(a),m=h.fallParas[0];if(m.enable){var n=0;n=0==m.recNum?m.recNum+g.data.rows.length:m.recNum+g.data.rows.length-1,j={pageNum:1,totalRowNum:1e5,totalPageNum:1e3,pageSize:m.cntNum,startRowNum:m.recNum,endRowNum:n<m.cntNum?m.cntNum:n}}else if(h.remotePagination){var o=$(a).reportgrid("getPager"),p=o.pagination("options");j={pageNum:1,totalRowNum:1e5,totalPageNum:1e3,noPagination:!0,remotePagination:!0,pageSize:p.pageSize,pageParamete:h.pageParamete,startRowNum:p.pageSize*(p.pageNumber-1),endRowNum:p.pageSize*p.pageNumber}}else{var o=$(a).datagrid("getPager"),p=o.pagination("options");j={pageNum:1,totalRowNum:1e5,totalPageNum:1e3,noPagination:!0,pageSize:p.pageSize,startRowNum:p.pageSize*(p.pageNumber-1),endRowNum:p.pageSize*p.pageNumber}}var q={};q[h.id]="col";var r=getVisibleFields(a),s={onBeforeExport:h.onBeforeExport,onBeforePrint:h.onBeforePrint,exportCheckAll:!1!==h.exportCheckAll,notShowDialog:e?!0:!1,showStatistics:h.showStatistics,tableView:q,reqStr:{req:[i]},lsKey:h.lsKey,pageInfo:j,gridColumns:r,exportType:f?d?d:"pdf":b,isPrint:f,title:l,fileName:l,userName:g_user&&g_user.userName?g_user.userName:"",orgName:g_user&&g_user.orgName?g_user.orgName:"",searchParam:k,fallParas:m,footerInfo:h.footerInfo,confirmInfo:h.confirmInfo,companyName:h.companyName};$.extend(s,c),submitReport(a,s)}function onFileImport(a){var b=$.data(a,"datagrid").options.toolbar,c={toolbar:b};submitImport(a,c)}function submitImport(a,b){var c=$.data(a,"datagrid");c.dc.importDialog?c.dc.importDialog.imports(a,b):c.dc.importDialog=$("<div></div>").imports(a,b)}function getSubRow(a,b,c){var c=c||2,d=$.data(a,"datagrid").options,e=d.finder.getTr(a,b,"body",c);return e.next("tr[class='datagird-row-sub-tr"+c+"']")}function fixSubRowHeight(a,b){var c=getSubRow(a,b,1),d=getSubRow(a,b,2);c.css("height",""),d.css("height","");var e=Math.max(c.height(),d.height());c.css("height",e),d.css("height",e)}function headFilter(a){var b,c=$.data(a,"datagrid"),d=c.options,e=c.dc,f=[];if($.each([e.header1,e.header2],function(a,c){var d={};c.find("td.filtered").each(function(){b=$(this),d={field:$(this).attr("field"),value:b.find(".combo-value").length>0?b.find(".combo-value").val():b.attr("filter"),fuzzy:0==b.find(".combo-value").length?!0:!1}}),!$.isEmptyObject(d)&&f.push(d),e["body"+(a+1)].find(">table>tbody>tr:hidden").show()}),f.length>0){var g=[];$.each(f,function(a,b){$.isEmptyObject(b)||$.each(d.originalRowsData,function(a,c){b.fuzzy&&-1!=c[b.field].indexOf(b.value)?g.push(c):b.fuzzy||c[b.field]!=b.value||g.push(c)})}),$(a).datagrid("loadData",{DATA:[d.originalRowsData],HEAD:{DATA_ROWS:d.originalRowsData.length},rows:g,total:g.length})}else $(a).datagrid("loadData",{DATA:[d.originalRowsData],HEAD:{DATA_ROWS:d.originalRowsData.length},rows:d.originalRowsData,total:d.originalRowsData.length});resize(a)}function clearHeadFilter(a){var b=$.data(a,"datagrid"),c=b.dc;$.each([c.header1,c.header2],function(a,b){b.find("td.filtered").attr("filter","").removeClass("filtered")})}function getToolbarButton(a,b){var c,d=$.data(a,"datagrid");return btns=d.panel.find(".datagrid-toolbar a.l-btn"),null==b?btns:"number"===$.type(b)?$(btns[b]):(b=String(b),c=btns.filter(function(){return $(this).attr("id")===b}),c.length?c:btns.filter(function(){return-1!=$(this).find(".l-btn-text").text().indexOf(b)}))}function getVisibleFields(a){var b,c,d=$.data(a,"datagrid").dc,e=d.header1.find("tr"),f=d.header2.find("tr"),g=f.find("td").add(e.find("td")),h=[];g.each(function(){return b=$(this),b.is(":visible")&&b.find(">div").is(":visible")?(c=b.attr("field"),void(c&&h.push(c))):!0});var i=$(a).datagrid("getOriginalColumns"),j=[];for(var k in h)for(var l in i)h[k]==i[l].field&&j.push(i[l]);return j}function getUIRowData(a,b){var c=$(a),d=c.data("datagrid").options,e=$(),f=[];return"number"===$.type(b)?e=d.finder.getTr(a,b):"object"===$.type(b)?e=d.finder.getTr(a,c.datagrid("getRowIndex",b)):$.isArray(b)&&$.each(b,function(){e.push(d.finder.getTr(a,c.datagrid("getRowIndex",this)))}),e.filter(function(){return!!$(this).html()}).each(function(){var a,b=$(this),c={};b.find("td").each(function(){a=$(this),a.attr("field")&&(c[a.attr("field")]=a.find(">div").text())}),f.push(c)}),$.isArray(b)?f:f[0]}var datagridId=0,g_user={userName:top.kjdp.getOpInfo?top.kjdp.getOpInfo().USER_NAME:"",orgName:top.kjdp.getOpInfo?top.kjdp.getOpInfo().ORG_NAME:""};$.fn.datagrid=function(a){if("string"==typeof a){var b=[this];return $.fn.datagrid.methods[a].apply(this,b.concat(Array.prototype.slice.call(arguments,1)))}return a=a||{},this.each(function(){var b,c=this,d=$.data(c,"datagrid");if(d)b=$.extend(d.options,a),d.options=b;else{b=$.extend(!0,{},$.extend({},$.fn.datagrid.defaults,{queryParams:{}}),$.fn.datagrid.parseOptions(c),a),$(c).css("width","").css("height","").attr("datagrid","datagrid");var e=wrapGrid(c,b.rownumbers);b.columns||(b.columns=e.columns),b.frozenColumns||(b.frozenColumns=e.frozenColumns),$.data(c,"datagrid",{options:b,panel:e.panel,dc:e.dc,selectedRows:[],data:{total:0,rows:[]},originalRows:[],updatedRows:[],insertedRows:[],deletedRows:[]})}d=d||$.data(c,"datagrid"),b=b||d.options,_.isArray(b.pageList)&&b.pageList.length>0&&!_.contains(b.pageList,b.pageSize)&&(b.pageSize=b.pageList[0]);var f=parseColumns(c);$.each(b.columns[0]||[],function(){"checkbox"===this.type&&(this.checkbox=!0)}),$.when(b.onBeforeInit.call(c)).then(function(){if(create(c),b.queryCols&&0!=b.queryCols.length||b.required||request(c),!d){var a=getData(c);a.total>0&&(loadData(c,a),saveOriginalRows(c))}setSize(c),bindEvents(c),b.isMoveColumns&&addMoveColumn(c),b.isHideColumns&&f.length>0&&hideColumns(c,f),b.onInitSuccess.call(c)})})},$.fn.datagrid.methods={options:function(a){var b=$.data(a[0],"datagrid").options,c=$.data(a[0],"datagrid").panel.panel("options"),d=$.extend(b,{width:c.width,height:c.height,closed:c.closed,collapsed:c.collapsed,minimized:c.minimized,maximized:c.maximized}),e=a.datagrid("getPager");if(e.length){var f=e.pagination("options");$.extend(d,{pageNumber:f.pageNumber,pageSize:f.pageSize})}return d},getPanel:function(a){return $.data(a[0],"datagrid").panel},getPager:function(a){return $.data(a[0],"datagrid").panel.children("div.datagrid-pager")},getColumnFields:function(a,b){return getColumnFields(a[0],b)},getColumnOption:function(a,b){return getColumnOption(a[0],b)},getData:function(a,b,c){return getData(a[0],b,c)},resize:function(a,b){return a.each(function(){setSize(this,b)})},loading:function(a){return a.each(function(){var a=$.data(this,"datagrid").options;if(!a.isShowLoading)return!1;if(a.pagination&&$(this).datagrid("getPager").pagination("loading"),a.loadMsg){var b=$(this).datagrid("getPanel");$('<div class="datagrid-mask" style="display:block"></div>').appendTo(b);var c=$('<div class="datagrid-mask-msg" style="display:block"></div>').html(a.loadMsg).appendTo(b);c.css("left",(b.width()-c.outerWidth())/2)}})},loaded:function(a){return a.each(function(){var a=$.data(this,"datagrid").options;a.pagination&&$(this).datagrid("getPager").pagination("loaded");var b=$(this).datagrid("getPanel");b.children("div.datagrid-mask-msg").remove(),b.children("div.datagrid-mask").remove(),a.editing=void 0})},loadData:function(a,b,c){return a.each(function(){loadData(this,b,c)})},fitColumns:function(a){return a.each(function(){fitColumns(this)})},fixColumnSize:function(a,b){return a.each(function(){fixColumnSize(this,b)})},fixRowHeight:function(a,b){return a.each(function(){fixRowHeight(this,b)})},autoSizeColumn:function(a,b){return a.each(function(){autoSizeColumn(this,b)})},getRows:function(a){return $.data(a[0],"datagrid").data.rows},getRowIndex:function(a,b){return getRowIndex(a[0],b)},getSelected:function(a){var b=getSelections(a[0]);return b.length>0?b[0]:null},getSelections:function(a){return getSelections(a[0])},clearSelections:function(a){return a.each(function(){var a=$.data(this,"datagrid").selectedRows;a.splice(0,a.length);var b=$.data(this,"datagrid"),c=b.dc,d=c.header1.add(c.header2),e=$("input[type=checkbox]",d);unselectAll(this),e.attr("checked",!1)})},selectAll:function(a){return a.each(function(){selectAll(this)})},unselectAll:function(a){return a.each(function(){unselectAll(this)})},reload:function(a,b,c){return a.each(function(){request(this,b,void 0,c)})},selectRow:function(a,b){return a.each(function(){selectRow(this,b)})},selectRecord:function(a,b){return a.each(function(){selectRecord(this,b)})},getSelectRows:function(a){return getSelectRows(a[0])},getCheckedRows:function(a){return getCheckedRows(a[0])},getUnCheckedRows:function(a){return getUnCheckedRows(a[0])},unselectRow:function(a,b){return a.each(function(){unselectRow(this,b)})},checkRow:function(a,b,c){return a.each(function(){checkRow(this,b,!0,c)})},uncheckRow:function(a,b,c){return a.each(function(){uncheckRow(this,b,!1,c)})},getEditor:function(a,b){return getEditor(a[0],b)},destroyEditor:function(a,b){return a.each(function(){destroyEditor(this,b)})},beginEdit:function(a,b){return a.each(function(){beginEdit(this,b)})},endEdit:function(a,b,c){return a.each(function(){endEdit(this,b,c)})},refreshRow:function(a,b){return a.each(function(){var a=$.data(this,"datagrid").options;a.view.refreshRow.call(a.view,this,b)})},updateRow:function(a,b,c){return a.each(function(){var a=$.data(this,"datagrid").options;a.view.updateRow.call(a.view,this,b,c)})},validateRow:function(a,b){return validateRow(a[0],b)},appendRow:function(a,b){return a.each(function(){appendRow(this,b)})},insertRow:function(a,b){return a.each(function(){insertRow(this,b)})},deleteRow:function(a,b,c){return a.each(function(){deleteRow(this,b,c)})},deleteAllSelections:function(a,b){return a.each(function(){deleteAllSelections(this,b)})},getChanges:function(a,b){return getChanges(a[0],b)},acceptChanges:function(a){return a.each(function(){acceptChanges(this)})},rejectChanges:function(a){return a.each(function(){rejectChanges(this)})},mergeCells:function(a,b){return a.each(function(){mergeCells(this,b)})},showColumn:function(a,b){return a.each(function(){var a=$(this).datagrid("getPanel");if($.isArray(b)){var c=this;$.each(b,function(){var b=this;a.find('td[field="'+b+'"]').show(),$(c).datagrid("getColumnOption",b).hidden=!1})}else a.find('td[field="'+b+'"]').show(),$(this).datagrid("getColumnOption",b).hidden=!1;$(this).datagrid("fitColumns")})},hideColumn:function(a,b){return a.each(function(){var a=$(this).datagrid("getPanel");if($.isArray(b)){var c=this;
$.each(b,function(){var b=this;a.find('td[field="'+b+'"]').hide(),$(c).datagrid("getColumnOption",b).hidden=!0})}else a.find('td[field="'+b+'"]').hide(),$(this).datagrid("getColumnOption",b).hidden=!0;$(this).datagrid("fitColumns")})},fileReport:function(a,b){onFileExport(a[0],"pdf",b)},fileExport:function(a,b){onFileExport(a[0],b.type,b,b.fileType,!0)},showAllReport:function(a,b){onFileExport(a[0],"print",void 0,b,!0)},onFileImport:function(a,b){onFileImport(a[0],b)},clean:function(a){return a.each(function(){clean(this)})},getOriginalColumns:function(a,b){return getOriginalColumns(a[0],b)},getSubRow:function(a,b){return getSubRow(a[0],b,2)},fixSubRowHeight:function(a,b){return a.each(function(){fixSubRowHeight(this,b)})},getToolbarButton:function(a,b){return getToolbarButton(a[0],b)},getUIRowData:function(a,b){return getUIRowData(a[0],b)},getOriginalRowsData:function(a){var b=$.data(a[0],"datagrid").options;return b.originalRowsData||[]},checkAll:function(a,b){return a.each(function(){checkAll(this,b)})},uncheckAll:function(a,b){return a.each(function(){uncheckAll(this,b)})}},$.fn.datagrid.parseOptions=function(target){var jq=$(target);return $.extend({},$.fn.panel.parseOptions(target),$.parser.parseOptions(target,["url","toolbar","idField","sortName","sortOrder","pagePosition",{fitColumns:"boolean",autoRowHeight:"boolean",striped:"boolean",nowrap:"boolean"},{rownumbers:"boolean",subrow:"boolean",singleSelect:"boolean",checkOnSelect:"boolean",selectOnCheck:"boolean"},{pagination:"boolean",remotePagination:"boolean",pageSize:"number",pageNumber:"number"},{remoteSort:"boolean",showHeader:"boolean"},{allowMove:"boolean"},{scrollbarSize:"number"}]),{pageList:jq.attr("pageList")?eval(jq.attr("pageList")):void 0,loadMsg:void 0!=jq.attr("loadMsg")?jq.attr("loadMsg"):void 0,rowStyler:jq.attr("rowStyler")?eval(jq.attr("rowStyler")):void 0})};var view={render:function(a,b,c,d){var e=$.data(a,"datagrid"),f=e.options,g=d||e.data.rows;d&&0===d.length&&(g=e.data.rows);var h=$(a).datagrid("getColumnFields",c);if(!c||f.rownumbers||f.subrow||f.frozenColumns&&f.frozenColumns.length){var i=[];if(d&&d.length){for(var j=parseInt(e.data.total),k=j-g.length,l=k;j>l;l++){var m=l%2&&f.striped?'class="datagrid-row datagrid-row-alt"':'class="datagrid-row"',n=f.rowStyler?f.rowStyler.call(a,l,g[l-k]):"",o=n?'style="'+n+'"':"",p=e.rowIdPrefix+"-"+(c?1:2)+"-"+l;i.push('<tr id="'+p+'" datagrid-row-index="'+l+'" '+m+" "+o+">"),i.push(this.renderRow.call(this,a,h,c,l,g[l-k])),i.push("</tr>")}$(b).find("tbody").append(i.join("")),g.length>f.maxRows?$(b).scrollTop(0):j>f.maxRows?0!==g.length&&$(b).scrollTop((f.maxRows-g.length)*f.trHeight+$(b).parent().height()):0!==g.length&&$(b).scrollTop(k*f.trHeight)}else{i.push('<table class="datagrid-btable" cellspacing="0" cellpadding="0" border="0"><tbody>');for(var l=0;l<g.length;l++){var m=l%2&&f.striped?'class="datagrid-row datagrid-row-alt"':'class="datagrid-row"',n=f.rowStyler?f.rowStyler.call(a,l,g[l]):"",o=n?'style="'+n+'"':"",p=e.rowIdPrefix+"-"+(c?1:2)+"-"+l;i.push('<tr id="'+p+'" datagrid-row-index="'+l+'" '+m+" "+o+">"),i.push(this.renderRow.call(this,a,h,c,l,g[l])),i.push("</tr>")}i.push("</tbody></table>");{i.join("")}$(b)[0].innerHTML=i.join(""),d||$(b).scrollTop(0)}}},renderFooter:function(a,b,c){for(var d=($.data(a,"datagrid").options,$.data(a,"datagrid").footer||[]),e=$(a).datagrid("getColumnFields",c),f=['<table class="datagrid-ftable" cellspacing="0" cellpadding="0" border="0"><tbody>'],g=0;g<d.length;g++)f.push('<tr class="datagrid-row" datagrid-row-index="'+g+'">'),f.push(this.renderRow.call(this,a,e,c,g,d[g])),f.push("</tr>");f.push("</tbody></table>"),$(b).html(f.join(""))},renderRow:function(target,fields,frozen,index,row){var opts=$.data(target,"datagrid").options,rowHtml=[],contextObj=parser.getContextObj();if(frozen&&(opts.rownumbers||opts.subrow)){var rowNumber=index+1;opts.pagination&&(rowNumber+=(opts.pageNumber-1)*opts.pageSize),rowHtml.push(opts.rownumbers?'<td class="datagrid-td-rownumber"><div class="datagrid-cell-rownumber">'+rowNumber+"</div></td>":'<td class="datagrid-td-subrow"><div class="datagrid-cell-subrow"><span class="datagrid-row-expander datagrid-row-expand" style="display:inline-block;width:16px;height:16px;cursor:pointer;"></span></div></td>')}for(var i=0;i<fields.length;i++){var field=fields[i];row[field]=gridDataValueReplace(row[field])||"";var col=$(target).datagrid("getColumnOption",field);if(col&&"notice"!=col.type){var styler=col.styler?col.styler(row[field],row,index)||"":"",colStyle=col.hidden?'style="display:none;'+styler+'"':col.listHidden?'style="display:none;'+styler+'"':styler?'style="'+styler+'"':"";if(col.formatter){var formatter=null,fFormatter=$.data(target,"formatter");"string"==typeof col.formatter?fFormatter&&fFormatter[col.formatter]?formatter=fFormatter[col.formatter]:contextObj&&contextObj[col.formatter]?formatter=contextObj[col.formatter]:eval("formatter="+col.formatter):formatter=col.formatter;var val=formatter.call(target,row[field],row,index,col);rowHtml.push(val&&"string"==typeof val&&val.indexOf("<")>-1?"<td title='"+(val.indexOf("<")>-1?$(val).text():val)+"' field=\""+field+'" '+colStyle+">":"<td title='"+val+"' field=\""+field+'" '+colStyle+">")}else col.editor&&col.editor.options&&col.editor.options.data?(col.editor.options.valueField=col.editor.options.valueField||"dict_val",col.editor.options.textField=col.editor.options.textField||"dict_des",rowHtml.push("<td title='"+getEdtDictText(col,row[field],row)+"' field=\""+field+'" '+colStyle+">")):col.editor&&col.editor.options&&col.editor.options.dict?(col.editor.options.valueField="dict_val",col.editor.options.textField="dict_des",rowHtml.push("<td title='"+getEdtDictText(col,row[field],row)+"' field=\""+field+'" '+colStyle+">")):rowHtml.push(col.editor&&col.editor.options&&col.editor.options.cache?"<td title='"+getEdtCacheText(col,row[field])+"' field=\""+field+'" '+colStyle+">":"<td title='"+row[field]+"' field=\""+field+'" '+colStyle+">");var style="";if(col.checkbox?style="":(style+="text-align:"+(col.align||"left")+";",opts.nowrap?opts.autoRowHeight&&(style+="height:auto;"):style+="white-space:normal;height:auto;"),rowHtml.push('<div style="'+style+'" '),rowHtml.push(col.checkbox?'class="datagrid-cell-check ':'class="datagrid-cell '+col.cellClass),rowHtml.push('">'),col.checkbox)rowHtml.push('<input type="checkbox" name="'+field+'" value="'+(void 0!=row[field]?row[field]:"")+'"/>');else if(col.formatter){var formatter=null;"string"==typeof col.formatter?fFormatter&&fFormatter[col.formatter]?formatter=fFormatter[col.formatter]:contextObj&&contextObj[col.formatter]?formatter=contextObj[col.formatter]:eval("formatter="+col.formatter):formatter=col.formatter,rowHtml.push(formatter.call(target,row[field],row,index,col))}else if(col.editor&&col.editor.options&&col.editor.options.data)col.editor.options.valueField=col.editor.options.valueField||"dict_val",col.editor.options.textField=col.editor.options.textField||"dict_des",rowHtml.push(getEdtDictText(col,row[field],row));else if(col.editor&&col.editor.options&&col.editor.options.dict)col.editor.options.valueField="dict_val",col.editor.options.textField="dict_des",rowHtml.push(getEdtDictText(col,row[field],row));else if(col.editor&&col.editor.options&&col.editor.options.cache)rowHtml.push(getEdtCacheText(col,row[field]));else if("numberbox"==col.type){row[field]="number"!==$.type(row[field])&&0==row[field].indexOf(".")?"0"+row[field]:row[field];var tempVal=row[field];""!==tempVal&&void 0!==tempVal&&!isNaN(tempVal)&&col.fixNum&&(tempVal=Number(tempVal).toFixed(col.fixNum)),rowHtml.push(kui.formatNumber(tempVal))}else rowHtml.push(row[field]);rowHtml.push("</div>"),rowHtml.push("</td>")}}return rowHtml.join("")},refreshRow:function(a,b){for(var c={},d=$(a).datagrid("getColumnFields",!0).concat($(a).datagrid("getColumnFields",!1)),e=0;e<d.length;e++)c[d[e]]=void 0;var f=$(a).datagrid("getRows");$.extend(c,f[b]),this.updateRow.call(this,a,b,c)},updateRow:function(target,index,row){var opts=$.data(target,"datagrid").options,rows=$(target).datagrid("getRows"),tr=opts.finder.getTr(target,index),fFormatter=$.data(target,"formatter"),contextObj=parser.getContextObj();for(var field in row){rows[index][field]=row[field];var td=tr.children('td[field="'+field+'"]'),cell=td.find("div.datagrid-cell"),col=$(target).datagrid("getColumnOption",field);if(col){var style=col.styler?col.styler(rows[index][field],rows[index],index):"";if(td.attr("style",style||""),(col.hidden||col.listHidden)&&td.hide(),col.formatter){var formatter=null;"string"==typeof col.formatter?fFormatter&&fFormatter[col.formatter]?formatter=fFormatter[col.formatter]:contextObj&&contextObj[col.formatter]?formatter=contextObj[col.formatter]:eval("formatter="+col.formatter):formatter=col.formatter,cell.html(formatter.call(target,rows[index][field],rows[index],index,col))}else cell.html(col.editor&&col.editor.options&&col.editor.options.data?getEdtDictText(col,row[field],row)+"":col.editor&&col.editor.options&&col.editor.options.cache?getEdtCacheText(col,row[field])+"":"object"==typeof rows[index][field]&&rows[index][field].length>0?rows[index][field].val():rows[index][field]);var str=cell.html()||"";str=""==str?"":str.replace(/<[^>]+>/g,""),td.attr("title",str)}}var style=opts.rowStyler?opts.rowStyler.call(target,index,rows[index]):"";tr.attr("style",style||""),$(target).datagrid("fixRowHeight",index)},insertRow:function(a,b,c){function d(c){for(var d=c?1:2,g=h.rows.length-1;g>=b;g--){var i=f.finder.getTr(a,g,"body",d);if(i.attr("datagrid-row-index",g+1),i.attr("id",e.rowIdPrefix+"-"+d+"-"+(g+1)),c&&f.rownumbers){var j=g+2;f.pagination&&(j+=(f.pageNumber-1)*f.pageSize),i.find("div.datagrid-cell-rownumber").html(j)}}}var e=$.data(a,"datagrid"),f=e.options,g=e.dc,h=e.data;0==h.rows&&(h.rows=[]),(void 0==b||null==b)&&(b=h.rows.length),b>h.rows.length&&(b=h.rows.length),d.call(this,!0),d.call(this,!1);var i=$(a).datagrid("getColumnFields",!0),j=$(a).datagrid("getColumnFields",!1),k=e.rowIdPrefix+"-1-"+b,l='<tr id="'+k+'" class="datagrid-row" datagrid-row-index="'+b+'">'+this.renderRow.call(this,a,i,!0,b,c)+"</tr>",m='<tr id="'+k+'" class="datagrid-row" datagrid-row-index="'+b+'">'+this.renderRow.call(this,a,j,!1,b,c)+"</tr>";b>=h.rows.length?h.rows.length?(f.finder.getTr(a,"","last",1).after(l),f.finder.getTr(a,"","last",2).after(m)):(g.body1.html('<table cellspacing="0" cellpadding="0" border="0"><tbody>'+l+"</tbody></table>"),g.body2.html('<table cellspacing="0" cellpadding="0" border="0"><tbody>'+m+"</tbody></table>")):(f.finder.getTr(a,b+1,"body",1).before(l),f.finder.getTr(a,b+1,"body",2).before(m)),h.total+=1,h.rows.splice(b,0,c),f.originalRowsData?f.originalRowsData.splice(b,0,c):f.originalRowsData=[c],this.refreshRow.call(this,a,b)},insertSubRow:function(a,b){var c=$.data(a,"datagrid").options,d=$(a).datagrid("getColumnFields",!1),e='<tr class="datagird-row-sub-tr1" style="display: table-row;"><td colspan="3" style="border-right:0"><div class="datagrid-row-sub"></div></td></tr>',f='<tr class="datagird-row-sub-tr2" style="display: table-row;"><td colspan="'+d.length+'"><div class="datagrid-row-sub"></div></td></tr>';c.finder.getTr(a,b+1,"body",1).before(e),c.finder.getTr(a,b+1,"body",2).before(f)},onBeforeRender:function(a,b){var c=$.data(a,"datagrid").options;_.isFunction(c.onBeforeRender)&&c.onBeforeRender.call(a,b)},onAfterRender:function(a){var b=$.data(a,"datagrid").options;_.isFunction(b.onAfterRender)&&b.onAfterRender.call(a)}};$.fn.datagrid.defaults=$.extend({},$.fn.panel.defaults,{frozenColumns:void 0,columns:void 0,isFormCollapsable:!1,isFormCollapsed:!1,colNumbers:3,fitColumns:!1,toolbar:null,toolbarAlign:"bottom",method:"post",req:[],nowrap:!0,striped:!0,rownumbers:!1,subrow:!1,singleSelect:!0,enableCheckAll:!0,selectOnCheck:!0,checkOnSelect:!0,loadMsg:"Processing, please wait ...",clearOnQuery:!0,pagination:!0,pagePosition:"bottom",pageSize:100,pageNumber:1,showTime:!0,maxRows:1e3,sort:!0,sortName:null,sortOrder:"asc",remoteSort:!1,remotePagination:!1,showHeader:!0,rowDetailHeight:80,showRowDetail:!1,isShowDetail:!1,limitQueryLine:3,isShowLoading:!0,showStatistics:!1,isShowStatistics:!1,stsDescFieldIndex:0,statisticsTexts:["最大值","最小值","平均值","合计"],showDetailCols:"",isMoveColumns:!0,gridMenu:!1,queryBtnIco:"icon-search",queryBtnTxt:"查询",exportTypes:["xls","dbf","pdf","csv"],importTypes:["导入"],reportTitle:void 0,fallParas:[{enable:!1,recName:"PAGE_NUM",dbPagination:!1,cntName:"PAGE_SIZE",recNum:1,cntNum:100,backAllBtn:!1,nextPageBtn:!0,showPageList:!0,pageList:[100,500,1e3]}],autoColNumber:!0,scrollbarSize:18,allowMove:!1,editing:void 0,view:view,rowStyler:function(){},loader:function(a,b,c){var d=$(this).datagrid("options");d.pageNumber=a.PAGE_NUM||1;var e=$(this);return 0!=d.req.length||d.url?void ajaxRequest({type:d.method,url:d.url,dataType:d.dataType,req:[a],func:function(a,c){var d={HEAD:c,DATA:a};b(d)},error:function(){c.apply(this,arguments),setTimeout(function(){clean(e[0]),e.datagrid("loaded")},0)}}):!1},beforeFilter:function(a){return a},loadFilter:function(a,b){var c=$(this),d=$(this).datagrid("options"),e=$(this).datagrid("getPager");if(d.pageNumber=b||1,"object"==typeof a&&a.HEAD&&a.DATA){var f=[],g="";d.comp_code&&d.comp_code.length>0?(g=a.DATA[0][d.comp_code].rows,f=a.DATA[0][d.comp_code].data):$.isArray(a.DATA[0])?(g=a.HEAD.DATA_ROWS,f=a.DATA[0]):(g=a.HEAD.BPM_ROWS,f=a.DATA[0].BPM_DATA),a.total=void 0!==a.total&&null!==a.total?a.total:g,a.rows=a.rows?a.rows:f,d.originalRowsData=f}else{if("number"==typeof a.total&&"function"==typeof a.rows.splice)return d.originalRowsData=a.rows,a;"[object Array]"===Object.prototype.toString.call(a)&&(d.originalRowsData=a,a={total:a.length,rows:a,originalRowsData:a})}if(d.remotePagination&&e.pagination({onSelectPage:function(a,b){d.pageNumber=a,d.pageSize=b,e.pagination("refresh",{pageNumber:a,pageSize:b}),c.datagrid("reload",null,!0)}}),!d.remotePagination&&!d.fallParas[0].enable){e.pagination({onSelectPage:function(b,f){d.pageNumber=b,d.pageSize=f,e.pagination("refresh",{pageNumber:b,pageSize:f}),a.originalRows||(a.originalRows=a.rows);var g=(d.pageNumber-1)*parseInt(d.pageSize),h=g+parseInt(d.pageSize);a.rows=a.originalRows.slice(g,h),c.datagrid("loadData",a)},onRefresh:function(){c.datagrid("reload",null,!0)},gridMenu:d.gridMenu,exportTypes:d.exportTypes,importTypes:d.importTypes,onHideColumns:function(){onHideColumns(c[0])},onHideCols:function(){onHideCols(c[0])},onFreezeColumns:function(){onFreezeColumns(c[0])},onRestoreDefault:function(){onRestoreDefault(c[0])},onFileExport:function(a){onFileExport(c[0],a)},onFileImport:function(){onFileImport(c[0])},fallParas:d.fallParas,showPageList:d.pagerShowPageList,showRefresh:d.pagerShowRefresh,pageNavigate:d.pagerPageNavigate,isShowDetail:d.isShowDetail}),a.originalRows||(a.originalRows=a.rows);var h=(d.pageNumber-1)*parseInt(d.pageSize),i=h+parseInt(d.pageSize);a.rows=void 0!=a.originalRows?a.originalRows.slice(h,i):0}return a},finder:{getTr:function(a,b,c,d){c=c||"body",d=d||0;var e=$.data(a,"datagrid"),f=e.dc,g=e.options;if(0==d){var h=g.finder.getTr(a,b,c,1),i=g.finder.getTr(a,b,c,2);return h.add(i)}if("body"==c){var j=$("#"+e.rowIdPrefix+"-"+d+"-"+b);return j.length||(j=(1==d?f.body1:f.body2).find(">table>tbody>tr[datagrid-row-index="+b+"]")),j}return"footer"==c?(1==d?f.footer1:f.footer2).find(">table>tbody>tr[datagrid-row-index="+b+"]"):"selected"==c?(1==d?f.body1:f.body2).find(">table>tbody>tr.datagrid-row-selected"):"last"==c?(1==d?f.body1:f.body2).find(">table>tbody>tr:last[datagrid-row-index]"):"allbody"==c?(1==d?f.body1:f.body2).find(">table>tbody>tr[datagrid-row-index]"):"allfooter"==c?(1==d?f.footer1:f.footer2).find(">table>tbody>tr[datagrid-row-index]"):void 0},getRow:function(a,b){return $.data(a,"datagrid").data.rows[b]}},toolbarHandler:{dft:{editHandler:function(a){a.data.callback(a)},clbHandler:function(a){a.data.callback(a)}},add:{editHandler:function(a){var b=$.data(a.data.target[0],"datagrid").insertedRows;0==b.length&&a.data.target.datagrid("appendRow",{})},clbHandler:function(a){a.data.callback(a)}},edit:{editHandler:function(a){a.data.callback(a)},clbHandler:function(a){a.data.callback(a)}},remove:{editHandler:function(a){var b=$.data(a.data.target[0],"datagrid").options;a.data.target.datagrid("destroyEditor",b.editing);var c=a.data.target.datagrid("getSelected"),d=a.data.target.datagrid("getRowIndex",c),e=b.finder.getTr(a.data.target[0],d);e.addClass("datagrid-row-del"),$.data(a.data.target[0],"datagrid").deletedRows.push(c)},clbHandler:function(a){a.data.callback(a)}},save:{editHandler:function(e){function parseInput(a){var b=$.extend({},a[0]);if(b)for(var c in b){var d=e.data.target.datagrid("getColumnOption",c);if(d)if("timespinner"==d.type){var f=b[c];f&&-1!=f.indexOf(":")&&(b[c]=f.replace(":","")+"00")}else if("combobox"==d.type&&d.editor.options.multiple){var f=b[c];"[object Array]"===Object.prototype.toString.apply(f)&&(b[c]=f.join("")),f&&-1!=f.indexOf(",")&&(b[c]=f.replace(",",""))}}return b}var $data=$.data(e.data.target[0],"datagrid"),opts=$data.options,cols=opts.columns,edit=!1,opType="";if(e.data.target.datagrid("validateRow",opts.editing)&&(e.data.target.datagrid("endEdit",opts.editing),edit=!0),edit){var primary=new Array;if(cols&&cols.length>0)for(var i=cols[0].length-1;i>=0;i--)"1"==cols[0][i].primary_key&&primary.push(cols[0][i].field);for(var inserted=$data.insertedRows,deleted=$data.deletedRows,updated=$data.updatedRows,tools=opts.toolbar,req=new Array,i=tools.length-1;i>=0;i--){var op=tools[i].iconCls?tools[i].iconCls.split("-")[1]:void 0;if(op){var baseReq="string"==typeof tools[i].req?eval("("+tools[i].req+")"):tools[i].req;switch(baseReq&&baseReq.length>0&&!baseReq[0].service&&(baseReq[0].service="P9999999"),op){case"add":if(inserted.length>0){var params=parseInput(inserted);req.push($.extend(params,baseReq[0])),opType="add"}break;case"edit":if(updated.length>0){var params=parseInput(updated);req.push($.extend(params,baseReq[0])),opType="edit"}break;case"remove":if(deleted.length>0){var params=parseInput(deleted);req.push($.extend(params,baseReq[0])),opType="remove"}}}}req.length>0&&ajaxRequest({type:opts.method,url:opts.url,dataType:opts.dataType,req:req,func:function(a){if(a&&a.length>0&&("0"===a[0].service.flag||"100"===a[0].service.flag))switch(e.data.target.datagrid("acceptChanges"),e.data.target.datagrid("reload"),opType){case"add":alert("增加成功！");break;case"edit":alert("修改成功！");break;case"remove":alert("删除成功！")}},error:function(){alert("操作失败",alert.ERROR)}})}},clbHandler:function(a){a.data.callback(a)}}},editors:{},view:view,onBeforeLoad:function(){},onLoadSuccess:function(){},onLoadError:function(){},onClickRow:function(){},onDblClickRow:function(){},onClickCell:function(){},onDblClickCell:function(){},onSortColumn:function(){},onResizeColumn:function(){},onSelect:function(){},onUnselect:function(){},onSelectAll:function(){},onUnselectAll:function(){},onCheck:function(){},onUncheck:function(){},onCheckAll:function(){},onUncheckAll:function(){},onBeforeEdit:function(){},onBeforeEditCell:function(){return!0},onAfterEdit:function(){},onCancelEdit:$.noop,onDeleteRow:function(){},onHeaderContextMenu:function(){},onRowContextMenu:function(){},onBeforeInit:$.noop,onInitSuccess:$.noop,onExpandRow:function(){},onCollapseRow:function(){}})}),define("lib/kui/treegrid",[],function(require,exports,module){function contain(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c]==b)return c;return-1}function removeObj(a,b){var c=contain(a,b);-1!=c&&a.splice(c,1)}function buildGrid(a){var b=$.data(a,"treegrid").options;if($(a).datagrid($.extend({},b,{url:null,loader:function(){return!1},onLoadSuccess:function(){},onResizeColumn:function(c,d){setRowHeight(a),b.onResizeColumn.call(a,c,d)},onSortColumn:function(c,d){if(b.sortName=c,b.sortOrder=d,b.remoteSort)request(a);else{var e=$(a).treegrid("getData");loadData(a,0,e)}b.onSortColumn.call(a,c,d)},onBeforeEdit:function(c,d){return 0==b.onBeforeEdit.call(a,d)?!1:void 0},onAfterEdit:function(c,d,e){b.onAfterEdit.call(a,d,e)},onCancelEdit:function(c,d){b.onCancelEdit.call(a,d)},onSelect:function(c){b.onSelect.call(a,find(a,c))},onUnselect:function(c){b.onUnselect.call(a,find(a,c))},onSelectAll:function(){b.onSelectAll.call(a,$.data(a,"treegrid").data)},onUnselectAll:function(){b.onUnselectAll.call(a,$.data(a,"treegrid").data)},onCheck:function(c){b.onCheck.call(a,find(a,c))},onUncheck:function(c){b.onUncheck.call(a,find(a,c))},onCheckAll:function(){b.onCheckAll.call(a,$.data(a,"treegrid").data)},onUncheckAll:function(){b.onUncheckAll.call(a,$.data(a,"treegrid").data)},onClickRow:function(b){var c=$(this).datagrid("getPanel"),d=$.data(this,"treegrid").options,e=d.idField,f=c.find("div.datagrid-body"),g=find(a,b),h=f.find("div.datagrid-cell-check input[type=checkbox]").filter("[value="+g[e]+"]");h.triggerHandler("click"),d.onClickRow.call(a,g)},onDblClickRow:function(c){b.onDblClickRow.call(a,find(a,c))},onClickCell:function(c,d){b.onClickCell.call(a,d,find(a,c))},onDblClickCell:function(c,d){b.onDblClickCell.call(a,d,find(a,c))},onRowContextMenu:function(c,d){b.onContextMenu.call(a,c,find(a,d))}})),b.pagination){var c=$(a).datagrid("getPager");c.pagination({pageNumber:b.pageNumber,pageSize:b.pageSize,pageList:b.pageList,onSelectPage:function(c,d){b.pageNumber=c,b.pageSize=d,request(a)}}),b.pageSize=c.pagination("options").pageSize}}function setRowHeight(a,b){function c(b){var c=d.finder.getTr(a,b,"body",1),e=d.finder.getTr(a,b,"body",2);c.css("height",""),e.css("height","");var f=Math.max(c.height(),e.height());c.css("height",f),e.css("height",f)}var d=$.data(a,"datagrid").options,e=$.data(a,"datagrid").dc;if(!e.body1.is(":empty")&&(!d.nowrap||d.autoRowHeight)&&void 0!=b)for(var f=getChildren(a,b),g=0;g<f.length;g++)c(f[g][d.idField]);$(a).datagrid("fixRowHeight",b)}function createRowNumber(a){var b=$.data(a,"datagrid").dc,c=$.data(a,"treegrid").options;c.rownumbers&&b.body1.find("div.datagrid-cell-rownumber").each(function(a){$(this).html(a+1)})}function bindEvent(a){var b=$.data(a,"datagrid").dc,c=b.body1.add(b.body2),d=($.data(c[0],"events")||$._data(c[0],"events")).click[0].handler;c.bind("mouseover",function(a){var b=$(a.target),c=b.closest("tr.datagrid-row");c.length&&(b.hasClass("tree-hit")&&b.addClass(b.hasClass("tree-expanded")?"tree-expanded-hover":"tree-collapsed-hover"),a.stopPropagation())}).bind("mouseout",function(a){var b=$(a.target),c=b.closest("tr.datagrid-row");c.length&&(b.hasClass("tree-hit")&&b.removeClass(b.hasClass("tree-expanded")?"tree-expanded-hover":"tree-collapsed-hover"),a.stopPropagation())}).unbind("click").bind("click",function(b){var c=$(b.target),e=c.closest("tr.datagrid-row");e.length&&(c.hasClass("tree-hit")?toggle(a,e.attr("node-id")):d(b),b.stopPropagation())})}function _643(a,b){function c(a,b){$('<tr class="treegrid-tr-tree"><td style="border:0px" colspan="'+b+'"><div></div></td></tr>').insertAfter(a)}var d=$.data(a,"treegrid").options,e=d.finder.getTr(a,b,"body",1),f=d.finder.getTr(a,b,"body",2),g=$(a).datagrid("getColumnFields",!0).length+(d.rownumbers?1:0),h=$(a).datagrid("getColumnFields",!1).length;c(e,g),c(f,h)}function loadData(a,b,c,d){var e=$.data(a,"treegrid").options,f=$.data(a,"datagrid"),g=f.dc;c=e.loadFilter.call(a,c,b),f.data=c;var h=find(a,b);if(h)var i=e.finder.getTr(a,b,"body",1),j=e.finder.getTr(a,b,"body",2),k=i.next("tr.treegrid-tr-tree").children("td").children("div"),l=j.next("tr.treegrid-tr-tree").children("td").children("div");else var k=g.body1,l=g.body2;if(d||($.data(a,"treegrid").data=[],k.empty(),l.empty()),e.view.onBeforeRender&&e.view.onBeforeRender.call(e.view,a,b,c),e.view.render.call(e.view,a,k,!0),e.view.render.call(e.view,a,l,!1),e.view.onAfterRender&&e.view.onAfterRender.call(e.view,a),e.onLoadSuccess.call(a,h,c),e.onLoadClickEvent.call(a,h,c),!b&&e.pagination){var m=$.data(a,"treegrid").total,n=$(a).datagrid("getPager");n.pagination("options").total!=m&&n.pagination({total:m})}setRowHeight(a),createRowNumber(a),$(a).treegrid("autoSizeColumn")}function request(a,b,c,d,e){var f=$.data(a,"treegrid").options,g=$(a).datagrid("getPanel").find("div.datagrid-body");c&&(f.queryParams=c);var h=$.extend({},f.queryParams);f.pagination&&$.extend(h,{page:f.pageNumber,rows:f.pageSize}),f.sortName&&$.extend(h,{sort:f.sortName,order:f.sortOrder});var i=find(a,b);if(0!=f.onBeforeLoad.call(a,i,h)){if(f.req&&f.req.length>0)for(var j=0;j<f.req.length;j++){var k=f.req[j];for(var l in h)k[l]=h[l]}var m=g.find("tr[node-id="+b+"] span.tree-folder");m.addClass("tree-loading"),$(a).treegrid("loading");var n=f.loader.call(a,f.req,function(c){m.removeClass("tree-loading"),$(a).treegrid("loaded"),loadData(a,b,c,d),e&&e()},function(){m.removeClass("tree-loading"),$(a).treegrid("loaded"),f.onLoadError.apply(a,arguments),e&&e()});0==n&&(m.removeClass("tree-loading"),$(a).treegrid("loaded"))}}function getRoot(a){var b=getRoots(a);return b.length?b[0]:null}function getRoots(a){return $.data(a,"treegrid").data}function getParent(a,b){var c=find(a,b);return c.pid?find(a,c.pid):null}function getChildren(a,b){function c(b){var f=find(a,b);if(f&&f.children)for(var g=0,h=f.children.length;h>g;g++){var i=f.children[g];e.push(i),c(i[d.idField])}}var d=$.data(a,"treegrid").options,e=($(a).datagrid("getPanel").find("div.datagrid-view2 div.datagrid-body"),[]);if(b)c(b);else for(var f=getRoots(a),g=0;g<f.length;g++)e.push(f[g]),c(f[g][d.idField]);return e}function getSelected(a){var b=getSelections(a);return b.length?b[0]:null}function getSelections(a){var b=[],c=$(a).datagrid("getPanel");return c.find("div.datagrid-view2 div.datagrid-body tr.datagrid-row-selected").each(function(){var c=$(this).attr("node-id");b.push(find(a,c))}),b}function getLevel(a,b){if(!b)return 0;var c=$.data(a,"treegrid").options,d=$(a).datagrid("getPanel").children("div.datagrid-view"),e=d.find("div.datagrid-body tr[node-id="+b+"]").children("td[field="+c.treeField+"]");return e.find("span.tree-indent,span.tree-hit").length}function find(a,b){for(var c=$.data(a,"treegrid").options,d=$.data(a,"treegrid").data,e=[d];e.length;)for(var f=e.shift(),g=0;g<f.length;g++){var h=f[g];if(h[c.idField]==b)return h;h.children&&e.push(h.children)}return null}function collapse(a,b){var c=$.data(a,"treegrid").options,d=find(a,b),e=c.finder.getTr(a,b),f=e.find("span.tree-hit");if(0!=f.length&&!f.hasClass("tree-collapsed")&&0!=c.onBeforeCollapse.call(a,d)){f.removeClass("tree-expanded tree-expanded-hover").addClass("tree-collapsed"),f.next().removeClass("tree-folder-open"),d.state="closed",e=e.next("tr.treegrid-tr-tree");var g=e.children("td").children("div");c.animate?g.slideUp("normal",function(){$(a).treegrid("autoSizeColumn"),setRowHeight(a,b),c.onCollapse.call(a,d)}):(g.hide(),$(a).treegrid("autoSizeColumn"),setRowHeight(a,b),c.onCollapse.call(a,d))}}function expand(a,b){function c(c){g.state="open",d.animate?c.slideDown("normal",function(){$(a).treegrid("autoSizeColumn"),setRowHeight(a,b),d.onExpand.call(a,g)}):(c.show(),$(a).treegrid("autoSizeColumn"),setRowHeight(a,b),d.onExpand.call(a,g))}var d=$.data(a,"treegrid").options,e=d.finder.getTr(a,b),f=e.find("span.tree-hit"),g=find(a,b);if(0!=f.length&&!f.hasClass("tree-expanded")&&0!=d.onBeforeExpand.call(a,g)){f.removeClass("tree-collapsed tree-collapsed-hover").addClass("tree-expanded"),f.next().addClass("tree-folder-open");var h=e.next("tr.treegrid-tr-tree");if(h.length){var i=h.children("td").children("div");c(i)}else{_643(a,g[d.idField]);var h=e.next("tr.treegrid-tr-tree"),i=h.children("td").children("div");i.hide(),request(a,g[d.idField],{id:g[d.idField]},!0,function(){i.is(":empty")?h.remove():c(i)})}}}function toggle(a,b){var c=$.data(a,"treegrid").options,d=c.finder.getTr(a,b),e=d.find("span.tree-hit");e.hasClass("tree-expanded")?collapse(a,b):expand(a,b)}function collapseAll(a,b){var c=$.data(a,"treegrid").options,d=getChildren(a,b);b&&d.unshift(find(a,b));for(var e=0;e<d.length;e++)collapse(a,d[e][c.idField])}function expandAll(a,b){var c=$.data(a,"treegrid").options,d=getChildren(a,b);b&&d.unshift(find(a,b));for(var e=0;e<d.length;e++)expand(a,d[e][c.idField])}function expandTo(a,b){for(var c=$.data(a,"treegrid").options,d=[],e=getParent(a,b);e;){var f=e[c.idField];d.unshift(f),e=getParent(a,f)}for(var g=0;g<d.length;g++)expand(a,d[g])}function append(a,b){var c=$.data(a,"treegrid").options;if(b.parent){var d=$(a).datagrid("getPanel").find("div.datagrid-body"),e=d.find("tr[node-id="+b.parent+"]");0==e.next("tr.treegrid-tr-tree").length&&_643(a,b.parent);var f=e.children("td[field="+c.treeField+"]").children("div.datagrid-cell"),g=f.children("span.tree-icon");if(g.hasClass("tree-file")){g.removeClass("tree-file").addClass("tree-folder");var h=$('<span class="tree-hit tree-expanded"></span>').insertBefore(g);h.prev().length&&h.prev().remove()}}loadData(a,b.parent,b.data,!0)}function remove(a,b){function c(c){var e,f=getParent(a,b);e=f?f.children:$(a).treegrid("getData");for(var g=0;g<e.length;g++)if(e[g][d.idField]==c){e.splice(g,1);break}return f}var d=$.data(a,"treegrid").options,e=d.finder.getTr(a,b);e.next("tr.treegrid-tr-tree").remove(),e.remove();var f=c(b);if(f&&0==f.children.length){e=d.finder.getTr(a,f[d.idField]),e.next("tr.treegrid-tr-tree").remove();var g=e.children("td[field="+d.treeField+"]").children("div.datagrid-cell");g.find(".tree-icon").removeClass("tree-folder").addClass("tree-file"),g.find(".tree-hit").remove(),$('<span class="tree-indent"></span>').prependTo(g)}createRowNumber(a)}function getEdtDictText(col,fieldValue,row){if(fieldValue&&("@"==fieldValue||"@"==fieldValue[0])&&1==col.editor.options.atIsAll)return"全部";var orgCode=col.editor.options.dictOrg?row[col.editor.options.dictOrg]:"",dictData=col.editor.options.data;if(col.editor.options.extItems){var extItems=$.isArray(col.editor.options.extItems)?col.editor.options.extItems:eval("("+col.editor.options.extItems+")");dictData=extItems.concat(dictData)}if(fieldValue=$.trim(fieldValue),fieldValue=gridDataValueReplaceReverse(fieldValue),!dictData)return fieldValue;var dictValue=[],valueField="combotree"==col.editor.type?col.editor.options.nodeId:col.editor.options.valueField,textField="combotree"==col.editor.type?col.editor.options.nodeName:col.editor.options.textField;if(null!=fieldValue&&void 0!=fieldValue&&""!=fieldValue){var sep=",";(col.singleByte||col.editor&&col.editor.options.singleByte)&&(sep="");var dictText=fieldValue.split(sep);dictText=$.grep(dictText,function(a){return" "!=a?!0:void 0});for(var m=0;m<dictText.length;m++){var index=-1;if($.each(dictData,function(a,b){return col.editor&&col.editor.options&&col.editor.options.conf&&"number"===col.editor.options.conf.nodeDataType&&(b[valueField]=Number(b[valueField]).toString()),$.trim(b[valueField])!=dictText[m]||orgCode&&orgCode!=b.dict_org?void 0:void(index=a)}),-1==index)dictValue.push(dictText[m]);else{var text="";if(-1!=textField.indexOf(",")){var textSplit=textField.split(",");text=dictData[index][textSplit[0]]+"-"+dictData[index][textSplit[1]]}else text=dictData[index][textField];dictValue.push(text)}}}return 1==dictValue.length?dictValue[0]:dictValue}function gridDataValueReplaceReverse(a){return"string"!=typeof a?a:(a=a.replace(/&lt;/g,"<"),a=a.replace(/&gt;/g,">"))}$.fn.treegrid=function(a,b,c){if("string"==typeof a){var d=[this],e=$.fn.treegrid.methods[a];return e?e.apply(this,d.concat(Array.prototype.slice.call(arguments,1))):this.datagrid(a,b,c)}return a=a||{},this.each(function(){var b=$.data(this,"treegrid");b?$.extend(b.options,a):$.data(this,"treegrid",{options:$.extend({},$.fn.treegrid.defaults,$.fn.treegrid.parseOptions(this),a),data:[]}),buildGrid(this),request(this),bindEvent(this)})},$.fn.treegrid.methods={options:function(a){return $.data(a[0],"treegrid").options},resize:function(a,b){return a.each(function(){$(this).datagrid("resize",b)})},fixRowHeight:function(a,b){return a.each(function(){setRowHeight(this,b)})},loadData:function(a,b){return a.each(function(){loadData(this,null,b)})},reload:function(a,b,c,d){return a.each(function(){if(b){var a=$(this).treegrid("find",b);
a.children&&a.children.splice(0,a.children.length);var e=$(this).datagrid("getPanel").find("div.datagrid-body"),f=e.find("tr[node-id="+b+"]");f.next("tr.treegrid-tr-tree").remove();var g=f.find("span.tree-hit");g.removeClass("tree-expanded tree-expanded-hover").addClass("tree-collapsed"),expand(this,b)}else request(this,null,c||{},null,d)})},reloadFooter:function(a){return a.each(function(){})},loading:function(a){return a.each(function(){$(this).datagrid("loading")})},loaded:function(a){return a.each(function(){$(this).datagrid("loaded")})},getData:function(a){return $.data(a[0],"treegrid").data},getRoot:function(a){return getRoot(a[0])},getRoots:function(a){return getRoots(a[0])},getParent:function(a,b){return getParent(a[0],b)},getChildren:function(a,b){return getChildren(a[0],b)},getSelected:function(a){return getSelected(a[0])},getSelections:function(a){return getSelections(a[0])},getLevel:function(a,b){return getLevel(a[0],b)},find:function(a,b){return find(a[0],b)},isLeaf:function(a,b){var c=$.data(a[0],"treegrid").options,d=c.finder.getTr(a[0],b),e=d.find("span.tree-hit");return 0==e.length},select:function(a,b){return a.each(function(){$(this).datagrid("selectRow",b)})},unselect:function(a,b){return a.each(function(){$(this).datagrid("unselectRow",b)})},collapse:function(a,b){return a.each(function(){collapse(this,b)})},expand:function(a,b){return a.each(function(){expand(this,b)})},toggle:function(a,b){return a.each(function(){toggle(this,b)})},collapseAll:function(a,b){return a.each(function(){collapseAll(this,b)})},expandAll:function(a,b){return a.each(function(){expandAll(this,b)})},expandTo:function(a,b){return a.each(function(){expandTo(this,b)})},append:function(a,b){return a.each(function(){append(this,b)})},remove:function(a,b){return a.each(function(){remove(this,b)})},refresh:function(a,b){return a.each(function(){var a=$.data(this,"treegrid").options;a.view.refreshRow.call(a.view,this,b)})},beginEdit:function(a,b){return a.each(function(){$(this).datagrid("beginEdit",b),$(this).treegrid("fixRowHeight",b)})},endEdit:function(a,b){return a.each(function(){$(this).datagrid("endEdit",b)})},cancelEdit:function(a,b){return a.each(function(){$(this).datagrid("destroyEditor",b)})}},$.fn.treegrid.parseOptions=function(a){return $.extend({},$.fn.datagrid.parseOptions(a),$.parser.parseOptions(a,["treeField",{animate:"boolean"}]))};var view=$.extend({},$.fn.datagrid.defaults.view,{render:function(a,b,c){function d(b,c,i){for(var j=['<table class="datagrid-btable" cellspacing="0" cellpadding="0" border="0"><tbody>'],k=0;k<i.length;k++){var l=i[k];e.collapseAll&&l.children&&l.children.length&&(l.state="closed"),"open"!=l.state&&"closed"!=l.state&&(l.state="open");var m=e.rowStyler?e.rowStyler.call(a,l):"",n=m?'style="'+m+'"':"",o=g+"-"+(b?1:2)+"-"+l[e.idField];if(j.push('<tr id="'+o+'" class="datagrid-row" node-id='+l[e.idField]+" "+n+">"),j=j.concat(h.renderRow.call(h,a,f,b,c,l)),j.push("</tr>"),l.children&&l.children.length){var p=d(b,c+1,l.children),q="closed"==l.state?"none":"block";j.push('<tr class="treegrid-tr-tree"><td style="border:0px" colspan='+(f.length+(e.rownumbers?1:0))+'><div style="display:'+q+'">'),j=j.concat(p),j.push("</div></td></tr>")}}return j.push("</tbody></table>"),j}var e=$.data(a,"treegrid").options,f=$(a).datagrid("getColumnFields",c),g=$.data(a,"datagrid").rowIdPrefix;if(!c||e.rownumbers||e.frozenColumns&&e.frozenColumns.length){var h=this,i=d(c,this.treeLevel,this.treeNodes);$(b).append(i.join(""))}},renderRow:function(target,fields,_6b0,_6b1,row){var opts=$.data(target,"treegrid").options,cc=[],index=_6b1;_6b0&&opts.rownumbers&&cc.push('<td class="datagrid-td-rownumber"><div class="datagrid-cell-rownumber">0</div></td>');for(var i=0;i<fields.length;i++){var field=fields[i],col=$(target).datagrid("getColumnOption",field);if(col){var styler=col.styler?col.styler(row[field],row)||"":"",hidden=col.hidden?'style="display:none;'+styler+'"':styler?'style="'+styler+'"':"";if(cc.push('<td field="'+field+'" '+hidden+">"),col.checkbox)var hidden="";else{var hidden="";hidden+="text-align:"+(col.align||"left")+";",opts.nowrap?opts.autoRowHeight&&(hidden+="height:auto;"):hidden+="white-space:normal;height:auto;"}if(cc.push('<div style="'+hidden+'" '),cc.push(col.checkbox?'class="datagrid-cell-check ':'class="datagrid-cell '+col.cellClass),col.checkbox)cc.push('">'),cc.push(row.checked?'<input type="checkbox" checked="checked"':'<input type="checkbox"'),cc.push(' name="'+field+'" value="'+(void 0!=row[field]?row[field]:"")+'"/>');else{var val=null,fFormatter=$.data(target,"formatter");if("string"==typeof col.formatter?(fFormatter&&fFormatter[col.formatter]?formatter=fFormatter[col.formatter]:contextObj&&contextObj[col.formatter]?formatter=contextObj[col.formatter]:eval("formatter="+col.formatter),val=formatter(row[field],row,index,col)):col.formatter?val=col.formatter(row[field],row,null,col):col.editor&&col.editor.options&&col.editor.options.data?(col.editor.options.valueField=col.editor.options.valueField||"dict_val",col.editor.options.textField=col.editor.options.textField||"dict_des",val=getEdtDictText(col,row[field])):col.editor&&col.editor.options&&col.editor.options.dict?(col.editor.options.valueField="dict_val",col.editor.options.textField="dict_des",val=getEdtDictText(col,row[field])):val="numberbox"==col.type?kui.formatNumber(row[field]):row[field]||"",field==opts.treeField){cc.push('">');for(var j=0;_6b1>j;j++)cc.push('<span class="tree-indent"></span>');"closed"==row.state?(cc.push('<span class="tree-hit tree-collapsed"></span>'),cc.push('<span class="tree-icon tree-folder '+(row.iconCls?row.iconCls:"")+'"></span>')):row.children&&row.children.length?(cc.push('<span class="tree-hit tree-expanded"></span>'),cc.push('<span class="tree-icon tree-folder tree-folder-open '+(row.iconCls?row.iconCls:"")+'"></span>')):(cc.push('<span class="tree-indent"></span>'),cc.push('<span class="tree-icon tree-file '+(row.iconCls?row.iconCls:"")+'"></span>')),cc.push('<span class="tree-title" title="'+val+'">'+val+"</span>")}else{try{cc.push($(val).length?'">':'" title="'+val+'">')}catch(ex){cc.push('">')}cc.push(val)}}cc.push("</div>"),cc.push("</td>")}}return cc.join("")},refreshRow:function(a,b){var c=$(a).treegrid("find",b),d=$.data(a,"treegrid").options,e=d.rowStyler?d.rowStyler.call(a,c):"",f=e?e:"",g=d.finder.getTr(a,b);g.attr("style",f),g.children("td").each(function(){var b=$(this).find("div.datagrid-cell"),e=$(this).attr("field"),f=$(a).datagrid("getColumnOption",e);if(f){var g=f.styler?f.styler(c[e],c)||"":"",h=f.hidden?"display:none;"+g:g?g:"";$(this).attr("style",h);var i=null;if(i=f.formatter?f.formatter(c[e],c):c[e],e==d.treeField){b.children("span.tree-title").html(i);var j="tree-icon",k=b.children("span.tree-icon");k.hasClass("tree-folder")&&(j+=" tree-folder"),k.hasClass("tree-folder-open")&&(j+=" tree-folder-open"),k.hasClass("tree-file")&&(j+=" tree-file"),c.iconCls&&(j+=" "+c.iconCls),k.attr("class",j)}else b.html(i)}}),$(a).treegrid("fixRowHeight",b)},onBeforeRender:function(a,b,c){function d(a,b){for(var c=0;c<a.length;c++){var f=a[c];f.pid=b,f.children&&f.children.length&&d(f.children,f[e.idField])}}if(!c)return!1;var e=$.data(a,"treegrid").options;void 0==c.length?(c.total&&($.data(a,"treegrid").total=c.total),c=this.transfer(a,b,c.rows)):d(c,b);var f=find(a,b);f?f.children=f.children?f.children.concat(c):c:$.data(a,"treegrid").data=$.data(a,"treegrid").data.concat(c),e.remoteSort||this.sort(a,c),this.treeNodes=c,this.treeLevel=$(a).treegrid("getLevel",b)},sort:function(a,b){function c(a){a.sort(function(a,b){return f(a[d.sortName],b[d.sortName])*("asc"==d.sortOrder?1:-1)});for(var b=0;b<a.length;b++){var e=a[b].children;e&&e.length&&c(e)}}var d=$.data(a,"treegrid").options,e=$(a).treegrid("getColumnOption",d.sortName);if(e){var f=e.sorter||function(a,b){return a>b?1:-1};c(b)}},transfer:function(a,b,c){for(var d=$.data(a,"treegrid").options,e=[],f=0;f<c.length;f++)e.push(c[f]);for(var g=[],f=0;f<e.length;f++){var h=e[f];b?h.pid==b&&(g.push(h),removeObj(e,h),f--):h.pid||(g.push(h),removeObj(e,h),f--)}for(var i=[],f=0;f<g.length;f++)i.push(g[f]);for(;i.length;)for(var j=i.shift(),f=0;f<e.length;f++){var h=e[f];h.pid==j[d.idField]&&(j.children?j.children.push(h):j.children=[h],i.push(h),removeObj(e,h),f--)}return g}});$.fn.treegrid.defaults=$.extend({},$.fn.datagrid.defaults,{collapseAll:!0,treeField:null,animate:!1,singleSelect:!0,view:view,isTreeGrid:!0,pagination:!1,deepCascadeCheck:!1,cascadeCheck:!1,loader:function(a,b,c){var d=$(this).treegrid("options");return d.req||d.url?void ajaxRequest({type:d.method,url:d.url,req:a,func:function(a){b(a)},error:function(){c.apply(this,arguments)}}):(alert("请为datagrid指定一个请求方式,定义req或url"),!1)},loadFilter:function(a){return"number"==typeof a.length&&"function"==typeof a.splice?{total:a[0].length,rows:a[0]}:"number"==typeof a.total&&"function"==typeof a.rows.splice?a:void 0},finder:{getTr:function(a,b,c,d){c=c||"body",d=d||0;var e=$.data(a,"datagrid").dc;if(0==d){var f=$.data(a,"treegrid").options,g=f.finder.getTr(a,b,c,1),h=f.finder.getTr(a,b,c,2);return g.add(h)}if("body"==c){var i=$("#"+$.data(a,"datagrid").rowIdPrefix+"-"+d+"-"+b);return i.length||(i=(1==d?e.body1:e.body2).find("tr[node-id="+b+"]")),i}return"footer"==c?(1==d?e.footer1:e.footer2).find("tr[node-id="+b+"]"):"selected"==c?(1==d?e.body1:e.body2).find("tr.datagrid-row-selected"):"last"==c?(1==d?e.body1:e.body2).find("tr:last[node-id]"):"allbody"==c?(1==d?e.body1:e.body2).find("tr[node-id]"):"allfooter"==c?(1==d?e.footer1:e.footer2).find("tr[node-id]"):void 0},getRow:function(a,b){return $(a).treegrid("find",b)}},onBeforeLoad:function(){},onLoadSuccess:function(){},onLoadClickEvent:function(){var a=$(this),b=$(this).datagrid("getPanel"),c=$.data(this,"treegrid").options,d=c.idField,e=b.find("div.datagrid-body");e.find("div.datagrid-cell-check input[type=checkbox]").unbind(".treegrid").click(function(b){function f(a,b,d,e){var h=a.treegrid("getParent",b);if(h){var i=h[d],j=g(a,i);if(e||j)a.treegrid("select",i);else{var k=a.treegrid("find",b),l=!0;c.curRowCascadeCheck&&(l=c.curRowCascadeCheck(k)),l&&a.treegrid("unselect",i)}f(a,i,d,e)}}function g(a,b){var c,d,f,g,h=a.treegrid("getChildren",b);return h.length?(c=e.find("div.datagrid-cell-check input[type=checkbox][value='"+b+"']"),d=c.closest("tr.datagrid-row"),f=d.next(),g=f.find("div.datagrid-cell-check input[type=checkbox]").filter(function(){return $(this).prop("checked")}),!!g.length):!1}function h(a,b,c,d,e){for(var f=a.treegrid("getChildren",b),g=0;g<f.length;g++){var h=f[g][c];e?a.treegrid("select",h):a.treegrid("unselect",h)}}if(!c.singleSelect){if(c.cascadeCheck||c.deepCascadeCheck){var i=$(this).parent().parent().parent().attr("node-id"),j=!1;$(this).attr("checked")&&(j=!0),j?a.treegrid("select",i):a.treegrid("unselect",i),h(a,i,d,c.deepCascadeCheck,j),f(a,i,d,j)}b.stopPropagation()}})},onLoadError:function(){},onBeforeCollapse:function(){},onCollapse:function(){},onBeforeExpand:function(){},onExpand:function(){},onClickRow:function(){},onDblClickRow:function(){},onClickCell:function(){},onDblClickCell:function(){},onContextMenu:function(){},onBeforeEdit:function(){},onAfterEdit:function(){},onCancelEdit:function(){}})}),define("lib/kui/propertygrid",[],function(){function a(a){var f=($.data(a,"propertygrid"),$.data(a,"propertygrid").options);$(a).datagrid($.extend({},f,{cls:"propertygrid",view:f.showGroup?e:void 0,onClickRow:function(c,e){if(d!=this&&(b(d),d=this),f.editIndex!=c&&e.editor){var g=$(this).datagrid("getColumnOption","value");g.editor=e.editor,b(d),"undefined"==typeof f.editIndex&&(f.editIndex=c,f.onClickRow.call(a,c,e))}},loadFilter:function(a){return b(this),f.loadFilter.call(this,a)},onResize:function(){c(a),$.isFunction(f.onResize)&&f.onResize.apply(this,arguments)},onLoadSuccess:function(b){c(a),f.onLoadSuccess.call(a,b)}})),$(document).unbind(".propertygrid").bind("mousedown.propertygrid",function(a){var c=$(a.target).closest("div.datagrid-view,div.combo-panel");c.length||(b(d),d=void 0)})}function b(a){var b=$(a);if(b.length){var c=$.data(a,"propertygrid").options,d=c.editIndex;void 0!=d&&(b.datagrid("validateRow",d)&&(b.datagrid("endEdit",d),d=void 0),c.editIndex=d)}}function c(a){$(a).datagrid("getPanel").find("div.datagrid-view2").find("div.datagrid-group").each(function(){var a=$(this);a.width(a.next().outerWidth())})}var d;$.fn.propertygrid=function(b,c){if("string"==typeof b){var d=$.fn.propertygrid.methods[b];return d?d(this,c):this.datagrid(b,c)}return b=b||{},this.each(function(){var c=$.data(this,"propertygrid");if(c)$.extend(c.options,b);else{var d=$.extend({},$.fn.propertygrid.defaults,$.fn.propertygrid.parseOptions(this),b);d.frozenColumns=$.extend(!0,[],d.frozenColumns),d.columns=$.extend(!0,[],d.columns),$.data(this,"propertygrid",{options:d})}a(this)})},$.fn.propertygrid.methods={options:function(a){return $.data(a[0],"propertygrid").options}},$.fn.propertygrid.parseOptions=function(a){$(a);return $.extend({},$.fn.datagrid.parseOptions(a),$.parser.parseOptions(a,[{showGroup:"boolean"}]))};var e=$.extend({},$.fn.datagrid.defaults.view,{render:function(a,b,c){for(var d=$.data(a,"datagrid"),e=d.options,f=(d.data.rows,$(a).datagrid("getColumnFields",c)),g=[],h=0,i=this.groups,j=0;j<i.length;j++){var k=i[j];g.push('<div class="datagrid-group" group-index='+j+' style="height:25px;overflow:hidden;border-bottom:1px solid #ccc;">'),g.push('<table cellspacing="0" cellpadding="0" border="0" style="height:100%"><tbody>'),g.push("<tr>"),g.push('<td style="border:0;">'),c||(g.push('<span style="color:#666;font-weight:bold;">'),g.push(e.groupFormatter.call(a,k.fvalue,k.rows)),g.push("</span>")),g.push("</td>"),g.push("</tr>"),g.push("</tbody></table>"),g.push("</div>"),g.push('<table class="datagrid-btable" cellspacing="0" cellpadding="0" border="0"><tbody>');for(var l=0;l<k.rows.length;l++){var m=h%2&&e.striped?'class="datagrid-row datagrid-row-alt"':'class="datagrid-row"',n=e.rowStyler?e.rowStyler.call(a,h,k.rows[l]):"",o=n?'style="'+n+'"':"",p=d.rowIdPrefix+"-"+(c?1:2)+"-"+h;g.push('<tr id="'+p+'" datagrid-row-index="'+h+'" '+m+" "+o+">"),g.push(this.renderRow.call(this,a,f,c,h,k.rows[l])),g.push("</tr>"),h++}g.push("</tbody></table>")}$(b).html(g.join(""))},onAfterRender:function(a){var b=$.data(a,"datagrid").options,c=$.data(a,"datagrid").dc,d=c.view,e=c.view1,f=c.view2;if($.fn.datagrid.defaults.view.onAfterRender.call(this,a),b.rownumbers||b.frozenColumns.length)var g=e.find("div.datagrid-group");else var g=f.find("div.datagrid-group");$('<td style="border:0;text-align:center;width:25px"><span class="datagrid-row-expander datagrid-row-collapse" style="display:inline-block;width:16px;height:16px;cursor:pointer">&nbsp;</span></td>').insertBefore(g.find("td")),d.find("div.datagrid-group").each(function(){var b=$(this).attr("group-index");$(this).find("span.datagrid-row-expander").bind("click",{groupIndex:b},function(b){$(this).hasClass("datagrid-row-collapse")?$(a).datagrid("collapseGroup",b.data.groupIndex):$(a).datagrid("expandGroup",b.data.groupIndex)})})},onBeforeRender:function(a,b){function c(a){for(var b=0;b<e.length;b++){var c=e[b];if(c.fvalue==a)return c}return null}for(var d=$.data(a,"datagrid").options,e=[],f=0;f<b.length;f++){var g=b[f],h=c(g[d.groupField]);h?h.rows.push(g):(h={fvalue:g[d.groupField],rows:[g],startRow:f},e.push(h))}this.groups=e;for(var i=[],f=0;f<e.length;f++)for(var h=e[f],j=0;j<h.rows.length;j++)i.push(h.rows[j]);$.data(a,"datagrid").data.rows=i}});$.extend($.fn.datagrid.methods,{expandGroup:function(a,b){return a.each(function(){var a=$.data(this,"datagrid").dc.view;if(void 0!=b)var c=a.find('div.datagrid-group[group-index="'+b+'"]');else var c=a.find("div.datagrid-group");var d=c.find("span.datagrid-row-expander");d.hasClass("datagrid-row-expand")&&(d.removeClass("datagrid-row-expand").addClass("datagrid-row-collapse"),c.next("table").show()),$(this).datagrid("fixRowHeight")})},collapseGroup:function(a,b){return a.each(function(){var a=$.data(this,"datagrid").dc.view;if(void 0!=b)var c=a.find('div.datagrid-group[group-index="'+b+'"]');else var c=a.find("div.datagrid-group");var d=c.find("span.datagrid-row-expander");d.hasClass("datagrid-row-collapse")&&(d.removeClass("datagrid-row-collapse").addClass("datagrid-row-expand"),c.next("table").hide()),$(this).datagrid("fixRowHeight")})}}),$.fn.propertygrid.defaults=$.extend({},$.fn.datagrid.defaults,{singleSelect:!0,remoteSort:!1,fitColumns:!0,loadMsg:"",frozenColumns:[[{field:"f",width:16,resizable:!1}]],columns:[[{field:"name",title:"Name",width:100,sortable:!0},{field:"value",title:"Value",width:100,resizable:!1}]],showGroup:!1,groupField:"group",groupFormatter:function(a){return a}})}),define("lib/kui/combogrid",[],function(){function a(a){var b=$.data(a,"combo").panel,c=b.parent().find(".combo-selectAll");c.find("span:eq(0)").unbind("click").bind("click",function(){$(a).combotree("selectAll")}),c.find("span:eq(1)").unbind("click").bind("click",function(){$(a).combotree("unSelectAll")})}function b(a){function b(b){var c=$.data(b,"combogrid").options;return c.fallParas[0].enable?!1:void $(a).combogrid("setValues",$(a).combo("getValues"))}function c(b,c){$.data(a,"combogrid").remainText=!1,e(),g.multiple||$(a).combo("hidePanel"),g.onClickRow.call(this,b,c)}function e(){for(var b=$.data(a,"combogrid").remainText,c=$.data(a,"combogrid").grid,d=c.datagrid("getSelections"),e=[],h=[],i=0;i<d.length;i++)e.push(d[i][g.idField]),h.push(f(g,d[i]));g.multiple?$(a).combo("setValues",e):$(a).combo("setValues",e.length?e:[""]),b||$(a).combo("setText",h.join(g.separator))}var g=$.data(a,"combogrid").options,h=$.data(a,"combogrid").grid;$(a).addClass("combogrid-f"),$(a).combo(g);var i=$(a).combo("panel");h||(h=$("<table></table>").appendTo(i),$.data(a,"combogrid").grid=h),$(a).combo($.extend({},g,{onClear:function(){$(this).combogrid("grid").datagrid("clearSelections"),g.onClear.call(a)}})),h.datagrid($.extend({},g,{required:!1,border:!1,fit:!0,singleSelect:!g.multiple,onLoadSuccess:function(){var b=$.data(a,"combogrid").remainText,c=$(a).combo("getValues");d(a,c,b),g.onLoadSuccess.apply(a,arguments)},onClickRow:c,onSelect:function(a,b){e(),g.onSelect.call(this,a,b)},onUnselect:function(a,b){e(),g.onUnselect.call(this,a,b)},onSelectAll:function(a){e(),g.onSelectAll.call(this,a)},onUnselectAll:function(a){g.multiple&&e(),g.onUnselectAll.call(this,a)},onLoadSuccess:function(){g.onLoadSuccess&&g.onLoadSuccess(),b(a)}}))}function c(a,b){var c=$.data(a,"combogrid").options,d=$.data(a,"combogrid").grid,e=d.datagrid("getRows").length;$.data(a,"combogrid").remainText=!1;var f,g=d.datagrid("getSelections");g.length?(f=d.datagrid("getRowIndex",g[g.length-1][c.idField]),f+=b,0>f&&(f=0),f>=e&&(f=e-1)):f=b>0?0:0>b?e-1:-1,f>=0&&(d.datagrid("clearSelections"),d.datagrid("selectRow",f))}function d(a,b,c){for(var d=$.data(a,"combogrid").options,e=$.data(a,"combogrid").grid,g=e.datagrid("options"),h=e.datagrid("getRows"),i=[],j=0;j<b.length;j++){var k=e.datagrid("getRowIndex",b[j]);if(k>=0)e.datagrid("selectRow",k),i.push(f(d,h[k]));else{var l=g.data,m=g.textField.split(",");if(m&&l){for(var n=0,o=l.length;o>n;n++)if(l[n][g.idField]===b[j]||l[n][g.valueField]===b[j]){i.push(f(g,l[n]));break}}else i.push(b[j])}}$(a).combo("getValues").join(",")!=b.join(",")&&($(a).combo("setValues",b),c||$(a).combo("setText",i.join(d.separator)))}function e(a,b){var c=$.data(a,"combogrid").options,e=$.data(a,"combogrid").grid;if($.data(a,"combogrid").remainText=!0,c.multiple&&!b?d(a,[],!0):d(a,[b],!0),"remote"==c.mode)e.datagrid("clearSelections"),e.datagrid("load",{q:b});else{if(!b)return;for(var f=e.datagrid("getRows"),g=0;g<f.length;g++)if(c.filter.call(a,b,f[g]))return e.datagrid("clearSelections"),void e.datagrid("selectRow",g)}}function f(a,b){var c="",d=a.textField.split(",");return c=d.length>1?b[d[0]]+"-"+b[d[1]]:b[a.textField]}$.fn.combogrid=function(c,d){if("string"==typeof c){var e=$.fn.combogrid.methods[c];return e?e(this,d):$.fn.combo.methods[c](this,d)}return c=c||{},this.each(function(){var d=$.data(this,"combogrid");d?$.extend(d.options,c):d=$.data(this,"combogrid",{options:$.extend({},$.fn.combogrid.defaults,$.fn.combogrid.parseOptions(this),c)}),b(this),a(this)})},$.fn.combogrid.methods={options:function(a){return $.data(a[0],"combogrid").options},grid:function(a){return $.data(a[0],"combogrid").grid},setValues:function(a,b){return a.each(function(){d(this,b)})},setValue:function(a,b){return a.each(function(){d(this,[b])})},clear:function(a){return a.each(function(){$(this).combogrid("grid").datagrid("clearSelections"),$(this).combo("clear")})},selectAll:function(a){var b,c,d,e=a[0],f=$.data(e,"combogrid").options,g=$.data(e,"combogrid").grid,h=$.data(e,"combo").panel,i=(h.parent().find(".combo-selectAll"),[]),j=[],k=$(".datagrid-cell-check",h).find("input");if($(".datagrid-header-check",h).find("input").attr("checked","true"),k.attr("checked","true"),$(".datagrid-body",h).find("tr").addClass("datagrid-row-selected"),b=g.datagrid("getRows"),b.length>0)for(var l=0;l<b.length;l++){var m=g.datagrid("getRowIndex",b[l][f.idField]);g.datagrid("selectRow",m,!1,!1)}c=g.datagrid("getSelections"),d={};for(var l=0;l<c.length;l++)i.push(c[l][f.idField]),j.push(c[l][f.textField]);$(e).combo("setValues",i),$(e).combo("setText",j),f.onSelectAll(c)},unSelectAll:function(a){var b,c,d=a[0],e=$.data(d,"combogrid").options,f=$.data(d,"combogrid").grid,g=$.data(d,"combo").panel,h=[],i=[],j={};if($(".datagrid-cell-check",g).find("input").each(function(){var a=$(this).parent().parent().parent();$(this).attr("checked")?a.removeClass("datagrid-row-alt").removeClass("datagrid-row-selected"):a.addClass("datagrid-row-alt").addClass("datagrid-row-selected");var b=a.attr("datagrid-row-index");this.checked?f.datagrid("unselectRow",b):f.datagrid("selectRow",b,!1,!1)}),b=f.datagrid("getSelectRows"),b.length>0)for(var k=0;k<b.length;k++){var l=f.datagrid("getRowIndex",b[k][e.idField]);f.datagrid("selectRow",l,!1,!1)}else $(".datagrid-header-check",g).find("input").removeAttr("checked");c=f.datagrid("getSelections");for(var k=0;k<c.length;k++)h.push(c[k][e.idField]),i.push(c[k][e.textField]),j[c[k][e.idField]]=c[k][e.textField];e.multiple?$(d).combo("setValues",h):$(d).combo("setValues",h.length?h:[""]),$(d).combo("setText",i.join(e.separator)),e.onUnselectAll(c)}},$.fn.combogrid.parseOptions=function(a){var b=$(a);return $.extend({},$.fn.combo.parseOptions(a),$.fn.datagrid.parseOptions(a),{idField:b.attr("idField")||void 0,textField:b.attr("textField")||void 0,mode:b.attr("mode")})},$.fn.combogrid.defaults=$.extend({},$.fn.combo.defaults,$.fn.datagrid.defaults,{isShowSelectPanel:!1,loadMsg:null,idField:null,textField:null,mode:"local",keyHandler:{up:function(){c(this,-1)},down:function(){c(this,1)},enter:function(){c(this,0),$(this).combo("hidePanel")},query:function(a){e(this,a)}},filter:function(a,b){var c=$(this).combogrid("options");return 0==b[c.textField].indexOf(a)},onShowPanel:function(){var a=($(this).combogrid("options"),$.data(this,"combo").panel),b=$(this).combogrid("grid"),c=a.find(".datagrid-queryForm form");c.length&&c.form("clear"),b.length>0&&!$(this).data("grid-reload")&&(b.datagrid("reload"),$(this).data("grid-reload","1"))}})});